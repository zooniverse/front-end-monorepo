"use strict";(self.webpackChunk_zooniverse_classifier=self.webpackChunk_zooniverse_classifier||[]).push([[8509],{"./src/components/Classifier/components/SubjectViewer/components/MultiFrameViewer/MultiFrameViewerContainer.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MultiFrameViewer_MultiFrameViewerContainer});var async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),react=__webpack_require__("../../node_modules/react/index.js"),helpers=__webpack_require__("./src/helpers/index.js"),locationValidator=__webpack_require__("./src/components/Classifier/components/SubjectViewer/helpers/locationValidator/index.js"),SingleImageViewer=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/SingleImageViewer/index.js"),Button=__webpack_require__("../../node_modules/grommet/es6/components/Button/Button.js"),FormUp=__webpack_require__("../../node_modules/grommet-icons/es6/icons/FormUp.js"),FormDown=__webpack_require__("../../node_modules/grommet-icons/es6/icons/FormDown.js"),More=__webpack_require__("../../node_modules/grommet-icons/es6/icons/More.js"),polished_esm=__webpack_require__("../../node_modules/polished/dist/polished.esm.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),Media=__webpack_require__("../lib-react-components/dist/esm/Media/Media.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}function _callSuper(t,o,e){return o=_getPrototypeOf(o),function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e))}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}var StyledControlButton=(0,styled_components_browser_esm.default)(Button.$).withConfig({displayName:"FrameCarousel__StyledControlButton",componentId:"sc-eb3aut-0"})(["",""],(function(props){return props.theme&&(0,styled_components_browser_esm.css)(["color:",";background:",";&:focus:not(:disabled),&:hover:not(:disabled){background:",";box-shadow:none;}"],props.theme.global.colors["neutral-6"],props.theme.global.colors.brand,(0,polished_esm.uq)(.5,props.theme.global.colors.brand))}));function PreviousLabel(){var t=(0,i18n.Bd)("components").t;return(0,jsx_runtime.jsxs)(Box.a,{as:"span",align:"center",direction:"column",children:[(0,jsx_runtime.jsx)(FormUp.I,{color:"neutral-6"}),t("SubjectViewer.MultiFrameViewer.FrameCarousel.previousFrameLabel")]})}function NextLabel(){var t=(0,i18n.Bd)("components").t;return(0,jsx_runtime.jsxs)(Box.a,{as:"span",align:"center",direction:"column",children:[t("SubjectViewer.MultiFrameViewer.FrameCarousel.nextFrameLabel"),(0,jsx_runtime.jsx)(FormDown.t,{color:"neutral-6"})]})}PreviousLabel.displayName="PreviousLabel",NextLabel.displayName="NextLabel";var StyledMedia=(0,styled_components_browser_esm.default)(Media.A).withConfig({displayName:"FrameCarousel__StyledMedia",componentId:"sc-eb3aut-1"})(["height:40px;width:40px;img{aspect-ratio:1 / 1;}"]),StyledLabel=styled_components_browser_esm.default.label.withConfig({displayName:"FrameCarousel__StyledLabel",componentId:"sc-eb3aut-2"})([""," input{opacity:0.01;position:absolute;height:0;width:0;}:hover{cursor:pointer;}"],(function(props){return props.theme&&(0,styled_components_browser_esm.css)(["input:checked + ","{border:solid ",";}input:focus + ","{outline:2px solid ",";}input:hover + ","{outline:2px solid ",";}"],StyledMedia,props.theme.global.colors["neutral-2"],StyledMedia,(0,polished_esm.uq)(.5,props.theme.global.colors.brand),StyledMedia,(0,polished_esm.uq)(.5,props.theme.global.colors.brand))})),StyledFrameList=styled_components_browser_esm.default.ul.withConfig({displayName:"FrameCarousel__StyledFrameList",componentId:"sc-eb3aut-3"})(["align-items:center;display:flex;flex-direction:column;flex:1 1 auto;list-style-type:none;margin:0;overflow:auto;padding:0;position:relative;scroll-behavior:smooth;li{height:40px;margin:5px 0;width:40px;&:first-child{margin-top:14px;}&:last-child{margin-bottom:14px;}}"]),FrameCarousel=function(_Component){function FrameCarousel(props){var _this;return function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,FrameCarousel),(_this=_callSuper(this,FrameCarousel,[props])).theme=props.theme||{global:{colors:{}}},_this.handleScroll=_this.handleScroll.bind(_this),_this.handlePrevious=_this.handlePrevious.bind(_this),_this.handleNext=_this.handleNext.bind(_this),_this.activeLabel=(0,react.createRef)(),_this.frameList=(0,react.createRef)(),_this}return function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(FrameCarousel,_Component),function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(FrameCarousel,[{key:"componentDidMount",value:function componentDidMount(){this.handleScroll()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var frame=this.props.frame;prevProps.frame!==frame&&this.handleScroll()}},{key:"handleScroll",value:function handleScroll(){var _this$activeLabel$cur,_this$frameList$curre,_this$activeLabel$cur2,_this$frameList$curre2,_this$frameList$curre3,labelIsAboveContainerTop=(null===(_this$activeLabel$cur=this.activeLabel.current)||void 0===_this$activeLabel$cur?void 0:_this$activeLabel$cur.offsetTop)<=(null===(_this$frameList$curre=this.frameList.current)||void 0===_this$frameList$curre?void 0:_this$frameList$curre.scrollTop),labelIsBelowContainerBottom=(null===(_this$activeLabel$cur2=this.activeLabel.current)||void 0===_this$activeLabel$cur2?void 0:_this$activeLabel$cur2.offsetTop)>=(null===(_this$frameList$curre2=this.frameList.current)||void 0===_this$frameList$curre2?void 0:_this$frameList$curre2.scrollTop)+(null===(_this$frameList$curre3=this.frameList.current)||void 0===_this$frameList$curre3?void 0:_this$frameList$curre3.clientHeight);if(labelIsAboveContainerTop||labelIsBelowContainerBottom){var newContainerTopPosition=this.activeLabel.current.offsetTop-this.activeLabel.current.offsetHeight;this.frameList.current.scrollTop=newContainerTopPosition}}},{key:"handleFrameChange",value:function handleFrameChange(frameIndex){(0,this.props.onFrameChange)(frameIndex)}},{key:"handlePrevious",value:function handlePrevious(){var frame=this.props.frame;frame>0&&this.handleFrameChange(frame-1)}},{key:"handleNext",value:function handleNext(){var _this$props=this.props,frame=_this$props.frame;frame<_this$props.locations.length&&this.handleFrameChange(frame+1)}},{key:"render",value:function render(){var _this2=this,_this$props2=this.props,frame=_this$props2.frame,locations=_this$props2.locations,t=_this$props2.t,locationElements=locations.map((function(location,index){location.mimeType;var url=location.url,activeFrame=frame===index;return(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsxs)(StyledLabel,{ref:activeFrame?_this2.activeLabel:null,children:[(0,jsx_runtime.jsx)("input",{checked:activeFrame,name:"frame",onChange:function onChange(){return _this2.handleFrameChange(index)},type:"radio"}),(0,jsx_runtime.jsx)(StyledMedia,{alt:t("SubjectViewer.MultiFrameViewer.FrameCarousel.thumbnailAltText"),background:"accent-1",fit:"cover",height:40,placeholder:(0,jsx_runtime.jsx)(More.K,{color:"neutral-6",size:"medium"}),src:url,width:40})]})},"".concat(url,"-").concat(index))}));return(0,jsx_runtime.jsxs)(Box.a,{background:{dark:"dark-3",light:"neutral-6"},direction:"column",height:{max:"450px"},width:"4em",children:[(0,jsx_runtime.jsx)(StyledControlButton,{disabled:0===frame,fill:"horizontal",label:(0,jsx_runtime.jsx)(PreviousLabel,{}),onClick:function onClick(){return _this2.handlePrevious()}}),(0,jsx_runtime.jsx)(StyledFrameList,{ref:this.frameList,children:locationElements}),(0,jsx_runtime.jsx)(StyledControlButton,{align:"center",disabled:frame===locations.length-1,fill:"horizontal",label:(0,jsx_runtime.jsx)(NextLabel,{}),onClick:function onClick(){return _this2.handleNext()}})]})}}])}(react.Component);FrameCarousel.displayName="FrameCarousel",FrameCarousel.propTypes={frame:prop_types_default().number.isRequired,locations:prop_types_default().arrayOf(locationValidator.A).isRequired,onFrameChange:prop_types_default().func.isRequired,theme:prop_types_default().object};var ThemedFrameCarousel=(0,styled_components_browser_esm.withTheme)(FrameCarousel);const MultiFrameViewer_FrameCarousel=(0,i18n.CI)("components")(ThemedFrameCarousel);function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}PreviousLabel.__docgenInfo={description:"",methods:[],displayName:"PreviousLabel"},NextLabel.__docgenInfo={description:"",methods:[],displayName:"NextLabel"},FrameCarousel.__docgenInfo={description:"",methods:[{name:"handleScroll",docblock:null,modifiers:[],params:[],returns:null},{name:"handleFrameChange",docblock:null,modifiers:[],params:[{name:"frameIndex",optional:!1,type:null}],returns:null},{name:"handlePrevious",docblock:null,modifiers:[],params:[],returns:null},{name:"handleNext",docblock:null,modifiers:[],params:[],returns:null}],displayName:"FrameCarousel",props:{frame:{description:"",type:{name:"number"},required:!0},locations:{description:"",type:{name:"arrayOf",value:{name:"custom",raw:"locationValidator"}},required:!0},onFrameChange:{description:"",type:{name:"func"},required:!0},theme:{description:"",type:{name:"object"},required:!1}}};var DEFAULT_HANDLER=function DEFAULT_HANDLER(){return!0},DEFAULT_TOOL={validate:function validate(){}};function MultiFrameViewerContainer(_ref2){var _ref2$activeTool=_ref2.activeTool,activeTool=void 0===_ref2$activeTool?DEFAULT_TOOL:_ref2$activeTool,_ref2$enableInteracti=_ref2.enableInteractionLayer,enableInteractionLayer=void 0!==_ref2$enableInteracti&&_ref2$enableInteracti,_ref2$frame=_ref2.frame,frame=void 0===_ref2$frame?0:_ref2$frame,_ref2$loadingState=_ref2.loadingState,loadingState=void 0===_ref2$loadingState?async_states_default().initialized:_ref2$loadingState,_ref2$onError=_ref2.onError,onError=void 0===_ref2$onError?DEFAULT_HANDLER:_ref2$onError,_ref2$onReady=_ref2.onReady,onReady=void 0===_ref2$onReady?DEFAULT_HANDLER:_ref2$onReady,_ref2$resetView=_ref2.resetView,resetView=void 0===_ref2$resetView?DEFAULT_HANDLER:_ref2$resetView,_ref2$setFrame=_ref2.setFrame,setFrame=void 0===_ref2$setFrame?DEFAULT_HANDLER:_ref2$setFrame,subject=_ref2.subject;return(0,react.useEffect)((function onFrameChange(){null==activeTool||activeTool.validate(),resetView()}),[frame]),loadingState===async_states_default().error?(0,jsx_runtime.jsx)("div",{children:"Something went wrong."}):loadingState!==async_states_default().initialized?(0,jsx_runtime.jsxs)(Box.a,{direction:"row",fill:"horizontal",children:[(0,jsx_runtime.jsx)(MultiFrameViewer_FrameCarousel,{frame,onFrameChange:setFrame,locations:subject.locations}),(0,jsx_runtime.jsx)(SingleImageViewer.Ay,{enableInteractionLayer,loadingState,onError,onReady})]}):null}MultiFrameViewerContainer.propTypes={activeTool:prop_types_default().shape({validate:prop_types_default().func}),enableInteractionLayer:prop_types_default().bool,frame:prop_types_default().number,loadingState:prop_types_default().string,onError:prop_types_default().func,onReady:prop_types_default().func,resetView:prop_types_default().func,setFrame:prop_types_default().func,subject:prop_types_default().shape({locations:prop_types_default().arrayOf(locationValidator.A)}).isRequired};const MultiFrameViewer_MultiFrameViewerContainer=(0,helpers.Lg)(MultiFrameViewerContainer,(function storeMapper(store){var _store$subjectViewer=store.subjectViewer,frame=_store$subjectViewer.frame,resetView=_store$subjectViewer.resetView,setFrame=_store$subjectViewer.setFrame;return{activeTool:(_slicedToArray(store.workflowSteps.activeStepTasks.filter((function(task){return"drawing"===task.type||"transcription"===task.type})),1)[0]||{}).activeTool,frame,resetView,setFrame}}));MultiFrameViewerContainer.__docgenInfo={description:"",methods:[],displayName:"MultiFrameViewerContainer",props:{activeTool:{defaultValue:{value:"{\n  validate: () => {}\n}",computed:!1},description:"",type:{name:"shape",value:{validate:{name:"func",required:!1}}},required:!1},enableInteractionLayer:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},frame:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"number"},required:!1},loadingState:{defaultValue:{value:"asyncStates.initialized",computed:!0},description:"",type:{name:"string"},required:!1},onError:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},onReady:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},resetView:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},setFrame:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},subject:{description:"",type:{name:"shape",value:{locations:{name:"arrayOf",value:{name:"custom",raw:"locationValidator"},required:!1}}},required:!0}}}}}]);