"use strict";(self.webpackChunk_zooniverse_classifier=self.webpackChunk_zooniverse_classifier||[]).push([[9663],{"./src/components/Classifier/components/SubjectViewer/components/SingleVideoViewer/SingleVideoViewerContainer.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>SingleVideoViewer_SingleVideoViewerContainer});var prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),mobxreact_esm=__webpack_require__("../../node_modules/mobx-react/dist/mobxreact.esm.js"),hooks=__webpack_require__("./src/hooks/index.js"),locationValidator=__webpack_require__("./src/components/Classifier/components/SubjectViewer/helpers/locationValidator/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),react=__webpack_require__("../../node_modules/react/index.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),lib=__webpack_require__("../../node_modules/react-player/lib/index.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),SubjectContainer=styled_components_browser_esm.default.div.withConfig({displayName:"VideoViewer__SubjectContainer",componentId:"sc-1aqsme0-0"})(["position:relative;"]);function VideoViewer(_ref){var _ref$onError=_ref.onError,onError=void 0===_ref$onError?function(){return!0}:_ref$onError,_ref$onReady=_ref.onReady,onReady=void 0===_ref$onReady?function(){return!0}:_ref$onReady,subject=_ref.subject,t=(0,i18n.Bd)("components").t,playerRef=(0,react.useRef)(null),videoLocation=subject?subject.locations.find((function(l){return"video"===l.type})):null,onReactPlayerReady=function onReactPlayerReady(){try{var _playerRef$current,_playerRef$current2,_playerRef$current3,_playerRef$current4,reactPlayerVideoHeight=null===(_playerRef$current=playerRef.current)||void 0===_playerRef$current?void 0:_playerRef$current.getInternalPlayer().videoHeight,reactPlayerVideoWidth=null===(_playerRef$current2=playerRef.current)||void 0===_playerRef$current2?void 0:_playerRef$current2.getInternalPlayer().videoWidth,reactPlayerClientHeight=null===(_playerRef$current3=playerRef.current)||void 0===_playerRef$current3?void 0:_playerRef$current3.getInternalPlayer().getBoundingClientRect().height,reactPlayerClientWidth=null===(_playerRef$current4=playerRef.current)||void 0===_playerRef$current4?void 0:_playerRef$current4.getInternalPlayer().getBoundingClientRect().width;onReady({target:{clientHeight:reactPlayerClientHeight,clientWidth:reactPlayerClientWidth,naturalHeight:reactPlayerVideoHeight,naturalWidth:reactPlayerVideoWidth}})}catch(error){onError(error)}},handlePlayerError=function handlePlayerError(error){onError(error)},memoizedViewer=(0,react.useMemo)((function(){return(0,jsx_runtime.jsx)(lib.A,{controls:!0,height:"100%",onError:handlePlayerError,onReady:onReactPlayerReady,ref:playerRef,width:"100%",url:null==videoLocation?void 0:videoLocation.url,config:{file:{attributes:{controlsList:["nodownload"],style:{display:"block",height:"100%",width:"100%"}}}}})}),[videoLocation]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:videoLocation?(0,jsx_runtime.jsx)(SubjectContainer,{children:memoizedViewer}):(0,jsx_runtime.jsx)(Box.a,{children:t("SubjectViewer.SingleVideoViewerContainer.error")})})}VideoViewer.propTypes={onError:prop_types_default().func,onReady:prop_types_default().func,subject:prop_types_default().shape({locations:prop_types_default().arrayOf(locationValidator.A)})};const VideoViewer_VideoViewer=VideoViewer;VideoViewer.__docgenInfo={description:"",methods:[],displayName:"VideoViewer",props:{onError:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},onReady:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"func"},required:!1},subject:{description:"",type:{name:"shape",value:{locations:{name:"arrayOf",value:{name:"custom",raw:"locationValidator"},required:!1}}},required:!1}}};var Text=__webpack_require__("../../node_modules/grommet/es6/components/Text/Text.js"),SVGContext=__webpack_require__("./src/plugins/drawingTools/shared/SVGContext.js"),InteractionLayer=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/index.js"),Button=__webpack_require__("../../node_modules/grommet/es6/components/Button/Button.js"),Select=__webpack_require__("../../node_modules/grommet/es6/components/Select/Select.js"),RangeInput=__webpack_require__("../../node_modules/grommet/es6/components/RangeInput/RangeInput.js"),ResponsiveContext=__webpack_require__("../../node_modules/grommet/es6/contexts/ResponsiveContext/ResponsiveContext.js"),ThemeContext=__webpack_require__("../../node_modules/grommet/es6/contexts/ThemeContext/ThemeContext.js"),Grid=__webpack_require__("../../node_modules/grommet/es6/components/Grid/Grid.js"),Pause=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Pause.js"),CirclePlay=__webpack_require__("../../node_modules/grommet-icons/es6/icons/CirclePlay.js"),FormDown=__webpack_require__("../../node_modules/grommet-icons/es6/icons/FormDown.js"),VolumeMute=__webpack_require__("../../node_modules/grommet-icons/es6/icons/VolumeMute.js"),VolumeLow=__webpack_require__("../../node_modules/grommet-icons/es6/icons/VolumeLow.js"),Volume=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Volume.js"),Expand=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Expand.js");const theme={global:{input:{display:"block",padding:{horizontal:"0",vertical:"0"}},spacing:"10px"},select:{icons:{margin:"0"}},rangeInput:{track:{height:"3px",lower:{color:{light:"black",dark:"light-1"}},upper:{color:{light:"dark-5",dark:"dark-6"}}},thumb:{color:"neutral-1"}}};var formatTimeStamp=__webpack_require__("./src/helpers/formatTimeStamp/formatTimeStamp.js");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var color={light:"dark-5",dark:"white"},StyledButton=(0,styled_components_browser_esm.default)(Button.$).withConfig({displayName:"VideoController__StyledButton",componentId:"sc-gqcv9c-0"})(["height:40px;width:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;&:hover:not(:disabled),&:focus:not(:disabled){"," > svg{stroke:white;}}"],(function(props){return props.theme.dark?(0,styled_components_browser_esm.css)(["background-color:",";"],props.theme.global.colors["neutral-1"]):(0,styled_components_browser_esm.css)(["background-color:",";"],props.theme.global.colors["accent-1"])})),SpeedSelect=(0,styled_components_browser_esm.default)(Select.l).withConfig({displayName:"VideoController__SpeedSelect",componentId:"sc-gqcv9c-1"})(["display:flex;align-content:center;width:2rem;text-align:right;"]),VolumeContainer=(0,styled_components_browser_esm.default)(Box.a).withConfig({displayName:"VideoController__VolumeContainer",componentId:"sc-gqcv9c-2"})(["position:relative;"]),VolumeRange=(0,styled_components_browser_esm.default)(RangeInput.s).withConfig({displayName:"VideoController__VolumeRange",componentId:"sc-gqcv9c-3"})(["display:block;width:100px;height:24px;padding:0 8px;background:",";position:absolute;left:-30px;bottom:80px;transform:rotate(-90deg);"],(function(props){return props.theme.dark?props.theme.global.colors["dark-1"]:props.theme.global.colors["light-1"]})),DEFAULT_HANDLER=function DEFAULT_HANDLER(){},VideoController=function VideoController(_ref){var _ref$duration=_ref.duration,duration=void 0===_ref$duration?0:_ref$duration,_ref$isPlaying=(_ref.enableDrawing,_ref.isPlaying),isPlaying=void 0!==_ref$isPlaying&&_ref$isPlaying,_ref$handleFullscreen=_ref.handleFullscreen,handleFullscreen=void 0===_ref$handleFullscreen?DEFAULT_HANDLER:_ref$handleFullscreen,_ref$handleSeekChange=_ref.handleSeekChange,handleSeekChange=void 0===_ref$handleSeekChange?DEFAULT_HANDLER:_ref$handleSeekChange,_ref$handleSeekMouseD=_ref.handleSeekMouseDown,handleSeekMouseDown=void 0===_ref$handleSeekMouseD?DEFAULT_HANDLER:_ref$handleSeekMouseD,_ref$handleSeekMouseU=_ref.handleSeekMouseUp,handleSeekMouseUp=void 0===_ref$handleSeekMouseU?DEFAULT_HANDLER:_ref$handleSeekMouseU,_ref$onPlayPause=_ref.onPlayPause,onPlayPause=void 0===_ref$onPlayPause?DEFAULT_HANDLER:_ref$onPlayPause,_ref$onSpeedChange=_ref.onSpeedChange,onSpeedChange=void 0===_ref$onSpeedChange?DEFAULT_HANDLER:_ref$onSpeedChange,_ref$playbackSpeed=_ref.playbackSpeed,playbackSpeed=void 0===_ref$playbackSpeed?"1x":_ref$playbackSpeed,_ref$played=_ref.played,played=void 0===_ref$played?0:_ref$played,playerRef=_ref.playerRef,_ref$setVolume=_ref.setVolume,setVolume=void 0===_ref$setVolume?DEFAULT_HANDLER:_ref$setVolume,_ref$volume=_ref.volume,volume=void 0===_ref$volume?1:_ref$volume,_ref$volumeDisabled=_ref.volumeDisabled,volumeDisabled=void 0!==_ref$volumeDisabled&&_ref$volumeDisabled,size=(0,react.useContext)(ResponsiveContext.u),t=(0,i18n.Bd)("components").t,_useState2=_slicedToArray((0,react.useState)(!1),2),volumeOpen=_useState2[0],setVolumeOpen=_useState2[1],playPauseLabel=isPlaying?"SubjectViewer.VideoController.pause":"SubjectViewer.VideoController.play",volumeButtonLabel=volumeOpen?"SubjectViewer.VideoController.closeVolume":"SubjectViewer.VideoController.openVolume",secondsPlayed=played*duration,displayedDuration=(0,react.useMemo)((function(){return(0,formatTimeStamp.A)(duration)}),[duration]),handleVolumeKeys=function handleVolumeKeys(e){"ArrowUp"===e.key&&volume<1?(e.preventDefault(),e.stopPropagation(),setVolume(volume+.25)):"ArrowDown"===e.key&&volume>0&&(e.preventDefault(),e.stopPropagation(),setVolume(volume-.25))};return(0,jsx_runtime.jsx)(Box.a,{background:{light:"white",dark:"dark-3"},pad:{horizontal:"small"===size?"0":"small"},border:[{color:{dark:"dark-1",light:"light-3"},side:"all"},{color:{dark:"transparent",light:"transparent"},side:"top"}],children:(0,jsx_runtime.jsx)(ThemeContext.D.Extend,{value:theme,children:(0,jsx_runtime.jsxs)(Grid.x,{columns:["min-content","flex","min-content"],rows:["1fr"],"data-testid":"video subject viewer custom controls",children:[(0,jsx_runtime.jsxs)(Box.a,{direction:"row",children:[(0,jsx_runtime.jsx)(StyledButton,{a11yTitle:t(playPauseLabel),onClick:onPlayPause,icon:isPlaying?(0,jsx_runtime.jsx)(Pause.v,{size:"1rem",color}):(0,jsx_runtime.jsx)(CirclePlay.H,{size:"1rem",color}),plain:!0}),(0,jsx_runtime.jsx)(SpeedSelect,{a11yTitle:t("SubjectViewer.VideoController.playbackSpeed"),options:["0.25x","0.5x","1x"],value:playbackSpeed,onChange:function onChange(_ref2){var option=_ref2.option;return onSpeedChange(option)},plain:!0,icon:(0,jsx_runtime.jsx)(FormDown.t,{size:"0.75rem",color}),focusIndicator:!0,size:"0.75rem",color}),(0,jsx_runtime.jsx)(Box.a,{direction:"row",align:"center",width:{min:"3.7rem",max:"3.7rem"},margin:{horizontal:"small"===size?"10px":"20px"},children:(0,jsx_runtime.jsxs)(Text.E,{size:"0.75rem",color,children:[(0,jsx_runtime.jsx)("time",{dateTime:"P".concat(Math.round(secondsPlayed),"S"),children:(0,formatTimeStamp.A)(secondsPlayed)})," / ",(0,jsx_runtime.jsx)("time",{dateTime:"P".concat(Math.round(duration),"S"),children:displayedDuration})]})})]}),(0,jsx_runtime.jsx)(Box.a,{direction:"row",align:"center",margin:{right:"10px"},children:(0,jsx_runtime.jsx)(RangeInput.s,{a11yTitle:t("SubjectViewer.VideoController.scrubber"),min:0,max:.999999,step:.01,value:played,onChange:handleSeekChange,onKeyDown:function handleSliderKeys(e){if("Space"===e.code||"Enter"===e.code)e.preventDefault(),e.stopPropagation(),onPlayPause();else if("ArrowLeft"===e.code){var _playerRef$current,_playerRef$current2;if(e.preventDefault(),e.stopPropagation(),0===played)return;0<played&&played<=.05?null==playerRef||null===(_playerRef$current=playerRef.current)||void 0===_playerRef$current||_playerRef$current.seekTo(0):null==playerRef||null===(_playerRef$current2=playerRef.current)||void 0===_playerRef$current2||_playerRef$current2.seekTo(played-.05)}else if("ArrowRight"===e.code){var _playerRef$current3,_playerRef$current4;if(e.preventDefault(),e.stopPropagation(),1===played)return;1>played&&played>=.95?null==playerRef||null===(_playerRef$current3=playerRef.current)||void 0===_playerRef$current3||_playerRef$current3.seekTo(duration):null==playerRef||null===(_playerRef$current4=playerRef.current)||void 0===_playerRef$current4||_playerRef$current4.seekTo(played+.05)}},onMouseDown:handleSeekMouseDown,onMouseUp:handleSeekMouseUp})}),(0,jsx_runtime.jsxs)(Box.a,{align:"center",direction:"row",fill:!0,children:[(0,jsx_runtime.jsxs)(VolumeContainer,{children:[(0,jsx_runtime.jsx)(StyledButton,{a11yTitle:t(volumeButtonLabel),disabled:volumeDisabled,icon:volume<=0||volumeDisabled?(0,jsx_runtime.jsx)(VolumeMute.W,{size:"1rem",color}):volume<=.5?(0,jsx_runtime.jsx)(VolumeLow.Z,{size:"1rem",color}):(0,jsx_runtime.jsx)(Volume.f,{size:"1rem",color}),onClick:function onClick(){return setVolumeOpen(!volumeOpen)},onKeyDown:handleVolumeKeys,plain:!0}),volumeOpen&&(0,jsx_runtime.jsx)(VolumeRange,{a11yTitle:t("SubjectViewer.VideoController.volumeSlider"),disabled:volumeDisabled,min:0,max:1,step:.25,onChange:function onVolumeChange(e){setVolume(parseFloat(e.target.value))},onKeyDown:handleVolumeKeys,value:volume})]}),(0,jsx_runtime.jsx)(StyledButton,{a11yTitle:t("SubjectViewer.VideoController.fullscreen"),icon:(0,jsx_runtime.jsx)(Expand.J,{size:"1rem",color}),plain:!0,onClick:handleFullscreen})]})]})})})};VideoController.displayName="VideoController",VideoController.propTypes={duration:prop_types.number,enableDrawing:prop_types.bool,isPlaying:prop_types.bool,handleFullscreen:prop_types.func,handleSeekChange:prop_types.func,handleSeekMouseDown:prop_types.func,handleSeekMouseUp:prop_types.func,onPlayPause:prop_types.func,onSpeedChange:prop_types.func,playbackSpeed:prop_types.string,played:prop_types.number,setVolume:prop_types.func,volume:prop_types.number,volumeDisabled:prop_types.bool};const VideoController_VideoController=VideoController;function VideoWithDrawing_slicedToArray(r,e){return function VideoWithDrawing_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function VideoWithDrawing_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function VideoWithDrawing_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return VideoWithDrawing_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?VideoWithDrawing_arrayLikeToArray(r,a):void 0}}(r,e)||function VideoWithDrawing_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function VideoWithDrawing_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}VideoController.__docgenInfo={description:"",methods:[],displayName:"VideoController",props:{duration:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"custom",raw:"number"},required:!1},enableDrawing:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"custom",raw:"bool"},required:!1},isPlaying:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"custom",raw:"bool"},required:!1},handleFullscreen:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},handleSeekChange:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},handleSeekMouseDown:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},handleSeekMouseUp:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onPlayPause:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onSpeedChange:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},playbackSpeed:{defaultValue:{value:"'1x'",computed:!1},description:"",type:{name:"custom",raw:"string"},required:!1},played:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"custom",raw:"number"},required:!1},setVolume:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},volume:{defaultValue:{value:"1",computed:!1},description:"",type:{name:"custom",raw:"number"},required:!1},volumeDisabled:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"custom",raw:"bool"},required:!1}}};var VideoWithDrawing_SubjectContainer=styled_components_browser_esm.default.div.withConfig({displayName:"VideoWithDrawing__SubjectContainer",componentId:"sc-hgjq1t-0"})(["position:relative;"]),DrawingLayer=styled_components_browser_esm.default.div.withConfig({displayName:"VideoWithDrawing__DrawingLayer",componentId:"sc-hgjq1t-1"})(["position:absolute;top:0px;width:100%;cursor:default;"]),VideoWithDrawing_DEFAULT_HANDLER=function DEFAULT_HANDLER(){return!0};function VideoWithDrawing(_ref){var _ref$loadingState=_ref.loadingState,loadingState=void 0===_ref$loadingState?async_states_default().initialized:_ref$loadingState,_ref$onError=_ref.onError,onError=void 0===_ref$onError?VideoWithDrawing_DEFAULT_HANDLER:_ref$onError,_ref$onReady=_ref.onReady,onReady=void 0===_ref$onReady?VideoWithDrawing_DEFAULT_HANDLER:_ref$onReady,_ref$onKeyDown=_ref.onKeyDown,onKeyDown=void 0===_ref$onKeyDown?VideoWithDrawing_DEFAULT_HANDLER:_ref$onKeyDown,_ref$setVideoSpeed=_ref.setVideoSpeed,setVideoSpeed=void 0===_ref$setVideoSpeed?VideoWithDrawing_DEFAULT_HANDLER:_ref$setVideoSpeed,_ref$setVolume=_ref.setVolume,setVolume=void 0===_ref$setVolume?VideoWithDrawing_DEFAULT_HANDLER:_ref$setVolume,subject=_ref.subject,_ref$videoSpeed=_ref.videoSpeed,videoSpeed=void 0===_ref$videoSpeed?"1x":_ref$videoSpeed,_ref$volume=_ref.volume,volume=void 0===_ref$volume?1:_ref$volume,_useState2=VideoWithDrawing_slicedToArray((0,react.useState)(0),2),duration=_useState2[0],setDuration=_useState2[1],_useState4=VideoWithDrawing_slicedToArray((0,react.useState)(!1),2),fullscreenError=_useState4[0],setFullscreenError=_useState4[1],_useState6=VideoWithDrawing_slicedToArray((0,react.useState)(!1),2),isPlaying=_useState6[0],setIsPlaying=_useState6[1],_useState8=VideoWithDrawing_slicedToArray((0,react.useState)(!1),2),isSeeking=_useState8[0],setIsSeeking=_useState8[1],_useState0=VideoWithDrawing_slicedToArray((0,react.useState)(0),2),played=_useState0[0],setPlayed=_useState0[1],_useState10=VideoWithDrawing_slicedToArray((0,react.useState)(!0),2),volumeDisabled=_useState10[0],setVolumeDisabled=_useState10[1],_useState12=VideoWithDrawing_slicedToArray((0,react.useState)(0),2),clientWidth=_useState12[0],setClientWidth=_useState12[1],_useState14=VideoWithDrawing_slicedToArray((0,react.useState)(0),2),videoHeight=_useState14[0],setVideoHeight=_useState14[1],_useState16=VideoWithDrawing_slicedToArray((0,react.useState)(0),2),videoWidth=_useState16[0],setVideoWidth=_useState16[1],playerRef=(0,react.useRef)(),interactionLayerSVG=(0,react.useRef)(),transformLayer=(0,react.useRef)(),t=(0,i18n.Bd)("components").t,videoLocation=subject?subject.locations.find((function(l){return"video"===l.type})):null,enableDrawing=loadingState===async_states_default().success,sanitizedSpeed=Number(videoSpeed.slice(0,-1)),canvas=null==transformLayer?void 0:transformLayer.current,interactionLayerScale=clientWidth/videoWidth,svgStyle={touchAction:"pinch-zoom"};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[videoLocation?(0,jsx_runtime.jsxs)(VideoWithDrawing_SubjectContainer,{children:[(0,jsx_runtime.jsx)(lib.A,{controls:!1,height:"100%",onDuration:function handleVideoDuration(duration){setDuration(duration)},onEnded:function handleVideoEnded(){setIsPlaying(!1)},onError:function handlePlayerError(error){onError(error)},onReady:function onReactPlayerReady(){try{var _playerRef$current,_playerRef$current2,_playerRef$current3,_playerRef$current4,reactPlayerVideoHeight=null===(_playerRef$current=playerRef.current)||void 0===_playerRef$current?void 0:_playerRef$current.getInternalPlayer().videoHeight,reactPlayerVideoWidth=null===(_playerRef$current2=playerRef.current)||void 0===_playerRef$current2?void 0:_playerRef$current2.getInternalPlayer().videoWidth,reactPlayerClientHeight=null===(_playerRef$current3=playerRef.current)||void 0===_playerRef$current3?void 0:_playerRef$current3.getInternalPlayer().getBoundingClientRect().height,reactPlayerClientWidth=null===(_playerRef$current4=playerRef.current)||void 0===_playerRef$current4?void 0:_playerRef$current4.getInternalPlayer().getBoundingClientRect().width;onReady({target:{clientHeight:reactPlayerClientHeight,clientWidth:reactPlayerClientWidth,naturalHeight:reactPlayerVideoHeight,naturalWidth:reactPlayerVideoWidth}}),function detectAudioTrack(){var internalVideo=playerRef.current.getInternalPlayer();(void 0!==internalVideo.webkitAudioDecodedByteCount&&internalVideo.webkitAudioDecodedByteCount>0||internalVideo.audioTracks&&internalVideo.audioTracks.length||void 0!==internalVideo.mozHasAudio)&&setVolumeDisabled(!1)}(),setVideoHeight(reactPlayerVideoHeight),setVideoWidth(reactPlayerVideoWidth),setClientWidth(reactPlayerClientWidth)}catch(error){onError(error)}},onProgress:function handleVideoProgress(reactPlayerState){var played=reactPlayerState.played;isSeeking||setPlayed(played)},playing:isPlaying,playbackRate:sanitizedSpeed,playsinline:!0,progressInterval:10,ref:playerRef,width:"100%",volume,url:null==videoLocation?void 0:videoLocation.url,config:{file:{attributes:{style:{display:"block",height:"100%",width:"100%"}}}}}),enableDrawing&&(0,jsx_runtime.jsx)(DrawingLayer,{children:(0,jsx_runtime.jsx)(Box.a,{overflow:"hidden",children:(0,jsx_runtime.jsx)(SVGContext.A.Provider,{value:{canvas},children:(0,jsx_runtime.jsx)("svg",{ref:interactionLayerSVG,focusable:!0,onKeyDown,style:svgStyle,tabIndex:0,viewBox:"0 0 ".concat(videoWidth," ").concat(videoHeight),xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("g",{ref:transformLayer,transform:"",children:(0,jsx_runtime.jsx)(InteractionLayer.A,{scale:interactionLayerScale,duration,height:videoHeight,played,width:videoWidth})})})})})})]}):(0,jsx_runtime.jsx)(Box.a,{children:t("SubjectViewer.SingleVideoViewerContainer.error")}),(0,jsx_runtime.jsx)(VideoController_VideoController,{duration,enableDrawing,isPlaying,handleFullscreen:function handleFullscreen(){try{var _playerRef$current6;null===(_playerRef$current6=playerRef.current)||void 0===_playerRef$current6||_playerRef$current6.getInternalPlayer().requestFullscreen()}catch(error){setFullscreenError(!0)}},handleSeekChange:function handleSeekChange(e){var _playerRef$current5;setPlayed(parseFloat(e.target.value)),null==playerRef||null===(_playerRef$current5=playerRef.current)||void 0===_playerRef$current5||_playerRef$current5.seekTo(parseFloat(e.target.value))},handleSeekMouseDown:function handleSeekMouseDown(e){setIsSeeking(!0)},handleSeekMouseUp:function handleSeekMouseUp(e){setIsSeeking(!1)},onPlayPause:function handlePlayPause(){setIsPlaying(!isPlaying)},onSpeedChange:function handleSetPlaybackSpeed(speed){setVideoSpeed(speed)},played,playbackSpeed:videoSpeed,playerRef,setVolume,volume,volumeDisabled}),fullscreenError&&(0,jsx_runtime.jsx)(Text.E,{children:"Fullscreen not supported in some mobile browsers"})]})}VideoWithDrawing.propTypes={loadingState:prop_types.string,onError:prop_types.func,onKeyDown:prop_types.func,onReady:prop_types.func,setVideoSpeed:prop_types.func,setVolume:prop_types.func,subject:(0,prop_types.shape)({locations:(0,prop_types.arrayOf)(locationValidator.A)}),videoSpeed:prop_types.string,volume:prop_types.number};const VideoWithDrawing_VideoWithDrawing=VideoWithDrawing;function storeMapper(store){var drawingTasks=store.workflowSteps.findTasksByType("drawing"),_store$subjectViewer=store.subjectViewer,setVideoSpeed=_store$subjectViewer.setVideoSpeed,setVolume=_store$subjectViewer.setVolume,videoSpeed=_store$subjectViewer.videoSpeed,volume=_store$subjectViewer.volume;return{enableInteractionLayer:!(null==drawingTasks||!drawingTasks.length),setVideoSpeed,setVolume,videoSpeed,volume}}VideoWithDrawing.__docgenInfo={description:"",methods:[],displayName:"VideoWithDrawing",props:{loadingState:{defaultValue:{value:"asyncStates.initialized",computed:!0},description:"",type:{name:"custom",raw:"string"},required:!1},onError:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onReady:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onKeyDown:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},setVideoSpeed:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},setVolume:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},videoSpeed:{defaultValue:{value:"'1x'",computed:!1},description:"",type:{name:"custom",raw:"string"},required:!1},volume:{defaultValue:{value:"1",computed:!1},description:"",type:{name:"custom",raw:"number"},required:!1},subject:{description:"",type:{name:"shape",value:{locations:{name:"arrayOf",value:{name:"custom",raw:"locationValidator"},required:!1}}},required:!1}}};var SingleVideoViewerContainer_DEFAULT_HANDLER=function DEFAULT_HANDLER(){};function SingleVideoViewerContainer(_ref){var _ref$loadingState=_ref.loadingState,loadingState=void 0===_ref$loadingState?async_states_default().initialized:_ref$loadingState,_ref$onError=_ref.onError,onError=void 0===_ref$onError?SingleVideoViewerContainer_DEFAULT_HANDLER:_ref$onError,_ref$onReady=_ref.onReady,onReady=void 0===_ref$onReady?SingleVideoViewerContainer_DEFAULT_HANDLER:_ref$onReady,_ref$onKeyDown=_ref.onKeyDown,onKeyDown=void 0===_ref$onKeyDown?SingleVideoViewerContainer_DEFAULT_HANDLER:_ref$onKeyDown,subject=_ref.subject,_useStores=(0,hooks.gy)(storeMapper),enableInteractionLayer=_useStores.enableInteractionLayer,setVideoSpeed=_useStores.setVideoSpeed,setVolume=_useStores.setVolume,videoSpeed=_useStores.videoSpeed,volume=_useStores.volume;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:enableInteractionLayer?(0,jsx_runtime.jsx)(VideoWithDrawing_VideoWithDrawing,{loadingState,onError,onReady,onKeyDown,setVideoSpeed,setVolume,subject,volume,videoSpeed}):(0,jsx_runtime.jsx)(VideoViewer_VideoViewer,{onError,onReady,subject})})}SingleVideoViewerContainer.propTypes={loadingState:prop_types.string,onError:prop_types.func,onKeyDown:prop_types.func,onReady:prop_types.func,subject:(0,prop_types.shape)({locations:(0,prop_types.arrayOf)(locationValidator.A)})};const SingleVideoViewer_SingleVideoViewerContainer=(0,mobxreact_esm.PA)(SingleVideoViewerContainer);SingleVideoViewerContainer.__docgenInfo={description:"",methods:[],displayName:"SingleVideoViewerContainer",props:{loadingState:{defaultValue:{value:"asyncStates.initialized",computed:!0},description:"",type:{name:"custom",raw:"string"},required:!1},onError:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onReady:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onKeyDown:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},subject:{description:"",type:{name:"shape",value:{locations:{name:"arrayOf",value:{name:"custom",raw:"locationValidator"},required:!1}}},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/SingleVideoViewer/SingleVideoViewerContainer.stories.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,NoSubject:()=>NoSubject,WithDrawing:()=>WithDrawing,WithDrawingNoSound:()=>WithDrawingNoSound,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var grommet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),rosie__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/rosie/src/rosie.js"),mobx_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/mobx-react/dist/mobxreact.esm.js"),_test_mockStore__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./test/mockStore/index.js"),_test_factories__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./test/factories/index.js"),_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/SingleVideoViewer/SingleVideoViewerContainer.jsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/jsx-runtime.js"),subject=rosie__WEBPACK_IMPORTED_MODULE_1__.$.build("subject",{locations:[{"video/mp4":"https://panoptes-uploads.zooniverse.org/subject_location/239f17f7-acf9-49f1-9873-266a80d29c33.mp4"}]}),subjectNoSound=rosie__WEBPACK_IMPORTED_MODULE_1__.$.build("subject",{locations:[{"video/mp4":"https://panoptes-uploads.zooniverse.org/subject_location/c13ebff6-bc25-4f33-afe5-5df0565c6839.mp4"}]}),drawingWorkflow=_test_factories__WEBPACK_IMPORTED_MODULE_4__.s4.build({display_name:"Video Drawing Task",first_task:"T0",tasks:{T0:{help:"",instruction:"Draw on the video",tools:[{color:"#000000",label:"Mock Tool",type:"ellipse"}],type:"drawing"}}}),noDrawingStore=(0,_test_mockStore__WEBPACK_IMPORTED_MODULE_3__.A)({subject}),drawingStore=(0,_test_mockStore__WEBPACK_IMPORTED_MODULE_3__.A)({subject,workflow:drawingWorkflow}),drawingNoSoundStore=(0,_test_mockStore__WEBPACK_IMPORTED_MODULE_3__.A)({subject:subjectNoSound,workflow:drawingWorkflow});const __WEBPACK_DEFAULT_EXPORT__={title:"Subject Viewers / SingleVideoViewer",component:_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__.A};var Default=function Default(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(mobx_react__WEBPACK_IMPORTED_MODULE_2__.Kq,{classifierStore:noDrawingStore,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(grommet__WEBPACK_IMPORTED_MODULE_0__.a,{width:"large",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__.A,{loadingState:"success",subject:noDrawingStore.subjects.active})})})};Default.displayName="Default";var WithDrawing=function WithDrawing(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(mobx_react__WEBPACK_IMPORTED_MODULE_2__.Kq,{classifierStore:drawingStore,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(grommet__WEBPACK_IMPORTED_MODULE_0__.a,{width:"large",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__.A,{loadingState:"success",subject:drawingStore.subjects.active})})})};WithDrawing.displayName="WithDrawing";var WithDrawingNoSound=function WithDrawingNoSound(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(mobx_react__WEBPACK_IMPORTED_MODULE_2__.Kq,{classifierStore:drawingNoSoundStore,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(grommet__WEBPACK_IMPORTED_MODULE_0__.a,{width:"large",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__.A,{loadingState:"success",subject:drawingNoSoundStore.subjects.active})})})};WithDrawingNoSound.displayName="WithDrawingNoSound";var NoSubject=function NoSubject(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(mobx_react__WEBPACK_IMPORTED_MODULE_2__.Kq,{classifierStore:drawingStore,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(grommet__WEBPACK_IMPORTED_MODULE_0__.a,{width:"large",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_SingleVideoViewerContainer__WEBPACK_IMPORTED_MODULE_5__.A,{})})})};NoSubject.displayName="NoSubject",Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"() => {\n  return <Provider classifierStore={noDrawingStore}>\n      <Box width='large'>\n        <SingleVideoViewerContainer loadingState='success' subject={noDrawingStore.subjects.active} />\n      </Box>\n    </Provider>;\n}",...Default.parameters?.docs?.source}}},WithDrawing.parameters={...WithDrawing.parameters,docs:{...WithDrawing.parameters?.docs,source:{originalSource:"() => {\n  return <Provider classifierStore={drawingStore}>\n      <Box width='large'>\n        <SingleVideoViewerContainer loadingState='success' subject={drawingStore.subjects.active} />\n      </Box>\n    </Provider>;\n}",...WithDrawing.parameters?.docs?.source}}},WithDrawingNoSound.parameters={...WithDrawingNoSound.parameters,docs:{...WithDrawingNoSound.parameters?.docs,source:{originalSource:"() => {\n  return <Provider classifierStore={drawingNoSoundStore}>\n      <Box width='large'>\n        <SingleVideoViewerContainer loadingState='success' subject={drawingNoSoundStore.subjects.active} />\n      </Box>\n    </Provider>;\n}",...WithDrawingNoSound.parameters?.docs?.source}}},NoSubject.parameters={...NoSubject.parameters,docs:{...NoSubject.parameters?.docs,source:{originalSource:"() => {\n  return <Provider classifierStore={drawingStore}>\n      <Box width='large'>\n        <SingleVideoViewerContainer />\n      </Box>\n    </Provider>;\n}",...NoSubject.parameters?.docs?.source}}};const __namedExportsOrder=["Default","WithDrawing","WithDrawingNoSound","NoSubject"]},"./src/components/Classifier/components/SubjectViewer/helpers/locationValidator/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>locationValidator_locationValidator});var valid_url=__webpack_require__("../../node_modules/valid-url/index.js"),mimeTypeRe=/^[-\w+.]+\/[-\w+.]+$/;const locationValidator_locationValidator=function locationValidator(propValue,key,componentName,location,propFullName){var subjectLocation=propValue[key],mimeType=subjectLocation.mimeType,url=subjectLocation.url;if(!mimeTypeRe.test(mimeType)||!(0,valid_url.isUri)(url))return new Error("Invalid prop `"+propFullName+"` supplied to `"+componentName+"`. Validation failed.")}}}]);