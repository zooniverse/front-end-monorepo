(self.webpackChunk_zooniverse_classifier=self.webpackChunk_zooniverse_classifier||[]).push([[4141],{"../../node_modules/sinon/pkg sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="../../node_modules/sinon/pkg sync recursive",module.exports=webpackEmptyContext},"../lib-react-components/dist/esm/MovableModal/MovableModal.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>MovableModal_MovableModal});var react=__webpack_require__("../../node_modules/react/index.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),lib=__webpack_require__("../../node_modules/react-rnd/lib/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var StyledWrapper=styled_components_browser_esm.default.span.withConfig({displayName:"ResizeIcon__StyledWrapper",componentId:"sc-1oobo67-0"})([""," display:flex;justify-content:center;"],(props=>props.theme.dark?(0,styled_components_browser_esm.css)(["color:",";"],props.theme.global.colors.text.dark):(0,styled_components_browser_esm.css)(["color:",";"],props.theme.global.colors.text.light)));const ResizeIcon_ResizeIcon=function ResizeIcon(props){return(0,jsx_runtime.jsx)(StyledWrapper,_objectSpread(_objectSpread({},props),{},{children:"⇲"}))};var withLayer=__webpack_require__("../lib-react-components/dist/esm/helpers/withLayer/withLayer.js"),Modal=__webpack_require__("../lib-react-components/dist/esm/Modal/Modal.js"),_excluded=["children","closeFn","headingBackground","overflow","pad","rndProps","title","titleColor"],_excluded2=["cancel","minHeight","minWidth"];function MovableModal_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MovableModal_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MovableModal_ownKeys(Object(t),!0).forEach((function(r){MovableModal_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MovableModal_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MovableModal_defineProperty(e,r,t){return(r=function MovableModal_toPropertyKey(t){var i=function MovableModal_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==e.indexOf(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],-1===t.indexOf(o)&&{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var defaultRndProps={default:{x:0,y:0},minHeight:100,minWidth:350},MovableModal=(0,react.forwardRef)((function(_ref,ref){var{children,closeFn,headingBackground,overflow="auto",pad,rndProps=defaultRndProps,title="",titleColor}=_ref,rest=_objectWithoutProperties(_ref,_excluded),{cancel,minHeight,minWidth}=rndProps,restRndProps=_objectWithoutProperties(rndProps,_excluded2);return(0,jsx_runtime.jsx)(lib.p,MovableModal_objectSpread(MovableModal_objectSpread({cancel,enableResizing:{bottom:!0,bottomLeft:!1,bottomRight:!0,left:!0,right:!0,top:!0,topLeft:!1,topRight:!1},minHeight,minWidth,resizeHandleComponent:{bottomRight:(0,jsx_runtime.jsx)(ResizeIcon_ResizeIcon,{})},resizeHandleStyles:{bottomLeft:{bottom:0,left:0},bottomRight:{bottom:0,height:"20px",right:0,width:"14px"},topLeft:{left:0,top:0},topRight:{right:0,top:0}}},restRndProps),{},{children:(0,jsx_runtime.jsx)(Modal.a,MovableModal_objectSpread(MovableModal_objectSpread({ref,closeFn,headingBackground,overflow,pad,title,titleColor},rest),{},{children}))}))}));MovableModal.propTypes={children:prop_types.node,closeFn:prop_types.func,headingBackground:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),overflow:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),pad:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),rndProps:(0,prop_types.shape)({cancel:prop_types.string,minHeight:prop_types.number,minWidth:prop_types.number,position:(0,prop_types.shape)({x:prop_types.number,y:prop_types.number})}),title:prop_types.string,titleColor:(0,prop_types.oneOfType)([prop_types.object,prop_types.string])};const MovableModal_MovableModal=(0,withLayer.A)(MovableModal);MovableModal.__docgenInfo={description:"",methods:[],displayName:"MovableModal",props:{children:{description:"",type:{name:"custom",raw:"node"},required:!1},closeFn:{description:"",type:{name:"custom",raw:"func"},required:!1},headingBackground:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},overflow:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},pad:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},rndProps:{description:"",type:{name:"shape",value:{cancel:{name:"string",required:!1},minHeight:{name:"number",required:!1},minWidth:{name:"number",required:!1},position:{name:"shape",value:{x:{name:"number",required:!1},y:{name:"number",required:!1}},required:!1}}},required:!1},title:{description:"",type:{name:"custom",raw:"string"},required:!1},titleColor:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/SubTaskPopup/components/ConfirmModal/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>ConfirmModal_ConfirmModal});var Paragraph=__webpack_require__("../../node_modules/grommet/es6/components/Paragraph/Paragraph.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),Button=__webpack_require__("../../node_modules/grommet/es6/components/Button/Button.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),Modal=__webpack_require__("../lib-react-components/dist/esm/Modal/Modal.js"),PrimaryButton=__webpack_require__("../lib-react-components/dist/esm/PrimaryButton/PrimaryButton.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function ConfirmModal(_ref){var _ref$onClose=_ref.onClose,onClose=void 0===_ref$onClose?function(){return!0}:_ref$onClose,_ref$onDelete=_ref.onDelete,onDelete=void 0===_ref$onDelete?function(){return!0}:_ref$onDelete,t=(0,i18n.Bd)("components").t;return(0,jsx_runtime.jsxs)(Modal.A,{active:!0,modal:!1,children:[(0,jsx_runtime.jsx)(Paragraph.f,{margin:{bottom:"medium"},children:t("SubjectViewer.InteractionLayer.ConfirmModal.confirm")}),(0,jsx_runtime.jsxs)(Box.a,{direction:"row",gap:"small",justify:"center",children:[(0,jsx_runtime.jsx)(Button.$,{label:t("SubjectViewer.InteractionLayer.ConfirmModal.keepWorking"),onClick:onClose}),(0,jsx_runtime.jsx)(PrimaryButton.A,{label:t("SubjectViewer.InteractionLayer.ConfirmModal.close"),color:"teal",onClick:onDelete})]})]})}ConfirmModal.displayName="ConfirmModal",ConfirmModal.propTypes={onClose:prop_types.func,onDelete:prop_types.func};const ConfirmModal_ConfirmModal=ConfirmModal;ConfirmModal.__docgenInfo={description:"An alert which confirms 'keep working' or 'delete' for incomplete annotations. Incomplete annotations must be either completed or deleted.",methods:[],displayName:"ConfirmModal",props:{onClose:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1},onDelete:{defaultValue:{value:"() => true",computed:!1},description:"",type:{name:"custom",raw:"func"},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/SubTaskPopup/components/SaveButton/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>SaveButton_SaveButton});var PrimaryButton=__webpack_require__("../lib-react-components/dist/esm/PrimaryButton/PrimaryButton.js"),withThemeContext=__webpack_require__("../lib-react-components/dist/esm/helpers/withThemeContext/withThemeContext.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js");const SaveButton_theme={text:{extend:function extend(props){return(0,styled_components_browser_esm.css)(["text-transform:capitalize;html[lang=\"ar\"],html[lang=\"he\"]{&:after{content:' ←';}}&:after{content:' →';}"])}}};var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function SaveButton(_ref){var _ref$autoFocus=_ref.autoFocus,autoFocus=void 0!==_ref$autoFocus&&_ref$autoFocus,_ref$disabled=_ref.disabled,disabled=void 0!==_ref$disabled&&_ref$disabled,onClick=_ref.onClick,label=(0,(0,i18n.Bd)("components").t)("SubjectViewer.InteractionLayer.SaveButton.save");return(0,jsx_runtime.jsx)(PrimaryButton.A,{autoFocus,disabled,label,onClick})}SaveButton.displayName="SaveButton",SaveButton.propTypes={autoFocus:prop_types.bool,disabled:prop_types.bool,onClick:prop_types.func.isRequired};const SaveButton_SaveButton=(0,withThemeContext.A)(SaveButton,SaveButton_theme);SaveButton.__docgenInfo={description:"",methods:[],displayName:"SaveButton",props:{autoFocus:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"custom",raw:"bool"},required:!1},disabled:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"custom",raw:"bool"},required:!1},onClick:{description:"",type:{name:"func"},required:!0}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/ConsensusPopup/ConsensusPopup.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>ConsensusPopup});var prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),Paragraph=__webpack_require__("../../node_modules/grommet/es6/components/Paragraph/Paragraph.js"),Text=__webpack_require__("../../node_modules/grommet/es6/components/Text/Text.js"),List=__webpack_require__("../../node_modules/grommet/es6/components/List/List.js"),MovableModal=__webpack_require__("../lib-react-components/dist/esm/MovableModal/MovableModal.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),getDefaultPosition=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/helpers/getDefaultPosition/getDefaultPosition.js"),MIN_POPUP_WIDTH=350,MIN_POPUP_HEIGHT=250,jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),StyledBox=(0,styled_components_browser_esm.default)(Box.a).withConfig({displayName:"ConsensusPopup__StyledBox",componentId:"sc-4q4c0a-0"})(['font-family:"Roboto Mono Regular",monospace;ul{font-size:0.8em;}']);function ConsensusPopup(_ref){var _ref$active=_ref.active,active=void 0!==_ref$active&&_ref$active,_ref$bounds=_ref.bounds,bounds=void 0===_ref$bounds?void 0:_ref$bounds,_ref$closeFn=_ref.closeFn,closeFn=void 0===_ref$closeFn?function(){}:_ref$closeFn,_ref$line=_ref.line,line=void 0===_ref$line?{consensusText:"",textOptions:[]}:_ref$line,t=(0,i18n.Bd)("components").t,itemProps={},position=(0,getDefaultPosition.A)(bounds,MIN_POPUP_HEIGHT,MIN_POPUP_WIDTH);return line.textOptions.forEach((function(option,index){return itemProps[index]={border:!1,pad:{horizontal:"none",vertical:"xsmall"}}})),(0,jsx_runtime.jsxs)(MovableModal.A,{active,closeFn,headingBackground:{dark:"dark-5",light:"neutral-6"},height:{min:"250px",max:"350px"},onWheel:function onWheel(event){event.stopPropagation()},pad:{bottom:"medium",left:"medium",right:"medium"},position:"top-left",plain:!0,rndProps:{cancel:".element-that-ignores-drag-actions",default:position,maxHeight:350,minHeight:MIN_POPUP_HEIGHT,minWidth:MIN_POPUP_WIDTH},title:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.title"),titleColor:"",children:[(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.explanation",{count:line.textOptions.length})}),(0,jsx_runtime.jsxs)(StyledBox,{className:"element-that-ignores-drag-actions",children:[line.consensusText&&(0,jsx_runtime.jsxs)(Paragraph.f,{children:[line.consensusText,(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsx)("em",{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.aggregatedTranscription")})})]}),!line.consensusText&&(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.noAggregation")}),line.textOptions.length>0&&(0,jsx_runtime.jsx)(List.B,{data:line.textOptions,itemKey:function itemKey(item,index){return"line-".concat(index)},itemProps}),0===line.textOptions.length&&(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.transcriptionsUnavailable")})]})]})}ConsensusPopup.displayName="ConsensusPopup",ConsensusPopup.propTypes={active:prop_types.bool,bounds:prop_types.object,closeFn:prop_types.func,line:(0,prop_types.shape)({consensusText:prop_types.string,textOptions:prop_types.array})},ConsensusPopup.__docgenInfo={description:"A popup which shows the previous annotations for a single transcription line.",methods:[],displayName:"ConsensusPopup",props:{active:{defaultValue:{value:"false",computed:!1},description:"Modal active state.",type:{name:"custom",raw:"bool"},required:!1},bounds:{defaultValue:{value:"undefined",computed:!0},description:"Bounding rectangle in the browser.",type:{name:"custom",raw:"object"},required:!1},closeFn:{defaultValue:{value:"() => {}",computed:!1},description:"Callback for the modal's close button.",type:{name:"custom",raw:"func"},required:!1},line:{defaultValue:{value:"{\n  consensusText: '',\n  textOptions: []\n}",computed:!1},description:"Consensus options for the current line.",type:{name:"shape",value:{consensusText:{name:"string",required:!1},textOptions:{name:"array",required:!1}}},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/TooltipIcon/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>TooltipIcon});var prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),Blank=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Blank.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function TooltipIcon(_ref){var fill=_ref.fill;return(0,jsx_runtime.jsx)(Blank.h,{color:fill,children:(0,jsx_runtime.jsx)("circle",{cx:"12",cy:"12",r:"6"})})}TooltipIcon.displayName="TooltipIcon",TooltipIcon.propTypes={fill:prop_types.string},TooltipIcon.__docgenInfo={description:"",methods:[],displayName:"TooltipIcon",props:{fill:{description:"",type:{name:"custom",raw:"string"},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>TranscribedLines_TranscribedLines});var mobxreact_esm=__webpack_require__("../../node_modules/mobx-react/dist/mobxreact.esm.js"),react=__webpack_require__("../../node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),Tooltip=__webpack_require__("../lib-react-components/dist/esm/Tooltip/Tooltip.js"),hooks=__webpack_require__("./src/hooks/index.js"),components=__webpack_require__("./src/plugins/drawingTools/components/index.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),TooltipIcon=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/TooltipIcon/index.js"),ConsensusPopup=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/ConsensusPopup/ConsensusPopup.jsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var ConsensusLine=styled_components_browser_esm.default.g.withConfig({displayName:"TranscribedLines__ConsensusLine",componentId:"sc-jddd70-0"})(["cursor:pointer;filter:drop-shadow(1px 1px 4px #5c5c5c);&:focus{outline:none;}&:focus-visible{",'}&[aria-disabled="true"]{cursor:not-allowed;opacity:0.3;}'],(function(props){return(0,styled_components_browser_esm.css)(["outline:solid medium ",";"],props.focusColor)})),defaultLine={consensusText:"",textOptions:[]};function onClick(event,callback,line){callback(line,event.target)}function onKeyDown(event,callback,line){if("Enter"===event.key||" "===event.key){var node=event.target;event.preventDefault(),callback(line,node)}}function TranscribedLines(){var _useTranscriptionRedu=(0,hooks.ef)(),active=_useTranscriptionRedu.active,annotation=_useTranscriptionRedu.annotation,frame=_useTranscriptionRedu.frame,invalidMark=_useTranscriptionRedu.invalidMark,lines=_useTranscriptionRedu.lines,marks=_useTranscriptionRedu.marks,task=_useTranscriptionRedu.task,visible=_useTranscriptionRedu.visible,theme=(0,styled_components_browser_esm.useTheme)(),_useState2=_slicedToArray((0,react.useState)({}),2),bounds=_useState2[0],setBounds=_useState2[1],_useState4=_slicedToArray((0,react.useState)(defaultLine),2),line=_useState4[0],setLine=_useState4[1],_useState6=_slicedToArray((0,react.useState)(!1),2),show=_useState6[0],setShow=_useState6[1],activeLine=(0,react.useRef)(null),scrollPosition=(0,react.useRef)(null),t=(0,i18n.Bd)("components").t;if((0,react.useEffect)((function handleVisibilityChange(){!show&&activeLine.current&&(activeLine.current.focus({preventScroll:!0}),scrollPosition.current&&window.scrollTo(scrollPosition.current.x,scrollPosition.current.y))}),[show]),!visible)return null;var invalidTranscriptionTask=!active||0===Object.keys(task).length,completedLines=lines.filter((function(line){return line.consensusReached})),transcribedLines=lines.filter((function(line){return!line.consensusReached})),fills_transcribed="drawing-pink",fills_complete="light-4",focusColor=theme.global.colors[theme.global.colors.focus];function createMark(line,node){var activeTool=task.activeTool,activeToolIndex=task.activeToolIndex,setActiveMark=task.setActiveMark;if(activeTool){var _line$points=_slicedToArray(line.points,2),_line$points$=_line$points[0],x1=_line$points$.x,y1=_line$points$.y,_line$points$2=_line$points[1],x2=_line$points$2.x,y2=_line$points$2.y,id=line.id,markSnapshot={frame,id,x1,y1,x2,y2,toolIndex:activeToolIndex},mark=activeTool.createMark(markSnapshot);setActiveMark(mark);var previousAnnotationValuesForEachMark=[];activeTool.tasks.forEach((function(task){var previousAnnotationValuesForThisMark={id:mark.id,taskKey:task.taskKey,taskType:task.type,values:line.textOptions};previousAnnotationValuesForEachMark.push(previousAnnotationValuesForThisMark)})),mark.setPreviousAnnotations(previousAnnotationValuesForEachMark),mark.finish();var value=annotation.value.slice();annotation.update([].concat(_toConsumableArray(value),[mark.id]))}}function showConsensus(line,node){activeLine.current=document.activeElement,scrollPosition.current={x:window.scrollX,y:window.scrollY};var bounds=(null==node?void 0:node.getBoundingClientRect())||{};setBounds(bounds),setLine(line),setShow(!0)}return(0,jsx_runtime.jsxs)("g",{children:[completedLines.map((function(line,index){var _line$points2=_slicedToArray(line.points,2),_line$points2$=_line$points2[0],x1=_line$points2$.x,y1=_line$points2$.y,_line$points2$2=_line$points2[1],x2=_line$points2$2.x,y2=_line$points2$2.y,mark={length:Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),x1,y1,x2,y2},id="complete-".concat(index),disabled=invalidMark,lineProps={};return disabled||(lineProps.onClick=function(event){return onClick(event,showConsensus,line)},lineProps.onKeyDown=function(event){return onKeyDown(event,showConsensus,line)}),(0,jsx_runtime.jsx)(Tooltip.A,{id,icon:(0,jsx_runtime.jsx)(TooltipIcon.A,{fill:fills_complete}),label:t("SubjectViewer.InteractionLayer.TranscribedLines.complete"),children:(0,jsx_runtime.jsx)(ConsensusLine,_objectSpread(_objectSpread({role:"button","aria-disabled":disabled.toString(),"aria-describedby":id,"aria-label":line.consensusText,className:"complete line",focusColor,pointerEvents:disabled?"none":"painted",tabIndex:disabled?-1:0},lineProps),{},{children:(0,jsx_runtime.jsx)(components.Xj,{state:"complete",mark})}))},line.id)})),transcribedLines.map((function(line,index){var _marks$filter=marks.filter((function(mark){return mark.id===line.id})),existingMark=_slicedToArray(_marks$filter,1)[0],disabled=invalidTranscriptionTask||invalidMark||!!existingMark,_line$points3=_slicedToArray(line.points,2),_line$points3$=_line$points3[0],x1=_line$points3$.x,y1=_line$points3$.y,_line$points3$2=_line$points3[1],x2=_line$points3$2.x,y2=_line$points3$2.y,mark={length:Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),x1,y1,x2,y2},id="transcribed-".concat(index),lineProps={};return disabled||(lineProps.onClick=function(event){return onClick(event,createMark,line)},lineProps.onKeyDown=function(event){return onKeyDown(event,createMark,line)}),(0,jsx_runtime.jsx)(Tooltip.A,{id,icon:(0,jsx_runtime.jsx)(TooltipIcon.A,{fill:fills_transcribed}),label:t("SubjectViewer.InteractionLayer.TranscribedLines.transcribed"),children:(0,jsx_runtime.jsx)(ConsensusLine,_objectSpread(_objectSpread({role:"button","aria-describedby":id,"aria-disabled":disabled.toString(),"aria-label":line.consensusText,className:"transcribed line",focusColor,pointerEvents:disabled?"none":"painted",tabIndex:disabled?-1:0},lineProps),{},{children:(0,jsx_runtime.jsx)(components.Xj,{state:"transcribed",mark})}))},line.id)})),(0,jsx_runtime.jsx)(ConsensusPopup.A,{active:show,closeFn:function close(event){event.preventDefault(),event.stopPropagation(),setBounds({}),setLine(defaultLine),setShow(!1)},line,bounds})]})}TranscribedLines.displayName="TranscribedLines",TranscribedLines.propTypes={};const TranscribedLines_TranscribedLines=(0,mobxreact_esm.PA)(TranscribedLines);TranscribedLines.__docgenInfo={description:"",methods:[],displayName:"TranscribedLines"}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/helpers/getDefaultPosition/getDefaultPosition.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>getDefaultPosition});var MIN_HEIGHT=200,MIN_WIDTH=350;function getDefaultPosition(){var _window,_window2,bounds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},minHeight=arguments.length>1&&void 0!==arguments[1]?arguments[1]:MIN_HEIGHT,minWidth=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MIN_WIDTH,viewport_height=null===(_window=window)||void 0===_window?void 0:_window.innerHeight,viewport_width=null===(_window2=window)||void 0===_window2?void 0:_window2.innerWidth,x=0,y=0;if(bounds){var markX=bounds.x||0,markY=bounds.y||0,markWidth=bounds.width||0,markHeight=bounds.height||0,yOffset=markHeight;viewport_height-(markY+markHeight)<minHeight&&(yOffset=0-(minHeight+markHeight)),x=markX+.5*markWidth,y=markY+yOffset}var rightLimit=viewport_width-minWidth||0,bottomLimit=viewport_height-minHeight||0;return x=Math.max(x,0),y=Math.max(y,0),{x:x=Math.min(x,rightLimit),y:y=Math.min(y,bottomLimit)}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>InteractionLayer_InteractionLayerContainer});var mobx_state_tree_module=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),cuid=__webpack_require__("../../node_modules/cuid/index.js"),cuid_default=__webpack_require__.n(cuid),react=__webpack_require__("../../node_modules/react/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),draggable=__webpack_require__("./src/plugins/drawingTools/components/draggable/draggable.jsx"),mobxreact_esm=__webpack_require__("../../node_modules/mobx-react/dist/mobxreact.esm.js"),hooks=__webpack_require__("./src/hooks/index.js"),components=__webpack_require__("./src/plugins/drawingTools/components/index.js"),Tooltip=(__webpack_require__("./src/plugins/drawingTools/experimental/components/FreehandLine/index.js"),__webpack_require__("../lib-react-components/dist/esm/Tooltip/Tooltip.js")),SVGContext=__webpack_require__("./src/plugins/drawingTools/shared/SVGContext.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),Close=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Close.js"),Checkmark=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Checkmark.js"),Undo=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Undo.js"),Redo=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Redo.js"),Radial=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Radial.js"),Trash=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Trash.js"),Pan=__webpack_require__("../../node_modules/grommet-icons/es6/icons/Pan.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var StyledGroup=styled_components_browser_esm.default.g.withConfig({displayName:"LineControls__StyledGroup",componentId:"sc-nuhwlg-0"})(["cursor:pointer;pointer-events:all !important;"]),DEFAULT_TRANSFORM_MATRIX={scaleX:1,scaleY:1,skewX:0,skewY:0,translateX:0,translateY:0},LineControls=(0,react.forwardRef)((function LineControls(_ref,ref){var mark=_ref.mark,onDelete=_ref.onDelete,theme=_ref.theme,_useState2=_slicedToArray((0,react.useState)("tl"),2),activePosition=_useState2[0],setActivePosition=_useState2[1],_useState4=_slicedToArray((0,react.useState)(!1),2),showDeleteButtons=_useState4[0],setShowDeleteButtons=_useState4[1],t=(0,i18n.Bd)("plugins").t,_useContext=(0,react.useContext)(SVGContext.A),canvas=_useContext.canvas,rotate=_useContext.rotate,_useContext$transform=_useContext.transformMatrix,transformMatrix=void 0===_useContext$transform?DEFAULT_TRANSFORM_MATRIX:_useContext$transform,scaleX=transformMatrix.scaleX,scaleY=transformMatrix.scaleY,translateX=transformMatrix.translateX,translateY=transformMatrix.translateY,FILL_COLOR=theme.dark?"#333333":"#ffffff",STROKE_COLOR=theme.dark?"#ffffff":"#000000",STROKE_WIDTH=.5/scaleX,OUTER_RADIUS=40/scaleX,INNER_RADIUS=20/scaleX,_canvas$getBBox=canvas.getBBox(),width=_canvas$getBBox.width,height=_canvas$getBBox.height,y=(70-translateY)/scaleY,p="tl"===activePosition?{x:(70-translateX)/scaleX,y}:{x:(width-translateX-70)/scaleX,y};var deleteButtons=[{label:t("LineControls.deleteCancel"),action:function deleteMarkCancel(){setShowDeleteButtons(!1)},icon:{type:Close.b,size:16/scaleX,x:p.x-27/scaleX,y:p.y-8/scaleY,color:"#E45950"},path:"M ".concat(p.x," ").concat(p.y+OUTER_RADIUS,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 1 ").concat(p.x," ").concat(p.y-OUTER_RADIUS,"\n        L ").concat(p.x," ").concat(p.y,"\n        Z")},{label:t("LineControls.deleteConfirm"),action:function deleteMarkConfirm(event){return event.preventDefault(),event.stopPropagation(),onDelete(event)},icon:{type:Checkmark.M,size:18/scaleX,x:p.x+12/scaleX,y:p.y-10/scaleY,color:"#1ED359"},path:"M ".concat(p.x," ").concat(p.y+OUTER_RADIUS,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 0 ").concat(p.x," ").concat(p.y-OUTER_RADIUS,"\n        Z")}],defaultButtons=[{label:t("LineControls.undo"),action:function undo(event){return event.preventDefault(),event.stopPropagation(),mark.undo()},icon:{type:Undo.V,size:10/scaleX,x:p.x-27/scaleX,y:p.y-27/scaleY,color:STROKE_COLOR},path:"M ".concat(p.x-OUTER_RADIUS," ").concat(p.y,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 1 ").concat(p.x," ").concat(p.y-OUTER_RADIUS,"\n        L ").concat(p.x," ").concat(p.y-INNER_RADIUS,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 0 ").concat(p.x-INNER_RADIUS," ").concat(p.y,"\n        Z")},{label:t("LineControls.redo"),action:mark.redo,icon:{type:Redo.B,size:10/scaleX,x:p.x+17/scaleX,y:p.y-27/scaleY,color:STROKE_COLOR},path:"M ".concat(p.x+OUTER_RADIUS," ").concat(p.y,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 0 ").concat(p.x," ").concat(p.y-OUTER_RADIUS,"\n        L ").concat(p.x," ").concat(p.y-INNER_RADIUS,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 1 ").concat(p.x+INNER_RADIUS," ").concat(p.y,"\n        Z")},{label:t("LineControls.close"),action:mark.close,icon:{type:Radial.s,size:10/scaleX,x:p.x-27/scaleX,y:p.y+17/scaleY,color:STROKE_COLOR},path:"M ".concat(p.x-OUTER_RADIUS," ").concat(p.y,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 0 ").concat(p.x," ").concat(p.y+OUTER_RADIUS,"\n        L ").concat(p.x," ").concat(p.y+INNER_RADIUS,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 1 ").concat(p.x-INNER_RADIUS," ").concat(p.y,"\n        Z")},{label:t("LineControls.delete"),action:function deleteMark(){setShowDeleteButtons(!0)},icon:{type:Trash.l,size:10/scaleX,x:p.x+17/scaleX,y:p.y+17/scaleY,color:STROKE_COLOR},path:"M ".concat(p.x+OUTER_RADIUS," ").concat(p.y,"\n        A ").concat(OUTER_RADIUS," ").concat(OUTER_RADIUS," 0 0 1 ").concat(p.x," ").concat(p.y+OUTER_RADIUS,"\n        L ").concat(p.x," ").concat(p.y+INNER_RADIUS,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 0 ").concat(p.x+INNER_RADIUS," ").concat(p.y,"\n        Z")},{label:t("LineControls.move"),action:function action(){setActivePosition("tl"==activePosition?"tr":"tl")},icon:{type:Pan.u,size:20/scaleX,x:p.x-10/scaleX,y:p.y-10/scaleY,color:STROKE_COLOR},path:"M ".concat(p.x-INNER_RADIUS," ").concat(p.y,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 0 ").concat(p.x+INNER_RADIUS," ").concat(p.y,"\n        A ").concat(INNER_RADIUS," ").concat(INNER_RADIUS," 0 0 0 ").concat(p.x-INNER_RADIUS," ").concat(p.y,"\n        Z")}],buttons=showDeleteButtons?deleteButtons:defaultButtons;return(0,jsx_runtime.jsx)(StyledGroup,{ref,role:"group","aria-label":t("lineControls.lineControls"),focusable:"false",fill:FILL_COLOR,transform:"rotate(".concat(-rotate," ").concat(width/2," ").concat(height/2,")"),children:buttons.map((function(_ref2,index){var label=_ref2.label,path=_ref2.path,action=_ref2.action,icon=_ref2.icon,IconComponent=icon.type;return(0,jsx_runtime.jsxs)("g",{focusable:"false",children:[(0,jsx_runtime.jsx)(Tooltip.A,{label,children:(0,jsx_runtime.jsx)("path",{role:"button","aria-label":label,focusable:"true",tabIndex:"0",d:path,stroke:STROKE_COLOR,strokeWidth:STROKE_WIDTH,onPointerDown:action,onKeyDown:function onKeyDown(ev){!function onEnterOrSpace(ev,func){if(13===ev.keyCode||32===ev.keyCode)return ev.preventDefault(),ev.stopPropagation(),func(ev)}(ev,action)}})}),(0,jsx_runtime.jsx)("svg",{height:icon.size,width:icon.size,x:icon.x,y:icon.y,children:(0,jsx_runtime.jsx)(IconComponent,{color:icon.color,size:"".concat(icon.size,"px"),focusable:"false"})})]},index)}))})}));LineControls.propTypes={mark:prop_types_default().shape({id:prop_types_default().string,setSubTaskVisibility:prop_types_default().func}),onDelete:prop_types_default().func};const LineControls_LineControls=(0,styled_components_browser_esm.withTheme)(LineControls);LineControls.__docgenInfo={description:"",methods:[],displayName:"LineControls",props:{mark:{description:"",type:{name:"shape",value:{id:{name:"string",required:!1},setSubTaskVisibility:{name:"func",required:!1}}},required:!1},onDelete:{description:"",type:{name:"func"},required:!1}}};__webpack_require__("./src/plugins/drawingTools/experimental/components/TranscriptionLine/index.js");function isInBounds(markElement,canvas){if(!canvas)return!0;if(!markElement)return!0;var object=markElement.getBoundingClientRect(),bounds=canvas.getBoundingClientRect(),notBeyondLeft=object.left+object.width>bounds.left,notBeyondRight=object.left<bounds.left+bounds.width,notBeyondTop=object.top+object.height>bounds.top,notBeyondBottom=object.top<bounds.top+bounds.height;return notBeyondLeft&&notBeyondRight&&notBeyondTop&&notBeyondBottom}function DrawingToolMarks(_ref){var _ref$activeMark=_ref.activeMark,activeMark=void 0===_ref$activeMark?{id:"",setSubTaskVisibility:function setSubTaskVisibility(){}}:_ref$activeMark,_ref$disabled=_ref.disabled,disabled=void 0!==_ref$disabled&&_ref$disabled,_ref$marks=_ref.marks,marks=void 0===_ref$marks?[]:_ref$marks,_ref$onDelete=_ref.onDelete,onDelete=void 0===_ref$onDelete?function(){return!0}:_ref$onDelete,_ref$onDeselectMark=_ref.onDeselectMark,onDeselectMark=void 0===_ref$onDeselectMark?function(){return!0}:_ref$onDeselectMark,_ref$onFinish=_ref.onFinish,onFinish=void 0===_ref$onFinish?function(){return!0}:_ref$onFinish,_ref$onMove=_ref.onMove,onMove=void 0===_ref$onMove?function(){return!0}:_ref$onMove,_ref$onSelectMark=_ref.onSelectMark,onSelectMark=void 0===_ref$onSelectMark?function(){return!0}:_ref$onSelectMark,_ref$pointerEvents=_ref.pointerEvents,pointerEvents=void 0===_ref$pointerEvents?"painted":_ref$pointerEvents,played=_ref.played,canvas=(0,react.useContext)(SVGContext.A).canvas;return marks.map((function(mark,index){var tool=mark.tool,videoTime=mark.videoTime,MarkingComponent=mark.toolComponent,isActive=mark.id===(null==activeMark?void 0:activeMark.id);function deleteMark(){activeMark.setSubTaskVisibility(!1),tool.deleteMark(mark),onDelete(mark)}function selectMark(){onSelectMark(mark)}return void 0!==videoTime&&played<videoTime?null:(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsxs)(components.CU,{isActive,coords:mark.coords,disabled,dragStart:selectMark,dragMove:function moveMark(_event,difference){onMove(mark,difference)},dragEnd:function endMoveMark(event){null!=event&&event.currentTarget&&!isInBounds(event.currentTarget,canvas)?deleteMark():onFinish(event)},label:"Mark ".concat(index),mark,onDelete:deleteMark,onFinish,onSelect:selectMark,pointerEvents:isActive?"painted":pointerEvents,children:[(0,jsx_runtime.jsx)(MarkingComponent,{active:isActive,mark,onFinish,played}),isActive&&"freehandLine"!==mark.tool.type&&(0,jsx_runtime.jsx)(components.et,{label:"Delete ".concat(tool.type),mark,onDelete:deleteMark,onDeselect:function deselectMark(event){null!=event&&event.currentTarget&&!isInBounds(event.currentTarget,canvas)?deleteMark():onDeselectMark(mark)}})]}),isActive&&"freehandLine"==mark.tool.type&&(0,jsx_runtime.jsx)(LineControls_LineControls,{mark,onDelete:deleteMark})]},mark.id)}))}DrawingToolMarks.propTypes={activeMark:prop_types_default().shape({id:prop_types_default().string,setSubTaskVisibility:prop_types_default().func}),marks:prop_types_default().array.isRequired,onDelete:prop_types_default().func,onDeselectMark:prop_types_default().func,onFinish:prop_types_default().func,onMove:prop_types_default().func,onSelectMark:prop_types_default().func,pointerEvents:prop_types_default().oneOf(["all","none","painted"])};function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const DrawingToolMarksConnector=function withMachineLearntReductions(Component){function WithMachineLearntReductions(props,ref){var taskProps=(0,hooks.Fw)();return(0,jsx_runtime.jsx)(Component,_objectSpread(_objectSpread({ref},props),taskProps))}return(0,mobxreact_esm.PA)((0,react.forwardRef)(WithMachineLearntReductions))}(DrawingToolMarks);var TranscribedLines=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/index.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),Paragraph=__webpack_require__("../../node_modules/grommet/es6/components/Paragraph/Paragraph.js"),MovableModal=__webpack_require__("../lib-react-components/dist/esm/MovableModal/MovableModal.js"),plugins_tasks=__webpack_require__("./src/plugins/tasks/index.js"),getDefaultPosition=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/helpers/getDefaultPosition/getDefaultPosition.js"),ConfirmModal=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/SubTaskPopup/components/ConfirmModal/index.js"),SaveButton=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/SubTaskPopup/components/SaveButton/index.js");function SubTaskPopup_slicedToArray(r,e){return function SubTaskPopup_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function SubTaskPopup_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function SubTaskPopup_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return SubTaskPopup_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?SubTaskPopup_arrayLikeToArray(r,a):void 0}}(r,e)||function SubTaskPopup_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SubTaskPopup_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var DEFAULT_HANDLER=function DEFAULT_HANDLER(){return!1},DEFAULT_ACTIVE_MARK={subTaskMarkBounds:void 0,subTaskPreviousAnnotationValues:void 0,subTaskVisibility:!1,setSubTaskVisibility:DEFAULT_HANDLER};function SubTaskPopup(_ref){var _ref$activeMark=_ref.activeMark,activeMark=void 0===_ref$activeMark?DEFAULT_ACTIVE_MARK:_ref$activeMark,_ref$onDelete=_ref.onDelete,onDelete=void 0===_ref$onDelete?DEFAULT_HANDLER:_ref$onDelete,subTaskMarkBounds=activeMark.subTaskMarkBounds,subTaskVisibility=activeMark.subTaskVisibility,subTaskPreviousAnnotationValues=activeMark.subTaskPreviousAnnotationValues,setSubTaskVisibility=activeMark.setSubTaskVisibility,t=(0,i18n.Bd)("components").t,_useClientRect2=SubTaskPopup_slicedToArray((0,hooks.F)(),2),dimensions=_useClientRect2[0],measuredContentRef=_useClientRect2[1],_useState2=SubTaskPopup_slicedToArray((0,react.useState)("pending"),2),confirmationState=_useState2[0],setConfirm=_useState2[1],_useState4=SubTaskPopup_slicedToArray((0,react.useState)(null),2),position=_useState4[0],setPosition=_useState4[1];if(!subTaskVisibility)return null;var tasks=null!=activeMark&&activeMark.tasks?activeMark.tasks:[];function close(event){event.preventDefault(),event.stopPropagation(),activeMark.isComplete?(setSubTaskVisibility(!1),activeMark.setPreviousAnnotations()):setConfirm("confirming")}var minHeight=(null==dimensions?void 0:dimensions.height)||200,minWidth=(null==dimensions?void 0:dimensions.width)||350,defaultPosition=(0,getDefaultPosition.A)(subTaskMarkBounds,minHeight,minWidth),disabled="confirming"===confirmationState,onDragStop=(0,react.useCallback)((function(event,data){var x=data.x,y=data.y;setPosition({x,y})})),onResize=(0,react.useCallback)((function(event,direction,ref,delta,position){setPosition(position)})),rndProps={cancel:".element-that-ignores-drag-actions",minHeight,minWidth,onDragStop,onResize,position:position||defaultPosition};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(MovableModal.A,{ref:measuredContentRef,active:!0,closeFn:close,headingBackground:"transparent",onWheel:function onWheel(event){event.stopPropagation()},pad:{bottom:"medium",left:"medium",right:"medium"},plain:!0,position:"top-left",rndProps,titleColor:"",children:(0,jsx_runtime.jsx)(Box.a,{className:"element-that-ignores-drag-actions",gap:"small",children:(0,jsx_runtime.jsxs)("form",{onSubmit:close,children:[tasks.map((function(task,index){var annotation=activeMark.annotation(task);annotation||(annotation=activeMark.addAnnotation(task));var taskType=task.type;"dropdown-simple"===taskType&&(taskType="dropdownSimple");var TaskComponent=plugins_tasks[taskType].TaskComponent;if(annotation&&TaskComponent){var _subTaskPreviousAnnot,requiredEmphasis=task.required&&!task.isComplete(annotation)&&"closed"===confirmationState;return(0,jsx_runtime.jsxs)(Box.a,{className:"subtaskpopup-task",border:!!requiredEmphasis&&{size:"small",color:"tomato"},overflow:"auto",pad:{horizontal:"2px"},children:[(0,jsx_runtime.jsx)(TaskComponent,{annotation,autoFocus:0===index,disabled,suggestions:null==subTaskPreviousAnnotationValues||null===(_subTaskPreviousAnnot=subTaskPreviousAnnotationValues.get(task.taskKey))||void 0===_subTaskPreviousAnnot?void 0:_subTaskPreviousAnnot.values,task}),requiredEmphasis&&(0,jsx_runtime.jsx)(Paragraph.f,{children:(0,jsx_runtime.jsx)("strong",{children:t("SubjectViewer.InteractionLayer.SubTaskPopup.required")})})]},annotation.id)}return(0,jsx_runtime.jsx)(Box.a,{pad:"none",children:(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.SubTaskPopup.notRender")})},"".concat(index,"-").concat(null==task?void 0:task.type))})),(0,jsx_runtime.jsx)(SaveButton.A,{disabled,onClick:close})]})})}),"confirming"===confirmationState&&(0,jsx_runtime.jsx)(ConfirmModal.A,{onClose:function onCloseConfirm(){setConfirm("closed")},onDelete:function deleteMark(){var tool=activeMark.tool;setConfirm("closed"),setSubTaskVisibility(!1),tool.deleteMark(activeMark),onDelete()}})]})}SubTaskPopup.propTypes={activeMark:prop_types_default().shape({subTaskMarkBounds:prop_types_default().object,subTaskPreviousAnnotationValues:mobxreact_esm.By.observableMap,subTaskVisibility:prop_types_default().bool,setSubTaskVisibility:prop_types_default().func}),onDelete:prop_types_default().func};const SubTaskPopup_SubTaskPopup=SubTaskPopup;SubTaskPopup.__docgenInfo={description:"A popup that renders activeMark.tasks for the active mark. Incomplete task annotations are confirmed, on save or close, for required tasks.",methods:[],displayName:"SubTaskPopup",props:{activeMark:{defaultValue:{value:"{\n  subTaskMarkBounds: undefined,\n  subTaskPreviousAnnotationValues: undefined,\n  subTaskVisibility: false,\n  setSubTaskVisibility: DEFAULT_HANDLER\n}",computed:!1},description:"",type:{name:"shape",value:{subTaskMarkBounds:{name:"object",required:!1},subTaskPreviousAnnotationValues:{name:"custom",raw:"MobXPropTypes.observableMap",required:!1},subTaskVisibility:{name:"bool",required:!1},setSubTaskVisibility:{name:"func",required:!1}}},required:!1},onDelete:{defaultValue:{value:"() => false",computed:!1},description:"",type:{name:"func"},required:!1}}};const SubTaskPopupContainer=(0,mobxreact_esm.PA)((function SubTaskPopupContainer(_ref){var activeMark=_ref.activeMark,onDelete=_ref.onDelete;return activeMark&&activeMark.subTaskVisibility?(0,jsx_runtime.jsx)(SubTaskPopup_SubTaskPopup,{activeMark,onDelete}):null}));function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return InteractionLayer_arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||InteractionLayer_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function InteractionLayer_slicedToArray(r,e){return function InteractionLayer_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function InteractionLayer_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||InteractionLayer_unsupportedIterableToArray(r,e)||function InteractionLayer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function InteractionLayer_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return InteractionLayer_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?InteractionLayer_arrayLikeToArray(r,a):void 0}}function InteractionLayer_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var DrawingCanvas=(0,styled_components_browser_esm.default)("rect").withConfig({displayName:"InteractionLayer__DrawingCanvas",componentId:"sc-j9ll7u-0"})(["",""],(function(props){return props.disabled?(0,styled_components_browser_esm.css)(["cursor:not-allowed;"]):(0,styled_components_browser_esm.css)(["cursor:crosshair;"])}));function cancelEvent(event){event.preventDefault(),event.stopPropagation()}function InteractionLayer(_ref){var activeMark=_ref.activeMark,activeTool=_ref.activeTool,_ref$activeToolIndex=_ref.activeToolIndex,activeToolIndex=void 0===_ref$activeToolIndex?0:_ref$activeToolIndex,annotation=_ref.annotation,_ref$disabled=_ref.disabled,disabled=void 0!==_ref$disabled&&_ref$disabled,_ref$frame=_ref.frame,frame=void 0===_ref$frame?0:_ref$frame,height=_ref.height,_ref$marks=_ref.marks,marks=void 0===_ref$marks?[]:_ref$marks,move=_ref.move,_ref$multiImageCloneM=_ref.multiImageCloneMarkers,multiImageCloneMarkers=void 0!==_ref$multiImageCloneM&&_ref$multiImageCloneM,_ref$setActiveMark=_ref.setActiveMark,setActiveMark=void 0===_ref$setActiveMark?function(){}:_ref$setActiveMark,width=_ref.width,played=_ref.played,duration=_ref.duration,_useState2=InteractionLayer_slicedToArray((0,react.useState)(!1),2),creating=_useState2[0],setCreating=_useState2[1],canvasRef=(0,react.useRef)(null);function createMark(event){var _annotation$value,timeStamp=function getFixedNumber(number,digits){return digits||console.log("getFixedNumber: Missing digits variable"),Math.round(number*Math.pow(10,digits))/Math.pow(10,digits)}(played,5),mark=activeTool.createMark({id:cuid_default()(),frame:multiImageCloneMarkers?0:frame,toolIndex:activeToolIndex});mark.initialPosition((0,draggable.U)(event,canvasRef.current)),setActiveMark(mark),setCreating(!0),mark.setSubTaskVisibility(!1),mark.setVideoTime(timeStamp,duration);var markIDs=null===(_annotation$value=annotation.value)||void 0===_annotation$value?void 0:_annotation$value.map((function(mark){return mark.id}));annotation.update([].concat(_toConsumableArray(markIDs),[mark.id]))}function onFinish(event){var _event$preventDefault,_event$stopPropagatio;null==event||null===(_event$preventDefault=event.preventDefault)||void 0===_event$preventDefault||_event$preventDefault.call(event),null==event||null===(_event$stopPropagatio=event.stopPropagation)||void 0===_event$stopPropagatio||_event$stopPropagatio.call(event),setCreating(!1),activeMark.element&&!isInBounds(activeMark.element,canvasRef.current)&&(activeTool.deleteMark(activeMark),setActiveMark(void 0))}function inactivateMark(){setActiveMark(void 0)}return creating&&!activeMark&&setCreating(!1),null!=activeMark&&activeMark.finished&&!activeMark.isValid&&(activeTool.deleteMark(activeMark),setActiveMark(void 0)),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(DrawingCanvas,{ref:canvasRef,disabled:disabled||move,pointerEvents:move?"none":"all",width,height,fill:"transparent",onPointerDown:function onPointerDown(event){if(disabled||cancelEvent(event),disabled||move)return!0;var _activeTool$handlePoi,target=event.target,pointerId=event.pointerId;return target.setPointerCapture(pointerId),!!activeTool.type&&(creating?(null==activeTool||null===(_activeTool$handlePoi=activeTool.handlePointerDown)||void 0===_activeTool$handlePoi||_activeTool$handlePoi.call(activeTool,(0,draggable.U)(event,canvasRef.current),activeMark),activeMark.finished&&onFinish(event),!0):(createMark(event),!1))},onPointerMove:function onPointerMove(event){var _activeTool$handlePoi2;cancelEvent(event),creating&&(null==activeTool||null===(_activeTool$handlePoi2=activeTool.handlePointerMove)||void 0===_activeTool$handlePoi2||_activeTool$handlePoi2.call(activeTool,(0,draggable.U)(event,canvasRef.current),activeMark))},onPointerUp:function onPointerUp(event){var _activeTool$handlePoi3;cancelEvent(event),creating&&(null==activeTool||null===(_activeTool$handlePoi3=activeTool.handlePointerUp)||void 0===_activeTool$handlePoi3||_activeTool$handlePoi3.call(activeTool,(0,draggable.U)(event,canvasRef.current),activeMark),activeMark.finished&&onFinish(event))}}),(0,jsx_runtime.jsx)(TranscribedLines.A,{}),(0,jsx_runtime.jsx)(SubTaskPopupContainer,{activeMark,onDelete:inactivateMark}),(0,jsx_runtime.jsx)(DrawingToolMarksConnector,{activeMark,marks,onDelete:inactivateMark,onDeselectMark:inactivateMark,onFinish,onSelectMark:function onSelectMark(mark){setActiveMark(mark)},onMove:function onMove(mark,difference){return mark.move(difference)},pointerEvents:creating?"none":"painted",played})]})}InteractionLayer.propTypes={activeMark:prop_types_default().object,activeTool:prop_types_default().object.isRequired,activeToolIndex:prop_types_default().number,annotation:prop_types_default().shape({task:prop_types_default().string,taskType:prop_types_default().string,value:prop_types_default().array}).isRequired,disabled:prop_types_default().bool,frame:prop_types_default().number,height:prop_types_default().number.isRequired,marks:prop_types_default().array,multiImageCloneMarkers:prop_types_default().bool,setActiveMark:prop_types_default().func,width:prop_types_default().number.isRequired};const InteractionLayer_InteractionLayer=InteractionLayer;InteractionLayer.__docgenInfo={description:"Render a drawing canvas for the current drawing task, including:\n- a canvas that handles pointer events while creating a new mark.\n- previously transcribed lines if the current task is a transcription task.\n- popups for any subtasks of the current task's tools.\n- editable marks created by the current drawing task.",methods:[],displayName:"InteractionLayer",props:{activeToolIndex:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"number"},required:!1},disabled:{defaultValue:{value:"false",computed:!1},description:"Disable creating new marks.",type:{name:"bool"},required:!1},frame:{defaultValue:{value:"0",computed:!1},description:"Index of the Frame. Initially inherits from parent Viewer or overwritten in Viewer with SubjectViewerStore",type:{name:"number"},required:!1},marks:{defaultValue:{value:"[]",computed:!1},description:"Array of marks for the current drawing task.",type:{name:"array"},required:!1},multiImageCloneMarkers:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},setActiveMark:{defaultValue:{value:"() => { }",computed:!1},description:"",type:{name:"func"},required:!1},activeMark:{description:"The active, or selected, mark.",type:{name:"object"},required:!1},activeTool:{description:"The selected drawing tool.",type:{name:"object"},required:!0},annotation:{description:"Annotation for the current drawing task.",type:{name:"shape",value:{task:{name:"string",required:!1},taskType:{name:"string",required:!1},value:{name:"array",required:!1}}},required:!0},height:{description:"Height of the canvas in SVG coordinates.",type:{name:"number"},required:!0},width:{description:"Width of the canvas in SVG coordinates.",type:{name:"number"},required:!0}}};var helpers_shownMarks=__webpack_require__("./src/helpers/shownMarks.js");function storeMapper(classifierStore){var _classifierStore$work3,classification=classifierStore.classifications.active,_classifierStore$work=classifierStore.workflowSteps,activeInteractionTask=_classifierStore$work.activeInteractionTask,shownMarks=_classifierStore$work.interactionTask.shownMarks;return{multiImageCloneMarkers:(null===(_classifierStore$work3=classifierStore.workflows)||void 0===_classifierStore$work3||null===(_classifierStore$work3=_classifierStore$work3.active)||void 0===_classifierStore$work3?void 0:_classifierStore$work3.configuration).multi_image_clone_markers,previousAnnotations:(null==classification?void 0:classification.previousInteractionTaskAnnotations(activeInteractionTask.taskKey))||[],shownMarks}}function PreviousMarks(_ref){var _ref$frame=_ref.frame,frame=void 0===_ref$frame?0:_ref$frame,_useStores=(0,hooks.gy)(storeMapper),multiImageCloneMarkers=_useStores.multiImageCloneMarkers,previousAnnotations=_useStores.previousAnnotations,_useStores$shownMarks=_useStores.shownMarks,shownMarks=void 0===_useStores$shownMarks?"ALL":_useStores$shownMarks,marksToShow=shownMarks===helpers_shownMarks.A.ALL||shownMarks===helpers_shownMarks.A.USER;return(null==previousAnnotations?void 0:previousAnnotations.length)>0&&marksToShow?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:previousAnnotations.map((function(annotation){var annotationValuesPerFrame=multiImageCloneMarkers?annotation.value:annotation.value.filter((function(value){return value.frame===frame}));return(0,jsx_runtime.jsx)("g",{className:"markGroup",pointerEvents:"none",children:(0,jsx_runtime.jsx)(DrawingToolMarksConnector,{disabled:!0,marks:annotationValuesPerFrame})},annotation.task)}))}):null}PreviousMarks.propTypes={frame:prop_types_default().number};const PreviousMarks_PreviousMarks=(0,mobxreact_esm.PA)(PreviousMarks);PreviousMarks.__docgenInfo={description:"",methods:[],displayName:"PreviousMarks",props:{frame:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"number"},required:!1}}};var helpers=__webpack_require__("./src/helpers/index.js");function InteractionLayerContainer_slicedToArray(r,e){return function InteractionLayerContainer_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function InteractionLayerContainer_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function InteractionLayerContainer_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return InteractionLayerContainer_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?InteractionLayerContainer_arrayLikeToArray(r,a):void 0}}(r,e)||function InteractionLayerContainer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function InteractionLayerContainer_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function InteractionLayerContainer(_ref2){var activeMark=_ref2.activeMark,activeTool=_ref2.activeTool,activeToolIndex=_ref2.activeToolIndex,annotation=_ref2.annotation,_ref2$disabled=_ref2.disabled,disabled=void 0!==_ref2$disabled&&_ref2$disabled,_ref2$frame=_ref2.frame,frame=void 0===_ref2$frame?0:_ref2$frame,height=_ref2.height,hidingIndex=_ref2.hidingIndex,_ref2$marks=_ref2.marks,marks=void 0===_ref2$marks?[]:_ref2$marks,_ref2$move=_ref2.move,move=void 0!==_ref2$move&&_ref2$move,_ref2$multiImageClone=_ref2.multiImageCloneMarkers,multiImageCloneMarkers=void 0!==_ref2$multiImageClone&&_ref2$multiImageClone,_ref2$setActiveMark=_ref2.setActiveMark,setActiveMark=void 0===_ref2$setActiveMark?function(){}:_ref2$setActiveMark,_ref2$shownMarks=_ref2.shownMarks,shownMarks=void 0===_ref2$shownMarks?helpers_shownMarks.A.ALL:_ref2$shownMarks,_ref2$taskKey=_ref2.taskKey,taskKey=void 0===_ref2$taskKey?"":_ref2$taskKey,width=_ref2.width,played=_ref2.played,duration=_ref2.duration,newMarks=shownMarks===helpers_shownMarks.A.NONE?marks.slice(hidingIndex):marks,visibleMarksPerFrame=multiImageCloneMarkers?newMarks:null==newMarks?void 0:newMarks.filter((function(mark){return mark.frame===frame}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[activeTool&&(0,jsx_runtime.jsx)(InteractionLayer_InteractionLayer,{activeMark,activeTool,activeToolIndex,annotation,disabled,duration,frame,height,marks:visibleMarksPerFrame,move,multiImageCloneMarkers,played,setActiveMark,width},taskKey),(0,jsx_runtime.jsx)(PreviousMarks_PreviousMarks,{frame})]})}InteractionLayerContainer.propTypes={activeMark:prop_types_default().object,activeTool:prop_types_default().object,disabled:prop_types_default().bool,duration:prop_types_default().number,frame:prop_types_default().number,height:prop_types_default().number.isRequired,interactionTaskAnnotations:prop_types_default().array,marks:prop_types_default().array,move:prop_types_default().bool,played:prop_types_default().number,setActiveMark:prop_types_default().func,shownMarks:prop_types_default().string,taskKey:prop_types_default().string,width:prop_types_default().number.isRequired};const InteractionLayer_InteractionLayerContainer=(0,helpers.Lg)(InteractionLayerContainer,(function InteractionLayerContainer_storeMapper(classifierStore){var _classifierStore$subj,_classifierStore$work2,activeStepAnnotations=null===(_classifierStore$subj=classifierStore.subjects.active)||void 0===_classifierStore$subj||null===(_classifierStore$subj=_classifierStore$subj.stepHistory)||void 0===_classifierStore$subj||null===(_classifierStore$subj=_classifierStore$subj.latest)||void 0===_classifierStore$subj?void 0:_classifierStore$subj.annotations,activeStepTasks=classifierStore.workflowSteps.activeStepTasks,move=classifierStore.subjectViewer.move,multiImageCloneMarkers=(null===(_classifierStore$work2=classifierStore.workflows)||void 0===_classifierStore$work2||null===(_classifierStore$work2=_classifierStore$work2.active)||void 0===_classifierStore$work2?void 0:_classifierStore$work2.configuration).multi_image_clone_markers,activeInteractionTask=InteractionLayerContainer_slicedToArray(activeStepTasks.filter((function(task){return"drawing"===task.type||"transcription"===task.type})),1)[0],annotation=null==activeStepAnnotations?void 0:activeStepAnnotations.find((function(annotation){return"drawing"===annotation.taskType||"transcription"===annotation.taskType})),_ref=activeInteractionTask||{},activeTool=_ref.activeTool,activeToolIndex=_ref.activeToolIndex,hidingIndex=_ref.hidingIndex,marks=_ref.marks,setActiveMark=_ref.setActiveMark,shownMarks=_ref.shownMarks,taskKey=_ref.taskKey;return{activeMark:(0,mobx_state_tree_module.$Q)((function(){return null==activeInteractionTask?void 0:activeInteractionTask.activeMark})),activeTool,activeToolIndex,annotation,disabled:null==activeTool?void 0:activeTool.disabled,hidingIndex,marks,move,multiImageCloneMarkers,setActiveMark,shownMarks,taskKey}}));InteractionLayerContainer.__docgenInfo={description:"",methods:[],displayName:"InteractionLayerContainer",props:{disabled:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},frame:{defaultValue:{value:"0",computed:!1},description:"Index of the Frame. Always inherits from SingleImageViewer, which inherits from the Viewer",type:{name:"number"},required:!1},marks:{defaultValue:{value:"[]",computed:!1},description:"",type:{name:"array"},required:!1},move:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},multiImageCloneMarkers:{defaultValue:{value:"false",computed:!1},required:!1},setActiveMark:{defaultValue:{value:"() => { }",computed:!1},description:"",type:{name:"func"},required:!1},shownMarks:{defaultValue:{value:"SHOWN_MARKS.ALL",computed:!0},description:"",type:{name:"string"},required:!1},taskKey:{defaultValue:{value:"''",computed:!1},description:"",type:{name:"string"},required:!1},activeMark:{description:"",type:{name:"object"},required:!1},activeTool:{description:"",type:{name:"object"},required:!1},duration:{description:"",type:{name:"number"},required:!1},height:{description:"",type:{name:"number"},required:!0},interactionTaskAnnotations:{description:"",type:{name:"array"},required:!1},played:{description:"",type:{name:"number"},required:!1},width:{description:"",type:{name:"number"},required:!0}}}},"./test/factories/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{wC:()=>DrawingTaskFactory,vR:()=>FieldGuideFactory,MJ:()=>FieldGuideMediumFactory,uQ:()=>ProjectFactory,vk:()=>SubjectFactory,$Z:()=>SubjectSetFactory,Ym:()=>TutorialMediumFactory,ez:()=>UPPFactory,s4:()=>WorkflowFactory});var rosie=__webpack_require__("../../node_modules/rosie/src/rosie.js"),medium=(new rosie.$).sequence("id",(function(id){return id.toString()})).attr("external_link",!1),TutorialMediumFactory=(new rosie.$).extend(medium).attr("content_type","image/gif").attr("href",["id"],(function(id){return"/tutorials/20/attached_images/".concat(id)})).attr("links",{linked:{href:"/tutorials/20",id:"20",type:"tutorials"}}).attr("media_type","tutorial_attached_image").attr("metadata",{}).attr("src","https://panoptes-uploads.zooniverse.org/staging/tutorial_attached_image/1ab2bd93-b422-4d10-a700-fa34d4e7e716.gif"),FieldGuideMediumFactory=(new rosie.$).extend(medium).attr("content_type","image/png").attr("external_link",!1).attr("href",["id"],(function(id){return"/field_guides/25/attached_images/".concat(id)})).attr("links",{linked:{href:"/field_guides/25",id:"20",type:"field_guides"}}).attr("media_type","field_guide_attached_image").attr("metadata",{}).attr("src","https://panoptes-uploads.zooniverse.org/staging/field_guide_attached_image/a04dc00f-ef28-4e52-9490-368ba9029aca.png");const ProjectFactory=(new rosie.$).sequence("id",(function(id){return id.toString()})).option("activeWorkflowId","12345").option("workflowId","67890").attr("display_name",["id"],(function(id){return"Project #".concat(id)})).attr("configuration",["activeWorkflowId"],(function(activeWorkflowId){return{default_workflow:activeWorkflowId}})).attr("experimental_tools",[]).attr("links",["activeWorkflowId","workflowId"],(function(activeWorkflowId,workflowId){return{active_workflows:[activeWorkflowId],workflows:[activeWorkflowId,workflowId]}})).attr("slug","zooniverse/example");const SubjectFactory=rosie.$.define("subject").sequence("id",(function(id){return id.toString()})).attr("already_seen",!1).attr("favorite",!1).attr("finished_workflow",!1).attr("locations",(function(){return[1,2,3,4,5,6,7,8,9,10,11].map((function(int){var randomString=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return{"image/png":"https://foo.bar/".concat(randomString,".png")}}))})).attr("metadata",{}).attr("retired",!1).attr("selected_at","2019-04-11T11:16:29.063Z").attr("selection_state","").attr("user_has_finished_workflow",!1),SubjectSetFactory=rosie.$.define("subject_set").sequence("id",(function(id){return id.toString()})).attr("display_name","Hello there!").attr("metadata",{}).attr("set_member_subjects_count",56).attr("links",{});var subjectSets=rosie.$.buildList("subject_set",5);const WorkflowFactory=rosie.$.define("workflow").sequence("id",(function(id){return id.toString()})).attr("display_name",["id"],(function(id){return"Workflow #".concat(id)})).attr("active",!0).attr("configuration",{}).attr("first_task","").attr("grouped",!1).attr("links",{subject_sets:subjectSets.map((function(subjectSet){return subjectSet.id}))}).attr("tasks",{}).attr("steps",[]).attr("subjectSets",{resources:{}}).attr("version","1.0"),UPPFactory=((new rosie.$).sequence("id",(function(id){return id.toString()})).attr("display_name",["id"],(function(id){return"Tutorial #".concat(id)})).attr("kind","tutorial").attr("language","en").attr("steps",[]),(new rosie.$).sequence("id",(function(id){return id.toString()})).attr("activity_count",100).attr("activity_count_by_workflow",{}).attr("links",{}).attr("preferences",{minicourses:{},selected_workflow:"",tutorials_completed_at:{}}).attr("settings",{})),FieldGuideFactory=((new rosie.$).sequence("id",(function(id){return id.toString()})).attr("admin",!1).attr("avatar_src","").attr("banned",!1).attr("beta_email_communication",!0).attr("credited_name","Jane Doe").attr("display_name","Jane").attr("email","jane@gmail.com").attr("global_email_communication",!0).attr("href",["id"],(function(id){return"/users/".concat(id)})).attr("intervention_notifications",!0).attr("languages",[]).attr("login","janedoe01").attr("login_prompt",!1).attr("private_profile",!0).attr("project_email_communication",!0).attr("subject_limit",100).attr("type","users").attr("upload_whitelist",!1).attr("uploaded_subjects_count",0).attr("ux_test_email_communication",!1).attr("valid_email",!0).attr("zooniverse_id",""),(new rosie.$).sequence("id",(function(id){return id.toString()})).attr("annotations",{}).attr("completed",!1).attr("links",{}).attr("metadata",{classifier_version:"2.0",source:"api",userLanguage:"",workflowVersion:""}),(new rosie.$).sequence("id",(function(id){return id.toString()})).attr("items",[]).attr("language","en")),DrawingTaskFactory=((new rosie.$).attr("isActive",!1).attr("rules",{}).attr("show_model",!1),(new rosie.$).attr("instruction","Please draw something").attr("tools",[]).attr("type","drawing"));(new rosie.$).attr("answers",[{label:"red"},{label:"blue"},{label:"green"}]).attr("required","").attr("strings",{question:"Check all of the colors that apply"}).attr("type","multiple"),(new rosie.$).attr("answers",[{label:"Yes"},{label:"No"}]).attr("required","true").attr("strings",{question:"Is there a galaxy?"}).attr("taskKey","").attr("type","single"),(new rosie.$).attr("modifiers",["insertion","deletion"]).attr("required",!1).attr("instruction","Enter some text").attr("taskKey","").attr("type","text"),(new rosie.$).attr("instruction","Please transcribe the text").attr("tools",[{details:[{instruction:"transcribe the text.",taskKey:"T0.0",type:"text"}],type:"transcriptionLine"}]).attr("type","transcription");var cuid=__webpack_require__("../../node_modules/cuid/index.js"),cuid_default=__webpack_require__.n(cuid);(new rosie.$).attr("id",cuid_default()()).attr("task","T0").attr("taskType","single").attr("value",0)},"./test/mockStore/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>mockStore});var async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),rosie=__webpack_require__("../../node_modules/rosie/src/rosie.js"),sinon_esm=__webpack_require__("../../node_modules/sinon/pkg/sinon-esm.js"),store=__webpack_require__("./src/store/index.js"),factories=__webpack_require__("./test/factories/index.js");function createResponse(url,factories){var endpoint=url.split("/")[1],response={},mockResponse=factories[url]||factories[endpoint];return response[endpoint]=mockResponse?[].concat(mockResponse):[],Promise.resolve({body:response})}const branchingWorkflow=factories.s4.build({display_name:"Branching workflow",first_task:"T0",tasks:{T0:{answers:[{label:"yes",next:"T1"},{label:"no",next:"T2"}],question:"Is there a cat?",required:!1,taskKey:"T0",type:"single"},T1:{answers:[{label:"napping"},{label:"standing"},{label:"playing"}],question:"What is/are the cat(s) doing?",required:!1,taskKey:"T1",type:"multiple"},T2:{answers:[{label:"oranges"},{label:"apples"},{label:"bananas"}],question:"Favourite fruit?",required:!1,taskKey:"T2",type:"multiple"}},version:"0.0"});function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var defaultClient={caesar:{request:sinon_esm.Ay.stub().callsFake((function(){return Promise.resolve({})}))},tutorials:{get:sinon_esm.Ay.stub().callsFake((function(){return Promise.resolve({body:{tutorials:[]}})}))}},defaultAuthClient={checkBearerToken:sinon_esm.Ay.stub().callsFake((function(){return Promise.resolve(null)})),checkCurrent:sinon_esm.Ay.stub().callsFake((function(){return Promise.resolve(null)})),listen:sinon_esm.Ay.stub(),stopListening:sinon_esm.Ay.stub()};function mockStore(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$authClient=_ref.authClient,authClient=void 0===_ref$authClient?defaultAuthClient:_ref$authClient,_ref$client=_ref.client,client=void 0===_ref$client?defaultClient:_ref$client,project=_ref.project,subject=_ref.subject,subjectSet=_ref.subjectSet,_ref$workflow=_ref.workflow,workflow=void 0===_ref$workflow?branchingWorkflow:_ref$workflow,subjectSnapshot=subject||factories.vk.build({metadata:{}}),subjectSetSnapshot=subjectSet||factories.$Z.build(),workflowSnapshot=workflow||factories.s4.build(),projectSnapshot=project||factories.uQ.build({},{activeWorkflowId:workflowSnapshot.id}),subjectResources={};rosie.$.buildList("subject",9).forEach((function(subject){return subjectResources[subject.id]=subject})),subjectResources[subjectSnapshot.id]=subjectSnapshot;var _stubPanoptesJs=function stubPanoptesJs(factories){return{panoptes:{get:function get(url){return createResponse(url,factories)},post:function post(url){return createResponse(url,factories)},put:function put(url){return createResponse(url,factories)}}}}({field_guides:[],projects:[projectSnapshot],subjects:Object.values(subjectResources),tutorials:[],workflows:[workflowSnapshot]}),panoptes=_stubPanoptesJs.panoptes,rootStore=store.A.create({projects:{active:projectSnapshot.id,loadingState:async_states_default().success,resources:_defineProperty({},projectSnapshot.id,projectSnapshot)},subjects:{active:subjectSnapshot.id,loadingState:async_states_default().success,queue:Object.keys(subjectResources),resources:subjectResources},subjectSets:{active:subjectSetSnapshot.id,loadingState:async_states_default().success,resources:_defineProperty({},subjectSetSnapshot.id,subjectSetSnapshot)},workflows:{active:workflowSnapshot.id,loadingState:async_states_default().success,resources:_defineProperty({},workflowSnapshot.id,workflowSnapshot)}},{authClient:_objectSpread(_objectSpread({},defaultAuthClient),authClient),client:_objectSpread(_objectSpread({},defaultClient),{},{panoptes},client)});return rootStore.subjects.setActiveSubject(subjectSnapshot.id),rootStore}}}]);