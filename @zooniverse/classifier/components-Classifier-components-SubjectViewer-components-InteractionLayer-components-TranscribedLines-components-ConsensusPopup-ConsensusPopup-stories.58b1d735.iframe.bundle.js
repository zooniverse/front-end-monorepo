(self.webpackChunk_zooniverse_classifier=self.webpackChunk_zooniverse_classifier||[]).push([[7703],{"../lib-async-states/src/async-states.js"(module){const asyncStates={};Object.defineProperty(asyncStates,"initialized",{value:"initialized",enumerable:!0}),Object.defineProperty(asyncStates,"loading",{value:"loading",enumerable:!0}),Object.defineProperty(asyncStates,"putting",{value:"putting",enumerable:!0}),Object.defineProperty(asyncStates,"posting",{value:"posting",enumerable:!0}),Object.defineProperty(asyncStates,"success",{value:"success",enumerable:!0}),Object.defineProperty(asyncStates,"error",{value:"error",enumerable:!0}),Object.defineProperty(asyncStates,"values",{value:Object.values(asyncStates)}),module.exports=asyncStates},"../lib-react-components/dist/esm/MovableModal/MovableModal.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>MovableModal_MovableModal});var react=__webpack_require__("../../node_modules/react/index.js"),prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),lib=__webpack_require__("../../node_modules/react-rnd/lib/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var StyledWrapper=styled_components_browser_esm.default.span.withConfig({displayName:"ResizeIcon__StyledWrapper",componentId:"sc-1oobo67-0"})([""," display:flex;justify-content:center;"],props=>props.theme.dark?(0,styled_components_browser_esm.css)(["color:",";"],props.theme.global.colors.text.dark):(0,styled_components_browser_esm.css)(["color:",";"],props.theme.global.colors.text.light));const ResizeIcon_ResizeIcon=function ResizeIcon(props){return(0,jsx_runtime.jsx)(StyledWrapper,_objectSpread(_objectSpread({},props),{},{children:"â‡²"}))};var withLayer=__webpack_require__("../lib-react-components/dist/esm/helpers/withLayer/withLayer.js"),Modal=__webpack_require__("../lib-react-components/dist/esm/Modal/Modal.js"),_excluded=["children","closeFn","headingBackground","overflow","pad","rndProps","title","titleColor"],_excluded2=["cancel","minHeight","minWidth"];function MovableModal_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function MovableModal_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MovableModal_ownKeys(Object(t),!0).forEach(function(r){MovableModal_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MovableModal_ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function MovableModal_defineProperty(e,r,t){return(r=function MovableModal_toPropertyKey(t){var i=function MovableModal_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==e.indexOf(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],-1===t.indexOf(o)&&{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var defaultRndProps={default:{x:0,y:0},minHeight:100,minWidth:350},MovableModal=(0,react.forwardRef)(function(_ref,ref){var{children,closeFn,headingBackground,overflow="auto",pad,rndProps=defaultRndProps,title="",titleColor}=_ref,rest=_objectWithoutProperties(_ref,_excluded),{cancel,minHeight,minWidth}=rndProps,restRndProps=_objectWithoutProperties(rndProps,_excluded2);return(0,jsx_runtime.jsx)(lib.p,MovableModal_objectSpread(MovableModal_objectSpread({cancel,enableResizing:{bottom:!0,bottomLeft:!1,bottomRight:!0,left:!0,right:!0,top:!0,topLeft:!1,topRight:!1},minHeight,minWidth,resizeHandleComponent:{bottomRight:(0,jsx_runtime.jsx)(ResizeIcon_ResizeIcon,{})},resizeHandleStyles:{bottomLeft:{bottom:0,left:0},bottomRight:{bottom:0,height:"20px",right:0,width:"14px"},topLeft:{left:0,top:0},topRight:{right:0,top:0}}},restRndProps),{},{children:(0,jsx_runtime.jsx)(Modal.a,MovableModal_objectSpread(MovableModal_objectSpread({ref,closeFn,headingBackground,overflow,pad,title,titleColor},rest),{},{children}))}))});MovableModal.propTypes={children:prop_types.node,closeFn:prop_types.func,headingBackground:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),overflow:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),pad:(0,prop_types.oneOfType)([prop_types.object,prop_types.string]),rndProps:(0,prop_types.shape)({cancel:prop_types.string,minHeight:prop_types.number,minWidth:prop_types.number,position:(0,prop_types.shape)({x:prop_types.number,y:prop_types.number})}),title:prop_types.string,titleColor:(0,prop_types.oneOfType)([prop_types.object,prop_types.string])};const MovableModal_MovableModal=(0,withLayer.A)(MovableModal);MovableModal.__docgenInfo={description:"",methods:[],displayName:"MovableModal",props:{children:{description:"",type:{name:"custom",raw:"node"},required:!1},closeFn:{description:"",type:{name:"custom",raw:"func"},required:!1},headingBackground:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},overflow:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},pad:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1},rndProps:{description:"",type:{name:"shape",value:{cancel:{name:"string",required:!1},minHeight:{name:"number",required:!1},minWidth:{name:"number",required:!1},position:{name:"shape",value:{x:{name:"number",required:!1},y:{name:"number",required:!1}},required:!1}}},required:!1},title:{description:"",type:{name:"custom",raw:"string"},required:!1},titleColor:{description:"",type:{name:"union",value:[{name:"object"},{name:"string"}]},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/ConsensusPopup/ConsensusPopup.jsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>ConsensusPopup});var prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),styled_components_browser_esm=__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),Paragraph=__webpack_require__("../../node_modules/grommet/es6/components/Paragraph/Paragraph.js"),Text=__webpack_require__("../../node_modules/grommet/es6/components/Text/Text.js"),List=__webpack_require__("../../node_modules/grommet/es6/components/List/List.js"),MovableModal=__webpack_require__("../lib-react-components/dist/esm/MovableModal/MovableModal.js"),i18n=__webpack_require__("./src/translations/i18n.jsx"),getDefaultPosition=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/helpers/getDefaultPosition/getDefaultPosition.js"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),StyledBox=(0,styled_components_browser_esm.default)(Box.a).withConfig({displayName:"ConsensusPopup__StyledBox",componentId:"sc-4q4c0a-0"})(['font-family:"Roboto Mono Regular",monospace;ul{font-size:0.8em;}']);function ConsensusPopup(_ref){var _ref$active=_ref.active,active=void 0!==_ref$active&&_ref$active,_ref$bounds=_ref.bounds,bounds=void 0===_ref$bounds?void 0:_ref$bounds,_ref$closeFn=_ref.closeFn,closeFn=void 0===_ref$closeFn?function(){}:_ref$closeFn,_ref$line=_ref.line,line=void 0===_ref$line?{consensusText:"",textOptions:[]}:_ref$line,t=(0,i18n.Bd)("components").t,itemProps={},position=(0,getDefaultPosition.A)(bounds,250,350);return line.textOptions.forEach(function(option,index){return itemProps[index]={border:!1,pad:{horizontal:"none",vertical:"xsmall"}}}),(0,jsx_runtime.jsxs)(MovableModal.A,{active,closeFn,headingBackground:{dark:"dark-5",light:"neutral-6"},height:{min:"250px",max:"350px"},onWheel:function onWheel(event){event.stopPropagation()},pad:{bottom:"medium",left:"medium",right:"medium"},position:"top-left",plain:!0,rndProps:{cancel:".element-that-ignores-drag-actions",default:position,maxHeight:350,minHeight:250,minWidth:350},title:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.title"),titleColor:"",children:[(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.explanation",{count:line.textOptions.length})}),(0,jsx_runtime.jsxs)(StyledBox,{className:"element-that-ignores-drag-actions",children:[line.consensusText&&(0,jsx_runtime.jsxs)(Paragraph.f,{children:[line.consensusText,(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(Text.E,{children:(0,jsx_runtime.jsx)("em",{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.aggregatedTranscription")})})]}),!line.consensusText&&(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.noAggregation")}),line.textOptions.length>0&&(0,jsx_runtime.jsx)(List.B,{data:line.textOptions,itemKey:function itemKey(item,index){return"line-".concat(index)},itemProps}),0===line.textOptions.length&&(0,jsx_runtime.jsx)(Paragraph.f,{children:t("SubjectViewer.InteractionLayer.TranscribedLines.ConsensusPopup.transcriptionsUnavailable")})]})]})}ConsensusPopup.propTypes={active:prop_types.bool,bounds:prop_types.object,closeFn:prop_types.func,line:(0,prop_types.shape)({consensusText:prop_types.string,textOptions:prop_types.array})},ConsensusPopup.__docgenInfo={description:"A popup which shows the previous annotations for a single transcription line.",methods:[],displayName:"ConsensusPopup",props:{active:{defaultValue:{value:"false",computed:!1},description:"Modal active state.",type:{name:"custom",raw:"bool"},required:!1},bounds:{defaultValue:{value:"undefined",computed:!0},description:"Bounding rectangle in the browser.",type:{name:"custom",raw:"object"},required:!1},closeFn:{defaultValue:{value:"() => {}",computed:!1},description:"Callback for the modal's close button.",type:{name:"custom",raw:"func"},required:!1},line:{defaultValue:{value:"{\n  consensusText: '',\n  textOptions: []\n}",computed:!1},description:"Consensus options for the current line.",type:{name:"shape",value:{consensusText:{name:"string",required:!1},textOptions:{name:"array",required:!1}}},required:!1}}}},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/ConsensusPopup/ConsensusPopup.stories.jsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,MissingLines:()=>MissingLines,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ConsensusPopup_stories});var Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),mocks=__webpack_require__("./src/store/subjects/Subject/TranscriptionReductions/mocks/index.js"),TranscriptionReductions=__webpack_require__("./src/store/subjects/Subject/TranscriptionReductions/index.js");var ConsensusPopup=__webpack_require__("./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/components/TranscribedLines/components/ConsensusPopup/ConsensusPopup.jsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const completedLines=function setupMock(){return TranscriptionReductions.A.create({reducer:"alice",reductions:mocks.Er.workflow.subject_reductions,subjectId:"1",workflowId:"2"}).consensusLines(0).filter(function(line){return line.consensusReached})}(),ConsensusPopup_stories={title:"Drawing Tools / TranscribedLines/ConsensusPopup",component:ConsensusPopup.A,parameters:{docs:{inlineStories:!1}}};function ConsensusPopupStory(props){const{index=0}=props;return(0,jsx_runtime.jsx)(Box.a,{width:"1000px",children:(0,jsx_runtime.jsx)(ConsensusPopup.A,{active:!0,line:completedLines[index]})})}function Default(){return(0,jsx_runtime.jsx)(ConsensusPopupStory,{})}function MissingLines(){return(0,jsx_runtime.jsx)(Box.a,{width:"1000px",children:(0,jsx_runtime.jsx)(ConsensusPopup.A,{active:!0})})}const __namedExportsOrder=["Default","MissingLines"]},"./src/components/Classifier/components/SubjectViewer/components/InteractionLayer/helpers/getDefaultPosition/getDefaultPosition.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>getDefaultPosition});function getDefaultPosition(){var _window,_window2,bounds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},minHeight=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,minWidth=arguments.length>2&&void 0!==arguments[2]?arguments[2]:350,viewport_height=null===(_window=window)||void 0===_window?void 0:_window.innerHeight,viewport_width=null===(_window2=window)||void 0===_window2?void 0:_window2.innerWidth,x=0,y=0;if(bounds){var markX=bounds.x||0,markY=bounds.y||0,markWidth=bounds.width||0,markHeight=bounds.height||0,yOffset=markHeight;viewport_height-(markY+markHeight)<minHeight&&(yOffset=0-(minHeight+markHeight)),x=markX+.5*markWidth,y=markY+yOffset}var rightLimit=viewport_width-minWidth||0,bottomLimit=viewport_height-minHeight||0;return x=Math.max(x,0),y=Math.max(y,0),{x:x=Math.min(x,rightLimit),y:y=Math.min(y,bottomLimit)}}},"./src/store/subjects/Subject/TranscriptionReductions/index.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>TranscriptionReductions_TranscriptionReductions});var async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),mobx_state_tree_module=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),cuid=__webpack_require__("../../node_modules/cuid/index.js"),cuid_default=__webpack_require__.n(cuid);function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}const TranscriptionReductions_TranscriptionReductions=mobx_state_tree_module.gK.model("TranscriptionReductions",{reducer:mobx_state_tree_module.gK.literal("alice"),error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),reductions:mobx_state_tree_module.gK.array(mobx_state_tree_module.gK.frozen({})),subjectId:mobx_state_tree_module.gK.string,workflowId:mobx_state_tree_module.gK.string}).views(function(self){function reductionConsensus(reduction,frame){var parameters=reduction.data.parameters,currentFrameReductions=reduction.data["frame".concat(frame)]||[],options={frame,minimumViews:(null==parameters?void 0:parameters.minimum_views)||5,threshold:(null==parameters?void 0:parameters.low_consensus_threshold)||3};return currentFrameReductions.map(function(line){return function frameConsensus(line,options){return line.id||(line.id=cuid_default()()),function constructLine(reduction,options){var frame=options.frame,minimumViews=options.minimumViews,threshold=options.threshold,consensusText=reduction.consensus_text,points=function constructCoordinates(line){return line&&line.clusters_x&&line.clusters_y?line.clusters_x.map(function(point,i){return{x:line.clusters_x[i],y:line.clusters_y[i]}}):[]}(reduction),textOptions=function constructText(line){var sentences=[];return line&&line.clusters_text&&line.clusters_text.forEach(function(value){value.forEach(function(word,i){sentences[i]||(sentences[i]=[]),word&&word.length&&sentences[i].push(word)})}),sentences.map(function(value){return value.join(" ")})}(reduction);return{consensusReached:reduction.consensus_score>=threshold||reduction.number_views>=minimumViews,consensusText,frame,id:reduction.id,points,textOptions}}(line,options)}(line,options)})}function reductionUsers(reduction){var users=function reductionFrames(reduction){return Object.entries(reduction.data).filter(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0];return _ref2[1],key.startsWith("frame")})}(reduction).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2);_ref4[0];return function frameUsers(frame){var users=frame.map(function(line){return line.user_ids});return _toConsumableArray(new Set(users.flat()))}(_ref4[1])});return _toConsumableArray(new Set(users.flat()))}return{consensusLines:function consensusLines(frame){return self.reductions.map(function(reduction){return reductionConsensus(reduction,frame)}).flat()},get userIDs(){var users=self.reductions.map(reductionUsers);return _toConsumableArray(new Set(users.flat()))}}}).actions(function(self){return{}})}}]);