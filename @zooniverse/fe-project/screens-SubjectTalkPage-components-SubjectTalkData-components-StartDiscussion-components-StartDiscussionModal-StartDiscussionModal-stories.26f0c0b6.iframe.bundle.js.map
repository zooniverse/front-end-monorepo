{"version":3,"file":"screens-SubjectTalkPage-components-SubjectTalkData-components-StartDiscussion-components-StartDiscussionModal-StartDiscussionModal-stories.26f0c0b6.iframe.bundle.js","mappings":";;;;AAcA;;AAIA;;;;AAMA","sources":["webpack://@zooniverse/fe-project/./src/screens/SubjectTalkPage/components/SubjectTalkData/components/StartDiscussion/components/StartDiscussionModal/StartDiscussionModal.jsx"],"sourcesContent":["import { Loader, Modal, SpacedText } from '@zooniverse/react-components'\nimport { Box, Button, Form, FormField, RadioButtonGroup, Text, TextArea, TextInput, ThemeContext } from 'grommet'\nimport { CircleInformation } from 'grommet-icons'\nimport { useTranslation } from 'next-i18next'\nimport { arrayOf, bool, func, shape, string } from 'prop-types'\nimport { useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nconst StyledRadioButtonGroup = styled(RadioButtonGroup)`\n  & > label > div {\n    margin-right: 5px;\n  }\n`\n\nconst StyledTextArea = styled(TextArea)`\n  height: 132px;\n`\n\nconst StyledButton = styled(Button)`\n  border-radius: 4px;\n  font-size: 1rem;\n  width: 300px;\n`\n\nconst DEFAULT_HANDLER = () => true\n\nfunction StartDiscussionModal({\n  active = false,\n  boards = undefined,\n  error = null,\n  loading = false,\n  onClose,\n  onSubmit = DEFAULT_HANDLER,\n  showCommentMessage = false,\n  subjectId = undefined\n}) {\n  const [discussion_board, setDiscussionBoard] = useState('')\n  const [discussion_title, setDiscussionTitle] = useState('')\n  const [discussion_comment, setDiscussionComment] = useState('')\n\n  const { t } = useTranslation('screens')\n\n  useEffect(() => {\n    const subjectDefaultBoard = boards?.find(board => board.subject_default)\n\n    if (!discussion_board) {\n      setDiscussionBoard(subjectDefaultBoard?.id || boards?.[0]?.id || '')\n      setDiscussionTitle(subjectDefaultBoard?.id ? `Subject ${subjectId}` : '')\n    }\n  }, [boards, subjectId])\n\n  const boardOptions = boards?.map(board => ({\n    label: (\n      <Text\n        color={{ dark: 'light-1', light: 'dark-4' }}\n        margin='none'\n        pad='none'\n        size='.875rem'\n      >\n        {board.title}\n      </Text>\n    ),\n    value: board.id\n  })) || []\n  const selectedBoard = boards?.find(board => board.id === discussion_board)\n\n  let commentInputLabel = t('Talk.Discussions.initialComment')\n  let submitButtonLabel = t('Talk.Discussions.startDiscussion')\n  if (selectedBoard?.subject_default) {\n    commentInputLabel = t('Talk.Discussions.newComment')\n    submitButtonLabel = t('Talk.Discussions.addComment')\n  }\n\n  function handleBoardChange(event) {\n    const newBoard = event?.target?.value\n    const selected = boards?.find(board => board.id === newBoard)\n    const subjectDefaultBoard = selected?.subject_default || boards?.find(board => board.subject_default)\n\n    // If the newly selected board is a subject_default board, set the title to Subject {id}\n    if (selected?.subject_default) {\n      setDiscussionTitle(`Subject ${subjectId}`)\n    // If we changed away from a subject_default board, clear the title\n    } else if ((discussion_board === subjectDefaultBoard?.id) && (newBoard !== subjectDefaultBoard?.id)) {\n      setDiscussionTitle('')\n    }\n\n    setDiscussionBoard(newBoard)\n  }\n\n  function handleTitleChange(event) {\n    setDiscussionTitle(event?.target?.value)\n  }\n\n  function handleCommentChange(event) {\n    setDiscussionComment(event?.target?.value)\n  }\n\n  function handleSubmit(event) {\n    event.preventDefault()\n    onSubmit({\n      discussion_board,\n      discussion_title,\n      discussion_comment,\n      subject_default: selectedBoard?.subject_default || false\n    })\n  }\n\n  return (\n    <Modal\n      active={active}\n      bodyBackground='transparent'\n      closeFn={onClose}\n      headingBackground='transparent'\n      pad={{ horizontal: 'small', top: 'xsmall', bottom: 'medium' }}\n      role='dialog'\n      title={t('Talk.Discussions.startDiscussion')}\n      titleColor='black'\n    >\n      <Box\n        gap='small'\n        width='600px'\n      >\n        {error ? (\n          <Box align='center' justify='center' fill pad='medium'>\n            <SpacedText uppercase={false}>\n              {t('Talk.somethingWentWrong')}\n            </SpacedText>\n          </Box>\n        ) : loading ? (\n          <Box align='center' justify='center' fill pad='medium'>\n            <Loader />\n          </Box>\n        ) : (\n          <Form\n            onSubmit={handleSubmit}\n            value={{\n              discussion_board,\n              discussion_title,\n              discussion_comment\n            }}\n          >\n            <Box gap='small'>\n              <ThemeContext.Extend value={{\n                formField: {\n                  border: false,\n                  label: { margin: { horizontal: 'none', top: 'none' }},\n                  margin: 'none'\n                },\n              }}>\n                <FormField\n                  htmlFor='discussion_board'\n                  label={<SpacedText>{t('Talk.Discussions.discussionBoard')}</SpacedText>}\n                  name='discussion_board'\n                  required\n                >\n                  <StyledRadioButtonGroup\n                    id='discussion_board'\n                    direction='row'\n                    name='discussion_board'\n                    onChange={handleBoardChange}\n                    options={boardOptions}\n                    value={discussion_board}\n                  />\n                </FormField>\n              </ThemeContext.Extend>\n              {showCommentMessage && (\n                <Box\n                  align='center'\n                  direction='row'\n                  gap='xxsmall'\n                >\n                  <CircleInformation size='0.75rem' />\n                  <SpacedText\n                    size='xsmall'\n                    uppercase={false}\n                  >\n                    {t('Talk.Discussions.commentMessage')}\n                  </SpacedText>\n                </Box>\n              )}\n              <ThemeContext.Extend value={{\n                formField: {\n                  border: {\n                    color: 'light-5',\n                    side: 'all',\n                    size: '1px'\n                  },\n                  label: { margin: { horizontal: 'none', top: 'none' }},\n                  margin: 'none'\n                }\n              }}>\n                <FormField\n                  contentProps={{ round: '4px' }}\n                  disabled={selectedBoard?.subject_default}\n                  htmlFor='discussion_title'\n                  label={<SpacedText>{t('Talk.Discussions.discussionTitle')}</SpacedText>}\n                  name='discussion_title'\n                  required\n                >\n                  <TextInput\n                    id='discussion_title'\n                    disabled={selectedBoard?.subject_default}\n                    name='discussion_title'\n                    onChange={handleTitleChange}\n                    value={discussion_title}\n                  />\n                </FormField>\n              </ThemeContext.Extend>\n              <ThemeContext.Extend value={{\n                formField: {\n                  border: {\n                    color: 'light-5',\n                    side: 'all',\n                    size: '0.5px'\n                  },\n                  label: { margin: { horizontal: 'none', top: 'none' }},\n                  margin: 'none'\n                }\n              }}>\n                <FormField\n                  contentProps={{ round: '4px' }}\n                  htmlFor='discussion_comment'\n                  label={<SpacedText>{commentInputLabel}</SpacedText>}\n                  name='discussion_comment'\n                  required\n                >\n                  <StyledTextArea\n                    id='discussion_comment'\n                    name='discussion_comment'\n                    onChange={handleCommentChange}\n                    plain\n                    value={discussion_comment}\n                  />\n                </FormField>\n              </ThemeContext.Extend>\n              <Box\n                align='center'\n                direction='row'\n                justify='end'\n              >\n                <StyledButton\n                  color={{ light: 'neutral-1', dark: 'accent-1' }}\n                  label={submitButtonLabel}\n                  primary\n                  type='submit'\n                />\n              </Box>\n            </Box>\n          </Form>\n        )}\n      </Box>\n    </Modal>\n  )\n}\n\nStartDiscussionModal.propTypes = {\n  active: bool,\n  boards: arrayOf(shape({\n    id: string,\n    subject_default: bool,\n    title: string\n  })),\n  error: shape({}),\n  loading: bool,\n  onClose: func.isRequired,\n  onSubmit: func,\n  showCommentMessage: bool,\n  subjectId: string\n}\n\nexport default StartDiscussionModal\n"],"names":[],"ignoreList":[],"sourceRoot":""}