{"version":3,"file":"screens-ClassifyPage-components-WorkflowMenuModal-WorkflowMenuModal-stories.428b1d43.iframe.bundle.js","mappings":";;AAsBA;;AAIA;;;;;AAKA;AACA;;;AAGA;;;;;AAKA;;AAEA;ACnCA;AACA;;ACkBA;ACEA;;;;;;;;;;;;;;;;AAgBA;;;;AAIA;;;;;;;AAOA;;;;AAIA","sources":["webpack://@zooniverse/fe-project/./src/shared/components/SubjectPicker/SubjectPicker.jsx","webpack://@zooniverse/fe-project/./src/shared/components/SubjectSetPicker/components/SubjectSetCard/SubjectSetCard.jsx","webpack://@zooniverse/fe-project/./src/shared/components/SubjectSetPicker/SubjectSetPicker.jsx","webpack://@zooniverse/fe-project/./src/shared/components/WorkflowSelector/components/WorkflowSelectButton/theme.js"],"sourcesContent":["import { PlainButton, SpacedText } from '@zooniverse/react-components'\nimport { debounce } from 'lodash'\nimport Link from 'next/link'\nimport { array, bool, number, shape, string } from 'prop-types'\nimport { useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport { Box, DataTable, Heading, Paragraph } from 'grommet'\nimport { useTranslation } from 'next-i18next'\n\nimport addQueryParams from '@helpers/addQueryParams'\nimport { columns, fetchStatuses, fetchSubjects, searchParams } from './helpers'\n\n/*\n  Grommet is opinionated about line-height and links it to font-size.\n  Reset the heading baselines here so that spacing is measured from\n  the tops and bottoms of the letters (without changing the text size.)\n  https://matthiasott.com/notes/the-thing-with-leading-in-css\n*/\n\nexport const StyledBox = styled(Box)`\n  min-height: 30px;\n`\nexport const StyledHeading = styled(Heading)`\n  line-height: 100%;\n`\n\nexport const SubjectDataTable = styled(DataTable)`\n  button {\n    padding: 0;\n  }\n  thead th {\n    background: ${props => props.theme.global.colors[props.background.header]};\n    padding: ${props => props.theme.global.edgeSize[props.pad.header]}\n  }\n  th button {\n    color: ${props => props.theme.global.colors['dark-1']};\n    font-weight: bold;\n    text-transform: uppercase;\n  }\n  th svg {\n    stroke: ${props => props.theme.global.colors['dark-1']};\n  }\n`\n\nconst PAGE_SIZE = 10\n\nexport default function SubjectPicker({ baseUrl, subjectSet, workflow }) {\n  const { t } = useTranslation('components')\n  const [ rows, setRows ] = useState([])\n  const [ query, setQuery ] = useState('')\n  const [ isFetching, setIsFetching ] = useState(false)\n  const [ sortField, setSortField ] = useState('priority')\n  const [ sortOrder, setSortOrder ] = useState('asc')\n  const { indexFields } = subjectSet.metadata\n  const customHeaders = indexFields.split(',')\n\n  rows.forEach(row => {\n    row.status = t(row.status)\n  })\n\n  useEffect(function onChange() {\n    async function fetchSubjectData() {\n      // Resetting the rows is important when fetchSubjectData() occurs as a\n      // result of changing the sort order, when the number of subjects exceeds\n      // PAGE_SIZE. Otherwise, we see a \"visual hiccup\" where the SubjectPicker\n      // first sorts the OLD set of subjects (say) 1-100, then fetches the new set\n      // of subjects (say) 899-999 (with the opposite sort logic), then sorts the\n      // new set.\n      // See https://github.com/zooniverse/front-end-monorepo/pull/2466#issuecomment-931547044\n      // for details.\n      setIsFetching(true)\n\n      const subjects = await fetchSubjects(subjectSet.id, query, sortField, sortOrder)\n      const newRows = await fetchStatuses(subjects, workflow, PAGE_SIZE)\n      setRows(newRows)\n      setIsFetching(false)\n    }\n\n    fetchSubjectData()\n  }, [query, sortField, sortOrder, subjectSet.id, workflow])\n\n  function search(data) {\n    const query = searchParams(data)\n    setQuery(query)\n  }\n\n  function sort(data) {\n    const { property: sortField, direction: sortOrder } = data\n    if (sortField === 'status') {\n      return true\n    }\n    setRows([])\n    setSortField(sortField)\n    setSortOrder(sortOrder)\n    return true\n  }\n\n  const background = {\n    header: \"accent-2\",\n    body: [\"white\", \"light-1\"]\n  }\n  const pad = {\n    header: \"xsmall\",\n    body: \"xsmall\"\n  }\n\n  /*\n    Vertical spacing for the picker instructions.\n    The theme's named margins are set in multiples of 10px, so set 15px explicitly.\n  */\n  const textMargin = {\n    top: '15px',\n    bottom: 'medium'\n  }\n  return (\n    <>\n      <PlainButton\n        forwardedAs={Link}\n        href={addQueryParams(baseUrl)}\n        text={t('SubjectPicker.back')}\n      />\n      <StyledHeading\n        level={3}\n        margin={{ top: 'xsmall', bottom: 'none' }}\n      >\n        {t('SubjectPicker.heading')}\n      </StyledHeading>\n      <Paragraph\n        margin={textMargin}\n      >\n        {t('SubjectPicker.byline')}\n      </Paragraph>\n      <StyledBox\n        background='brand'\n        fill\n        pad={{\n          top: '5px',\n          bottom: 'none',\n          horizontal: 'none'\n        }}\n      >\n        <Paragraph\n          color=\"white\"\n          margin='none'\n          textAlign='center'\n        >\n          <SpacedText\n            margin='medium'\n            weight='bold'\n          >\n            {subjectSet.display_name}\n          </SpacedText>\n        </Paragraph>\n      </StyledBox>\n      <SubjectDataTable\n        background={background}\n        columns={columns(customHeaders, `${baseUrl}/subject-set/${subjectSet.id}`)}\n        data={rows}\n        fill\n        onSearch={debounce(search, 500)}\n        onSort={sort}\n        pad={pad}\n        pin\n        replace\n        sortable\n        step={PAGE_SIZE}\n      />\n      {isFetching && (\n        <Paragraph textAlign=\"center\">{t('SubjectPicker.fetching')}</Paragraph>\n      )}\n    </>\n  )\n}\n\nSubjectPicker.propTypes = {\n  /**\n    Base URL for links eg. `/${owner}/${project}/classify/workflow/${workflow.id}`\n  */\n  baseUrl: string.isRequired,\n  /**\n    The selected subject set.\n  */\n  subjectSet: shape({\n    completeness: number,\n    display_name: string,\n    id: string,\n    subjects: array\n  }),\n  /**\n    The selected workflow.\n  */\n  workflow: shape({\n    completeness: number,\n    default: bool,\n    display_name: string,\n    id: string,\n    subjectSets: array\n  }).isRequired\n}\n","import { Media, SpacedText } from '@zooniverse/react-components'\nimport { Box, Image, Paragraph, Text } from 'grommet'\nimport { array, number, string } from 'prop-types'\nimport styled, { css } from 'styled-components'\nimport { useTranslation } from 'next-i18next'\n\nconst PossiblyTransparentBox = styled(Box)`\n  ${props => css`opacity: ${(props.isComplete) ? '0.5' : '1.0'};`}\n`\n\n/**\n  Summary card for a subject set, showing a preview subject, the set name, total subject count and completeness percentage.\n*/\nfunction SubjectSetCard ({\n  completeness = 0,\n  display_name,\n  id,\n  set_member_subjects_count,\n  subjects = []\n}) {\n  const { t } = useTranslation('components')\n  const [subject] = subjects\n  const placeholderUrl = 'https://static.zooniverse.org/fem-assets/subject-placeholder.jpg'\n  const subjectURLs = subject ? subject.locations.map(location => Object.values(location)[0]) : []\n  const alt = subject ? `Subject ${subject.id}` : 'Loading'\n  const percentComplete = parseInt(100 * completeness)\n  const isComplete = completeness >= 1\n  const placeholder = <Image alt='' height={358} role='presentation' src={placeholderUrl} width={500} />\n\n  return (\n    <Box\n      className=\"subject-set-card\"\n      data-testid={`subject-set-card-${id}`}\n      background='neutral-6'\n      border='all'\n    >\n      <PossiblyTransparentBox\n        align='center'\n        height='100px'\n        isComplete={isComplete}\n        overflow='hidden'\n        width='100%'\n      >\n        <Media\n          alt={alt}\n          height={700}\n          placeholder={placeholder}\n          src={subjectURLs[0]}\n          width={700}\n        />\n      </PossiblyTransparentBox>\n      <PossiblyTransparentBox\n        isComplete={isComplete}\n        pad='small'\n      >\n        {(isComplete) && (\n          <SpacedText\n            weight=\"normal\"\n          >\n            {t('SubjectSetPicker.SubjectSetCard.isComplete')}\n          </SpacedText>\n        )}\n\n        <SpacedText\n          truncate\n          weight=\"bold\"\n        >\n          {display_name}\n        </SpacedText>\n        <Paragraph\n          margin={{\n            top: 'small',\n            bottom: 'none',\n            horizontal: 'none'\n          }}\n        >\n          <Text\n            weight=\"normal\"\n          >\n            {`${set_member_subjects_count} subjects`}\n          </Text>\n\n          <br />\n\n          {(!isComplete) && (\n            <Text\n              weight=\"normal\"\n            >\n              {percentComplete}% complete\n            </Text>\n          )}\n        </Paragraph>\n      </PossiblyTransparentBox>\n    </Box>\n  )\n}\n\nSubjectSetCard.propTypes = {\n  /**\n   The number of subjects available to be classified.\n  */\n  availableSubjects: number.isRequired,\n  /**\n   Subject set title.\n  */\n  display_name: string.isRequired,\n  /**\n    Subject set ID.\n  */\n  id: string.isRequired,\n  /**\n    Total subject count\n  */\n  set_member_subjects_count: number.isRequired,\n  /**\n   Preview subjects. Used to show a preview image.\n  */\n  subjects: array\n}\n\nexport default SubjectSetCard\n","import { PlainButton } from '@zooniverse/react-components'\nimport { Anchor, Box, Grid, Heading, Paragraph } from 'grommet'\nimport Link from 'next/link'\nimport { array, bool, number, shape, string } from 'prop-types'\nimport styled from 'styled-components'\nimport { useTranslation } from 'next-i18next'\n\nimport addQueryParams from '@helpers/addQueryParams'\nimport SubjectSetCard from './components/SubjectSetCard'\n\nfunction NoPrefetchLink(props) {\n  return <Link prefetch={false} {...props} />\n}\n\n/*\n  Grommet is opinionated about line-height and links it to font-size.\n  Reset the heading baselines here so that spacing is measured from\n  the tops and bottoms of the letters (without changing the text size.)\n  https://matthiasott.com/notes/the-thing-with-leading-in-css\n*/\nconst StyledHeading = styled(Heading)`\n  line-height: 100%;\n`\n\n/**\n  Display a list of subject set cards for a workflow. Each card links to the corresponding subject set ID.\n*/\nfunction SubjectSetPicker ({\n  baseUrl,\n  workflow\n}) {\n  const { t } = useTranslation('components')\n  /*\n    Vertical spacing for the picker instructions.\n    The theme's named margins are set in multiples of 10px, so set 15px explicitly.\n  */\n  const textMargin = {\n    top: '15px',\n    bottom: 'medium'\n  }\n\n  const columns = Math.floor(window.innerWidth / 240)\n\n  const sortedSubjectSets = (workflow?.subjectSets)\n    ? [...workflow?.subjectSets]\n    : []\n\n  // Sort the Subject Sets so completed sets appear at the end.\n  sortedSubjectSets.sort((a, b) => {\n    const aCompleteness = a.completeness[workflow.id] || 0\n    const bCompleteness = b.completeness[workflow.id] || 0\n    const aIsComplete = aCompleteness >= 1\n    const bIsComplete = bCompleteness >= 1\n    return (aIsComplete === bIsComplete)\n      ? 0  // We don't change the order if both sets are complete, or both sets are incomplete.\n      : aCompleteness - bCompleteness\n  })\n\n  return (\n    <>\n      <PlainButton\n        forwardedAs={Link}\n        href={addQueryParams(baseUrl)}\n        text={t('SubjectSetPicker.back')}\n      />\n      <StyledHeading\n        level={3}\n        margin={{ top: 'xsmall', bottom: 'none' }}\n      >\n        {t('SubjectSetPicker.heading')}\n      </StyledHeading>\n      <Paragraph\n        margin={textMargin}\n      >\n        {t('SubjectSetPicker.byline')}\n      </Paragraph>\n      <Box\n        background='light-1'\n        border={{ color: 'light-5', size: 'xsmall' }}\n        overflow=\"scroll\"\n      >\n        <Grid\n          alignContent='stretch'\n          columns={[`repeat(${columns}, minmax(200px, 1fr))`]}\n          gap='small'\n          pad='medium'\n        >\n          {sortedSubjectSets.map(subjectSet => {\n            const href = `${baseUrl}/workflow/${workflow.id}/subject-set/${subjectSet.id}`\n            const panoptesCompleteness = subjectSet.completeness[workflow.id]\n            return (\n              <Anchor\n                as={NoPrefetchLink}\n                key={subjectSet.id}\n                href={addQueryParams(href)}\n                className=\"test-subject-set-card\" data-testid={`test-subject-set-card-${subjectSet.id}`}\n              >\n                <SubjectSetCard\n                  {...subjectSet}\n                  completeness={panoptesCompleteness}  /* This will override subjectSet.completeness */\n                />\n              </Anchor>\n            )\n          })}\n        </Grid>\n      </Box>\n    </>\n  )\n}\n\nSubjectSetPicker.propTypes = {\n  /**\n    Base URL for links eg. `/${owner}/${project}/classify`\n  */\n  baseUrl: string.isRequired,\n  /**\n    The selected workflow.\n  */\n  workflow: shape({\n    completeness: number,\n    default: bool,\n    display_name: string,\n    id: string,\n    subjectSets: array\n  }).isRequired\n}\n\nexport default SubjectSetPicker\nexport { StyledHeading }\n","import { normalizeColor } from 'grommet/utils'\nimport getGradientShade from '@zooniverse/react-components/helpers/getGradientShade'\nimport { css } from 'styled-components'\n\nconst theme = {\n  button: {\n    border: {\n      color: 'accent-2',\n      width: '1px'\n    },\n    color: 'black',\n    primary: {\n      color: {\n        dark: 'dark-3',\n        light: 'neutral-2'\n      }\n    },\n    extend: props => {\n      const { theme: { global: { colors } }, completeness } = props\n      const color = normalizeColor(colors['neutral-2'], props.theme)\n      const secondaryColor = getGradientShade(color)\n      const percentComplete = `${completeness}%`\n      const progressGradient = [\n        `${colors['accent-2']} ${percentComplete}`,\n        `transparent ${percentComplete}`\n      ].join(',')\n\n      return css`\n        background: ${color};\n        box-shadow: 0px 2px 6px rgba(0, 0, 0, .3);\n        position: relative;\n        text-align: left;\n        transition-property: color, border-color, box-shadow;\n        width: 100%;\n        max-width: 350px;\n\n        > div {\n          justify-content: space-between;\n        }\n        &:disabled {\n          cursor: not-allowed;\n        }\n        &:focus:not(:disabled),\n        &:hover:not(:disabled) {\n          background: linear-gradient(${color}, ${secondaryColor});\n          box-shadow: 0px 2px 14px rgba(0, 0, 0, .3);\n        }\n        &:active:not(:disabled) {\n          background: linear-gradient(${secondaryColor}, ${color});\n        }\n        &:before {\n          content: \"\";\n          width: 100%;\n          position: absolute;\n          height: 5px;\n          background: linear-gradient(to right, ${progressGradient});\n          top: 0;\n          left: 0;\n        }\n    `\n    }\n  }\n}\n\nexport default theme"],"names":[],"ignoreList":[],"sourceRoot":""}