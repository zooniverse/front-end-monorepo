(self.webpackChunk_zooniverse_fe_project=self.webpackChunk_zooniverse_fe_project||[]).push([[3145],{"../lib-async-states/src/async-states.js":module=>{var asyncStates={};Object.defineProperty(asyncStates,"initialized",{value:"initialized",enumerable:!0}),Object.defineProperty(asyncStates,"loading",{value:"loading",enumerable:!0}),Object.defineProperty(asyncStates,"putting",{value:"putting",enumerable:!0}),Object.defineProperty(asyncStates,"posting",{value:"posting",enumerable:!0}),Object.defineProperty(asyncStates,"success",{value:"success",enumerable:!0}),Object.defineProperty(asyncStates,"error",{value:"error",enumerable:!0}),Object.defineProperty(asyncStates,"values",{value:Object.values(asyncStates)}),module.exports=asyncStates},"./src/helpers/getCookie/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>getCookie});var dist=__webpack_require__("./node_modules/cookie/dist/index.js");function getCookie(name){var _document;if(null!==(_document=document)&&void 0!==_document&&_document.cookie){var parsedCookie=dist.qg(document.cookie);return parsedCookie&&parsedCookie[name]?parsedCookie[name]:""}return""}},"./src/helpers/logger/logToSentry.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>logToSentry});var _sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/@sentry/core/build/esm/exports.js"),_sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/@sentry/core/build/esm/currentScopes.js"),process=__webpack_require__("../../node_modules/process/browser.js");function logToSentry(error){var errorInfo=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return process.env.SENTRY_PROJECT_DSN&&(0,_sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__.v4)((function(scope){Object.keys(errorInfo).forEach((function(key){scope.setExtra(key,errorInfo[key])})),(0,_sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__.Cp)(error)})),null}},"./stores/Store.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>stores_Store});var async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),mobx_state_tree_module=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),mobx_esm=__webpack_require__("../../node_modules/mobx/dist/mobx.esm.js"),logToSentry=__webpack_require__("./src/helpers/logger/logToSentry.js");const types_numberString=mobx_state_tree_module.gK.refinement("numberString",mobx_state_tree_module.gK.string,(function(value){return/^\d+$/.test(value)}));var TranslationStrings=mobx_state_tree_module.gK.map(mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string));const stores_Organization=mobx_state_tree_module.gK.model("Organization",{id:mobx_state_tree_module.gK.maybeNull(types_numberString),display_name:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),listed:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),primary_language:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,"en"),slug:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),strings:TranslationStrings}).views((function(self){return{get title(){return self.strings.get("title")}}}));var slicedToArray=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),Project_TranslationStrings=mobx_state_tree_module.gK.map(mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string));const stores_Project=mobx_state_tree_module.gK.model("Project",{about_pages:mobx_state_tree_module.gK.frozen([]),avatar:mobx_state_tree_module.gK.frozen({}),background:mobx_state_tree_module.gK.frozen({}),beta_approved:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),beta_requested:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),classifications_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),classifiers_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),configuration:mobx_state_tree_module.gK.frozen({}),completeness:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),error:mobx_state_tree_module.gK.frozen({}),experimental_tools:mobx_state_tree_module.gK.frozen([]),id:mobx_state_tree_module.gK.maybeNull(types_numberString),launch_approved:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),links:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),live:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),primary_language:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,"en"),owners:mobx_state_tree_module.gK.frozen([]),retired_subjects_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),slug:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),strings:Project_TranslationStrings,subjects_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),urls:mobx_state_tree_module.gK.frozen([])}).views((function(self){return{get baseUrl(){return"/".concat(self.slug)},get defaultWorkflow(){var singleActiveWorkflow;1===self.links.active_workflows.length&&(singleActiveWorkflow=(0,slicedToArray.A)(self.links.active_workflows,1)[0]);return singleActiveWorkflow},get description(){return self.strings.get("description")},get display_name(){return self.strings.get("display_name")},get displayName(){return self.display_name},get hasResultsPage(){return!!self.about_pages.find((function(page){return"results"===page.url_key}))},get introduction(){return self.strings.get("introduction")},get isComplete(){return 1===self.completeness},get inBeta(){return!self.launch_approved&&self.beta_approved},get researcher_quote(){return self.strings.get("researcher_quote")},get title(){return self.strings.get("title")},get workflow_description(){return self.strings.get("workflow_description")},workflowIsActive:function workflowIsActive(workflowId){return self.links.active_workflows.includes(workflowId)}}}));var dist=__webpack_require__("./node_modules/cookie/dist/index.js"),string_hash=__webpack_require__("../../node_modules/@sindresorhus/string-hash/index.js"),string_hash_default=__webpack_require__.n(string_hash),getCookie=__webpack_require__("./src/helpers/getCookie/index.js"),process=__webpack_require__("../../node_modules/process/browser.js"),canSetCookie=process.browser||"test"===process.env.BABEL_ENV;const stores_UI=mobx_state_tree_module.gK.model("UI",{authModalActiveIndex:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,-1),dismissedProjectAnnouncementBanner:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.number)}).views((function(self){return{get showAnnouncement(){var announcement=(0,mobx_state_tree_module.Zn)(self).project.configuration.announcement;return!announcement||string_hash_default()(announcement)!==self.dismissedProjectAnnouncementBanner}}})).preProcessSnapshot((function(snapshot){return{dismissedProjectAnnouncementBanner:snapshot&&snapshot.dismissedProjectAnnouncementBanner?parseInt(snapshot.dismissedProjectAnnouncementBanner,10):void 0}})).actions((function(self){return{afterAttach:function afterAttach(){self.createDismissedProjectAnnouncementBannerObserver()},createDismissedProjectAnnouncementBannerObserver:function createDismissedProjectAnnouncementBannerObserver(){var dismissedProjectAnnouncementBannerDisposer=(0,mobx_esm.fm)((function(){(0,mobx_state_tree_module.k4)(self,(function(patch){var isCorrectPath="/dismissedProjectAnnouncementBanner"===patch.path,parsedCookie=dist.qg(document.cookie)||{},cookieIsStale=parseInt(parsedCookie.dismissedProjectAnnouncementBanner,10)!==self.dismissedProjectAnnouncementBanner;canSetCookie&&isCorrectPath&&cookieIsStale&&self.setProjectAnnouncementBannerCookie()}))}),{name:"updateDismissedProjectAnnouncementBannerCookie"});(0,mobx_state_tree_module.LF)(self,dismissedProjectAnnouncementBannerDisposer)},dismissProjectAnnouncementBanner:function dismissProjectAnnouncementBanner(){var announcement=(0,mobx_state_tree_module.Zn)(self).project.configuration.announcement,announcementHash=string_hash_default()(announcement);self.dismissedProjectAnnouncementBanner=announcementHash},readCookies:function readCookies(){canSetCookie&&(self.dismissedProjectAnnouncementBanner=parseInt((0,getCookie.A)("dismissedProjectAnnouncementBanner"),10)||null)},setAuthModalActiveIndex:function setAuthModalActiveIndex(index){self.authModalActiveIndex=index},setProjectAnnouncementBannerCookie:function setProjectAnnouncementBannerCookie(){var slug=(0,mobx_state_tree_module.Zn)(self).project.slug;document.cookie=dist.lK("dismissedProjectAnnouncementBanner",self.dismissedProjectAnnouncementBanner,{domain:"zooniverse.org",path:"/projects/".concat(slug)})}}}));var defineProperty=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),auth=__webpack_require__("../../node_modules/panoptes-client/lib/auth.js"),auth_default=__webpack_require__.n(auth),Collections=__webpack_require__("./stores/User/Collections/Collections.js"),regenerator=__webpack_require__("../../node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),console=__webpack_require__("../../node_modules/console-browserify/index.js"),Recent=mobx_state_tree_module.gK.model("Recent",{favorite:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),subjectId:mobx_state_tree_module.gK.string,locations:mobx_state_tree_module.gK.frozen({})}).actions((function(self){return{toggleFavourite:function toggleFavourite(){var collections=(0,mobx_state_tree_module.k2)(self,User_User).collections;self.favorite=!self.favorite,self.favorite?collections.addFavourites([self.subjectId]):collections.removeFavourites([self.subjectId])}}}));const Recents_Recents=mobx_state_tree_module.gK.model("Recents",{error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),recents:mobx_state_tree_module.gK.array(Recent),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized)}).actions((function(self){return{fetch:(0,mobx_state_tree_module.L3)(regenerator_default().mark((function fetch(){var _getRoot,client,project,user,token,authorization,query,response,recents,_t;return regenerator_default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _getRoot=(0,mobx_state_tree_module.Zn)(self),client=_getRoot.client,project=_getRoot.project,user=_getRoot.user,self.loadingState=async_states_default().loading,_context.prev=1,_context.next=2,auth_default().checkBearerToken();case 2:return token=_context.sent,authorization="Bearer ".concat(token),query={project_id:project.id,sort:"-created_at"},_context.next=3,client.panoptes.get("/users/".concat(user.id,"/recents"),query,{authorization});case 3:response=_context.sent,recents=response.body.recents,self.recents=recents.map((function(recent){return{subjectId:recent.links.subject,locations:recent.locations}})),self.loadingState=async_states_default().success,_context.next=5;break;case 4:_context.prev=4,_t=_context.catch(1),console.error(_t),self.error=_t,self.loadingState=async_states_default().error;case 5:case"end":return _context.stop()}}),fetch,null,[[1,4]])}))),add:function add(_ref){var subjectId=_ref.subjectId,_ref$favorite=_ref.favorite,favorite=void 0!==_ref$favorite&&_ref$favorite,locations=_ref.locations;self.recents.unshift(Recent.create({subjectId,favorite,locations}))}}}));var asyncToGenerator=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),src=__webpack_require__("../lib-panoptes-js/src/index.js");function getUnreadConversationsIds(_x){return _getUnreadConversationsIds.apply(this,arguments)}function _getUnreadConversationsIds(){return _getUnreadConversationsIds=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee2(authorization){var unreadConversationsIds,getConversations,_getConversations;return regenerator_default().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(_getConversations=function _getConversations3(){return _getConversations=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee(){var query,response,_ref,meta,conversations,_args=arguments;return regenerator_default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return query={unread:!0,page:_args.length>0&&void 0!==_args[0]?_args[0]:1},_context.next=1,src.talkAPI.get("/conversations",query,{authorization});case 1:if(response=_context.sent,_ref=(null==response?void 0:response.body)||{},meta=_ref.meta,(conversations=_ref.conversations)&&conversations.length&&(unreadConversationsIds=unreadConversationsIds.concat(conversations.map((function(conversation){return conversation.id})))),null==meta||!meta.next_page){_context.next=2;break}return _context.abrupt("return",getConversations(meta.next_page));case 2:return _context.abrupt("return",unreadConversationsIds);case 3:case"end":return _context.stop()}}),_callee)}))),_getConversations.apply(this,arguments)},getConversations=function _getConversations2(){return _getConversations.apply(this,arguments)},authorization){_context2.next=1;break}return _context2.abrupt("return",[]);case 1:return unreadConversationsIds=[],_context2.abrupt("return",getConversations(1));case 2:case"end":return _context2.stop()}}),_callee2)}))),_getUnreadConversationsIds.apply(this,arguments)}function getUnreadNotificationsCount(_x){return _getUnreadNotificationsCount.apply(this,arguments)}function _getUnreadNotificationsCount(){return(_getUnreadNotificationsCount=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee(authorization){var query;return regenerator_default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(authorization){_context.next=1;break}return _context.abrupt("return",void 0);case 1:return query={delivered:!1,page_size:1},_context.abrupt("return",src.talkAPI.get("/notifications",query,{authorization}).then((function(response){var _response$body;return null==response||null===(_response$body=response.body)||void 0===_response$body||null===(_response$body=_response$body.meta)||void 0===_response$body||null===(_response$body=_response$body.notifications)||void 0===_response$body?void 0:_response$body.count})));case 2:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}var sugarClient,_initSugarClient,Notifications_console=__webpack_require__("../../node_modules/console-browserify/index.js"),isBrowser="undefined"!=typeof window;(_initSugarClient=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee(){var sugarModule;return regenerator_default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!isBrowser){_context.next=2;break}return _context.next=1,Promise.all([__webpack_require__.e(7588),__webpack_require__.e(6857)]).then(__webpack_require__.t.bind(__webpack_require__,"../../node_modules/panoptes-client/lib/sugar.js",23));case 1:sugarModule=_context.sent,sugarClient=sugarModule.sugarClient;case 2:case"end":return _context.stop()}}),_callee)}))),function initSugarClient(){return _initSugarClient.apply(this,arguments)})();const Notifications_Notifications=mobx_state_tree_module.gK.model("Notifications",{unreadConversationsIds:mobx_state_tree_module.gK.array(mobx_state_tree_module.gK.string),unreadNotificationsCount:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized)}).actions((function(self){return{fetchAndSubscribe:function fetchAndSubscribe(){self.fetchInitialUnreadConversationsIds(),self.fetchInitialUnreadNotificationsCount(),self.subscribeToSugarNotifications()},fetchInitialUnreadConversationsIds:(0,mobx_state_tree_module.L3)(regenerator_default().mark((function fetchInitialUnreadConversationsIds(){var token,authorization,unreadConversationsIds,_t;return regenerator_default().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return self.setLoadingState(async_states_default().loading),_context2.prev=1,_context2.next=2,auth_default().checkBearerToken();case 2:return token=_context2.sent,authorization="Bearer ".concat(token),_context2.next=3,getUnreadConversationsIds(authorization);case 3:unreadConversationsIds=_context2.sent,self.unreadConversationsIds=unreadConversationsIds,self.setLoadingState(async_states_default().success),_context2.next=5;break;case 4:_context2.prev=4,_t=_context2.catch(1),self.handleError(_t);case 5:case"end":return _context2.stop()}}),fetchInitialUnreadConversationsIds,null,[[1,4]])}))),fetchInitialUnreadNotificationsCount:(0,mobx_state_tree_module.L3)(regenerator_default().mark((function fetchInitialUnreadNotificationsCount(){var token,authorization,unreadNotificationsCount,_t2;return regenerator_default().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return self.setLoadingState(async_states_default().loading),_context3.prev=1,_context3.next=2,auth_default().checkBearerToken();case 2:return token=_context3.sent,authorization="Bearer ".concat(token),unreadNotificationsCount=0,_context3.next=3,getUnreadNotificationsCount(authorization);case 3:unreadNotificationsCount=_context3.sent,self.unreadNotificationsCount=unreadNotificationsCount,self.setLoadingState(async_states_default().success),_context3.next=5;break;case 4:_context3.prev=4,_t2=_context3.catch(1),self.handleError(_t2);case 5:case"end":return _context3.stop()}}),fetchInitialUnreadNotificationsCount,null,[[1,4]])}))),processSugarNotification:function processSugarNotification(notification){if("Moderation"!==(null==notification?void 0:notification.data.source_type)&&(self.unreadNotificationsCount=self.unreadNotificationsCount+1),"Message"===(null==notification?void 0:notification.data.source_type)){var conversationId=notification.data.url.split("/").pop();self.unreadConversationsIds.includes(conversationId)||self.unreadConversationsIds.push(conversationId)}},subscribeToSugarNotifications:function subscribeToSugarNotifications(){var user=(0,mobx_state_tree_module.Zn)(self).user;try{sugarClient.subscribeTo("user:".concat(user.id)),sugarClient.on("notification",(function(notification){return self.processSugarNotification(notification)}))}catch(error){self.handleError(error)}},unsubscribeFromSugarNotifications:function unsubscribeFromSugarNotifications(){var user=(0,mobx_state_tree_module.Zn)(self).user;if(user)try{sugarClient.unsubscribeFrom("user:".concat(null==user?void 0:user.id))}catch(error){self.handleError(error)}},handleError:function handleError(error){Notifications_console.error(error),self.error=error,self.setLoadingState(async_states_default().error)},setLoadingState:function setLoadingState(state){self.loadingState=state},reset:function reset(){this.unsubscribeFromSugarNotifications(),self.unreadConversationsIds=[],self.unreadNotificationsCount=0,self.error=void 0,this.setLoadingState(async_states_default().initialized)}}}));var UserProjectPreferences_console=__webpack_require__("../../node_modules/console-browserify/index.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var Preferences=mobx_state_tree_module.gK.model("Preferences",{minicourses:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen()),selected_workflow:mobx_state_tree_module.gK.maybe(types_numberString),tutorials_completed_at:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen())}),Settings=mobx_state_tree_module.gK.model("Settings",{workflow_id:mobx_state_tree_module.gK.maybe(types_numberString)}).preProcessSnapshot((function(snapshot){var _snapshot$workflow_id;return snapshot?_objectSpread(_objectSpread({},snapshot),{},{workflow_id:null==snapshot||null===(_snapshot$workflow_id=snapshot.workflow_id)||void 0===_snapshot$workflow_id?void 0:_snapshot$workflow_id.toString()}):snapshot}));const UserProjectPreferences_UserProjectPreferences=mobx_state_tree_module.gK.model("UserProjectPreferences",{error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),id:mobx_state_tree_module.gK.maybe(types_numberString),links:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen({project:mobx_state_tree_module.gK.string,user:mobx_state_tree_module.gK.string})),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),preferences:mobx_state_tree_module.gK.maybe(Preferences),settings:mobx_state_tree_module.gK.maybe(Settings)}).views((function(self){return{get assignedWorkflowID(){var _self$settings;return null===(_self$settings=self.settings)||void 0===_self$settings?void 0:_self$settings.workflow_id},promptAssignment:function promptAssignment(currentWorkflowID){var project=(0,mobx_state_tree_module.Zn)(self).project;return!(!self.assignedWorkflowID||!currentWorkflowID||self.assignedWorkflowID===currentWorkflowID)&&project.workflowIsActive(self.assignedWorkflowID)},get isLoaded(){return self.loadingState===async_states_default().success}}})).actions((function(self){function _fetch(){return _fetch2.apply(this,arguments)}function _fetch2(){return(_fetch2=(0,asyncToGenerator.A)(regenerator_default().mark((function _callee(){var _getRoot,client,project,user,token,authorization,query,response,_response$body$projec,preferences;return regenerator_default().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _getRoot=(0,mobx_state_tree_module.Zn)(self),client=_getRoot.client,project=_getRoot.project,user=_getRoot.user,_context3.next=1,auth_default().checkBearerToken();case 1:return token=_context3.sent,authorization="Bearer ".concat(token),query={project_id:project.id,user_id:user.id},_context3.next=2,client.panoptes.get("/project_preferences",query,{authorization});case 2:return response=_context3.sent,_response$body$projec=(0,slicedToArray.A)(response.body.project_preferences,1),preferences=_response$body$projec[0],_context3.abrupt("return",preferences);case 3:case"end":return _context3.stop()}}),_callee)})))).apply(this,arguments)}return{reset:function reset(){var resetSnapshot={error:void 0,id:void 0,links:void 0,loadingState:async_states_default().initialized,preferences:void 0,settings:void 0};(0,mobx_state_tree_module.Nh)(self,resetSnapshot)},setResource:function setResource(resource){(0,mobx_state_tree_module.Nh)(self,resource)},setLoadingState:function setLoadingState(state){self.loadingState=state},fetchResource:(0,mobx_state_tree_module.L3)(regenerator_default().mark((function fetchResource(){var preferences,_t;return regenerator_default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.prev=0,self.id){_context.next=2;break}return self.setLoadingState(async_states_default().loading),_context.next=1,_fetch();case 1:(preferences=_context.sent)&&(0,mobx_state_tree_module.Nh)(self,preferences),self.setLoadingState(async_states_default().success);case 2:_context.next=4;break;case 3:_context.prev=3,_t=_context.catch(0),UserProjectPreferences_console.error(_t),(0,logToSentry.A)(_t),self.error=_t,self.setLoadingState(async_states_default().error);case 4:case"end":return _context.stop()}}),fetchResource,null,[[0,3]])}))),refreshSettings:(0,mobx_state_tree_module.L3)(regenerator_default().mark((function refreshSettings(){var preferences,_t2;return regenerator_default().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=1,_fetch();case 1:null!=(preferences=_context2.sent)&&preferences.settings&&(self.settings=preferences.settings),self.setLoadingState(async_states_default().success),_context2.next=3;break;case 2:_context2.prev=2,_t2=_context2.catch(0),UserProjectPreferences_console.error(_t2);case 3:case"end":return _context2.stop()}}),refreshSettings,null,[[0,2]])})))}}));const UserPersonalization_UserPersonalization=mobx_state_tree_module.gK.model("UserPersonalization",{notifications:mobx_state_tree_module.gK.optional(Notifications_Notifications,{}),projectPreferences:mobx_state_tree_module.gK.optional(UserProjectPreferences_UserProjectPreferences,{}),sessionCount:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0)}).views((function(self){return{get sessionCountIsDivisibleByFive(){return self.sessionCount%5==0}}})).actions((function(self){function _onUserChange(){var user=(0,mobx_state_tree_module.Zn)(self).user;user.isLoggedIn||user.loadingState!==async_states_default().success||self.projectPreferences.setLoadingState(async_states_default().success)}return{afterAttach:function afterAttach(){(0,mobx_state_tree_module.LF)(self,(0,mobx_esm.fm)(_onUserChange))},incrementSessionCount:function incrementSessionCount(){self.sessionCount=self.sessionCount+1;var user=(0,mobx_state_tree_module.Zn)(self).user;null!=user&&user.id&&self.sessionCountIsDivisibleByFive&&self.projectPreferences.refreshSettings()},load:function load(){var newUser=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];self.notifications.fetchAndSubscribe(),newUser?self.projectPreferences.fetchResource():self.projectPreferences.refreshSettings()},reset:function reset(){self.notifications.reset(),self.projectPreferences.reset(),self.projectPreferences.setLoadingState(async_states_default().success),self.sessionCount=0}}}));function User_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function User_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?User_ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):User_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const User_User=mobx_state_tree_module.gK.model("User",{admin:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),avatar_src:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),collections:mobx_state_tree_module.gK.optional(Collections.A,{}),display_name:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),id:mobx_state_tree_module.gK.maybeNull(types_numberString),login:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),personalization:mobx_state_tree_module.gK.optional(UserPersonalization_UserPersonalization,{}),recents:mobx_state_tree_module.gK.optional(Recents_Recents,{})}).views((function(self){return{get displayName(){return self.display_name},get isAdmin(){return self.isLoggedIn&&self.admin},get isLoaded(){return self.loadingState===async_states_default().success},get isLoggedIn(){return!!self.id}}})).actions((function(self){return{clear:function clear(){var loggedOutUser={id:null,display_name:null,login:null,loadingState:async_states_default().success,personalization:{projectPreferences:{loadingState:async_states_default().success}}};(0,mobx_state_tree_module.Nh)(self,loggedOutUser)},set:function set(user){var newUser=self.id!==(null==user?void 0:user.id),userSnapshot=User_objectSpread(User_objectSpread({personalization:(0,mobx_state_tree_module.dV)(self).personalization},user),{},{loadingState:async_states_default().success});(0,mobx_state_tree_module.Nh)(self,userSnapshot),self.recents.fetch(),self.collections.searchCollections({favorite:!1,current_user_roles:"owner,collaborator,contributor"}),self.id&&self.personalization.load(newUser)}}}));var Store_console=__webpack_require__("../../node_modules/console-browserify/index.js");const stores_Store=mobx_state_tree_module.gK.model("Store",{organization:mobx_state_tree_module.gK.optional(stores_Organization,{}),project:mobx_state_tree_module.gK.optional(stores_Project,{}),ui:mobx_state_tree_module.gK.optional(stores_UI,{}),user:mobx_state_tree_module.gK.optional(User_User,{})}).views((function(self){return{get client(){return(0,mobx_state_tree_module._$)(self).client},get appLoadingState(){var loadingStates=[self.user.loadingState,self.user.personalization.projectPreferences.loadingState,self.project.loadingState];return loadingStates.includes(async_states_default().error)?async_states_default().error:loadingStates.includes(async_states_default().loading)?async_states_default().loading:loadingStates.every((function(state){return state===async_states_default().success}))?async_states_default().success:async_states_default().initialized}}})).actions((function(self){return{afterCreate:function afterCreate(){!function createSignOutObserver(){var signOutDisposer=(0,mobx_esm.fm)((function(){(0,mobx_state_tree_module.i5)(self,(function(call){"clear"===call.name&&self.user.personalization.reset()}))}),{name:"User clear action Observer autorun"});(0,mobx_state_tree_module.LF)(self,signOutDisposer)}(),(0,mobx_state_tree_module.I7)(self,(function(call,next,abort){try{next(call)}catch(error){Store_console.error("Project App MST error:",error),(0,logToSentry.A)(error)}}))},testError:function testError(){throw new Error("Testing errors")}}}))},"./stores/User/Collections/Collections.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,p:()=>Collection});var _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/@babel/runtime/regenerator/index.js"),_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__),mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/panoptes-client/lib/auth.js"),panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3__),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../lib-async-states/src/async-states.js"),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4__),console=__webpack_require__("../../node_modules/console-browserify/index.js"),Collection=mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.model("Collection",{display_name:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.maybeNull(mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.string),favorite:!1,id:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.identifier,links:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.frozen({}),private:!0});const __WEBPACK_DEFAULT_EXPORT__=mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.model("Collections",{error:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.maybeNull(mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.frozen({})),collections:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.array(Collection),favourites:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.maybeNull(Collection),loadingState:mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.optional(mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.gK.enumeration("state",_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().values),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().initialized)}).actions((function(self){var client,fetchCollections=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function fetchCollections(query){var token,authorization,response,collections,_t;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().loading,_context.next=1,panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3___default().checkBearerToken();case 1:return token=_context.sent,authorization="Bearer ".concat(token),_context.next=2,client.collections.get({authorization,query});case 2:return response=_context.sent,collections=response.body.collections,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().success,_context.abrupt("return",collections);case 3:return _context.prev=3,_t=_context.catch(0),console.log(_t.message),self.error=_t,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().error,_context.abrupt("return",[]);case 4:case"end":return _context.stop()}}),fetchCollections,null,[[0,3]])}))),newCollection=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)((function newCollection(options){var subjectIds=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee(){var _getRoot,project,token,authorization,defaults,data,response,_response$body$collec,collection,_t2;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_getRoot=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.Zn)(self),project=_getRoot.project,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().loading,_context2.next=1,panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3___default().checkBearerToken();case 1:return token=_context2.sent,authorization="Bearer ".concat(token),defaults={display_name:"",favorite:!1,private:!1},data=Object.assign({},defaults,options),_context2.next=2,client.collections.create({authorization,data,project:project.id,subjects:subjectIds});case 2:return response=_context2.sent,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().success,_response$body$collec=(0,_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__.A)(response.body.collections,1),collection=_response$body$collec[0],_context2.abrupt("return",collection);case 3:return _context2.prev=3,_t2=_context2.catch(0),console.log(_t2.message),self.error=_t2,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_4___default().error,_context2.abrupt("return",null);case 4:case"end":return _context2.stop()}}),_callee,null,[[0,3]])}))()}));return{afterAttach:function afterAttach(){client=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.Zn)(self).client},createCollection:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)((function createCollection(options){var subjectIds=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee2(){var collection;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=1,newCollection(options,subjectIds);case 1:return collection=_context3.sent,_context3.abrupt("return",collection);case 2:case"end":return _context3.stop()}}),_callee2)}))()})),createFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)((function createFavourites(){var subjectIds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee3(){var _getRoot2,project,options,favourites;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _getRoot2=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.Zn)(self),project=_getRoot2.project,options={display_name:"Favorites ".concat(project.slug),favorite:!0,private:!0},_context4.next=1,newCollection(options,subjectIds);case 1:return favourites=_context4.sent,_context4.abrupt("return",favourites);case 2:case"end":return _context4.stop()}}),_callee3)}))()})),searchCollections:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function searchCollections(query){return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=1,fetchCollections(query);case 1:self.collections=_context5.sent;case 2:case"end":return _context5.stop()}}),searchCollections)}))),fetchFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function fetchFavourites(){var _getRoot3,project,user,query,_yield$fetchCollectio,_yield$fetchCollectio2,favourites;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _getRoot3=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.Zn)(self),project=_getRoot3.project,user=_getRoot3.user,query={favorite:!0,project_ids:[project.id],owner:user.login},_context6.next=1,fetchCollections(query);case 1:return _yield$fetchCollectio=_context6.sent,_yield$fetchCollectio2=(0,_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__.A)(_yield$fetchCollectio,1),favourites=_yield$fetchCollectio2[0],_context6.abrupt("return",favourites);case 2:case"end":return _context6.stop()}}),fetchFavourites)}))),fetchOrCreateFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function fetchOrCreateFavourites(){var favouritesData;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=1,self.fetchFavourites();case 1:if(favouritesData=_context7.sent){_context7.next=3;break}return _context7.next=2,self.createFavourites();case 2:favouritesData=_context7.sent;case 3:return self.setFavourites(favouritesData),_context7.abrupt("return",self.favourites);case 4:case"end":return _context7.stop()}}),fetchOrCreateFavourites)}))),setFavourites:function setFavourites(favourites){self.favourites=favourites?Collection.create(favourites):null},addSubjects:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function addSubjects(id,subjectIds){var token,authorization,params,response,_response$body$collec2,collection;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=1,panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3___default().checkBearerToken();case 1:return token=_context8.sent,authorization="Bearer ".concat(token),params={authorization,id,subjects:subjectIds},_context8.next=2,client.collections.addSubjects(params);case 2:return response=_context8.sent,_response$body$collec2=(0,_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_0__.A)(response.body.collections,1),collection=_response$body$collec2[0],_context8.abrupt("return",collection);case 3:case"end":return _context8.stop()}}),addSubjects)}))),addFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function addFavourites(subjectIds){var _self$favourites,favouritesData;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(null!==(_self$favourites=self.favourites)&&void 0!==_self$favourites&&_self$favourites.id){_context9.next=1;break}return _context9.next=1,self.fetchOrCreateFavourites();case 1:return _context9.next=2,self.addSubjects(self.favourites.id,subjectIds);case 2:favouritesData=_context9.sent,self.setFavourites(favouritesData);case 3:case"end":return _context9.stop()}}),addFavourites)}))),removeSubjects:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function removeSubjects(id,subjectIds){var token,authorization,params;return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context0){for(;;)switch(_context0.prev=_context0.next){case 0:return _context0.next=1,panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_3___default().checkBearerToken();case 1:return token=_context0.sent,authorization="Bearer ".concat(token),params={authorization,id,subjects:subjectIds},_context0.next=2,client.collections.removeSubjects(params);case 2:case"end":return _context0.stop()}}),removeSubjects)}))),removeFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_2__.L3)(_home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function removeFavourites(subjectIds){return _home_runner_work_front_end_monorepo_front_end_monorepo_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(_context1){for(;;)switch(_context1.prev=_context1.next){case 0:return _context1.next=1,self.removeSubjects(self.favourites.id,subjectIds);case 1:case"end":return _context1.stop()}}),removeFavourites)})))}}))}}]);