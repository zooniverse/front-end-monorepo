{"version":3,"file":"shared-components-SubjectSetPicker-SubjectSetPicker-stories.e818d77b.iframe.bundle.js","mappings":";AAOA;AACA;;ACkBA","sources":["webpack://@zooniverse/fe-project/./src/shared/components/SubjectSetPicker/components/SubjectSetCard/SubjectSetCard.jsx","webpack://@zooniverse/fe-project/./src/shared/components/SubjectSetPicker/SubjectSetPicker.jsx"],"sourcesContent":["import { Media, SpacedText } from '@zooniverse/react-components'\nimport { Box, Image, Paragraph, Text } from 'grommet'\nimport { array, number, string } from 'prop-types'\nimport styled, { css } from 'styled-components'\nimport { useTranslation } from 'next-i18next'\n\nconst PossiblyTransparentBox = styled(Box)`\n  ${props => css`opacity: ${(props.isComplete) ? '0.5' : '1.0'};`}\n`\n\n/**\n  Summary card for a subject set, showing a preview subject, the set name, total subject count and completeness percentage.\n*/\nfunction SubjectSetCard ({\n  completeness = 0,\n  display_name,\n  id,\n  set_member_subjects_count,\n  subjects = []\n}) {\n  const { t } = useTranslation('components')\n  const [subject] = subjects\n  const placeholderUrl = 'https://static.zooniverse.org/fem-assets/subject-placeholder.jpg'\n  const subjectURLs = subject ? subject.locations.map(location => Object.values(location)[0]) : []\n  const alt = subject ? `Subject ${subject.id}` : 'Loading'\n  const percentComplete = parseInt(100 * completeness)\n  const isComplete = completeness >= 1\n  const placeholder = <Image alt='' height={358} role='presentation' src={placeholderUrl} width={500} />\n\n  return (\n    <Box\n      className=\"subject-set-card\"\n      data-testid={`subject-set-card-${id}`}\n      background='neutral-6'\n      border='all'\n    >\n      <PossiblyTransparentBox\n        align='center'\n        height='100px'\n        isComplete={isComplete}\n        overflow='hidden'\n        width='100%'\n      >\n        <Media\n          alt={alt}\n          height={700}\n          placeholder={placeholder}\n          src={subjectURLs[0]}\n          width={700}\n        />\n      </PossiblyTransparentBox>\n      <PossiblyTransparentBox\n        isComplete={isComplete}\n        pad='small'\n      >\n        {(isComplete) && (\n          <SpacedText\n            weight=\"normal\"\n          >\n            {t('SubjectSetPicker.SubjectSetCard.isComplete')}\n          </SpacedText>\n        )}\n\n        <SpacedText\n          truncate\n          weight=\"bold\"\n        >\n          {display_name}\n        </SpacedText>\n        <Paragraph\n          margin={{\n            top: 'small',\n            bottom: 'none',\n            horizontal: 'none'\n          }}\n        >\n          <Text\n            weight=\"normal\"\n          >\n            {`${set_member_subjects_count} subjects`}\n          </Text>\n\n          <br />\n\n          {(!isComplete) && (\n            <Text\n              weight=\"normal\"\n            >\n              {percentComplete}% complete\n            </Text>\n          )}\n        </Paragraph>\n      </PossiblyTransparentBox>\n    </Box>\n  )\n}\n\nSubjectSetCard.propTypes = {\n  /**\n   The number of subjects available to be classified.\n  */\n  availableSubjects: number.isRequired,\n  /**\n   Subject set title.\n  */\n  display_name: string.isRequired,\n  /**\n    Subject set ID.\n  */\n  id: string.isRequired,\n  /**\n    Total subject count\n  */\n  set_member_subjects_count: number.isRequired,\n  /**\n   Preview subjects. Used to show a preview image.\n  */\n  subjects: array\n}\n\nexport default SubjectSetCard\n","import { PlainButton } from '@zooniverse/react-components'\nimport { Anchor, Box, Grid, Heading, Paragraph } from 'grommet'\nimport Link from 'next/link'\nimport { array, bool, number, shape, string } from 'prop-types'\nimport styled from 'styled-components'\nimport { useTranslation } from 'next-i18next'\n\nimport addQueryParams from '@helpers/addQueryParams'\nimport SubjectSetCard from './components/SubjectSetCard'\n\nfunction NoPrefetchLink(props) {\n  return <Link prefetch={false} {...props} />\n}\n\n/*\n  Grommet is opinionated about line-height and links it to font-size.\n  Reset the heading baselines here so that spacing is measured from\n  the tops and bottoms of the letters (without changing the text size.)\n  https://matthiasott.com/notes/the-thing-with-leading-in-css\n*/\nconst StyledHeading = styled(Heading)`\n  line-height: 100%;\n`\n\n/**\n  Display a list of subject set cards for a workflow. Each card links to the corresponding subject set ID.\n*/\nfunction SubjectSetPicker ({\n  baseUrl,\n  workflow\n}) {\n  const { t } = useTranslation('components')\n  /*\n    Vertical spacing for the picker instructions.\n    The theme's named margins are set in multiples of 10px, so set 15px explicitly.\n  */\n  const textMargin = {\n    top: '15px',\n    bottom: 'medium'\n  }\n\n  const columns = Math.floor(window.innerWidth / 240)\n\n  const sortedSubjectSets = (workflow?.subjectSets)\n    ? [...workflow?.subjectSets]\n    : []\n\n  // Sort the Subject Sets so completed sets appear at the end.\n  sortedSubjectSets.sort((a, b) => {\n    const aCompleteness = a.completeness[workflow.id] || 0\n    const bCompleteness = b.completeness[workflow.id] || 0\n    const aIsComplete = aCompleteness >= 1\n    const bIsComplete = bCompleteness >= 1\n    return (aIsComplete === bIsComplete)\n      ? 0  // We don't change the order if both sets are complete, or both sets are incomplete.\n      : aCompleteness - bCompleteness\n  })\n\n  return (\n    <>\n      <PlainButton\n        forwardedAs={Link}\n        href={addQueryParams(baseUrl)}\n        text={t('SubjectSetPicker.back')}\n      />\n      <StyledHeading\n        level={3}\n        margin={{ top: 'xsmall', bottom: 'none' }}\n      >\n        {t('SubjectSetPicker.heading')}\n      </StyledHeading>\n      <Paragraph\n        margin={textMargin}\n      >\n        {t('SubjectSetPicker.byline')}\n      </Paragraph>\n      <Box\n        background='light-1'\n        border={{ color: 'light-5', size: 'xsmall' }}\n        overflow=\"scroll\"\n      >\n        <Grid\n          alignContent='stretch'\n          columns={[`repeat(${columns}, minmax(200px, 1fr))`]}\n          gap='small'\n          pad='medium'\n        >\n          {sortedSubjectSets.map(subjectSet => {\n            const href = `${baseUrl}/workflow/${workflow.id}/subject-set/${subjectSet.id}`\n            const panoptesCompleteness = subjectSet.completeness[workflow.id]\n            return (\n              <Anchor\n                as={NoPrefetchLink}\n                key={subjectSet.id}\n                href={addQueryParams(href)}\n                className=\"test-subject-set-card\" data-testid={`test-subject-set-card-${subjectSet.id}`}\n              >\n                <SubjectSetCard\n                  {...subjectSet}\n                  completeness={panoptesCompleteness}  /* This will override subjectSet.completeness */\n                />\n              </Anchor>\n            )\n          })}\n        </Grid>\n      </Box>\n    </>\n  )\n}\n\nSubjectSetPicker.propTypes = {\n  /**\n    Base URL for links eg. `/${owner}/${project}/classify`\n  */\n  baseUrl: string.isRequired,\n  /**\n    The selected workflow.\n  */\n  workflow: shape({\n    completeness: number,\n    default: bool,\n    display_name: string,\n    id: string,\n    subjectSets: array\n  }).isRequired\n}\n\nexport default SubjectSetPicker\nexport { StyledHeading }\n"],"names":[],"ignoreList":[],"sourceRoot":""}