/*! For license information please see 5308.8c3c4e2d.iframe.bundle.js.LICENSE.txt */
(self.webpackChunk_zooniverse_fe_project=self.webpackChunk_zooniverse_fe_project||[]).push([[5308],{"../../node_modules/normalizeurl/lib/normalizeUrl.js"(module,__unused_webpack_exports,__webpack_require__){module.exports=function(nodeJsUrlModule){function extend(targetObj){for(var i=1;i<arguments.length;i+=1){var source=arguments[i];if(source)for(var prop in source)targetObj[prop]=source[prop]}return targetObj}function createNormalizer(options){for(var charsToLeaveAlone=(options=options||{}).leaveAlone||"",asciiCharCodesToPercentEncode=[],doPercentEncodeByUpperCaseHex={},charByUpperCaseHex={},charCode=0;charCode<256;charCode+=1){for(var ch=String.fromCharCode(charCode),upperCaseHex=charCode.toString(16).toUpperCase();upperCaseHex.length<2;)upperCaseHex="0"+upperCaseHex;charByUpperCaseHex[upperCaseHex]=ch,-1===charsToLeaveAlone.indexOf(ch)&&ch!==encodeURIComponent(ch)&&(doPercentEncodeByUpperCaseHex[upperCaseHex]=!0,charCode<128&&"/"!==ch&&"%"!==ch&&"="!==ch&&asciiCharCodesToPercentEncode.push(charCode))}var asciiCharsToPercentEncodeRegExp=new RegExp("["+asciiCharCodesToPercentEncode.map(function(charCode){var hex=charCode.toString("16");return"\\x"+(hex.length<2?"0":"")+hex}).join("")+"]","g");function normalizePercentEncodedChars(urlFragment,allowPassThroughByChar){return urlFragment.replace(/%([0-9a-f]{2})/gi,function($0,hex){var upperCaseHex=hex.toUpperCase();return doPercentEncodeByUpperCaseHex[upperCaseHex]?"%"+upperCaseHex:charByUpperCaseHex[upperCaseHex]}).replace(asciiCharsToPercentEncodeRegExp,allowPassThroughByChar?function($0){return allowPassThroughByChar[$0]?$0:encodeURIComponent($0)}:encodeURIComponent)}function normalizeUrlFragment(urlFragment,urlFragmentName){if(urlFragment=urlFragment||"","protocol"===urlFragmentName)urlFragment=urlFragment.toLowerCase();else if("string"==typeof urlFragment)if(urlFragmentName&&"path"!==urlFragmentName&&"pathname"!==urlFragmentName)"hash"===urlFragmentName||"search"===urlFragmentName?urlFragment.length>0&&(urlFragment=urlFragment[0]+normalizePercentEncodedChars(urlFragment.substr(1),{"?":!0,"#":"hash"===urlFragmentName})):urlFragment="host"===urlFragmentName?normalizePercentEncodedChars(urlFragment,{":":!0}):"auth"===urlFragmentName?normalizePercentEncodedChars(urlFragment,{":":!0,"@":!0}):normalizePercentEncodedChars(urlFragment);else{var numReplacements,matchProtocolRelativeHost=urlFragment.match(/^(\/\/[^\/]+)(\/.*)?$/);matchProtocolRelativeHost&&(urlFragment=matchProtocolRelativeHost[2]||""),urlFragment=(urlFragment=normalizePercentEncodedChars(urlFragment)).replace(/\/\.(\/|$)/g,"$1");do{numReplacements=0,urlFragment=urlFragment.replace(/\/[^\/]+\/\.\.(\/|$)/g,function($0,$1){return numReplacements+=1,$1})}while(numReplacements>0);matchProtocolRelativeHost&&(urlFragment=matchProtocolRelativeHost[1]+urlFragment),urlFragment=urlFragment||"/"}return urlFragment}return function normalizeUrl(urlOrUrlObj){var urlObj,inputIsUrlObj=urlOrUrlObj&&"object"==typeof urlOrUrlObj;if(inputIsUrlObj)urlObj=extend({},urlOrUrlObj);else{if(!nodeJsUrlModule||!nodeJsUrlModule.parse){if(/^[\w\+]+:|^\/\//.test(urlOrUrlObj))throw new Error("Cannot normalize absolute and protocol-relative urls passed as a string without the node.js url module");var matchQueryStringAndFragmentIdentifier=urlOrUrlObj.match(/^([^?#]*)(\?[^#]*)?(#(.*))?$/);return normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[1],"pathname")+normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[2],"search")+normalizeUrlFragment(matchQueryStringAndFragmentIdentifier[3],"hash")}urlObj=nodeJsUrlModule.parse(urlOrUrlObj)}return delete urlObj.href,delete urlObj.path,Object.keys(urlObj).forEach(function(propertyName){urlObj[propertyName]=normalizeUrlFragment(urlObj[propertyName],propertyName)}),inputIsUrlObj?(nodeJsUrlModule&&(urlObj.href=nodeJsUrlModule.format(urlObj),(urlObj.pathname||urlObj.search)&&(urlObj.path=(urlObj.pathname||"")+(urlObj.search||""))),urlObj):nodeJsUrlModule.format(urlObj)}}var defaultNormalizer=createNormalizer();return defaultNormalizer.create=createNormalizer,defaultNormalizer}(__webpack_require__("../../node_modules/url/url.js"))},"../../node_modules/panoptes-client/lib/api-client.js"(module,__unused_webpack_exports,__webpack_require__){var console=__webpack_require__("../../node_modules/console-browserify/index.js"),JSONAPIClient=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/index.js"),config=__webpack_require__("../../node_modules/panoptes-client/lib/config.js"),apiClient=new JSONAPIClient(config.host+"/api",{"Content-Type":"application/json",Accept:"application/vnd.api+json; version=1"},{params:config.params,beforeEveryRequest:function(){return __webpack_require__("../../node_modules/panoptes-client/lib/auth.js").checkBearerToken()},handleError:function(response){var errorMessage;if(response instanceof Error)return Promise.reject(response);response.body&&"object"==typeof response.body?response.body.error?(errorMessage=response.body.error,response.body.error_description&&(errorMessage+=" "+response.error_description)):errorMessage=Array.isArray(response.body.errors)?response.body.errors.map(function(error){return"string"==typeof error.message?error.message:"object"==typeof error.message?Object.keys(error.message).map(function(key){return key+" "+error.message[key]}).join("\n"):void 0}).join("\n"):"Unknown error (bad response body)":errorMessage="Unknown error (bad response)",console.warn(errorMessage);var e=new Error(errorMessage);return e.status=response.status,e.statusText=response.statusText,Promise.reject(e)}});module.exports=apiClient},"../../node_modules/panoptes-client/lib/auth.js"(module,__unused_webpack_exports,__webpack_require__){var console=__webpack_require__("../../node_modules/console-browserify/index.js"),JSONAPIClient=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/index.js"),Model=JSONAPIClient.Model,makeHTTPRequest=JSONAPIClient.makeHTTPRequest,makeCredentialHTTPRequest=JSONAPIClient.makeCredentialHTTPRequest,config=__webpack_require__("../../node_modules/panoptes-client/lib/config.js"),apiClient=__webpack_require__("../../node_modules/panoptes-client/lib/api-client.js"),getCSRFToken=__webpack_require__("../../node_modules/panoptes-client/lib/csrf-token.js");const authClient=new Model({_currentUserPromise:null,_bearerToken:"",_bearerTokenExpiration:NaN,_refreshToken:"",_tokenRefreshPromise:null,async _getBearerToken(){if(console.log("Getting bearer token"),this._bearerToken)return console.info("Already had a bearer token"),this._bearerToken;var url=config.host+"/oauth/token",data={grant_type:"password",client_id:config.clientAppID};try{const response=await makeCredentialHTTPRequest("POST",url,data,config.jsonHeaders),token=this._handleNewBearerToken(response);return console.info("Got bearer token",token.slice(-6)),token}catch(error){return console.error("Failed to get bearer token"),apiClient.handleError(error)}},_handleNewBearerToken(request){var response=JSON.parse(request.text);return this._bearerToken=response.access_token,apiClient.headers.Authorization="Bearer "+this._bearerToken,this._bearerTokenExpiration=Date.now()+1e3*response.expires_in,this._refreshToken=response.refresh_token,this.emit("refresh",this._bearerToken),this._bearerToken},_bearerTokenIsExpired(){return Date.now()>=this._bearerTokenExpiration-3e5},async _makeRefreshTokenRequest(data){var url=config.host+"/oauth/token";let token="";try{const response=await makeHTTPRequest("POST",url,data,config.jsonHeaders);token=this._handleNewBearerToken(response),console.info("Refreshed bearer token",token.slice(-6))}catch(error){console.error("Failed to refresh bearer token"),apiClient.handleError(error)}return this._tokenRefreshPromise=null,token},async _refreshBearerToken(){if(this._refreshToken&&null===this._tokenRefreshPromise){console.log("Refreshing expired bearer token");var data={grant_type:"refresh_token",refresh_token:this._refreshToken,client_id:config.clientAppID};this._tokenRefreshPromise=this._makeRefreshTokenRequest(data)}return this._tokenRefreshPromise},_deleteBearerToken(){this._bearerToken="",delete apiClient.headers.Authorization,this._bearerTokenExpiration=NaN,this._refreshToken="",console.log("Deleted bearer token")},async _getSession(){console.log("Getting session");try{const[user]=await apiClient.get("/me");return console.info("Got session",user.login,user.id),user}catch(error){throw console.error("Failed to get session"),error}},async _makeRegistrationRequest(data){try{const url=config.host+"/users";await makeCredentialHTTPRequest("POST",url,data,config.jsonHeaders),await this._getBearerToken();const user=await this._getSession();return console.info("Registered account",user.login,user.id),user}catch(error){return console.error("Failed to register"),apiClient.handleError(error)}},async register(given){if(await this.checkCurrent())return await this.signOut(),this.register(given);{const data={authenticity_token:await getCSRFToken(config.host),user:{login:given.login,email:given.email,password:given.password,credited_name:given.credited_name,global_email_communication:given.global_email_communication,project_id:given.project_id,beta_email_communication:given.beta_email_communication,project_email_communication:given.project_email_communication}},registrationRequest=this._makeRegistrationRequest(data);return this._currentUserPromise=registrationRequest.catch(()=>null),await this._currentUserPromise,this.emit("change",this._currentUserPromise),registrationRequest}},async _getUser(){try{await this._getBearerToken();return this._getSession()}catch(error){return console.info("No current user"),null}},async checkCurrent(){return this._currentUserPromise||(console.log("Checking current user"),this._currentUserPromise=this._getUser(),await this._currentUserPromise,this.emit("change",this._currentUserPromise)),this._currentUserPromise},async checkBearerToken(){let bearerToken;return bearerToken=this._bearerTokenIsExpired()?await this._refreshBearerToken():this._bearerToken,bearerToken},async _makeSignInRequest(data){try{const url=config.host+"/users/sign_in";await makeCredentialHTTPRequest("POST",url,data,config.jsonHeaders),await this._getBearerToken();const user=await this._getSession();return console.info("Signed in",user.login,user.id),user}catch(error){return console.error("Failed to sign in"),apiClient.handleError(error)}},async signIn(credentials){if(await this.checkCurrent())return await this.signOut(),this.signIn(credentials);{console.log("Signing in",credentials.login);const data={authenticity_token:await getCSRFToken(config.host),user:{login:credentials.login,password:credentials.password,remember_me:!0}},signInRequest=this._makeSignInRequest(data);return this._currentUserPromise=signInRequest.catch(()=>null),await this._currentUserPromise,this.emit("change",this._currentUserPromise),signInRequest}},async changePassword(given){const user=await this.checkCurrent();if(user){const data={authenticity_token:await getCSRFToken(config.host),user:{current_password:given.current,password:given.replacement,password_confirmation:given.replacement}},url=config.host+"/users";return await makeCredentialHTTPRequest("PUT",url,data,config.jsonHeaders),await this.signOut(),this.signIn({login:user.login,password:given.replacement})}throw new Error("No signed-in user to change the password for")},async requestPasswordReset(given){const data={authenticity_token:await getCSRFToken(config.host),user:{email:given.email}};return apiClient.post("/../users/password",data,config.jsonHeaders)},async resetPassword(given){const data={authenticity_token:await getCSRFToken(config.host),user:{password:given.password,password_confirmation:given.confirmation,reset_password_token:given.token}},url=config.host+"/users/password";return makeCredentialHTTPRequest("PUT",url,data,config.jsonHeaders)},async disableAccount(){console.log("Disabling account");const user=await this.checkCurrent();if(user)return this._deleteBearerToken(),this._currentUserPromise=await user.delete().then(()=>null),this.emit("change",this._currentUserPromise),console.info("Disabled account"),null;throw new Error("Failed to disable account; not signed in")},async signOut(){console.log("Signing out");if(!await this.checkCurrent())throw new Error("Failed to sign out; not signed in");{const token=await getCSRFToken(config.host),url=config.host+"/users/sign_out",bearerToken=await this.checkBearerToken(),deleteHeaders={...config.jsonHeaders,"X-CSRF-Token":token,Authorization:"Bearer "+bearerToken};try{return this._deleteBearerToken(),this._currentUserPromise=await makeCredentialHTTPRequest("DELETE",url,null,deleteHeaders).then(()=>null),this.emit("change",this._currentUserPromise),console.info("Signed out"),null}catch(error){return console.error("Failed to sign out"),apiClient.handleError(error)}}},async unsubscribeEmail(given){const token=await getCSRFToken(config.host),url=config.host+"/unsubscribe",data={authenticity_token:token,email:given.email};return makeHTTPRequest("POST",url,data,config.jsonHeaders)}});module.exports={changePassword:authClient.changePassword.bind(authClient),checkCurrent:authClient.checkCurrent.bind(authClient),checkBearerToken:authClient.checkBearerToken.bind(authClient),disableAccount:authClient.disableAccount.bind(authClient),listen:authClient.listen.bind(authClient),register:authClient.register.bind(authClient),requestPasswordReset:authClient.requestPasswordReset.bind(authClient),resetPassword:authClient.resetPassword.bind(authClient),signIn:authClient.signIn.bind(authClient),stopListening:authClient.stopListening.bind(authClient),signOut:authClient.signOut.bind(authClient),unsubscribeEmail:authClient.unsubscribeEmail.bind(authClient)}},"../../node_modules/panoptes-client/lib/config.js"(module,__unused_webpack_exports,__webpack_require__){var process=__webpack_require__("../../node_modules/process/browser.js"),hostFromShell=process.env.PANOPTES_API_HOST,appFromShell=process.env.PANOPTES_API_APPLICATION,talkFromShell=process.env.TALK_HOST,sugarFromShell=process.env.SUGAR_HOST,statFromShell=process.env.STAT_HOST,erasFromShell=process.env.ERAS_HOST,oauthFromShell=process.env.OAUTH_HOST,envFromBrowser=function locationMatch(regex){var match;"undefined"!=typeof location&&null!==location&&(match=location.search.match(regex));return match&&match[1]?match[1]:void 0}(/\W?env=(\w+)/),envFromCreateReactApp=process.env.REACT_APP_ENV,env=envFromBrowser||envFromCreateReactApp||"production";if(!env.match(/^(production|staging|development|test)$/))throw new Error('Panoptes Javascript Client Error: Invalid Environment; try setting NODE_ENV to "staging" instead of "production".');var defaultParams={http_cache:!0};if("undefined"!=typeof location&&null!==location){var query=window.location.search.substring(1);(query=query.split("&")).map(function(param){var pair=param.split("="),key=decodeURIComponent(pair[0]),value=decodeURIComponent(pair[1]);defaultParams[key]&&(defaultParams[key]=value)})}module.exports={host:hostFromShell||{production:"https://www.zooniverse.org",staging:"https://panoptes-staging.zooniverse.org",development:"https://panoptes-staging.zooniverse.org",test:"https://panoptes-staging.zooniverse.org"}[env],clientAppID:appFromShell||{production:"f79cf5ea821bb161d8cbb52d061ab9a2321d7cb169007003af66b43f7b79ce2a",staging:"535759b966935c297be11913acee7a9ca17c025f9f15520e7504728e71110a27",development:"535759b966935c297be11913acee7a9ca17c025f9f15520e7504728e71110a27",test:"535759b966935c297be11913acee7a9ca17c025f9f15520e7504728e71110a27"}[env],talkHost:talkFromShell||{production:"https://talk.zooniverse.org",staging:"https://talk-staging.zooniverse.org",development:"https://talk-staging.zooniverse.org",test:"https://talk-test.zooniverse.org"}[env],sugarHost:sugarFromShell||{production:"https://notifications.zooniverse.org",staging:"https://notifications-staging.zooniverse.org",development:"https://notifications-staging.zooniverse.org",test:"https://notifications-staging.zooniverse.org"}[env],statHost:statFromShell||{production:"https://stats.zooniverse.org",staging:"https://stats-staging.zooniverse.org",development:"https://stats-staging.zooniverse.org",test:"https://stats-staging.zooniverse.org"}[env],erasHost:erasFromShell||{production:"https://eras.zooniverse.org",staging:"https://eras-staging.zooniverse.org",development:"https://eras-staging.zooniverse.org",test:"https://eras-staging.zooniverse.org"}[env],oauthHost:oauthFromShell||{production:"https://www.zooniverse.org",staging:"https://panoptes-staging.zooniverse.org",development:"https://panoptes-staging.zooniverse.org",test:"https://panoptes-staging.zooniverse.org"}[env],params:defaultParams,jsonHeaders:{"Content-Type":"application/json",Accept:"application/json"}}},"../../node_modules/panoptes-client/lib/csrf-token.js"(module,__unused_webpack_exports,__webpack_require__){var console=__webpack_require__("../../node_modules/console-browserify/index.js"),config=__webpack_require__("../../node_modules/panoptes-client/lib/config.js"),apiClient=__webpack_require__("../../node_modules/panoptes-client/lib/api-client.js"),makeCredentialHTTPRequest=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/index.js").makeCredentialHTTPRequest;module.exports=function getCSRFToken(host){console.log("Getting CSRF token");var url=host+"/users/sign_in/?now="+Date.now();return makeCredentialHTTPRequest("GET",url,null,config.jsonHeaders).then(function(response){var csrfToken=response.header["x-csrf-token"];return console.info("Got CSRF token",csrfToken.slice(-6)),csrfToken}).catch(function(response){console.error("Failed to get csrf token"),apiClient.handleError(response)})}},"../../node_modules/panoptes-client/lib/json-api-client/default-headers.js"(module){(function(){module.exports={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/emitter.js"(module){(function(){var arraysMatch,callHandler,splice=[].splice;arraysMatch=function(array1,array2){var i,item,matches,ref;return matches=function(){var j,len,results;for(results=[],i=j=0,len=array1.length;j<len;i=++j)item=array1[i],array2[i]===item&&results.push(i);return results}(),array1.length===(ref=array2.length)&&ref===matches.length},callHandler=function(handler,payload){var boundArgs,context;Array.isArray(handler)?([context,handler,...boundArgs]=handler,"string"==typeof handler&&(handler=context[handler])):boundArgs=[],handler.apply(context,boundArgs.concat(payload))},module.exports=function(){class Emitter{constructor(){this._callbacks={}}listen(...arg){var base,callback,ref,signal;return ref=arg,[...arg]=ref,[callback]=splice.call(arg,-1),[signal]=arg,null==signal&&(signal="change"),null==(base=this._callbacks)[signal]&&(base[signal]=[]),this._callbacks[signal].push(callback),this}stopListening(...arg){var callback,handler,i,index,j,ref,ref1,signal;if(ref=arg,[...arg]=ref,[callback]=splice.call(arg,-1),[signal]=arg,null==signal&&(signal="change"),null!=this._callbacks[signal])if(null!=callback){if(Array.isArray(callback)){for(index=-1,i=j=(ref1=this._callbacks[signal]).length-1;j>=0;i=j+=-1)if(handler=ref1[i],Array.isArray(handler)&&arraysMatch(callback,handler)){index=i;break}}else index=this._callbacks[signal].lastIndexOf(callback);-1!==index&&this._callbacks[signal].splice(index,1)}else this._callbacks[signal].splice(0);return this}emit(signal,...payload){var callback,j,len,ref;if(null==signal&&(signal="change"),signal in this._callbacks)for(j=0,len=(ref=this._callbacks[signal]).length;j<len;j++)callback=ref[j],callHandler(callback,payload);return this}destroy(){var callback,j,len,ref,signal;for(signal in this.emit("destroy"),this._callbacks)for(j=0,len=(ref=this._callbacks[signal]).length;j<len;j++)callback=ref[j],this.stopListening(signal,callback)}}return Emitter.prototype._callbacks=null,Emitter}.call(this)}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/index.js"(module,__unused_webpack_exports,__webpack_require__){(function(){var DEFAULT_HEADERS,Emitter,JSONAPIClient,Model,READ_OPS,RESERVED_TOP_LEVEL_KEYS,Resource,Type,WRITE_OPS,makeHTTPRequest,mergeInto,indexOf=[].indexOf;makeHTTPRequest=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/make-http-request.js"),mergeInto=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/merge-into.js"),Emitter=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/emitter.js"),Type=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/type.js"),Model=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/model.js"),Resource=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/resource.js"),DEFAULT_HEADERS=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/default-headers.js"),RESERVED_TOP_LEVEL_KEYS=["meta","links","linked","data"],READ_OPS=["HEAD","GET"],WRITE_OPS=["POST","PUT","DELETE"],JSONAPIClient=function(){class JSONAPIClient extends Model{constructor(root,headers1={},mixins){super(null),this.root=root,this.headers=headers1,this.params={},this._typesCache={},mergeInto(this,mixins)}beforeEveryRequest(){return Promise.resolve()}request(method,url,payload,headers,query){return this.beforeEveryRequest().then(()=>{var allHeaders,fullPayload,fullURL,request;return method=method.toUpperCase(),fullURL=this.root+url,fullPayload=mergeInto({},this.params,payload),allHeaders=mergeInto({},DEFAULT_HEADERS,this.headers,headers),indexOf.call(READ_OPS,method)>=0?this.update({reads:this.reads+1}):indexOf.call(WRITE_OPS,method)>=0&&this.update({writes:this.writes+1}),(request=makeHTTPRequest.makeHTTPRequest(method,fullURL,fullPayload,allHeaders,query)).catch(()=>null).then(()=>indexOf.call(READ_OPS,method)>=0?this.update({reads:this.reads-1}):indexOf.call(WRITE_OPS,method)>=0?this.update({writes:this.writes-1}):void 0),request.then(this.processResponse.bind(this)).catch(this.handleError.bind(this))})}processResponse(res){var headers,resources,response,results,typeName;if(response=function(){try{return JSON.parse(res.text)}catch(error){return{}}}(),({headers}=res),"links"in response&&this._handleLinks(response.links),"linked"in response)for(typeName in response.linked)response.linked[typeName].filter(Boolean).forEach(resourceData=>{this.type(typeName).create(resourceData,headers,response.meta)});if(results=[],"data"in response)response.data.filter(Boolean).forEach(resourceData=>{results.push(this.type(resourceData.type).create(resourceData,headers,response.meta))});else for(typeName in response)resources=response[typeName],indexOf.call(RESERVED_TOP_LEVEL_KEYS,typeName)<0&&resources.filter(Boolean).forEach(resourceData=>{results.push(this.type(typeName).create(resourceData,headers,response.meta))});return results}_handleLinks(links){var attributeName,href,link,results1,type,typeAndAttribute,typeName;for(typeAndAttribute in results1=[],links)link=links[typeAndAttribute],[typeName,attributeName]=typeAndAttribute.split("."),"string"==typeof link?href=link:({href,type}=link),results1.push(this._handleLink(typeName,attributeName,href,type));return results1}_handleLink(typeName,attributeName,hrefTemplate,attributeTypeName){var base,type;if(null==(base=(type=this.type(typeName))._links)[attributeName]&&(base[attributeName]={}),null!=hrefTemplate&&(type._links[attributeName].href=hrefTemplate),null!=attributeTypeName)return type._links[attributeName].type=attributeTypeName}handleError(){return Promise.reject(...arguments)}type(name){var base;return null==(base=this._typesCache)[name]&&(base[name]=new Type(name,this)),this._typesCache[name]}get(url,payload,headers,query){return this.request("get",url,payload,headers,query)}post(url,payload,headers,query){return this.request("post",url,payload,headers,query)}put(url,payload,headers,query){return this.request("put",url,payload,headers,query)}delete(url,payload,headers,query){return this.request("delete",url,payload,headers,query)}}return JSONAPIClient.prototype.root="/",JSONAPIClient.prototype.headers=null,JSONAPIClient.prototype.params=null,JSONAPIClient.prototype.reads=0,JSONAPIClient.prototype.writes=0,JSONAPIClient.prototype._typesCache=null,JSONAPIClient}.call(this),module.exports=JSONAPIClient,module.exports.makeHTTPRequest=makeHTTPRequest.makeHTTPRequest,module.exports.makeCredentialHTTPRequest=makeHTTPRequest.makeCredentialHTTPRequest,module.exports.Emitter=Emitter,module.exports.Type=Type,module.exports.Model=Model,module.exports.Resource=Resource}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/make-http-request.js"(module,__unused_webpack_exports,__webpack_require__){(function(){var DEFAULT_HEADERS,credentialRequest,getsInProgress,makeCredentialHTTPRequest,makeHTTPRequest,makeRequest,normalizeUrl,parseJSON,request,superagent;superagent=__webpack_require__("../../node_modules/superagent/lib/client.js"),DEFAULT_HEADERS=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/default-headers.js"),normalizeUrl=__webpack_require__("../../node_modules/normalizeurl/lib/normalizeUrl.js"),getsInProgress={},parseJSON=superagent.parse["application/json"],superagent.parse[DEFAULT_HEADERS.Accept]=parseJSON,request=superagent,credentialRequest=superagent,null!=superagent.agent&&(request=superagent.agent(),null!=(credentialRequest=superagent.agent()).withCredentials&&(credentialRequest=credentialRequest.withCredentials())),makeHTTPRequest=function(method,url,data,headers={},query){return makeRequest(request,method,url,data,headers,query)},makeCredentialHTTPRequest=function(method,url,data,headers={},query){return makeRequest(credentialRequest,method,url,data,headers,query)},makeRequest=function(request,method,url,data,headers,query){var key,originalArguments,promisedRequest,requestID,value;if(originalArguments=Array.prototype.slice.call(arguments),method=method.toLowerCase(),url=normalizeUrl(url),"get"===method){for(key in data)value=data[key],Array.isArray(value)&&(data[key]=value.join(","));if(requestID=`${url} ${JSON.stringify(data)}`,null!=getsInProgress[requestID])return getsInProgress[requestID]}return promisedRequest=new Promise(function(resolve,reject){return function(){switch(method){case"get":return request.get(url).query(data);case"head":return request.head(url).query(data);case"put":return request.put(url).query(query).send(data);case"post":return request.post(url).query(query).send(data);case"delete":return request.del(url).query(query).query(data)}}().set(headers).end(function(error,response){return delete getsInProgress[requestID],408===(null!=error?error.status:void 0)?resolve(makeHTTPRequest.apply(null,originalArguments)):null!=error?reject(null!=response?response:error):resolve(response)})}),"get"===method&&(getsInProgress[requestID]=promisedRequest),promisedRequest},module.exports={makeHTTPRequest,makeCredentialHTTPRequest}}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/merge-into.js"(module){(function(){var hasProp={}.hasOwnProperty;module.exports=function(){var argument,i,key,len,ref,value;for(i=0,len=(ref=Array.prototype.slice.call(arguments,1)).length;i<len;i++)if(null!=(argument=ref[i]))for(key in argument)hasProp.call(argument,key)&&(value=argument[key],arguments[0][key]=value);return arguments[0]}}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/model.js"(module,__unused_webpack_exports,__webpack_require__){(function(){var Emitter,isIndex,mergeInto,removeUnderscoredKeys,indexOf=[].indexOf,hasProp={}.hasOwnProperty;Emitter=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/emitter.js"),mergeInto=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/merge-into.js"),isIndex=function(string){var integer;return(integer=parseInt(string,10)).toString(10)===string&&!isNaN(integer)},removeUnderscoredKeys=function(target){var i,key,len,results,results1,value;if(Array.isArray(target)){for(results1=[],i=0,len=target.length;i<len;i++)value=target[i],results1.push(removeUnderscoredKeys(value));return results1}if(null!=target&&"object"==typeof target){for(key in results={},target)value=target[key],"_"!==key.charAt(0)&&(results[key]=removeUnderscoredKeys(value));return results}return target},module.exports=function(){class Model extends Emitter{constructor(...configs){super(...configs),this._changedKeys=[],mergeInto(this,...configs),this.emit("create")}update(changeSet={}){var base,i,key,lastKey,len,name,path,rootKey,value;if("string"==typeof changeSet)for(i=0,len=arguments.length;i<len;i++)key=arguments[i],indexOf.call(this._changedKeys,key)<0&&this._changedKeys.push(...arguments);else for(key in changeSet)if(hasProp.call(changeSet,key)){for(value=changeSet[key],rootKey=(path=key.split("."))[0],base=this;1!==path.length;)null==base[name=path[0]]&&(base[name]=isIndex(path[1])?[]:{}),base=base[path.shift()];lastKey=path.shift(),void 0===value?Array.isArray(base)?base.splice(lastKey,1):delete base[lastKey]:base[lastKey]=value,indexOf.call(this._changedKeys,rootKey)<0&&this._changedKeys.push(rootKey)}return this.emit("change"),this}hasUnsavedChanges(){return 0!==this._changedKeys.length}toJSON(){return removeUnderscoredKeys(this)}destroy(){return this._changedKeys.splice(0),super.destroy()}}return Model.prototype._changedKeys=null,Model}.call(this)}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/resource.js"(module,__unused_webpack_exports,__webpack_require__){(function(){var Model,Resource,ResourcePromise;Model=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/model.js"),Resource=function(){class Resource extends Model{constructor(_type){if(super(_type),this._type=_type,null==this._type)throw new Error('Don\'t call the Resource constructor directly, use `client.type("things").create({});`');this._headers={},this._meta={},this._linksCache={},this._savingKeys={},this._type.emit("change"),this.emit("create")}getMeta(key=this._type._name){return this._meta[key]}update(){var value;return value=super.update(...arguments),this.id&&this._type._resourcesCache[this.id]!==this&&(this._type._resourcesCache[this.id]=this,null!=this.href&&(this._type._resourcesCache[this.href]=this),this._type.emit("change")),value}save(query={}){var base,changes,key,payload;for(key in payload={},changes=this.toJSON.call(this.getChangesSinceSave()),payload[this._type._name]=changes,this._changedKeys.splice(0),changes)null==(base=this._savingKeys)[key]&&(base[key]=0),this._savingKeys[key]+=1;return this._write=this._write.catch(()=>null).then(()=>{var save;return save=this.id?this.refresh(!0,query).then(()=>this._type._client.put(this._getURL(),payload,this._getHeadersForModification(),query)):this._type._client.post(this._type._getURL(),payload,{},query),new ResourcePromise(save.then(([result])=>{for(key in changes)this._savingKeys[key]-=1,0===this._savingKeys[key]&&delete this._savingKeys[key];return result!==this&&(this.update(result),result.destroy()),this.emit("save"),this}))}),this._write}getChangesSinceSave(){var changes,i,key,len,ref;for(changes={},i=0,len=(ref=this._changedKeys).length;i<len;i++)changes[key=ref[i]]=this[key];return changes}refresh(saveChanges,query={}){var changes;if(saveChanges)return changes=this.getChangesSinceSave(),this.refresh(!1,query).then(()=>this.update(changes));if(this.id)return this._type._client.get(this._getURL(),query);throw new Error("Can't refresh a resource with no ID")}uncache(){if(this.id)return this.emit("uncache"),delete this._type._resourcesCache[this.id],delete this._type._resourcesCache[this.href];throw new Error("Can't uncache a resource with no ID")}delete(query={}){return this._write=this._write.catch(()=>null).then(()=>{var deletion;return deletion=this.id?this.refresh(!0,query).then(()=>this._type._client.delete(this._getURL(),null,this._getHeadersForModification(),query)):Promise.resolve(),new ResourcePromise(deletion.then(()=>(this.emit("delete"),this._type.emit("change"),this.destroy(),null)))}),this._write}get(name,query){var cachedByHREF,fullHREF,href,id,ids,ref,ref1,ref2,ref3,ref4,resourceLink,result,type,typeLink;return null!=this._linksCache[name]&&null==query?this._linksCache[name]:(resourceLink=null!=(ref=this.links)?ref[name]:void 0,typeLink=this._type._links[name],(result=null!=resourceLink||null!=typeLink?(href=null!=(ref1=null!=resourceLink?resourceLink.href:void 0)?ref1:null!=typeLink?typeLink.href:void 0,type=null!=(ref2=null!=resourceLink?resourceLink.type:void 0)?ref2:null!=typeLink?typeLink.type:void 0,null!=(id=null!=(ref3=null!=resourceLink?resourceLink.id:void 0)?ref3:null!=typeLink?typeLink.id:void 0)||(id="string"==typeof resourceLink?resourceLink:void 0),null!=(ids=null!=(ref4=null!=resourceLink?resourceLink.ids:void 0)?ref4:null!=typeLink?typeLink.ids:void 0)||(ids=Array.isArray(resourceLink)?resourceLink:void 0),null!=href?(fullHREF=this._applyHREF(href),null!=(cachedByHREF=this._type._client.type(type)._resourcesCache[fullHREF])&&null==query?Promise.resolve(cachedByHREF):this._type._client.get(fullHREF,query).then(function(links){return null!=id?links[0]:links})):null!=type?this._type._client.type(type).get(null!=id?id:ids,query).then(function(links){return null!=id?links[0]:links}):void 0):name in this?Promise.resolve(this[name]):this._type._client.get(this._getURL(name))).then(()=>{if(null==query)return this._linksCache[name]=result}),new ResourcePromise(result))}_applyHREF(href){var context;return(context={})[this._type._name]=this,href.replace(/{(.+?)}/g,function(_,path){var ref,ref1,segment,segments,value;for(segments=path.split("."),value=context;0!==segments.length;)value=null!=(ref=value[segment=segments.shift()])?ref:null!=(ref1=value.links)?ref1[segment]:void 0;if(Array.isArray(value)&&(value=value.join(",")),"string"!=typeof value)throw new Error(`Value for '${path}' in '${href}' should be a string.`);return value})}addLink(name,value){var data,url;return url=this._getURL("links",name),(data={})[name]=value,this._type._client.post(url,data).then(()=>(this.uncacheLink(name),this.refresh()))}removeLink(name,value){var url;return url=this._getURL("links",name,[].concat(value).join(",")),this._type._client.delete(url).then(()=>(this.uncacheLink(name),this.refresh()))}uncacheLink(name){return delete this._linksCache[name]}_getHeadersForModification(){var header,headers;for(header in headers={"If-Unmodified-Since":this._getHeader("Last-Modified"),"If-Match":this._getHeader("ETag")})null==headers[header]&&delete headers[header];return headers}_getHeader(header){var name,value;return header=header.toLowerCase(),function(){var ref,results1;for(name in results1=[],ref=this._headers)value=ref[name],name.toLowerCase()===header&&results1.push(value);return results1}.call(this)[0]}_getURL(){return this.href?[this.href,...arguments].join("/"):this._type._getURL(this.id,...arguments)}}return Resource.prototype._type=null,Resource.prototype._headers=null,Resource.prototype._meta=null,Resource.prototype._linksCache=null,Resource.prototype._savingKeys=null,Resource.prototype._write=Promise.resolve(),Resource}.call(this),ResourcePromise=function(){class ResourcePromise{constructor(_promise){if(this._promise=_promise,!(this._promise instanceof Promise))throw new Error("ResourcePromise requires a real promise instance")}then(){return this._promise.then(...arguments)}catch(){return this._promise.catch(...arguments)}index(index){return this._promise=this._promise.then(function(value){var a,b;return a=index,b=value.length,value[index=(+a%(b=+b)+b)%b]}),this}api(method,...args){return this._promise=this._promise.then(promisedValue=>{const results=[].concat(promisedValue).map(resource=>{const result=resource[method](...args);return result instanceof this.constructor?result._promise:result});return Array.isArray(promisedValue)?Promise.all(results):results[0]}),this}delete(...args){return this.api("delete",...args)}get(...args){return this.api("get",...args)}save(...args){return this.api("save",...args)}update(...args){return this.api("update",...args)}refresh(...args){return this.api("refresh",...args)}uncache(...args){return this.api("uncache",...args)}getMeta(...args){return this.api("getMeta",...args)}addLink(...args){return this.api("addLink",...args)}removeLink(...args){return this.api("removeLink",...args)}uncacheLink(...args){return this.api("uncacheLink",...args)}getChangesSinceSave(...args){return this.api("getChangesSinceSave",...args)}}return ResourcePromise.prototype._promise=null,ResourcePromise}.call(this),module.exports=Resource,module.exports.Promise=ResourcePromise}).call(this)},"../../node_modules/panoptes-client/lib/json-api-client/type.js"(module,__unused_webpack_exports,__webpack_require__){(function(){var Emitter,Resource,mergeInto,indexOf=[].indexOf;Emitter=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/emitter.js"),Resource=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/resource.js"),mergeInto=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/merge-into.js"),module.exports=function(){class Type extends Emitter{constructor(_name,_client){if(super(null),this._name=_name,this._client=_client,this._links={},this._resourcesCache={},!this._name||null==this._client)throw new Error('Don\'t call the Type constructor directly, use `client.type("things");`')}create(data={},headers={},meta={}){var key,ref,resource,value;if(data.type&&data.type!==this._name)return this._client.type(data.type).create(...arguments);if(resource=null!=(ref=this._resourcesCache[data.id])?ref:new this.Resource(this),mergeInto(resource._headers,headers),mergeInto(resource._meta,meta),null!=data.id){for(key in data)value=data[key],indexOf.call(resource._changedKeys,key)<0&&!(key in resource._savingKeys)&&(resource[key]=value);this._resourcesCache[resource.id]=resource,resource.emit("change")}else resource.update(data);return resource}get(){return new Resource.Promise("string"==typeof arguments[0]?this._getByID(...arguments):Array.isArray(arguments[0])?this._getByIDs(...arguments):this._getByQuery(...arguments))}_getByID(id,...otherArgs){return this._getByIDs([id],...otherArgs).then(function([resource]){return resource})}_getByIDs(ids,...otherArgs){var id,requests;return requests=function(){var i,len,results;for(results=[],i=0,len=ids.length;i<len;i++)!((id=ids[i])in this._resourcesCache)||0!==otherArgs.length&&null!=otherArgs[0]?results.push(this._client.get(this._getURL(id),...otherArgs).then(function([resource]){return resource})):results.push(Promise.resolve(this._resourcesCache[id]));return results}.call(this),Promise.all(requests)}_getByQuery(query,...otherArgs){return this._client.get(this._getURL(),query,...otherArgs)}_getURL(){return["",this._name,...arguments].join("/")}}return Type.prototype.Resource=Resource,Type.prototype._name="",Type.prototype._client=null,Type.prototype._links=null,Type.prototype._resourcesCache=null,Type}.call(this)}).call(this)},"../../node_modules/url/node_modules/punycode/punycode.js"(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;module=__webpack_require__.nmd(module),function(){exports&&exports.nodeType,module&&module.nodeType;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self;var punycode,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=128,bias=72;for((basic=input.lastIndexOf("-"))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),((digit=basicToDigit(input.charCodeAt(index++)))>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)w>floor(maxInt/(baseMinusT=36-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;!(q<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII:function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},"../../node_modules/url/url.js"(__unused_webpack_module,exports,__webpack_require__){"use strict";var punycode=__webpack_require__("../../node_modules/url/node_modules/punycode/punycode.js");function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__("../../node_modules/qs/lib/index.js");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&"object"==typeof url&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if("string"!=typeof url)throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@/]+@[^@/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(query=querystring.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if("string"==typeof relative){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.pathname="/",result.path=result.pathname),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(null!=relative.search){if(psychotic)result.host=srcPath.shift(),result.hostname=result.host,(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.hostname=authInHost.shift(),result.host=result.hostname);return result.search=relative.search,result.query=relative.query,null===result.pathname&&null===result.search||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=isAbsolute?"":srcPath.length?srcPath.shift():"",result.host=result.hostname,(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.hostname=authInHost.shift(),result.host=result.hostname));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length>0?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),null===result.pathname&&null===result.search||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)},exports.parse=urlParse,exports.resolve=function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function urlFormat(obj){return"string"==typeof obj&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url}}]);