/*! For license information please see 8656.8f8ad30e.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_zooniverse_fe_project=self.webpackChunk_zooniverse_fe_project||[]).push([[8656],{"../../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}__webpack_require__.d(__webpack_exports__,{A:()=>_arrayLikeToArray})},"../../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _arrayWithHoles(r){if(Array.isArray(r))return r}__webpack_require__.d(__webpack_exports__,{A:()=>_arrayWithHoles})},"../../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}__webpack_require__.d(__webpack_exports__,{A:()=>_nonIterableRest})},"../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>_slicedToArray});var arrayWithHoles=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js");var unsupportedIterableToArray=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js"),nonIterableRest=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js");function _slicedToArray(r,e){return(0,arrayWithHoles.A)(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||(0,unsupportedIterableToArray.A)(r,e)||(0,nonIterableRest.A)()}},"../../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>_unsupportedIterableToArray});var _arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return(0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.A)(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?(0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.A)(r,a):void 0}}},"../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$Q:()=>tryReference,Eh:()=>createActionTrackingMiddleware2,Ey:()=>recordPatches,I7:()=>addMiddleware,KE:()=>resolveIdentifier,L3:()=>flow,LF:()=>addDisposer,Nh:()=>applySnapshot,PA:()=>getParent,Pw:()=>getType,X6:()=>applyPatch,Yi:()=>decorate,Zn:()=>getRoot,_$:()=>getEnv,aF:()=>isValidReference,aQ:()=>onSnapshot,dV:()=>getSnapshot,gK:()=>types,gU:()=>isActionContextThisOrChildOf,i5:()=>onAction,k2:()=>getParentOfType,k4:()=>onPatch,o1:()=>resolvePath,zr:()=>destroy});var Hook,mobx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/mobx/dist/mobx.esm.js"),console=__webpack_require__("../../node_modules/console-browserify/index.js"),process=__webpack_require__("../../node_modules/process/browser.js"),livelinessChecking="warn";function getLivelinessChecking(){return livelinessChecking}!function(Hook){Hook.afterCreate="afterCreate",Hook.afterAttach="afterAttach",Hook.afterCreationFinalization="afterCreationFinalization",Hook.beforeDetach="beforeDetach",Hook.beforeDestroy="beforeDestroy"}(Hook||(Hook={}));var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function getType(object){return assertIsStateTreeNode(object,1),getStateTreeNode(object).type}function onPatch(target,callback){return assertIsStateTreeNode(target,1),assertIsFunction(callback,2),getStateTreeNode(target).onPatch(callback)}function onSnapshot(target,callback){return assertIsStateTreeNode(target,1),assertIsFunction(callback,2),getStateTreeNode(target).onSnapshot(callback)}function applyPatch(target,patch){assertIsStateTreeNode(target,1),assertArg(patch,(function(p){return"object"==typeof p}),"object or array",2),getStateTreeNode(target).applyPatches(asArray(patch))}function recordPatches(subject,filter){assertIsStateTreeNode(subject,1);var disposer,data={patches:[],inversePatches:[]},publicData={},recorder={get recording(){return!!disposer},get patches(){return publicData.patches||(publicData.patches=data.patches.slice()),publicData.patches},get reversedInversePatches(){return publicData.reversedInversePatches||(publicData.reversedInversePatches=data.inversePatches.slice().reverse()),publicData.reversedInversePatches},get inversePatches(){return publicData.inversePatches||(publicData.inversePatches=data.inversePatches.slice()),publicData.inversePatches},stop:function(){disposer&&(disposer(),disposer=void 0)},resume:function(){disposer||(disposer=onPatch(subject,(function(patch,inversePatch){filter&&!filter(patch,inversePatch,getRunningActionContext())||(data.patches.push(patch),data.inversePatches.push(inversePatch),publicData.patches=void 0,publicData.inversePatches=void 0,publicData.reversedInversePatches=void 0)})))},replay:function(target){applyPatch(target||subject,data.patches)},undo:function(target){applyPatch(target||subject,data.inversePatches.slice().reverse())}};return recorder.resume(),recorder}function applySnapshot(target,snapshot){return assertIsStateTreeNode(target,1),getStateTreeNode(target).applySnapshot(snapshot)}function getSnapshot(target,applyPostProcess){void 0===applyPostProcess&&(applyPostProcess=!0),assertIsStateTreeNode(target,1);var node=getStateTreeNode(target);return applyPostProcess?node.snapshot:freeze(node.type.getSnapshot(node,!1))}function getParent(target,depth){void 0===depth&&(depth=1),assertIsStateTreeNode(target,1),assertIsNumber(depth,2,0);for(var d=depth,parent=getStateTreeNode(target).parent;parent;){if(0==--d)return parent.storedValue;parent=parent.parent}throw fail("Failed to find the parent of "+getStateTreeNode(target)+" at depth "+depth)}function getParentOfType(target,type){assertIsStateTreeNode(target,1),assertIsType(type,2);for(var parent=getStateTreeNode(target).parent;parent;){if(type.is(parent.storedValue))return parent.storedValue;parent=parent.parent}throw fail("Failed to find the parent of "+getStateTreeNode(target)+" of a given type")}function getRoot(target){return assertIsStateTreeNode(target,1),getStateTreeNode(target).root.storedValue}function resolvePath(target,path){assertIsStateTreeNode(target,1),assertIsString(path,2);var node=resolveNodeByPath(getStateTreeNode(target),path);return node?node.value:void 0}function resolveIdentifier(type,target,identifier){assertIsType(type,1),assertIsStateTreeNode(target,2),function assertIsValidIdentifier(id,argNumber){assertArg(id,isValidIdentifier,"string or number (identifier)",argNumber)}(identifier,3);var node=getStateTreeNode(target).root.identifierCache.resolve(type,normalizeIdentifier(identifier));return null==node?void 0:node.value}function tryReference(getter,checkIfAlive){void 0===checkIfAlive&&(checkIfAlive=!0);try{var node=getter();if(null==node)return;if(isStateTreeNode(node))return checkIfAlive?isAlive(node)?node:void 0:node;throw fail("The reference to be checked is not one of node, null or undefined")}catch(e){if(e instanceof InvalidReferenceError)return;throw e}}function isValidReference(getter,checkIfAlive){void 0===checkIfAlive&&(checkIfAlive=!0);try{var node=getter();if(null==node)return!1;if(isStateTreeNode(node))return!checkIfAlive||isAlive(node);throw fail("The reference to be checked is not one of node, null or undefined")}catch(e){if(e instanceof InvalidReferenceError)return!1;throw e}}function destroy(target){assertIsStateTreeNode(target,1);var node=getStateTreeNode(target);node.isRoot?node.die():node.parent.removeChild(node.subpath)}function isAlive(target){return assertIsStateTreeNode(target,1),getStateTreeNode(target).observableIsAlive}function addDisposer(target,disposer){return assertIsStateTreeNode(target,1),assertIsFunction(disposer,2),getStateTreeNode(target).addDisposer(disposer),disposer}function getEnv(target){assertIsStateTreeNode(target,1);var env=getStateTreeNode(target).root.environment;return env||EMPTY_OBJECT}var BaseNode=function(){function BaseNode(type,parent,subpath,environment){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:type}),Object.defineProperty(this,"environment",{enumerable:!0,configurable:!0,writable:!0,value:environment}),Object.defineProperty(this,"_escapedSubpath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_subpath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_subpathUponDeath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pathUponDeath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aliveAtom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_state",{enumerable:!0,configurable:!0,writable:!0,value:NodeLifeCycle.INITIALIZING}),Object.defineProperty(this,"_hookSubscribers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pathAtom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.environment=environment,this.baseSetParent(parent,subpath)}return Object.defineProperty(BaseNode.prototype,"subpath",{get:function(){return this._subpath},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"subpathUponDeath",{get:function(){return this._subpathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"pathUponDeath",{get:function(){return this._pathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"value",{get:function(){return this.type.getValue(this)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"state",{get:function(){return this._state},set:function(val){var wasAlive=this.isAlive;this._state=val;var isAlive=this.isAlive;this.aliveAtom&&wasAlive!==isAlive&&this.aliveAtom.reportChanged()},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"fireInternalHook",{enumerable:!1,configurable:!0,writable:!0,value:function(name){this._hookSubscribers&&this._hookSubscribers.emit(name,this,name)}}),Object.defineProperty(BaseNode.prototype,"registerHook",{enumerable:!1,configurable:!0,writable:!0,value:function(hook,hookHandler){return this._hookSubscribers||(this._hookSubscribers=new EventHandlers),this._hookSubscribers.register(hook,hookHandler)}}),Object.defineProperty(BaseNode.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"getReconciliationType",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.type}}),Object.defineProperty(BaseNode.prototype,"baseSetParent",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath){this._parent=parent,this._subpath=subpath,this._escapedSubpath=void 0,this.pathAtom&&this.pathAtom.reportChanged()}}),Object.defineProperty(BaseNode.prototype,"path",{get:function(){return this.getEscapedPath(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"getEscapedPath",{enumerable:!1,configurable:!0,writable:!0,value:function(reportObserved){return reportObserved&&(this.pathAtom||(this.pathAtom=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.MN)("path")),this.pathAtom.reportObserved()),this.parent?(void 0===this._escapedSubpath&&(this._escapedSubpath=this._subpath?escapeJsonPath(this._subpath):""),this.parent.getEscapedPath(reportObserved)+"/"+this._escapedSubpath):""}}),Object.defineProperty(BaseNode.prototype,"isRoot",{get:function(){return null===this.parent},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"isAlive",{get:function(){return this.state!==NodeLifeCycle.DEAD},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"isDetaching",{get:function(){return this.state===NodeLifeCycle.DETACHING},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"observableIsAlive",{get:function(){return this.aliveAtom||(this.aliveAtom=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.MN)("alive")),this.aliveAtom.reportObserved(),this.isAlive},enumerable:!1,configurable:!0}),Object.defineProperty(BaseNode.prototype,"baseFinalizeCreation",{enumerable:!1,configurable:!0,writable:!0,value:function(whenFinalized){if(this.state===NodeLifeCycle.CREATED){if(this.parent){if(this.parent.state!==NodeLifeCycle.FINALIZED)return;this.fireHook(Hook.afterAttach)}this.state=NodeLifeCycle.FINALIZED,whenFinalized&&whenFinalized()}}}),Object.defineProperty(BaseNode.prototype,"baseFinalizeDeath",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._hookSubscribers&&this._hookSubscribers.clearAll(),this._subpathUponDeath=this._subpath,this._pathUponDeath=this.getEscapedPath(!1),this.baseSetParent(null,""),this.state=NodeLifeCycle.DEAD}}),Object.defineProperty(BaseNode.prototype,"baseAboutToDie",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.fireHook(Hook.beforeDestroy)}}),BaseNode}(),ScalarNode=function(_super){function ScalarNode(simpleType,parent,subpath,environment,initialSnapshot){var _this=_super.call(this,simpleType,parent,subpath,environment)||this;try{_this.storedValue=simpleType.createNewInstance(initialSnapshot)}catch(e){throw _this.state=NodeLifeCycle.DEAD,e}return _this.state=NodeLifeCycle.CREATED,_this.finalizeCreation(),_this}return __extends(ScalarNode,_super),Object.defineProperty(ScalarNode.prototype,"root",{get:function(){if(!this.parent)throw fail("This scalar node is not part of a tree");return this.parent.root},enumerable:!1,configurable:!0}),Object.defineProperty(ScalarNode.prototype,"setParent",{enumerable:!1,configurable:!0,writable:!0,value:function(newParent,subpath){var parentChanged=this.parent!==newParent,subpathChanged=this.subpath!==subpath;(parentChanged||subpathChanged)&&(this.environment=void 0,this.baseSetParent(this.parent,subpath))}}),Object.defineProperty(ScalarNode.prototype,"snapshot",{get:function(){return freeze(this.getSnapshot())},enumerable:!1,configurable:!0}),Object.defineProperty(ScalarNode.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.type.getSnapshot(this)}}),Object.defineProperty(ScalarNode.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){var path=(this.isAlive?this.path:this.pathUponDeath)||"<root>";return this.type.name+"@"+path+(this.isAlive?"":" [dead]")}}),Object.defineProperty(ScalarNode.prototype,"die",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isAlive&&this.state!==NodeLifeCycle.DETACHING&&(this.aboutToDie(),this.finalizeDeath())}}),Object.defineProperty(ScalarNode.prototype,"finalizeCreation",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.baseFinalizeCreation()}}),Object.defineProperty(ScalarNode.prototype,"aboutToDie",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.baseAboutToDie()}}),Object.defineProperty(ScalarNode.prototype,"finalizeDeath",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.baseFinalizeDeath()}}),Object.defineProperty(ScalarNode.prototype,"fireHook",{enumerable:!1,configurable:!0,writable:!0,value:function(name){this.fireInternalHook(name)}}),ScalarNode}(BaseNode);ScalarNode.prototype.die=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ScalarNode.prototype.die);var _a,TypeFlags,nextNodeId=1,snapshotReactionOptions={onError:function(e){throw e}},ObjectNode=function(_super){function ObjectNode(complexType,parent,subpath,environment,initialValue){var _this=_super.call(this,complexType,parent,subpath,environment)||this;if(Object.defineProperty(_this,"nodeId",{enumerable:!0,configurable:!0,writable:!0,value:++nextNodeId}),Object.defineProperty(_this,"identifierAttribute",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"identifier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"unnormalizedIdentifier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"identifierCache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"isProtectionEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(_this,"middlewares",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"hasSnapshotPostProcessor",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_applyPatches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_applySnapshot",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_autoUnbox",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(_this,"_isRunningAction",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_hasSnapshotReaction",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_observableInstanceState",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(_this,"_childNodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_initialSnapshot",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_cachedInitialSnapshot",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_cachedInitialSnapshotCreated",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(_this,"_snapshotComputed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_snapshotUponDeath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_internalEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this._snapshotComputed=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.EW)((function(){return freeze(_this.getSnapshot())})),_this.unbox=_this.unbox.bind(_this),_this._initialSnapshot=freeze(initialValue),_this.identifierAttribute=complexType.identifierAttribute,parent||(_this.identifierCache=new IdentifierCache),_this._childNodes=complexType.initializeChildNodes(_this,_this._initialSnapshot),_this.identifier=null,_this.unnormalizedIdentifier=null,_this.identifierAttribute&&_this._initialSnapshot){var id=_this._initialSnapshot[_this.identifierAttribute];if(void 0===id){var childNode=_this._childNodes[_this.identifierAttribute];childNode&&(id=childNode.value)}if("string"!=typeof id&&"number"!=typeof id)throw fail("Instance identifier '"+_this.identifierAttribute+"' for type '"+_this.type.name+"' must be a string or a number");_this.identifier=normalizeIdentifier(id),_this.unnormalizedIdentifier=id}return parent?parent.root.identifierCache.addNodeToCache(_this):_this.identifierCache.addNodeToCache(_this),_this}return __extends(ObjectNode,_super),Object.defineProperty(ObjectNode.prototype,"applyPatches",{enumerable:!1,configurable:!0,writable:!0,value:function(patches){this.createObservableInstanceIfNeeded(),this._applyPatches(patches)}}),Object.defineProperty(ObjectNode.prototype,"applySnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){this.createObservableInstanceIfNeeded(),this._applySnapshot(snapshot)}}),Object.defineProperty(ObjectNode.prototype,"createObservableInstanceIfNeeded",{enumerable:!1,configurable:!0,writable:!0,value:function(fireHooks){void 0===fireHooks&&(fireHooks=!0),0===this._observableInstanceState&&this.createObservableInstance(fireHooks)}}),Object.defineProperty(ObjectNode.prototype,"createObservableInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(fireHooks){var e_1,_a,e_2,_b;void 0===fireHooks&&(fireHooks=!0),this._observableInstanceState=1;for(var parentChain=[],parent=this.parent;parent&&0===parent._observableInstanceState;)parentChain.unshift(parent),parent=parent.parent;try{for(var parentChain_1=__values(parentChain),parentChain_1_1=parentChain_1.next();!parentChain_1_1.done;parentChain_1_1=parentChain_1.next()){(p=parentChain_1_1.value).createObservableInstanceIfNeeded(!1)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{parentChain_1_1&&!parentChain_1_1.done&&(_a=parentChain_1.return)&&_a.call(parentChain_1)}finally{if(e_1)throw e_1.error}}var type=this.type;try{this.storedValue=type.createNewInstance(this._childNodes),this.preboot(),this._isRunningAction=!0,type.finalizeNewInstance(this,this.storedValue)}catch(e){throw this.state=NodeLifeCycle.DEAD,e}finally{this._isRunningAction=!1}if(this._observableInstanceState=2,this._snapshotComputed.trackAndCompute(),this.isRoot&&this._addSnapshotReaction(),this._childNodes=EMPTY_OBJECT,this.state=NodeLifeCycle.CREATED,fireHooks){this.fireHook(Hook.afterCreate),this.finalizeCreation();try{for(var _c=__values(parentChain.reverse()),_d=_c.next();!_d.done;_d=_c.next()){var p;(p=_d.value).fireHook(Hook.afterCreate),p.finalizeCreation()}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_d&&!_d.done&&(_b=_c.return)&&_b.call(_c)}finally{if(e_2)throw e_2.error}}}}}),Object.defineProperty(ObjectNode.prototype,"root",{get:function(){var parent=this.parent;return parent?parent.root:this},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectNode.prototype,"clearParent",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.parent){this.fireHook(Hook.beforeDetach);var previousState=this.state;this.state=NodeLifeCycle.DETACHING;var root=this.root,newEnv=root.environment,newIdCache=root.identifierCache.splitCache(this);try{this.parent.removeChild(this.subpath),this.baseSetParent(null,""),this.environment=newEnv,this.identifierCache=newIdCache}finally{this.state=previousState}}}}),Object.defineProperty(ObjectNode.prototype,"setParent",{enumerable:!1,configurable:!0,writable:!0,value:function(newParent,subpath){var parentChanged=newParent!==this.parent,subpathChanged=subpath!==this.subpath;(parentChanged||subpathChanged)&&(parentChanged?(this.environment=void 0,newParent.root.identifierCache.mergeCache(this),this.baseSetParent(newParent,subpath),this.fireHook(Hook.afterAttach)):subpathChanged&&this.baseSetParent(this.parent,subpath))}}),Object.defineProperty(ObjectNode.prototype,"fireHook",{enumerable:!1,configurable:!0,writable:!0,value:function(name){var _this=this;this.fireInternalHook(name);var fn=this.storedValue&&"object"==typeof this.storedValue&&this.storedValue[name];"function"==typeof fn&&(mobx__WEBPACK_IMPORTED_MODULE_0__._t?(0,mobx__WEBPACK_IMPORTED_MODULE_0__._t)((function(){fn.apply(_this.storedValue)})):fn.apply(this.storedValue))}}),Object.defineProperty(ObjectNode.prototype,"snapshot",{get:function(){return this.hasSnapshotPostProcessor&&this.createObservableInstanceIfNeeded(),this._snapshotComputed.get()},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectNode.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.isAlive?2===this._observableInstanceState?this._getActualSnapshot():this._getCachedInitialSnapshot():this._snapshotUponDeath}}),Object.defineProperty(ObjectNode.prototype,"_getActualSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.type.getSnapshot(this)}}),Object.defineProperty(ObjectNode.prototype,"_getCachedInitialSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(!this._cachedInitialSnapshotCreated){var type=this.type,childNodes=this._childNodes,snapshot=this._initialSnapshot;this._cachedInitialSnapshot=type.processInitialSnapshot(childNodes,snapshot),this._cachedInitialSnapshotCreated=!0}return this._cachedInitialSnapshot}}),Object.defineProperty(ObjectNode.prototype,"isRunningAction",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!!this._isRunningAction||!this.isRoot&&this.parent.isRunningAction()}}),Object.defineProperty(ObjectNode.prototype,"assertAlive",{enumerable:!1,configurable:!0,writable:!0,value:function(context){var livelinessChecking=getLivelinessChecking();if(!this.isAlive&&"ignore"!==livelinessChecking){var error=this._getAssertAliveError(context);switch(livelinessChecking){case"error":throw fail(error);case"warn":warnError(error)}}}}),Object.defineProperty(ObjectNode.prototype,"_getAssertAliveError",{enumerable:!1,configurable:!0,writable:!0,value:function(context){var escapedPath=this.getEscapedPath(!1)||this.pathUponDeath||"",subpath=context.subpath&&escapeJsonPath(context.subpath)||"",actionContext=context.actionContext||getCurrentActionContext();actionContext&&"action"!==actionContext.type&&actionContext.parentActionEvent&&(actionContext=actionContext.parentActionEvent);var actionFullPath="";actionContext&&null!=actionContext.name&&(actionFullPath=(actionContext&&actionContext.context&&function getPath(target){return assertIsStateTreeNode(target,1),getStateTreeNode(target).path}(actionContext.context)||escapedPath)+"."+actionContext.name+"()");return"You are trying to read or write to an object that is no longer part of a state tree. (Object type: '"+this.type.name+"', Path upon death: '"+escapedPath+"', Subpath: '"+subpath+"', Action: '"+actionFullPath+"'). Either detach nodes first, or don't use objects after removing / replacing them in the tree."}}),Object.defineProperty(ObjectNode.prototype,"getChildNode",{enumerable:!1,configurable:!0,writable:!0,value:function(subpath){this.assertAlive({subpath}),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildNode(this,subpath):this._childNodes[subpath]}finally{this._autoUnbox=!0}}}),Object.defineProperty(ObjectNode.prototype,"getChildren",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.assertAlive(EMPTY_OBJECT),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildren(this):convertChildNodesToArray(this._childNodes)}finally{this._autoUnbox=!0}}}),Object.defineProperty(ObjectNode.prototype,"getChildType",{enumerable:!1,configurable:!0,writable:!0,value:function(propertyName){return this.type.getChildType(propertyName)}}),Object.defineProperty(ObjectNode.prototype,"isProtected",{get:function(){return this.root.isProtectionEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectNode.prototype,"assertWritable",{enumerable:!1,configurable:!0,writable:!0,value:function(context){if(this.assertAlive(context),!this.isRunningAction()&&this.isProtected)throw fail("Cannot modify '"+this+"', the object is protected and can only be modified by using an action.")}}),Object.defineProperty(ObjectNode.prototype,"removeChild",{enumerable:!1,configurable:!0,writable:!0,value:function(subpath){this.type.removeChild(this,subpath)}}),Object.defineProperty(ObjectNode.prototype,"unbox",{enumerable:!1,configurable:!0,writable:!0,value:function(childNode){return childNode?(this.assertAlive({subpath:childNode.subpath||childNode.subpathUponDeath}),this._autoUnbox?childNode.value:childNode):childNode}}),Object.defineProperty(ObjectNode.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){var path=(this.isAlive?this.path:this.pathUponDeath)||"<root>",identifier=this.identifier?"(id: "+this.identifier+")":"";return this.type.name+"@"+path+identifier+(this.isAlive?"":" [dead]")}}),Object.defineProperty(ObjectNode.prototype,"finalizeCreation",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _this=this;this.baseFinalizeCreation((function(){var e_3,_a;try{for(var _b=__values(_this.getChildren()),_c=_b.next();!_c.done;_c=_b.next()){_c.value.finalizeCreation()}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_3)throw e_3.error}}_this.fireInternalHook(Hook.afterCreationFinalization)}))}}),Object.defineProperty(ObjectNode.prototype,"detach",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(!this.isAlive)throw fail("Error while detaching, node is not alive.");this.clearParent()}}),Object.defineProperty(ObjectNode.prototype,"preboot",{enumerable:!1,configurable:!0,writable:!0,value:function(){var self=this;this._applyPatches=createActionInvoker(this.storedValue,"@APPLY_PATCHES",(function(patches){patches.forEach((function(patch){if(patch.path){var parts=splitJsonPath(patch.path);resolveNodeByPathParts(self,parts.slice(0,-1)).applyPatchLocally(parts[parts.length-1],patch)}else self.type.applySnapshot(self,patch.value)}))})),this._applySnapshot=createActionInvoker(this.storedValue,"@APPLY_SNAPSHOT",(function(snapshot){if(snapshot!==self.snapshot)return self.type.applySnapshot(self,snapshot)})),addHiddenFinalProp(this.storedValue,"$treenode",this),addHiddenFinalProp(this.storedValue,"toJSON",toJSON)}}),Object.defineProperty(ObjectNode.prototype,"die",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isAlive&&this.state!==NodeLifeCycle.DETACHING&&(this.aboutToDie(),this.finalizeDeath())}}),Object.defineProperty(ObjectNode.prototype,"aboutToDie",{enumerable:!1,configurable:!0,writable:!0,value:function(){0!==this._observableInstanceState&&(this.getChildren().forEach((function(node){node.aboutToDie()})),this.baseAboutToDie(),this._internalEventsEmit("dispose"),this._internalEventsClear("dispose"))}}),Object.defineProperty(ObjectNode.prototype,"finalizeDeath",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.getChildren().forEach((function(node){node.finalizeDeath()})),this.root.identifierCache.notifyDied(this);var snapshot=this.snapshot;this._snapshotUponDeath=snapshot,this._internalEventsClearAll(),this.baseFinalizeDeath()}}),Object.defineProperty(ObjectNode.prototype,"onSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(onChange){return this._addSnapshotReaction(),this._internalEventsRegister("snapshot",onChange)}}),Object.defineProperty(ObjectNode.prototype,"emitSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){this._internalEventsEmit("snapshot",snapshot)}}),Object.defineProperty(ObjectNode.prototype,"onPatch",{enumerable:!1,configurable:!0,writable:!0,value:function(handler){return this._internalEventsRegister("patch",handler)}}),Object.defineProperty(ObjectNode.prototype,"emitPatch",{enumerable:!1,configurable:!0,writable:!0,value:function(basePatch,source){if(this._internalEventsHasSubscribers("patch")){var localizedPatch=function extend(a){for(var b=[],_i=1;_i<arguments.length;_i++)b[_i-1]=arguments[_i];for(var i=0;i<b.length;i++){var current=b[i];for(var key in current)a[key]=current[key]}return a}({},basePatch,{path:source.path.substr(this.path.length)+"/"+basePatch.path}),_a=__read(function splitPatch(patch){if(!("oldValue"in patch))throw fail("Patches without `oldValue` field cannot be inversed");return[stripPatch(patch),invertPatch(patch)]}(localizedPatch),2),patch=_a[0],reversePatch=_a[1];this._internalEventsEmit("patch",patch,reversePatch)}this.parent&&this.parent.emitPatch(basePatch,source)}}),Object.defineProperty(ObjectNode.prototype,"hasDisposer",{enumerable:!1,configurable:!0,writable:!0,value:function(disposer){return this._internalEventsHas("dispose",disposer)}}),Object.defineProperty(ObjectNode.prototype,"addDisposer",{enumerable:!1,configurable:!0,writable:!0,value:function(disposer){if(this.hasDisposer(disposer))throw fail("cannot add a disposer when it is already registered for execution");this._internalEventsRegister("dispose",disposer,!0)}}),Object.defineProperty(ObjectNode.prototype,"removeDisposer",{enumerable:!1,configurable:!0,writable:!0,value:function(disposer){if(!this._internalEventsHas("dispose",disposer))throw fail("cannot remove a disposer which was never registered for execution");this._internalEventsUnregister("dispose",disposer)}}),Object.defineProperty(ObjectNode.prototype,"removeMiddleware",{enumerable:!1,configurable:!0,writable:!0,value:function(middleware){if(this.middlewares){var index=this.middlewares.indexOf(middleware);index>=0&&this.middlewares.splice(index,1)}}}),Object.defineProperty(ObjectNode.prototype,"addMiddleWare",{enumerable:!1,configurable:!0,writable:!0,value:function(handler,includeHooks){var _this=this;void 0===includeHooks&&(includeHooks=!0);var middleware={handler,includeHooks};return this.middlewares?this.middlewares.push(middleware):this.middlewares=[middleware],function(){_this.removeMiddleware(middleware)}}}),Object.defineProperty(ObjectNode.prototype,"applyPatchLocally",{enumerable:!1,configurable:!0,writable:!0,value:function(subpath,patch){this.assertWritable({subpath}),this.createObservableInstanceIfNeeded(),this.type.applyPatchLocally(this,subpath,patch)}}),Object.defineProperty(ObjectNode.prototype,"_addSnapshotReaction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _this=this;if(!this._hasSnapshotReaction){var snapshotDisposer=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.mJ)((function(){return _this.snapshot}),(function(snapshot){return _this.emitSnapshot(snapshot)}),snapshotReactionOptions);this.addDisposer(snapshotDisposer),this._hasSnapshotReaction=!0}}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsHasSubscribers",{enumerable:!1,configurable:!0,writable:!0,value:function(event){return!!this._internalEvents&&this._internalEvents.hasSubscribers(event)}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsRegister",{enumerable:!1,configurable:!0,writable:!0,value:function(event,eventHandler,atTheBeginning){return void 0===atTheBeginning&&(atTheBeginning=!1),this._internalEvents||(this._internalEvents=new EventHandlers),this._internalEvents.register(event,eventHandler,atTheBeginning)}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsHas",{enumerable:!1,configurable:!0,writable:!0,value:function(event,eventHandler){return!!this._internalEvents&&this._internalEvents.has(event,eventHandler)}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsUnregister",{enumerable:!1,configurable:!0,writable:!0,value:function(event,eventHandler){this._internalEvents&&this._internalEvents.unregister(event,eventHandler)}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsEmit",{enumerable:!1,configurable:!0,writable:!0,value:function(event){for(var _a,args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this._internalEvents&&(_a=this._internalEvents).emit.apply(_a,__spread([event],args))}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsClear",{enumerable:!1,configurable:!0,writable:!0,value:function(event){this._internalEvents&&this._internalEvents.clear(event)}}),Object.defineProperty(ObjectNode.prototype,"_internalEventsClearAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._internalEvents&&this._internalEvents.clearAll()}}),ObjectNode}(BaseNode);ObjectNode.prototype.createObservableInstance=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ObjectNode.prototype.createObservableInstance),ObjectNode.prototype.detach=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ObjectNode.prototype.detach),ObjectNode.prototype.die=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ObjectNode.prototype.die),function(TypeFlags){TypeFlags[TypeFlags.String=1]="String",TypeFlags[TypeFlags.Number=2]="Number",TypeFlags[TypeFlags.Boolean=4]="Boolean",TypeFlags[TypeFlags.Date=8]="Date",TypeFlags[TypeFlags.Literal=16]="Literal",TypeFlags[TypeFlags.Array=32]="Array",TypeFlags[TypeFlags.Map=64]="Map",TypeFlags[TypeFlags.Object=128]="Object",TypeFlags[TypeFlags.Frozen=256]="Frozen",TypeFlags[TypeFlags.Optional=512]="Optional",TypeFlags[TypeFlags.Reference=1024]="Reference",TypeFlags[TypeFlags.Identifier=2048]="Identifier",TypeFlags[TypeFlags.Late=4096]="Late",TypeFlags[TypeFlags.Refinement=8192]="Refinement",TypeFlags[TypeFlags.Union=16384]="Union",TypeFlags[TypeFlags.Null=32768]="Null",TypeFlags[TypeFlags.Undefined=65536]="Undefined",TypeFlags[TypeFlags.Integer=131072]="Integer",TypeFlags[TypeFlags.Custom=262144]="Custom",TypeFlags[TypeFlags.SnapshotProcessor=524288]="SnapshotProcessor",TypeFlags[TypeFlags.Lazy=1048576]="Lazy",TypeFlags[TypeFlags.Finite=2097152]="Finite",TypeFlags[TypeFlags.Float=4194304]="Float"}(TypeFlags||(TypeFlags={}));var $type=Symbol("$type"),BaseType=function(){function BaseType(name){Object.defineProperty(this,_a,{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"C",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"S",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"T",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"N",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isType",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=name}return Object.defineProperty(BaseType.prototype,"create",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot,environment){return typecheckInternal(this,snapshot),this.instantiate(null,"",environment,snapshot).value}}),Object.defineProperty(BaseType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,applyPostProcess){throw fail("unimplemented method")}}),Object.defineProperty(BaseType.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return type===this}}),Object.defineProperty(BaseType.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){if(getStateTreeNodeSafe(value)){var valueType=getType(value);return this.isAssignableFrom(valueType)?typeCheckSuccess():typeCheckFailure(context,value)}return this.isValidSnapshot(value,context)}}),Object.defineProperty(BaseType.prototype,"is",{enumerable:!1,configurable:!0,writable:!0,value:function(thing){return 0===this.validate(thing,[{path:"",type:this}]).length}}),Object.defineProperty(BaseType.prototype,"Type",{get:function(){throw fail("Factory.Type should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.Type`")},enumerable:!1,configurable:!0}),Object.defineProperty(BaseType.prototype,"TypeWithoutSTN",{get:function(){throw fail("Factory.TypeWithoutSTN should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.TypeWithoutSTN`")},enumerable:!1,configurable:!0}),Object.defineProperty(BaseType.prototype,"SnapshotType",{get:function(){throw fail("Factory.SnapshotType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.SnapshotType`")},enumerable:!1,configurable:!0}),Object.defineProperty(BaseType.prototype,"CreationType",{get:function(){throw fail("Factory.CreationType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.CreationType`")},enumerable:!1,configurable:!0}),BaseType}();_a=$type,BaseType.prototype.create=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(BaseType.prototype.create);var ComplexType=function(_super){function ComplexType(name){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"identifierAttribute",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this}return __extends(ComplexType,_super),Object.defineProperty(ComplexType.prototype,"create",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot,environment){return void 0===snapshot&&(snapshot=this.getDefaultSnapshot()),_super.prototype.create.call(this,snapshot,environment)}}),Object.defineProperty(ComplexType.prototype,"getValue",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.createObservableInstanceIfNeeded(),node.storedValue}}),Object.defineProperty(ComplexType.prototype,"isMatchingSnapshotId",{enumerable:!1,configurable:!0,writable:!0,value:function(current,snapshot){return!current.identifierAttribute||current.identifier===normalizeIdentifier(snapshot[current.identifierAttribute])}}),Object.defineProperty(ComplexType.prototype,"tryToReconcileNode",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue){return!current.isDetaching&&(current.snapshot===newValue||(!(!isStateTreeNode(newValue)||getStateTreeNode(newValue)!==current)||!(current.type!==this||!isMutable(newValue)||isStateTreeNode(newValue)||!this.isMatchingSnapshotId(current,newValue))&&(current.applySnapshot(newValue),!0)))}}),Object.defineProperty(ComplexType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){if(this.tryToReconcileNode(current,newValue))return current.setParent(parent,subpath),current;if(current.die(),isStateTreeNode(newValue)&&this.isAssignableFrom(getType(newValue))){var newNode=getStateTreeNode(newValue);return newNode.setParent(parent,subpath),newNode}return this.instantiate(parent,subpath,void 0,newValue)}}),Object.defineProperty(ComplexType.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),ComplexType}(BaseType);ComplexType.prototype.create=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ComplexType.prototype.create);var SimpleType=function(_super){function SimpleType(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(SimpleType,_super),Object.defineProperty(SimpleType.prototype,"createNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){return snapshot}}),Object.defineProperty(SimpleType.prototype,"getValue",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.storedValue}}),Object.defineProperty(SimpleType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.storedValue}}),Object.defineProperty(SimpleType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){if(!current.isDetaching&&current.type===this&&current.storedValue===newValue)return current;var res=this.instantiate(parent,subpath,void 0,newValue);return current.die(),res}}),Object.defineProperty(SimpleType.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),SimpleType}(BaseType);function isType(value){return"object"==typeof value&&value&&!0===value.isType}function assertIsType(type,argNumber){assertArg(type,isType,"mobx-state-tree type",argNumber)}new Map;var RunningAction=function(){function RunningAction(hooks,call){Object.defineProperty(this,"hooks",{enumerable:!0,configurable:!0,writable:!0,value:hooks}),Object.defineProperty(this,"call",{enumerable:!0,configurable:!0,writable:!0,value:call}),Object.defineProperty(this,"flowsPending",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"running",{enumerable:!0,configurable:!0,writable:!0,value:!0}),hooks&&hooks.onStart(call)}return Object.defineProperty(RunningAction.prototype,"finish",{enumerable:!1,configurable:!0,writable:!0,value:function(error){this.running&&(this.running=!1,this.hooks&&this.hooks.onFinish(this.call,error))}}),Object.defineProperty(RunningAction.prototype,"incFlowsPending",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.flowsPending++}}),Object.defineProperty(RunningAction.prototype,"decFlowsPending",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.flowsPending--}}),Object.defineProperty(RunningAction.prototype,"hasFlowsPending",{get:function(){return this.flowsPending>0},enumerable:!1,configurable:!0}),RunningAction}();function createActionTrackingMiddleware2(middlewareHooks){var runningActions=new Map;return function actionTrackingMiddleware(call,next){var parentRunningAction=call.parentActionEvent?runningActions.get(call.parentActionEvent.id):void 0;if("action"===call.type){var newCall=__assign(__assign({},call),{env:parentRunningAction&&parentRunningAction.call.env,parentCall:parentRunningAction&&parentRunningAction.call}),passesFilter=!middlewareHooks.filter||middlewareHooks.filter(newCall),runningAction=new RunningAction(passesFilter?middlewareHooks:void 0,newCall);runningActions.set(call.id,runningAction);var res=void 0;try{res=next(call)}catch(e){throw runningActions.delete(call.id),runningAction.finish(e),e}return runningAction.hasFlowsPending||(runningActions.delete(call.id),runningAction.finish()),res}if(!parentRunningAction)return next(call);switch(call.type){case"flow_spawn":return parentRunningAction.incFlowsPending(),next(call);case"flow_resume":case"flow_resume_error":return next(call);case"flow_throw":var error=call.args[0];try{return next(call)}finally{parentRunningAction.decFlowsPending(),parentRunningAction.hasFlowsPending||(runningActions.delete(call.parentActionEvent.id),parentRunningAction.finish(error))}case"flow_return":try{return next(call)}finally{parentRunningAction.decFlowsPending(),parentRunningAction.hasFlowsPending||(runningActions.delete(call.parentActionEvent.id),parentRunningAction.finish())}}}}function serializeTheUnserializable(baseType){return{$MST_UNSERIALIZABLE:!0,type:baseType}}function onAction(target,listener,attachAfter){return void 0===attachAfter&&(attachAfter=!1),assertIsStateTreeNode(target,1),addMiddleware(target,(function handler(rawCall,next){if("action"===rawCall.type&&rawCall.id===rawCall.rootId){var sourceNode_1=getStateTreeNode(rawCall.context),info={name:rawCall.name,path:getRelativePathBetweenNodes(getStateTreeNode(target),sourceNode_1),args:rawCall.args.map((function(arg,index){return function serializeArgument(node,actionName,index,arg){if(arg instanceof Date)return{$MST_DATE:arg.getTime()};if(isPrimitive(arg))return arg;if(isStateTreeNode(arg))return serializeTheUnserializable("[MSTNode: "+getType(arg).name+"]");if("function"==typeof arg)return serializeTheUnserializable("[function]");if("object"==typeof arg&&!isPlainObject(arg)&&!isArray(arg))return serializeTheUnserializable("[object "+(arg&&arg.constructor&&arg.constructor.name||"Complex Object")+"]");try{return JSON.stringify(arg),arg}catch(e){return serializeTheUnserializable(""+e)}}(0,rawCall.name,0,arg)}))};if(attachAfter){var res=next(rawCall);return listener(info),res}return listener(info),next(rawCall)}return next(rawCall)}))}var currentActionContext,nextActionId=1;function getCurrentActionContext(){return currentActionContext}function getNextActionId(){return nextActionId++}function runWithActionContext(context,fn){var node=getStateTreeNode(context.context);"action"===context.type&&node.assertAlive({actionContext:context});var baseIsRunningAction=node._isRunningAction;node._isRunningAction=!0;var previousContext=currentActionContext;currentActionContext=context;try{return function runMiddleWares(node,baseCall,originalFn){var middlewares=new CollectedMiddlewares(node,originalFn);if(middlewares.isEmpty)return(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(originalFn).apply(null,baseCall.args);var result=null;function runNextMiddleware(call){var middleware=middlewares.getNextMiddleware(),handler=middleware&&middleware.handler;if(!handler)return(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(originalFn).apply(null,call.args);if(!middleware.includeHooks&&Hook[call.name])return runNextMiddleware(call);function next(call2,callback){result=runNextMiddleware(call2),callback&&(result=callback(result))}function abort(value){result=value}return handler(call,next,abort),result}return runNextMiddleware(baseCall)}(node,context,fn)}finally{currentActionContext=previousContext,node._isRunningAction=baseIsRunningAction}}function getParentActionContext(parentContext){if(parentContext)return"action"===parentContext.type?parentContext:parentContext.parentActionEvent}function createActionInvoker(target,name,fn){var res=function(){var id=getNextActionId(),parentContext=currentActionContext,parentActionContext=getParentActionContext(parentContext);return runWithActionContext({type:"action",name,id,args:argsToArray(arguments),context:target,tree:getRoot(target),rootId:parentContext?parentContext.rootId:id,parentId:parentContext?parentContext.id:0,allParentIds:parentContext?__spread(parentContext.allParentIds,[parentContext.id]):[],parentEvent:parentContext,parentActionEvent:parentActionContext},fn)};return res._isMSTAction=!0,res._isFlowAction=fn._isFlowAction,res}function addMiddleware(target,handler,includeHooks){void 0===includeHooks&&(includeHooks=!0);var node=getStateTreeNode(target);return node.addMiddleWare(handler,includeHooks)}function decorate(handler,fn,includeHooks){void 0===includeHooks&&(includeHooks=!0);var middleware={handler,includeHooks};return fn.$mst_middleware=fn.$mst_middleware||[],fn.$mst_middleware.push(middleware),fn}var CollectedMiddlewares=function(){function CollectedMiddlewares(node,fn){Object.defineProperty(this,"arrayIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"inArrayIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"middlewares",{enumerable:!0,configurable:!0,writable:!0,value:[]}),fn.$mst_middleware&&this.middlewares.push(fn.$mst_middleware);for(var n=node;n;)n.middlewares&&this.middlewares.push(n.middlewares),n=n.parent}return Object.defineProperty(CollectedMiddlewares.prototype,"isEmpty",{get:function(){return this.middlewares.length<=0},enumerable:!1,configurable:!0}),Object.defineProperty(CollectedMiddlewares.prototype,"getNextMiddleware",{enumerable:!1,configurable:!0,writable:!0,value:function(){var array=this.middlewares[this.arrayIndex];if(array){var item=array[this.inArrayIndex++];return item||(this.arrayIndex++,this.inArrayIndex=0,this.getNextMiddleware())}}}),CollectedMiddlewares}();function getRunningActionContext(){for(var current=getCurrentActionContext();current&&"action"!==current.type;)current=current.parentActionEvent;return current}function _isActionContextThisOrChildOf(actionContext,sameOrParent,includeSame){for(var parentId="number"==typeof sameOrParent?sameOrParent:sameOrParent.id,current=includeSame?actionContext:actionContext.parentActionEvent;current;){if(current.id===parentId)return!0;current=current.parentActionEvent}return!1}function isActionContextThisOrChildOf(actionContext,parentOrThis){return _isActionContextThisOrChildOf(actionContext,parentOrThis,!0)}function prettyPrintValue(value){return"function"==typeof value?"<function"+(value.name?" "+value.name:"")+">":isStateTreeNode(value)?"<"+value+">":"`"+function safeStringify(value){try{return JSON.stringify(value)}catch(e){return"<Unserializable: "+e+">"}}(value)+"`"}function toErrorString(error){var value=error.value,type=error.context[error.context.length-1].type,fullPath=error.context.map((function(_a){return _a.path})).filter((function(path){return path.length>0})).join("/"),pathPrefix=fullPath.length>0?'at path "/'+fullPath+'" ':"",currentTypename=isStateTreeNode(value)?"value of type "+getStateTreeNode(value).type.name+":":isPrimitive(value)?"value":"snapshot",isSnapshotCompatible=type&&isStateTreeNode(value)&&type.is(getStateTreeNode(value).snapshot);return""+pathPrefix+currentTypename+" "+prettyPrintValue(value)+" is not assignable "+(type?"to type: `"+type.name+"`":"")+(error.message?" ("+error.message+")":"")+(type?function isPrimitiveType(type){return isType(type)&&(type.flags&(TypeFlags.String|TypeFlags.Number|TypeFlags.Integer|TypeFlags.Boolean|TypeFlags.Date))>0}(type)||isPrimitive(value)?".":", expected an instance of `"+type.name+"` or a snapshot like `"+type.describe()+"` instead."+(isSnapshotCompatible?" (Note that a snapshot of the provided value is compatible with the targeted type)":""):".")}function getContextForPath(context,path,type){return context.concat([{path,type}])}function typeCheckSuccess(){return EMPTY_ARRAY}function typeCheckFailure(context,value,message){return[{context,value,message}]}function flattenTypeErrors(errors){return errors.reduce((function(a,i){return a.concat(i)}),[])}function typecheckInternal(type,value){(function isTypeCheckingEnabled(){return void 0!==process&&process.env&&"true"===process.env.ENABLE_TYPE_CHECK})()&&function typecheck(type,value){var errors=type.validate(value,[{path:"",type}]);if(errors.length>0)throw fail(function validationErrorsToString(type,value,errors){if(0===errors.length)return;return"Error while converting "+function shortenPrintValue(valueInString){return valueInString.length<280?valueInString:valueInString.substring(0,272)+"......"+valueInString.substring(valueInString.length-8)}(prettyPrintValue(value))+" to `"+type.name+"`:\n\n    "+errors.map(toErrorString).join("\n    ")}(type,value,errors))}(type,value)}var NodeLifeCycle,identifierCacheId=0,IdentifierCache=function(){function IdentifierCache(){Object.defineProperty(this,"cacheId",{enumerable:!0,configurable:!0,writable:!0,value:identifierCacheId++}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:mobx__WEBPACK_IMPORTED_MODULE_0__.sH.map()}),Object.defineProperty(this,"lastCacheModificationPerId",{enumerable:!0,configurable:!0,writable:!0,value:mobx__WEBPACK_IMPORTED_MODULE_0__.sH.map()})}return Object.defineProperty(IdentifierCache.prototype,"updateLastCacheModificationPerId",{enumerable:!1,configurable:!0,writable:!0,value:function(identifier){var lcm=this.lastCacheModificationPerId.get(identifier);this.lastCacheModificationPerId.set(identifier,void 0===lcm?1:lcm+1)}}),Object.defineProperty(IdentifierCache.prototype,"getLastCacheModificationPerId",{enumerable:!1,configurable:!0,writable:!0,value:function(identifier){var modificationId=this.lastCacheModificationPerId.get(identifier)||0;return this.cacheId+"-"+modificationId}}),Object.defineProperty(IdentifierCache.prototype,"addNodeToCache",{enumerable:!1,configurable:!0,writable:!0,value:function(node,lastCacheUpdate){if(void 0===lastCacheUpdate&&(lastCacheUpdate=!0),node.identifierAttribute){var identifier=node.identifier;this.cache.has(identifier)||this.cache.set(identifier,mobx__WEBPACK_IMPORTED_MODULE_0__.sH.array([],mobxShallow));var set=this.cache.get(identifier);if(-1!==set.indexOf(node))throw fail("Already registered");set.push(node),lastCacheUpdate&&this.updateLastCacheModificationPerId(identifier)}}}),Object.defineProperty(IdentifierCache.prototype,"mergeCache",{enumerable:!1,configurable:!0,writable:!0,value:function(node){var _this=this;(0,mobx__WEBPACK_IMPORTED_MODULE_0__.zu)(node.identifierCache.cache).forEach((function(nodes){return nodes.forEach((function(child){_this.addNodeToCache(child)}))}))}}),Object.defineProperty(IdentifierCache.prototype,"notifyDied",{enumerable:!1,configurable:!0,writable:!0,value:function(node){if(node.identifierAttribute){var id=node.identifier,set=this.cache.get(id);set&&(set.remove(node),set.length||this.cache.delete(id),this.updateLastCacheModificationPerId(node.identifier))}}}),Object.defineProperty(IdentifierCache.prototype,"splitCache",{enumerable:!1,configurable:!0,writable:!0,value:function(splitNode){var _this=this,newCache=new IdentifierCache,basePath=splitNode.path+"/";return(0,mobx__WEBPACK_IMPORTED_MODULE_0__.jO)(this.cache).forEach((function(_a){for(var _b=__read(_a,2),id=_b[0],nodes=_b[1],modified=!1,i=nodes.length-1;i>=0;i--){var node=nodes[i];node!==splitNode&&0!==node.path.indexOf(basePath)||(newCache.addNodeToCache(node,!1),nodes.splice(i,1),nodes.length||_this.cache.delete(id),modified=!0)}modified&&_this.updateLastCacheModificationPerId(id)})),newCache}}),Object.defineProperty(IdentifierCache.prototype,"has",{enumerable:!1,configurable:!0,writable:!0,value:function(type,identifier){var set=this.cache.get(identifier);return!!set&&set.some((function(candidate){return type.isAssignableFrom(candidate.type)}))}}),Object.defineProperty(IdentifierCache.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(type,identifier){var set=this.cache.get(identifier);if(!set)return null;var matches=set.filter((function(candidate){return type.isAssignableFrom(candidate.type)}));switch(matches.length){case 0:return null;case 1:return matches[0];default:throw fail("Cannot resolve a reference to type '"+type.name+"' with id: '"+identifier+"' unambigously, there are multiple candidates: "+matches.map((function(n){return n.path})).join(", "))}}}),IdentifierCache}();function createObjectNode(type,parent,subpath,environment,initialValue){var existingNode=getStateTreeNodeSafe(initialValue);if(existingNode){if(existingNode.parent)throw fail("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+(parent?parent.path:"")+"/"+subpath+"', but it lives already at '"+existingNode.path+"'");return parent&&existingNode.setParent(parent,subpath),existingNode}return new ObjectNode(type,parent,subpath,environment,initialValue)}function createScalarNode(type,parent,subpath,environment,initialValue){return new ScalarNode(type,parent,subpath,environment,initialValue)}function isStateTreeNode(value){return!(!value||!value.$treenode)}function assertIsStateTreeNode(value,argNumber){assertArg(value,isStateTreeNode,"mobx-state-tree node",argNumber)}function getStateTreeNode(value){if(!isStateTreeNode(value))throw fail("Value "+value+" is no MST Node");return value.$treenode}function getStateTreeNodeSafe(value){return value&&value.$treenode||null}function toJSON(){return getStateTreeNode(this).snapshot}!function(NodeLifeCycle){NodeLifeCycle[NodeLifeCycle.INITIALIZING=0]="INITIALIZING",NodeLifeCycle[NodeLifeCycle.CREATED=1]="CREATED",NodeLifeCycle[NodeLifeCycle.FINALIZED=2]="FINALIZED",NodeLifeCycle[NodeLifeCycle.DETACHING=3]="DETACHING",NodeLifeCycle[NodeLifeCycle.DEAD=4]="DEAD"}(NodeLifeCycle||(NodeLifeCycle={}));var doubleDot=function(_){return".."};function getRelativePathBetweenNodes(base,target){if(base.root!==target.root)throw fail("Cannot calculate relative path: objects '"+base+"' and '"+target+"' are not part of the same object tree");for(var baseParts=splitJsonPath(base.path),targetParts=splitJsonPath(target.path),common=0;common<baseParts.length&&baseParts[common]===targetParts[common];common++);return baseParts.slice(common).map(doubleDot).join("/")+joinJsonPath(targetParts.slice(common))}function resolveNodeByPath(base,path,failIfResolveFails){return void 0===failIfResolveFails&&(failIfResolveFails=!0),resolveNodeByPathParts(base,splitJsonPath(path),failIfResolveFails)}function resolveNodeByPathParts(base,pathParts,failIfResolveFails){void 0===failIfResolveFails&&(failIfResolveFails=!0);var current=base;try{for(var i=0;i<pathParts.length;i++){var part=pathParts[i];if(".."===part){if(current=current.parent)continue}else{if("."===part)continue;if(current){if(current instanceof ScalarNode){var value=current.value;isStateTreeNode(value)&&(current=getStateTreeNode(value))}if(current instanceof ObjectNode)if(current.getChildType(part)&&(current=current.getChildNode(part)))continue}}throw fail("Could not resolve '"+part+"' in path '"+(joinJsonPath(pathParts.slice(0,i))||"/")+"' while resolving '"+joinJsonPath(pathParts)+"'")}}catch(e){if(!failIfResolveFails)return;throw e}return current}function convertChildNodesToArray(childNodes){if(!childNodes)return EMPTY_ARRAY;var keys=Object.keys(childNodes);if(!keys.length)return EMPTY_ARRAY;var result=new Array(keys.length);return keys.forEach((function(key,index){result[index]=childNodes[key]})),result}var plainObjectString=Object.toString(),EMPTY_ARRAY=Object.freeze([]),EMPTY_OBJECT=Object.freeze({}),mobxShallow=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.sG)().useProxies?{deep:!1}:{deep:!1,proxy:!1};function fail(message){return void 0===message&&(message="Illegal state"),new Error("[mobx-state-tree] "+message)}function identity(_){return _}Object.freeze(mobxShallow);var isInteger=Number.isInteger;function isArray(val){return Array.isArray(val)||(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Fq)(val)}function asArray(val){return val?isArray(val)?val:[val]:EMPTY_ARRAY}function isPlainObject(value){var _a;if(null===value||"object"!=typeof value)return!1;var proto=Object.getPrototypeOf(value);return null==proto||(null===(_a=proto.constructor)||void 0===_a?void 0:_a.toString())===plainObjectString}function isMutable(value){return!(null===value||"object"!=typeof value||value instanceof Date||value instanceof RegExp)}function isPrimitive(value,includeDate){return void 0===includeDate&&(includeDate=!0),null==value||"string"==typeof value||"number"==typeof value||"boolean"==typeof value||includeDate&&value instanceof Date}function freeze(value){return value}function isSerializable(value){return"function"!=typeof value}function defineProperty(object,key,descriptor){(0,mobx__WEBPACK_IMPORTED_MODULE_0__.OB)(object)?(0,mobx__WEBPACK_IMPORTED_MODULE_0__.n8)(object,key,descriptor):Object.defineProperty(object,key,descriptor)}function addHiddenFinalProp(object,propName,value){defineProperty(object,propName,{enumerable:!1,writable:!1,configurable:!0,value})}var EventHandler=function(){function EventHandler(){Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]})}return Object.defineProperty(EventHandler.prototype,"hasSubscribers",{get:function(){return this.handlers.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(EventHandler.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(fn,atTheBeginning){var _this=this;return void 0===atTheBeginning&&(atTheBeginning=!1),atTheBeginning?this.handlers.unshift(fn):this.handlers.push(fn),function(){_this.unregister(fn)}}}),Object.defineProperty(EventHandler.prototype,"has",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){return this.handlers.indexOf(fn)>=0}}),Object.defineProperty(EventHandler.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var index=this.handlers.indexOf(fn);index>=0&&this.handlers.splice(index,1)}}),Object.defineProperty(EventHandler.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.handlers.length=0}}),Object.defineProperty(EventHandler.prototype,"emit",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.handlers.slice().forEach((function(f){return f.apply(void 0,__spread(args))}))}}),EventHandler}(),EventHandlers=function(){function EventHandlers(){Object.defineProperty(this,"eventHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(EventHandlers.prototype,"hasSubscribers",{enumerable:!1,configurable:!0,writable:!0,value:function(event){var handler=this.eventHandlers&&this.eventHandlers[event];return!!handler&&handler.hasSubscribers}}),Object.defineProperty(EventHandlers.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(event,fn,atTheBeginning){void 0===atTheBeginning&&(atTheBeginning=!1),this.eventHandlers||(this.eventHandlers={});var handler=this.eventHandlers[event];return handler||(handler=this.eventHandlers[event]=new EventHandler),handler.register(fn,atTheBeginning)}}),Object.defineProperty(EventHandlers.prototype,"has",{enumerable:!1,configurable:!0,writable:!0,value:function(event,fn){var handler=this.eventHandlers&&this.eventHandlers[event];return!!handler&&handler.has(fn)}}),Object.defineProperty(EventHandlers.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(event,fn){var handler=this.eventHandlers&&this.eventHandlers[event];handler&&handler.unregister(fn)}}),Object.defineProperty(EventHandlers.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(event){this.eventHandlers&&delete this.eventHandlers[event]}}),Object.defineProperty(EventHandlers.prototype,"clearAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.eventHandlers=void 0}}),Object.defineProperty(EventHandlers.prototype,"emit",{enumerable:!1,configurable:!0,writable:!0,value:function(event){for(var _a,args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var handler=this.eventHandlers&&this.eventHandlers[event];handler&&(_a=handler).emit.apply(_a,__spread(args))}}),EventHandlers}();function argsToArray(args){for(var res=new Array(args.length),i=0;i<args.length;i++)res[i]=args[i];return res}function stringStartsWith(str,beginning){return 0===str.indexOf(beginning)}var deprecated=function(id,message){};function warnError(msg){console.warn(new Error("[mobx-state-tree] "+msg))}function assertArg(value,fn,typeName,argNumber){0}function assertIsFunction(value,argNumber){assertArg()}function assertIsNumber(value,argNumber,min,max){assertArg(),void 0!==min&&assertArg(),void 0!==max&&assertArg()}function assertIsString(value,argNumber,canBeEmpty){void 0===canBeEmpty&&(canBeEmpty=!0),assertArg(),canBeEmpty||assertArg()}function setImmediateWithFallback(fn){"function"==typeof queueMicrotask?queueMicrotask(fn):"function"==typeof setImmediate?setImmediate(fn):setTimeout(fn,1)}function flow(generator){return function createFlowSpawner(name,generator){var spawner=function flowSpawner(){var runId=getNextActionId(),parentContext=getCurrentActionContext();if(!parentContext)throw fail("a mst flow must always have a parent context");var parentActionContext=getParentActionContext(parentContext);if(!parentActionContext)throw fail("a mst flow must always have a parent action context");var contextBase={name,id:runId,tree:parentContext.tree,context:parentContext.context,parentId:parentContext.id,allParentIds:__spread(parentContext.allParentIds,[parentContext.id]),rootId:parentContext.rootId,parentEvent:parentContext,parentActionEvent:parentActionContext},args=arguments;function wrap(fn,type,arg){return fn.$mst_middleware=spawner.$mst_middleware,runWithActionContext(__assign(__assign({},contextBase),{type,args:[arg]}),fn)}return new Promise((function(resolve,reject){var gen,init=function asyncActionInit(){gen=generator.apply(null,arguments),onFulfilled(void 0)};function onFulfilled(res){var ret;try{var cancelError=wrap((function(r){ret=gen.next(r)}),"flow_resume",res);cancelError instanceof Error&&(ret=gen.throw(cancelError))}catch(e){return void setImmediateWithFallback((function(){wrap((function(r){reject(e)}),"flow_throw",e)}))}next(ret)}function onRejected(err){var ret;try{wrap((function(r){ret=gen.throw(r)}),"flow_resume_error",err)}catch(e){return void setImmediateWithFallback((function(){wrap((function(r){reject(e)}),"flow_throw",e)}))}next(ret)}function next(ret){if(!ret.done){if(!ret.value||"function"!=typeof ret.value.then)throw fail("Only promises can be yielded to `async`, got: "+ret);return ret.value.then(onFulfilled,onRejected)}setImmediateWithFallback((function(){wrap((function(r){resolve(r)}),"flow_return",ret.value)}))}init.$mst_middleware=spawner.$mst_middleware,runWithActionContext(__assign(__assign({},contextBase),{type:"flow_spawn",args:argsToArray(args)}),init)}))};return spawner._isFlowAction=!0,spawner}(generator.name,generator)}function stripPatch(patch){switch(patch.op){case"add":return{op:"add",path:patch.path,value:patch.value};case"remove":return{op:"remove",path:patch.path};case"replace":return{op:"replace",path:patch.path,value:patch.value}}}function invertPatch(patch){switch(patch.op){case"add":return{op:"remove",path:patch.path};case"remove":return{op:"add",path:patch.path,value:patch.oldValue};case"replace":return{op:"replace",path:patch.path,value:patch.oldValue}}}function escapeJsonPath(path){return!0===function isNumber(x){return"number"==typeof x}(path)?""+path:-1===path.indexOf("/")&&-1===path.indexOf("~")?path:path.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapeJsonPath(path){return path.replace(/~1/g,"/").replace(/~0/g,"~")}function joinJsonPath(path){if(0===path.length)return"";var getPathStr=function(p){return p.map(escapeJsonPath).join("/")};return"."===path[0]||".."===path[0]?getPathStr(path):"/"+getPathStr(path)}function splitJsonPath(path){var parts=path.split("/").map(unescapeJsonPath);if(!(""===path||"."===path||".."===path||stringStartsWith(path,"/")||stringStartsWith(path,"./")||stringStartsWith(path,"../")))throw fail("a json path must be either rooted, empty or relative, but got '"+path+"'");return""===parts[0]&&parts.shift(),parts}deprecated.ids={};var $preProcessorFailed=Symbol("$preProcessorFailed"),SnapshotProcessor=function(_super){function SnapshotProcessor(_subtype,_processors,name){var _this=_super.call(this,name||_subtype.name)||this;return Object.defineProperty(_this,"_subtype",{enumerable:!0,configurable:!0,writable:!0,value:_subtype}),Object.defineProperty(_this,"_processors",{enumerable:!0,configurable:!0,writable:!0,value:_processors}),_this}return __extends(SnapshotProcessor,_super),Object.defineProperty(SnapshotProcessor.prototype,"flags",{get:function(){return this._subtype.flags|TypeFlags.SnapshotProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(SnapshotProcessor.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"snapshotProcessor("+this._subtype.describe()+")"}}),Object.defineProperty(SnapshotProcessor.prototype,"preProcessSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(sn){return this._processors.preProcessor?this._processors.preProcessor.call(null,sn):sn}}),Object.defineProperty(SnapshotProcessor.prototype,"preProcessSnapshotSafe",{enumerable:!1,configurable:!0,writable:!0,value:function(sn){try{return this.preProcessSnapshot(sn)}catch(e){return $preProcessorFailed}}}),Object.defineProperty(SnapshotProcessor.prototype,"postProcessSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(sn,node){return this._processors.postProcessor?this._processors.postProcessor.call(null,sn,node.storedValue):sn}}),Object.defineProperty(SnapshotProcessor.prototype,"_fixNode",{enumerable:!1,configurable:!0,writable:!0,value:function(node){var _this=this;!function proxyNodeTypeMethods(nodeType,snapshotProcessorType){for(var e_1,_a,methods=[],_i=2;_i<arguments.length;_i++)methods[_i-2]=arguments[_i];try{for(var methods_1=__values(methods),methods_1_1=methods_1.next();!methods_1_1.done;methods_1_1=methods_1.next()){var method=methods_1_1.value;nodeType[method]=snapshotProcessorType[method].bind(snapshotProcessorType)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{methods_1_1&&!methods_1_1.done&&(_a=methods_1.return)&&_a.call(methods_1)}finally{if(e_1)throw e_1.error}}}(node.type,this,"create"),node instanceof ObjectNode&&(node.hasSnapshotPostProcessor=!!this._processors.postProcessor);var oldGetSnapshot=node.getSnapshot;node.getSnapshot=function(){return _this.postProcessSnapshot(oldGetSnapshot.call(node),node)},function isUnionType(type){return(type.flags&TypeFlags.Union)>0}(this._subtype)||(node.getReconciliationType=function(){return _this})}}),Object.defineProperty(SnapshotProcessor.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){var processedInitialValue=isStateTreeNode(initialValue)?initialValue:this.preProcessSnapshot(initialValue),node=this._subtype.instantiate(parent,subpath,environment,processedInitialValue);return this._fixNode(node),node}}),Object.defineProperty(SnapshotProcessor.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){var node=this._subtype.reconcile(current,isStateTreeNode(newValue)?newValue:this.preProcessSnapshot(newValue),parent,subpath);return node!==current&&this._fixNode(node),node}}),Object.defineProperty(SnapshotProcessor.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,applyPostProcess){void 0===applyPostProcess&&(applyPostProcess=!0);var sn=this._subtype.getSnapshot(node);return applyPostProcess?this.postProcessSnapshot(sn,node):sn}}),Object.defineProperty(SnapshotProcessor.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var processedSn=this.preProcessSnapshotSafe(value);return processedSn===$preProcessorFailed?typeCheckFailure(context,value,"Failed to preprocess value"):this._subtype.validate(processedSn,context)}}),Object.defineProperty(SnapshotProcessor.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subtype}}),Object.defineProperty(SnapshotProcessor.prototype,"is",{enumerable:!1,configurable:!0,writable:!0,value:function(thing){var value=isType(thing)?this._subtype:isStateTreeNode(thing)?getSnapshot(thing,!1):this.preProcessSnapshotSafe(thing);return value!==$preProcessorFailed&&0===this._subtype.validate(value,[{path:"",type:this._subtype}]).length}}),Object.defineProperty(SnapshotProcessor.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return this._subtype.isAssignableFrom(type)}}),Object.defineProperty(SnapshotProcessor.prototype,"isMatchingSnapshotId",{enumerable:!1,configurable:!0,writable:!0,value:function(current,snapshot){if(!(this._subtype instanceof ComplexType))return!1;var processedSn=this.preProcessSnapshot(snapshot);return this._subtype.isMatchingSnapshotId(current,processedSn)}}),SnapshotProcessor}(BaseType);var MapIdentifierMode,needsIdentifierError="Map.put can only be used to store complex values that have an identifier type attribute";function tryCollectModelTypes(type,modelTypes){var e_1,_a,subtypes=type.getSubTypes();if("cannotDetermine"===subtypes)return!1;if(subtypes){var subtypesArray=asArray(subtypes);try{for(var subtypesArray_1=__values(subtypesArray),subtypesArray_1_1=subtypesArray_1.next();!subtypesArray_1_1.done;subtypesArray_1_1=subtypesArray_1.next()){if(!tryCollectModelTypes(subtypesArray_1_1.value,modelTypes))return!1}}catch(e_1_1){e_1={error:e_1_1}}finally{try{subtypesArray_1_1&&!subtypesArray_1_1.done&&(_a=subtypesArray_1.return)&&_a.call(subtypesArray_1)}finally{if(e_1)throw e_1.error}}}return type instanceof ModelType&&modelTypes.push(type),!0}!function(MapIdentifierMode){MapIdentifierMode[MapIdentifierMode.UNKNOWN=0]="UNKNOWN",MapIdentifierMode[MapIdentifierMode.YES=1]="YES",MapIdentifierMode[MapIdentifierMode.NO=2]="NO"}(MapIdentifierMode||(MapIdentifierMode={}));var MSTMap=function(_super){function MSTMap(initialData,name){return _super.call(this,initialData,mobx__WEBPACK_IMPORTED_MODULE_0__.sH.ref.enhancer,name)||this}return __extends(MSTMap,_super),Object.defineProperty(MSTMap.prototype,"get",{enumerable:!1,configurable:!0,writable:!0,value:function(key){return _super.prototype.get.call(this,""+key)}}),Object.defineProperty(MSTMap.prototype,"has",{enumerable:!1,configurable:!0,writable:!0,value:function(key){return _super.prototype.has.call(this,""+key)}}),Object.defineProperty(MSTMap.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(key){return _super.prototype.delete.call(this,""+key)}}),Object.defineProperty(MSTMap.prototype,"set",{enumerable:!1,configurable:!0,writable:!0,value:function(key,value){return _super.prototype.set.call(this,""+key,value)}}),Object.defineProperty(MSTMap.prototype,"put",{enumerable:!1,configurable:!0,writable:!0,value:function(value){if(!value)throw fail("Map.put cannot be used to set empty values");if(isStateTreeNode(value)){var node=getStateTreeNode(value);if(null===node.identifier)throw fail(needsIdentifierError);return this.set(node.identifier,value),value}if(isMutable(value)){var mapNode=getStateTreeNode(this),mapType=mapNode.type;if(mapType.identifierMode!==MapIdentifierMode.YES)throw fail(needsIdentifierError);var id=value[mapType.mapIdentifierAttribute];if(!isValidIdentifier(id)){var newNode=this.put(mapType.getChildType().create(value,mapNode.environment));return this.put(getSnapshot(newNode))}var key=normalizeIdentifier(id);return this.set(key,value),this.get(key)}throw fail("Map.put can only be used to store complex values")}}),MSTMap}(mobx__WEBPACK_IMPORTED_MODULE_0__.Es),MapType=function(_super){function MapType(name,_subType,hookInitializers){void 0===hookInitializers&&(hookInitializers=[]);var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"_subType",{enumerable:!0,configurable:!0,writable:!0,value:_subType}),Object.defineProperty(_this,"identifierMode",{enumerable:!0,configurable:!0,writable:!0,value:MapIdentifierMode.UNKNOWN}),Object.defineProperty(_this,"mapIdentifierAttribute",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Map}),Object.defineProperty(_this,"hookInitializers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),_this._determineIdentifierMode(),_this.hookInitializers=hookInitializers,_this}return __extends(MapType,_super),Object.defineProperty(MapType.prototype,"hooks",{enumerable:!1,configurable:!0,writable:!0,value:function(hooks){var hookInitializers=this.hookInitializers.length>0?this.hookInitializers.concat(hooks):[hooks];return new MapType(this.name,this._subType,hookInitializers)}}),Object.defineProperty(MapType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return this._determineIdentifierMode(),createObjectNode(this,parent,subpath,environment,initialValue)}}),Object.defineProperty(MapType.prototype,"_determineIdentifierMode",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.identifierMode===MapIdentifierMode.UNKNOWN){var modelTypes=[];if(tryCollectModelTypes(this._subType,modelTypes)){var identifierAttribute=modelTypes.reduce((function(current,type){if(!type.identifierAttribute)return current;if(current&&current!==type.identifierAttribute)throw fail("The objects in a map should all have the same identifier attribute, expected '"+current+"', but child of type '"+type.name+"' declared attribute '"+type.identifierAttribute+"' as identifier");return type.identifierAttribute}),void 0);identifierAttribute?(this.identifierMode=MapIdentifierMode.YES,this.mapIdentifierAttribute=identifierAttribute):this.identifierMode=MapIdentifierMode.NO}}}}),Object.defineProperty(MapType.prototype,"initializeChildNodes",{enumerable:!1,configurable:!0,writable:!0,value:function(objNode,initialSnapshot){void 0===initialSnapshot&&(initialSnapshot={});var subType=objNode.type._subType,result={};return Object.keys(initialSnapshot).forEach((function(name){result[name]=subType.instantiate(objNode,name,void 0,initialSnapshot[name])})),result}}),Object.defineProperty(MapType.prototype,"createNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){return new MSTMap(childNodes,this.name)}}),Object.defineProperty(MapType.prototype,"finalizeNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(node,instance){(0,mobx__WEBPACK_IMPORTED_MODULE_0__.pA)(instance,node.unbox),node.type.hookInitializers.forEach((function(initializer){var hooks=initializer(instance);Object.keys(hooks).forEach((function(name){var hook=hooks[name],actionInvoker=createActionInvoker(instance,name,hook);addHiddenFinalProp(instance,name,actionInvoker)}))})),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Zc)(instance,this.willChange),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.lB)(instance,this.didChange)}}),Object.defineProperty(MapType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(MapType.prototype,"getChildren",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return(0,mobx__WEBPACK_IMPORTED_MODULE_0__.zu)(node.storedValue)}}),Object.defineProperty(MapType.prototype,"getChildNode",{enumerable:!1,configurable:!0,writable:!0,value:function(node,key){var childNode=node.storedValue.get(""+key);if(!childNode)throw fail("Not a child "+key);return childNode}}),Object.defineProperty(MapType.prototype,"willChange",{enumerable:!1,configurable:!0,writable:!0,value:function(change){var node=getStateTreeNode(change.object),key=change.name;node.assertWritable({subpath:key});var mapType=node.type,subType=mapType._subType;switch(change.type){case"update":var newValue=change.newValue;if(newValue===change.object.get(key))return null;typecheckInternal(subType,newValue),change.newValue=subType.reconcile(node.getChildNode(key),change.newValue,node,key),mapType.processIdentifier(key,change.newValue);break;case"add":typecheckInternal(subType,change.newValue),change.newValue=subType.instantiate(node,key,void 0,change.newValue),mapType.processIdentifier(key,change.newValue)}return change}}),Object.defineProperty(MapType.prototype,"processIdentifier",{enumerable:!1,configurable:!0,writable:!0,value:function(expected,node){if(this.identifierMode===MapIdentifierMode.YES&&node instanceof ObjectNode){var identifier=node.identifier;if(identifier!==expected)throw fail("A map of objects containing an identifier should always store the object under their own identifier. Trying to store key '"+identifier+"', but expected: '"+expected+"'")}}}),Object.defineProperty(MapType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node){var res={};return node.getChildren().forEach((function(childNode){res[childNode.subpath]=childNode.snapshot})),res}}),Object.defineProperty(MapType.prototype,"processInitialSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){var processed={};return Object.keys(childNodes).forEach((function(key){processed[key]=childNodes[key].getSnapshot()})),processed}}),Object.defineProperty(MapType.prototype,"didChange",{enumerable:!1,configurable:!0,writable:!0,value:function(change){var node=getStateTreeNode(change.object);switch(change.type){case"update":return void node.emitPatch({op:"replace",path:escapeJsonPath(change.name),value:change.newValue.snapshot,oldValue:change.oldValue?change.oldValue.snapshot:void 0},node);case"add":return void node.emitPatch({op:"add",path:escapeJsonPath(change.name),value:change.newValue.snapshot,oldValue:void 0},node);case"delete":var oldSnapshot=change.oldValue.snapshot;return change.oldValue.die(),void node.emitPatch({op:"remove",path:escapeJsonPath(change.name),oldValue:oldSnapshot},node)}}}),Object.defineProperty(MapType.prototype,"applyPatchLocally",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath,patch){var target=node.storedValue;switch(patch.op){case"add":case"replace":target.set(subpath,patch.value);break;case"remove":target.delete(subpath)}}}),Object.defineProperty(MapType.prototype,"applySnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,snapshot){typecheckInternal(this,snapshot);var target=node.storedValue,currentKeys={};if(Array.from(target.keys()).forEach((function(key){currentKeys[key]=!1})),snapshot)for(var key in snapshot)target.set(key,snapshot[key]),currentKeys[""+key]=!0;Object.keys(currentKeys).forEach((function(key){!1===currentKeys[key]&&target.delete(key)}))}}),Object.defineProperty(MapType.prototype,"getChildType",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subType}}),Object.defineProperty(MapType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var _this=this;return isPlainObject(value)?flattenTypeErrors(Object.keys(value).map((function(path){return _this._subType.validate(value[path],getContextForPath(context,path,_this._subType))}))):typeCheckFailure(context,value,"Value is not a plain object")}}),Object.defineProperty(MapType.prototype,"getDefaultSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return EMPTY_OBJECT}}),Object.defineProperty(MapType.prototype,"removeChild",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath){node.storedValue.delete(subpath)}}),MapType}(ComplexType);MapType.prototype.applySnapshot=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(MapType.prototype.applySnapshot);var ArrayType=function(_super){function ArrayType(name,_subType,hookInitializers){void 0===hookInitializers&&(hookInitializers=[]);var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"_subType",{enumerable:!0,configurable:!0,writable:!0,value:_subType}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Array}),Object.defineProperty(_this,"hookInitializers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),_this.hookInitializers=hookInitializers,_this}return __extends(ArrayType,_super),Object.defineProperty(ArrayType.prototype,"hooks",{enumerable:!1,configurable:!0,writable:!0,value:function(hooks){var hookInitializers=this.hookInitializers.length>0?this.hookInitializers.concat(hooks):[hooks];return new ArrayType(this.name,this._subType,hookInitializers)}}),Object.defineProperty(ArrayType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return createObjectNode(this,parent,subpath,environment,initialValue)}}),Object.defineProperty(ArrayType.prototype,"initializeChildNodes",{enumerable:!1,configurable:!0,writable:!0,value:function(objNode,snapshot){void 0===snapshot&&(snapshot=[]);var subType=objNode.type._subType,result={};return snapshot.forEach((function(item,index){var subpath=""+index;result[subpath]=subType.instantiate(objNode,subpath,void 0,item)})),result}}),Object.defineProperty(ArrayType.prototype,"createNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){var options=__assign(__assign({},mobxShallow),{name:this.name});return mobx__WEBPACK_IMPORTED_MODULE_0__.sH.array(convertChildNodesToArray(childNodes),options)}}),Object.defineProperty(ArrayType.prototype,"finalizeNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(node,instance){(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Mr)(instance).dehancer=node.unbox,node.type.hookInitializers.forEach((function(initializer){var hooks=initializer(instance);Object.keys(hooks).forEach((function(name){var hook=hooks[name],actionInvoker=createActionInvoker(instance,name,hook);addHiddenFinalProp(instance,name,actionInvoker)}))})),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Zc)(instance,this.willChange),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.lB)(instance,this.didChange)}}),Object.defineProperty(ArrayType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(ArrayType.prototype,"getChildren",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.storedValue.slice()}}),Object.defineProperty(ArrayType.prototype,"getChildNode",{enumerable:!1,configurable:!0,writable:!0,value:function(node,key){var index=Number(key);if(index<node.storedValue.length)return node.storedValue[index];throw fail("Not a child: "+key)}}),Object.defineProperty(ArrayType.prototype,"willChange",{enumerable:!1,configurable:!0,writable:!0,value:function(change){var node=getStateTreeNode(change.object);node.assertWritable({subpath:""+change.index});var subType=node.type._subType,childNodes=node.getChildren();switch(change.type){case"update":if(change.newValue===change.object[change.index])return null;var updatedNodes=reconcileArrayChildren(node,subType,[childNodes[change.index]],[change.newValue],[change.index]);if(!updatedNodes)return null;change.newValue=updatedNodes[0];break;case"splice":var index_1=change.index,removedCount=change.removedCount,added=change.added,addedNodes=reconcileArrayChildren(node,subType,childNodes.slice(index_1,index_1+removedCount),added,added.map((function(_,i){return index_1+i})));if(!addedNodes)return null;change.added=addedNodes;for(var i=index_1+removedCount;i<childNodes.length;i++)childNodes[i].setParent(node,""+(i+added.length-removedCount))}return change}}),Object.defineProperty(ArrayType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.getChildren().map((function(childNode){return childNode.snapshot}))}}),Object.defineProperty(ArrayType.prototype,"processInitialSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){var processed=[];return Object.keys(childNodes).forEach((function(key){processed.push(childNodes[key].getSnapshot())})),processed}}),Object.defineProperty(ArrayType.prototype,"didChange",{enumerable:!1,configurable:!0,writable:!0,value:function(change){var node=getStateTreeNode(change.object);switch(change.type){case"update":return void node.emitPatch({op:"replace",path:""+change.index,value:change.newValue.snapshot,oldValue:change.oldValue?change.oldValue.snapshot:void 0},node);case"splice":for(var i=change.removedCount-1;i>=0;i--)node.emitPatch({op:"remove",path:""+(change.index+i),oldValue:change.removed[i].snapshot},node);for(i=0;i<change.addedCount;i++)node.emitPatch({op:"add",path:""+(change.index+i),value:node.getChildNode(""+(change.index+i)).snapshot,oldValue:void 0},node);return}}}),Object.defineProperty(ArrayType.prototype,"applyPatchLocally",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath,patch){var target=node.storedValue,index="-"===subpath?target.length:Number(subpath);switch(patch.op){case"replace":target[index]=patch.value;break;case"add":target.splice(index,0,patch.value);break;case"remove":target.splice(index,1)}}}),Object.defineProperty(ArrayType.prototype,"applySnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,snapshot){typecheckInternal(this,snapshot),node.storedValue.replace(snapshot)}}),Object.defineProperty(ArrayType.prototype,"getChildType",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subType}}),Object.defineProperty(ArrayType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var _this=this;return isArray(value)?flattenTypeErrors(value.map((function(item,index){return _this._subType.validate(item,getContextForPath(context,""+index,_this._subType))}))):typeCheckFailure(context,value,"Value is not an array")}}),Object.defineProperty(ArrayType.prototype,"getDefaultSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return EMPTY_ARRAY}}),Object.defineProperty(ArrayType.prototype,"removeChild",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath){node.storedValue.splice(Number(subpath),1)}}),ArrayType}(ComplexType);function reconcileArrayChildren(parent,childType,oldNodes,newValues,newPaths){for(var value,nothingChanged=!0,i=0;;i++){var hasNewNode=i<=newValues.length-1,oldNode=oldNodes[i],newValue=hasNewNode?newValues[i]:void 0,newPath=""+newPaths[i];if(((value=newValue)instanceof ScalarNode||value instanceof ObjectNode)&&(newValue=newValue.storedValue),!oldNode&&!hasNewNode)break;if(hasNewNode)if(oldNode)if(areSame(oldNode,newValue))oldNodes[i]=valueAsNode(childType,parent,newPath,newValue,oldNode);else{for(var oldMatch=void 0,j=i;j<oldNodes.length;j++)if(areSame(oldNodes[j],newValue)){oldMatch=oldNodes.splice(j,1)[0];break}nothingChanged=!1;newNode=valueAsNode(childType,parent,newPath,newValue,oldMatch);oldNodes.splice(i,0,newNode)}else{if(isStateTreeNode(newValue)&&getStateTreeNode(newValue).parent===parent)throw fail("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+parent.path+"/"+newPath+"', but it lives already at '"+getStateTreeNode(newValue).path+"'");nothingChanged=!1;var newNode=valueAsNode(childType,parent,newPath,newValue);oldNodes.splice(i,0,newNode)}else nothingChanged=!1,oldNodes.splice(i,1),oldNode instanceof ObjectNode&&oldNode.createObservableInstanceIfNeeded(),oldNode.die(),i--}return nothingChanged?null:oldNodes}function valueAsNode(childType,parent,subpath,newValue,oldNode){typecheckInternal(childType,newValue);var newNode=function getNewNode(){if(isStateTreeNode(newValue)){var childNode=getStateTreeNode(newValue);if(childNode.assertAlive(EMPTY_OBJECT),null!==childNode.parent&&childNode.parent===parent)return childNode.setParent(parent,subpath),childNode}return oldNode?childType.reconcile(oldNode,newValue,parent,subpath):childType.instantiate(parent,subpath,void 0,newValue)}();return oldNode&&oldNode!==newNode&&(oldNode instanceof ObjectNode&&oldNode.createObservableInstanceIfNeeded(),oldNode.die()),newNode}function areSame(oldNode,newValue){if(!oldNode.isAlive)return!1;if(isStateTreeNode(newValue)){var newNode=getStateTreeNode(newValue);return newNode.isAlive&&newNode===oldNode}if(oldNode.snapshot===newValue)return!0;if(!(oldNode instanceof ObjectNode))return!1;var oldNodeType=oldNode.getReconciliationType();return null!==oldNode.identifier&&oldNode.identifierAttribute&&isPlainObject(newValue)&&oldNodeType.is(newValue)&&oldNodeType.isMatchingSnapshotId(oldNode,newValue)}ArrayType.prototype.applySnapshot=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ArrayType.prototype.applySnapshot);function objectTypeToString(){return getStateTreeNode(this).toString()}var defaultObjectOptions={name:"AnonymousModel",properties:{},initializers:EMPTY_ARRAY};function toPropertiesObject(declaredProps){var keysList=Object.keys(declaredProps),alreadySeenKeys=new Set;return keysList.forEach((function(key){if(alreadySeenKeys.has(key))throw fail(key+" is declared twice in the model. Model should not contain the same keys");alreadySeenKeys.add(key)})),keysList.reduce((function(props,key){if(key in Hook)throw fail("Hook '"+key+"' was defined as property. Hooks should be defined as part of the actions");var descriptor=Object.getOwnPropertyDescriptor(declaredProps,key);if("get"in descriptor)throw fail("Getters are not supported as properties. Please use views instead");var value=descriptor.value;if(null==value)throw fail("The default value of an attribute cannot be null or undefined as the type cannot be inferred. Did you mean `types.maybe(someType)`?");if(isPrimitive(value))props[key]=optional(function getPrimitiveFactoryFromValue(value){switch(typeof value){case"string":return string;case"number":return number;case"boolean":return boolean;case"object":if(value instanceof Date)return DatePrimitive}throw fail("Cannot determine primitive type from value "+value)}(value),value);else if(value instanceof MapType)props[key]=optional(value,{});else if(value instanceof ArrayType)props[key]=optional(value,[]);else if(!isType(value))throw fail("Invalid type definition for property '"+key+"', cannot infer a type from a value like '"+value+"' ("+typeof value+")");return props}),__assign({},declaredProps))}var ModelType=function(_super){function ModelType(opts){var _this=_super.call(this,opts.name||defaultObjectOptions.name)||this;return Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Object}),Object.defineProperty(_this,"initializers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"preProcessor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"postProcessor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"propertyNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"named",{enumerable:!0,configurable:!0,writable:!0,value:function(name){return _this.cloneAndEnhance({name})}}),Object.defineProperty(_this,"props",{enumerable:!0,configurable:!0,writable:!0,value:function(properties){return _this.cloneAndEnhance({properties})}}),Object.defineProperty(_this,"preProcessSnapshot",{enumerable:!0,configurable:!0,writable:!0,value:function(preProcessor){var currentPreprocessor=_this.preProcessor;return currentPreprocessor?_this.cloneAndEnhance({preProcessor:function(snapshot){return currentPreprocessor(preProcessor(snapshot))}}):_this.cloneAndEnhance({preProcessor})}}),Object.defineProperty(_this,"postProcessSnapshot",{enumerable:!0,configurable:!0,writable:!0,value:function(postProcessor){var currentPostprocessor=_this.postProcessor;return currentPostprocessor?_this.cloneAndEnhance({postProcessor:function(snapshot){return postProcessor(currentPostprocessor(snapshot))}}):_this.cloneAndEnhance({postProcessor})}}),Object.assign(_this,defaultObjectOptions,opts),_this.properties=toPropertiesObject(_this.properties),_this.properties,_this.propertyNames=Object.keys(_this.properties),_this.identifierAttribute=_this._getIdentifierAttribute(),_this}return __extends(ModelType,_super),Object.defineProperty(ModelType.prototype,"_getIdentifierAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(){var identifierAttribute=void 0;return this.forAllProps((function(propName,propType){if(propType.flags&TypeFlags.Identifier){if(identifierAttribute)throw fail("Cannot define property '"+propName+"' as object identifier, property '"+identifierAttribute+"' is already defined as identifier property");identifierAttribute=propName}})),identifierAttribute}}),Object.defineProperty(ModelType.prototype,"cloneAndEnhance",{enumerable:!1,configurable:!0,writable:!0,value:function(opts){return new ModelType({name:opts.name||this.name,properties:Object.assign({},this.properties,opts.properties),initializers:this.initializers.concat(opts.initializers||[]),preProcessor:opts.preProcessor||this.preProcessor,postProcessor:opts.postProcessor||this.postProcessor})}}),Object.defineProperty(ModelType.prototype,"actions",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var _this=this;return this.cloneAndEnhance({initializers:[function(self){return _this.instantiateActions(self,fn(self)),self}]})}}),Object.defineProperty(ModelType.prototype,"instantiateActions",{enumerable:!1,configurable:!0,writable:!0,value:function(self,actions){if(!isPlainObject(actions))throw fail("actions initializer should return a plain object containing actions");Object.keys(actions).forEach((function(name){if("preProcessSnapshot"===name)throw fail("Cannot define action 'preProcessSnapshot', it should be defined using 'type.preProcessSnapshot(fn)' instead");if("postProcessSnapshot"===name)throw fail("Cannot define action 'postProcessSnapshot', it should be defined using 'type.postProcessSnapshot(fn)' instead");var action2=actions[name],baseAction=self[name];if(name in Hook&&baseAction){var specializedAction_1=action2;action2=function(){baseAction.apply(null,arguments),specializedAction_1.apply(null,arguments)}}var middlewares=action2.$mst_middleware,boundAction=action2.bind(actions);boundAction._isFlowAction=action2._isFlowAction||!1,boundAction.$mst_middleware=middlewares;var actionInvoker=createActionInvoker(self,name,boundAction);actions[name]=actionInvoker,addHiddenFinalProp(self,name,actionInvoker)}))}}),Object.defineProperty(ModelType.prototype,"volatile",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var _this=this;if("function"!=typeof fn)throw fail("You passed an "+typeof fn+" to volatile state as an argument, when function is expected");return this.cloneAndEnhance({initializers:[function(self){return _this.instantiateVolatileState(self,fn(self)),self}]})}}),Object.defineProperty(ModelType.prototype,"instantiateVolatileState",{enumerable:!1,configurable:!0,writable:!0,value:function(self,state){if(!isPlainObject(state))throw fail("volatile state initializer should return a plain object containing state");(0,mobx__WEBPACK_IMPORTED_MODULE_0__.hZ)(self,state)}}),Object.defineProperty(ModelType.prototype,"extend",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var _this=this;return this.cloneAndEnhance({initializers:[function(self){var _a=fn(self),actions=_a.actions,views=_a.views,state=_a.state,rest=function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}(_a,["actions","views","state"]);for(var key in rest)throw fail("The `extend` function should return an object with a subset of the fields 'actions', 'views' and 'state'. Found invalid key '"+key+"'");return state&&_this.instantiateVolatileState(self,state),views&&_this.instantiateViews(self,views),actions&&_this.instantiateActions(self,actions),self}]})}}),Object.defineProperty(ModelType.prototype,"views",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var _this=this;return this.cloneAndEnhance({initializers:[function(self){return _this.instantiateViews(self,fn(self)),self}]})}}),Object.defineProperty(ModelType.prototype,"instantiateViews",{enumerable:!1,configurable:!0,writable:!0,value:function(self,views){if(!isPlainObject(views))throw fail("views initializer should return a plain object containing views");Object.getOwnPropertyNames(views).forEach((function(key){var _a,descriptor=Object.getOwnPropertyDescriptor(views,key);if("get"in descriptor)(0,mobx__WEBPACK_IMPORTED_MODULE_0__.n8)(self,key,descriptor),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Gn)(self,((_a={})[key]=mobx__WEBPACK_IMPORTED_MODULE_0__.EW,_a));else{if("function"!=typeof descriptor.value)throw fail("A view member should either be a function or getter based property");addHiddenFinalProp(self,key,descriptor.value)}}))}}),Object.defineProperty(ModelType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return createObjectNode(this,parent,subpath,environment,isStateTreeNode(initialValue)?initialValue:this.applySnapshotPreProcessor(initialValue))}}),Object.defineProperty(ModelType.prototype,"initializeChildNodes",{enumerable:!1,configurable:!0,writable:!0,value:function(objNode,initialSnapshot){void 0===initialSnapshot&&(initialSnapshot={});var type=objNode.type,result={};return type.forAllProps((function(name,childType){result[name]=childType.instantiate(objNode,name,void 0,initialSnapshot[name])})),result}}),Object.defineProperty(ModelType.prototype,"createNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){var options=__assign(__assign({},mobxShallow),{name:this.name});return mobx__WEBPACK_IMPORTED_MODULE_0__.sH.object(childNodes,EMPTY_OBJECT,options)}}),Object.defineProperty(ModelType.prototype,"finalizeNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(node,instance){addHiddenFinalProp(instance,"toString",objectTypeToString),this.forAllProps((function(name){(0,mobx__WEBPACK_IMPORTED_MODULE_0__.pA)(instance,name,node.unbox)})),this.initializers.reduce((function(self,fn){return fn(self)}),instance),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Zc)(instance,this.willChange),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.lB)(instance,this.didChange)}}),Object.defineProperty(ModelType.prototype,"willChange",{enumerable:!1,configurable:!0,writable:!0,value:function(chg){var change=chg,node=getStateTreeNode(change.object),subpath=change.name;node.assertWritable({subpath});var childType=node.type.properties[subpath];return childType&&(typecheckInternal(childType,change.newValue),change.newValue=childType.reconcile(node.getChildNode(subpath),change.newValue,node,subpath)),change}}),Object.defineProperty(ModelType.prototype,"didChange",{enumerable:!1,configurable:!0,writable:!0,value:function(chg){var change=chg,childNode=getStateTreeNode(change.object);if(childNode.type.properties[change.name]){var oldChildValue=change.oldValue?change.oldValue.snapshot:void 0;childNode.emitPatch({op:"replace",path:escapeJsonPath(change.name),value:change.newValue.snapshot,oldValue:oldChildValue},childNode)}}}),Object.defineProperty(ModelType.prototype,"getChildren",{enumerable:!1,configurable:!0,writable:!0,value:function(node){var _this=this,res=[];return this.forAllProps((function(name){res.push(_this.getChildNode(node,name))})),res}}),Object.defineProperty(ModelType.prototype,"getChildNode",{enumerable:!1,configurable:!0,writable:!0,value:function(node,key){var _a;if(!(key in this.properties))throw fail("Not a value property: "+key);var adm=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.Mr)(node.storedValue,key),childNode=null===(_a=adm.raw)||void 0===_a?void 0:_a.call(adm);if(!childNode)throw fail("Node not available for property "+key);return childNode}}),Object.defineProperty(ModelType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,applyPostProcess){var _this=this;void 0===applyPostProcess&&(applyPostProcess=!0);var res={};return this.forAllProps((function(name,type){try{(0,mobx__WEBPACK_IMPORTED_MODULE_0__.go)(node.storedValue,name).reportObserved()}catch(e){throw fail(name+" property is declared twice")}res[name]=_this.getChildNode(node,name).snapshot})),applyPostProcess?this.applySnapshotPostProcessor(res):res}}),Object.defineProperty(ModelType.prototype,"processInitialSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(childNodes){var processed={};return Object.keys(childNodes).forEach((function(key){processed[key]=childNodes[key].getSnapshot()})),this.applySnapshotPostProcessor(processed)}}),Object.defineProperty(ModelType.prototype,"applyPatchLocally",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath,patch){if("replace"!==patch.op&&"add"!==patch.op)throw fail("object does not support operation "+patch.op);node.storedValue[subpath]=patch.value}}),Object.defineProperty(ModelType.prototype,"applySnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node,snapshot){typecheckInternal(this,snapshot);var preProcessedSnapshot=this.applySnapshotPreProcessor(snapshot);this.forAllProps((function(name){node.storedValue[name]=preProcessedSnapshot[name]}))}}),Object.defineProperty(ModelType.prototype,"applySnapshotPreProcessor",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){var processor=this.preProcessor;return processor?processor.call(null,snapshot):snapshot}}),Object.defineProperty(ModelType.prototype,"applySnapshotPostProcessor",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){var postProcessor=this.postProcessor;return postProcessor?postProcessor.call(null,snapshot):snapshot}}),Object.defineProperty(ModelType.prototype,"getChildType",{enumerable:!1,configurable:!0,writable:!0,value:function(propertyName){return assertIsString(),this.properties[propertyName]}}),Object.defineProperty(ModelType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var _this=this,snapshot=this.applySnapshotPreProcessor(value);return isPlainObject(snapshot)?flattenTypeErrors(this.propertyNames.map((function(key){return _this.properties[key].validate(snapshot[key],getContextForPath(context,key,_this.properties[key]))}))):typeCheckFailure(context,snapshot,"Value is not a plain object")}}),Object.defineProperty(ModelType.prototype,"forAllProps",{enumerable:!1,configurable:!0,writable:!0,value:function(fn){var _this=this;this.propertyNames.forEach((function(key){return fn(key,_this.properties[key])}))}}),Object.defineProperty(ModelType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){var _this=this;return"{ "+this.propertyNames.map((function(key){return key+": "+_this.properties[key].describe()})).join("; ")+" }"}}),Object.defineProperty(ModelType.prototype,"getDefaultSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){return EMPTY_OBJECT}}),Object.defineProperty(ModelType.prototype,"removeChild",{enumerable:!1,configurable:!0,writable:!0,value:function(node,subpath){node.storedValue[subpath]=void 0}}),ModelType}(ComplexType);function isModelType(type){return isType(type)&&(type.flags&TypeFlags.Object)>0}ModelType.prototype.applySnapshot=(0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)(ModelType.prototype.applySnapshot);var CoreType=function(_super){function CoreType(name,flags,checker,initializer){void 0===initializer&&(initializer=identity);var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:flags}),Object.defineProperty(_this,"checker",{enumerable:!0,configurable:!0,writable:!0,value:checker}),Object.defineProperty(_this,"initializer",{enumerable:!0,configurable:!0,writable:!0,value:initializer}),_this.flags=flags,_this}return __extends(CoreType,_super),Object.defineProperty(CoreType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(CoreType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return createScalarNode(this,parent,subpath,environment,initialValue)}}),Object.defineProperty(CoreType.prototype,"createNewInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(snapshot){return this.initializer(snapshot)}}),Object.defineProperty(CoreType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return isPrimitive(value)&&this.checker(value)?typeCheckSuccess():typeCheckFailure(context,value,"Value is not a "+("Date"===this.name?"Date or a unix milliseconds timestamp":this.name))}}),CoreType}(SimpleType),string=new CoreType("string",TypeFlags.String,(function(v){return"string"==typeof v})),number=new CoreType("number",TypeFlags.Number,(function(v){return"number"==typeof v})),integer=new CoreType("integer",TypeFlags.Integer,(function(v){return isInteger(v)})),float=new CoreType("float",TypeFlags.Float,(function(v){return function isFloat(val){return Number(val)===val&&val%1!=0}(v)})),finite=new CoreType("finite",TypeFlags.Finite,(function(v){return function isFinite(val){return Number.isFinite(val)}(v)})),boolean=new CoreType("boolean",TypeFlags.Boolean,(function(v){return"boolean"==typeof v})),nullType=new CoreType("null",TypeFlags.Null,(function(v){return null===v})),undefinedType=new CoreType("undefined",TypeFlags.Undefined,(function(v){return void 0===v})),_DatePrimitive=new CoreType("Date",TypeFlags.Date,(function(v){return"number"==typeof v||v instanceof Date}),(function(v){return v instanceof Date?v:new Date(v)}));_DatePrimitive.getSnapshot=function(node){return node.storedValue.getTime()};var DatePrimitive=_DatePrimitive;var Literal=function(_super){function Literal(value){var _this=_super.call(this,JSON.stringify(value))||this;return Object.defineProperty(_this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Literal}),_this.value=value,_this}return __extends(Literal,_super),Object.defineProperty(Literal.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return createScalarNode(this,parent,subpath,environment,initialValue)}}),Object.defineProperty(Literal.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return JSON.stringify(this.value)}}),Object.defineProperty(Literal.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return isPrimitive(value)&&value===this.value?typeCheckSuccess():typeCheckFailure(context,value,"Value is not a literal "+JSON.stringify(this.value))}}),Literal}(SimpleType);function literal(value){return assertArg(),new Literal(value)}var Refinement=function(_super){function Refinement(name,_subtype,_predicate,_message){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"_subtype",{enumerable:!0,configurable:!0,writable:!0,value:_subtype}),Object.defineProperty(_this,"_predicate",{enumerable:!0,configurable:!0,writable:!0,value:_predicate}),Object.defineProperty(_this,"_message",{enumerable:!0,configurable:!0,writable:!0,value:_message}),_this}return __extends(Refinement,_super),Object.defineProperty(Refinement.prototype,"flags",{get:function(){return this._subtype.flags|TypeFlags.Refinement},enumerable:!1,configurable:!0}),Object.defineProperty(Refinement.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(Refinement.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return this._subtype.instantiate(parent,subpath,environment,initialValue)}}),Object.defineProperty(Refinement.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return this._subtype.isAssignableFrom(type)}}),Object.defineProperty(Refinement.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var subtypeErrors=this._subtype.validate(value,context);if(subtypeErrors.length>0)return subtypeErrors;var snapshot=isStateTreeNode(value)?getStateTreeNode(value).snapshot:value;return this._predicate(snapshot)?typeCheckSuccess():typeCheckFailure(context,value,this._message(value))}}),Object.defineProperty(Refinement.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){return this._subtype.reconcile(current,newValue,parent,subpath)}}),Object.defineProperty(Refinement.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subtype}}),Refinement}(BaseType);var Union=function(_super){function Union(name,_types,options){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"_types",{enumerable:!0,configurable:!0,writable:!0,value:_types}),Object.defineProperty(_this,"_dispatcher",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(_this,"_eager",{enumerable:!0,configurable:!0,writable:!0,value:!0}),options=__assign({eager:!0,dispatcher:void 0},options),_this._dispatcher=options.dispatcher,options.eager||(_this._eager=!1),_this}return __extends(Union,_super),Object.defineProperty(Union.prototype,"flags",{get:function(){var result=TypeFlags.Union;return this._types.forEach((function(type){result|=type.flags})),result},enumerable:!1,configurable:!0}),Object.defineProperty(Union.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return this._types.some((function(subType){return subType.isAssignableFrom(type)}))}}),Object.defineProperty(Union.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"("+this._types.map((function(factory){return factory.describe()})).join(" | ")+")"}}),Object.defineProperty(Union.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){var type=this.determineType(initialValue,void 0);if(!type)throw fail("No matching type for union "+this.describe());return type.instantiate(parent,subpath,environment,initialValue)}}),Object.defineProperty(Union.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){var type=this.determineType(newValue,current.getReconciliationType());if(!type)throw fail("No matching type for union "+this.describe());return type.reconcile(current,newValue,parent,subpath)}}),Object.defineProperty(Union.prototype,"determineType",{enumerable:!1,configurable:!0,writable:!0,value:function(value,reconcileCurrentType){return this._dispatcher?this._dispatcher(value):reconcileCurrentType?reconcileCurrentType.is(value)?reconcileCurrentType:this._types.filter((function(t){return t!==reconcileCurrentType})).find((function(type){return type.is(value)})):this._types.find((function(type){return type.is(value)}))}}),Object.defineProperty(Union.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){if(this._dispatcher)return this._dispatcher(value).validate(value,context);for(var allErrors=[],applicableTypes=0,i=0;i<this._types.length;i++){var errors=this._types[i].validate(value,context);if(0===errors.length){if(this._eager)return typeCheckSuccess();applicableTypes++}else allErrors.push(errors)}return 1===applicableTypes?typeCheckSuccess():typeCheckFailure(context,value,"No type is applicable for the union").concat(flattenTypeErrors(allErrors))}}),Object.defineProperty(Union.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._types}}),Union}(BaseType);function union(optionsOrType){for(var otherTypes=[],_i=1;_i<arguments.length;_i++)otherTypes[_i-1]=arguments[_i];var options=isType(optionsOrType)?void 0:optionsOrType,types=isType(optionsOrType)?__spread([optionsOrType],otherTypes):otherTypes,name="("+types.map((function(type){return type.name})).join(" | ")+")";return new Union(name,types,options)}var OptionalValue=function(_super){function OptionalValue(_subtype,_defaultValue,optionalValues){var _this=_super.call(this,_subtype.name)||this;return Object.defineProperty(_this,"_subtype",{enumerable:!0,configurable:!0,writable:!0,value:_subtype}),Object.defineProperty(_this,"_defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:_defaultValue}),Object.defineProperty(_this,"optionalValues",{enumerable:!0,configurable:!0,writable:!0,value:optionalValues}),_this}return __extends(OptionalValue,_super),Object.defineProperty(OptionalValue.prototype,"flags",{get:function(){return this._subtype.flags|TypeFlags.Optional},enumerable:!1,configurable:!0}),Object.defineProperty(OptionalValue.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subtype.describe()+"?"}}),Object.defineProperty(OptionalValue.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){if(this.optionalValues.indexOf(initialValue)>=0){var defaultInstanceOrSnapshot=this.getDefaultInstanceOrSnapshot();return this._subtype.instantiate(parent,subpath,environment,defaultInstanceOrSnapshot)}return this._subtype.instantiate(parent,subpath,environment,initialValue)}}),Object.defineProperty(OptionalValue.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){return this._subtype.reconcile(current,this.optionalValues.indexOf(newValue)<0&&this._subtype.is(newValue)?newValue:this.getDefaultInstanceOrSnapshot(),parent,subpath)}}),Object.defineProperty(OptionalValue.prototype,"getDefaultInstanceOrSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(){var defaultInstanceOrSnapshot="function"==typeof this._defaultValue?this._defaultValue():this._defaultValue;return"function"==typeof this._defaultValue&&typecheckInternal(this,defaultInstanceOrSnapshot),defaultInstanceOrSnapshot}}),Object.defineProperty(OptionalValue.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return this.optionalValues.indexOf(value)>=0?typeCheckSuccess():this._subtype.validate(value,context)}}),Object.defineProperty(OptionalValue.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return this._subtype.isAssignableFrom(type)}}),Object.defineProperty(OptionalValue.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._subtype}}),OptionalValue}(BaseType);function optional(type,defaultValueOrFunction,optionalValues){return function checkOptionalPreconditions(type,defaultValueOrFunction){if("function"!=typeof defaultValueOrFunction&&isStateTreeNode(defaultValueOrFunction))throw fail("default value cannot be an instance, pass a snapshot or a function that creates an instance/snapshot instead");assertIsType(type,1)}(type,defaultValueOrFunction),new OptionalValue(type,defaultValueOrFunction,optionalValues||undefinedAsOptionalValues)}var undefinedAsOptionalValues=[void 0];var optionalUndefinedType=optional(undefinedType,void 0),optionalNullType=optional(nullType,null);function maybe(type){return assertIsType(type,1),union(type,optionalUndefinedType)}var Late=function(_super){function Late(name,_definition){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"_definition",{enumerable:!0,configurable:!0,writable:!0,value:_definition}),Object.defineProperty(_this,"_subType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_this}return __extends(Late,_super),Object.defineProperty(Late.prototype,"flags",{get:function(){return(this._subType?this._subType.flags:0)|TypeFlags.Late},enumerable:!1,configurable:!0}),Object.defineProperty(Late.prototype,"getSubType",{enumerable:!1,configurable:!0,writable:!0,value:function(mustSucceed){if(!this._subType){var t=void 0;try{t=this._definition()}catch(e){if(!(e instanceof ReferenceError))throw e;t=void 0}if(mustSucceed&&void 0===t)throw fail("Late type seems to be used too early, the definition (still) returns undefined");t&&(this._subType=t)}return this._subType}}),Object.defineProperty(Late.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return this.getSubType(!0).instantiate(parent,subpath,environment,initialValue)}}),Object.defineProperty(Late.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){return this.getSubType(!0).reconcile(current,newValue,parent,subpath)}}),Object.defineProperty(Late.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=this.getSubType(!1);return t?t.name:"<uknown late type>"}}),Object.defineProperty(Late.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){var t=this.getSubType(!1);return t?t.validate(value,context):typeCheckSuccess()}}),Object.defineProperty(Late.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){var t=this.getSubType(!1);return!!t&&t.isAssignableFrom(type)}}),Object.defineProperty(Late.prototype,"getSubTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){var subtype=this.getSubType(!1);return subtype||"cannotDetermine"}}),Late}(BaseType);var Lazy=function(_super){function Lazy(name,options){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"options",{enumerable:!0,configurable:!0,writable:!0,value:options}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Lazy}),Object.defineProperty(_this,"loadedType",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(_this,"pendingNodeList",{enumerable:!0,configurable:!0,writable:!0,value:mobx__WEBPACK_IMPORTED_MODULE_0__.sH.array()}),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.z7)((function(){return _this.pendingNodeList.length>0&&_this.pendingNodeList.some((function(node){return node.isAlive&&_this.options.shouldLoadPredicate(node.parent?node.parent.value:null)}))}),(function(){_this.options.loadType().then((0,mobx__WEBPACK_IMPORTED_MODULE_0__.XI)((function(type){_this.loadedType=type,_this.pendingNodeList.forEach((function(node){node.parent&&_this.loadedType&&node.parent.applyPatches([{op:"replace",path:"/"+node.subpath,value:node.snapshot}])}))})))})),_this}return __extends(Lazy,_super),Object.defineProperty(Lazy.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"<lazy "+this.name+">"}}),Object.defineProperty(Lazy.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,value){var _this=this;if(this.loadedType)return this.loadedType.instantiate(parent,subpath,environment,value);var node=createScalarNode(this,parent,subpath,environment,value);return this.pendingNodeList.push(node),(0,mobx__WEBPACK_IMPORTED_MODULE_0__.z7)((function(){return!node.isAlive}),(function(){return _this.pendingNodeList.splice(_this.pendingNodeList.indexOf(node),1)})),node}}),Object.defineProperty(Lazy.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return this.loadedType?this.loadedType.validate(value,context):isSerializable(value)?typeCheckSuccess():typeCheckFailure(context,value,"Value is not serializable and cannot be lazy")}}),Object.defineProperty(Lazy.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,value,parent,subpath){return this.loadedType?(current.die(),this.loadedType.instantiate(parent,subpath,parent.environment,value)):_super.prototype.reconcile.call(this,current,value,parent,subpath)}}),Lazy}(SimpleType),Frozen=function(_super){function Frozen(subType){var _this=_super.call(this,subType?"frozen("+subType.name+")":"frozen")||this;return Object.defineProperty(_this,"subType",{enumerable:!0,configurable:!0,writable:!0,value:subType}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Frozen}),_this}return __extends(Frozen,_super),Object.defineProperty(Frozen.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"<any immutable value>"}}),Object.defineProperty(Frozen.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,value){return createScalarNode(this,parent,subpath,environment,value)}}),Object.defineProperty(Frozen.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return isSerializable(value)?this.subType?this.subType.validate(value,context):typeCheckSuccess():typeCheckFailure(context,value,"Value is not serializable and cannot be frozen")}}),Frozen}(SimpleType),untypedFrozenInstance=new Frozen;var StoredReference=function(){function StoredReference(value,targetType){if(Object.defineProperty(this,"targetType",{enumerable:!0,configurable:!0,writable:!0,value:targetType}),Object.defineProperty(this,"identifier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolvedReference",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),isValidIdentifier(value))this.identifier=value;else{if(!isStateTreeNode(value))throw fail("Can only store references to tree nodes or identifiers, got: '"+value+"'");var targetNode=getStateTreeNode(value);if(!targetNode.identifierAttribute)throw fail("Can only store references with a defined identifier attribute.");var id=targetNode.unnormalizedIdentifier;if(null==id)throw fail("Can only store references to tree nodes with a defined identifier.");this.identifier=id}}return Object.defineProperty(StoredReference.prototype,"updateResolvedReference",{enumerable:!1,configurable:!0,writable:!0,value:function(node){var normalizedId=normalizeIdentifier(this.identifier),root=node.root,lastCacheModification=root.identifierCache.getLastCacheModificationPerId(normalizedId);if(!this.resolvedReference||this.resolvedReference.lastCacheModification!==lastCacheModification){var targetType=this.targetType,target=root.identifierCache.resolve(targetType,normalizedId);if(!target)throw new InvalidReferenceError("[mobx-state-tree] Failed to resolve reference '"+this.identifier+"' to type '"+this.targetType.name+"' (from node: "+node.path+")");this.resolvedReference={node:target,lastCacheModification}}}}),Object.defineProperty(StoredReference.prototype,"resolvedValue",{get:function(){return this.updateResolvedReference(this.node),this.resolvedReference.node.value},enumerable:!1,configurable:!0}),StoredReference}(),InvalidReferenceError=function(_super){function InvalidReferenceError(m){var _this=_super.call(this,m)||this;return Object.setPrototypeOf(_this,InvalidReferenceError.prototype),_this}return __extends(InvalidReferenceError,_super),InvalidReferenceError}(Error),BaseReferenceType=function(_super){function BaseReferenceType(targetType,onInvalidated){var _this=_super.call(this,"reference("+targetType.name+")")||this;return Object.defineProperty(_this,"targetType",{enumerable:!0,configurable:!0,writable:!0,value:targetType}),Object.defineProperty(_this,"onInvalidated",{enumerable:!0,configurable:!0,writable:!0,value:onInvalidated}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Reference}),_this}return __extends(BaseReferenceType,_super),Object.defineProperty(BaseReferenceType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(BaseReferenceType.prototype,"isAssignableFrom",{enumerable:!1,configurable:!0,writable:!0,value:function(type){return this.targetType.isAssignableFrom(type)}}),Object.defineProperty(BaseReferenceType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return isValidIdentifier(value)?typeCheckSuccess():typeCheckFailure(context,value,"Value is not a valid identifier, which is a string or a number")}}),Object.defineProperty(BaseReferenceType.prototype,"fireInvalidated",{enumerable:!1,configurable:!0,writable:!0,value:function(cause,storedRefNode,referenceId,refTargetNode){var storedRefParentNode=storedRefNode.parent;if(storedRefParentNode&&storedRefParentNode.isAlive){var storedRefParentValue=storedRefParentNode.storedValue;storedRefParentValue&&this.onInvalidated({cause,parent:storedRefParentValue,invalidTarget:refTargetNode?refTargetNode.storedValue:void 0,invalidId:referenceId,replaceRef:function(newRef){applyPatch(storedRefNode.root.storedValue,{op:"replace",value:newRef,path:storedRefNode.path})},removeRef:function(){isModelType(storedRefParentNode.type)?this.replaceRef(void 0):applyPatch(storedRefNode.root.storedValue,{op:"remove",path:storedRefNode.path})}})}}}),Object.defineProperty(BaseReferenceType.prototype,"addTargetNodeWatcher",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode,referenceId){var _this=this,refTargetValue=this.getValue(storedRefNode);if(refTargetValue){var refTargetNode=getStateTreeNode(refTargetValue),hookHandler=function(_,refTargetNodeHook){var cause=function getInvalidationCause(hook){switch(hook){case Hook.beforeDestroy:return"destroy";case Hook.beforeDetach:return"detach";default:return}}(refTargetNodeHook);cause&&_this.fireInvalidated(cause,storedRefNode,referenceId,refTargetNode)},refTargetDetachHookDisposer=refTargetNode.registerHook(Hook.beforeDetach,hookHandler),refTargetDestroyHookDisposer=refTargetNode.registerHook(Hook.beforeDestroy,hookHandler);return function(){refTargetDetachHookDisposer(),refTargetDestroyHookDisposer()}}}}),Object.defineProperty(BaseReferenceType.prototype,"watchTargetNodeForInvalidations",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode,identifier,customGetSet){var _this=this;if(this.onInvalidated){var onRefTargetDestroyedHookDisposer;storedRefNode.registerHook(Hook.beforeDestroy,(function(){onRefTargetDestroyedHookDisposer&&onRefTargetDestroyedHookDisposer()}));var startWatching=function(sync){onRefTargetDestroyedHookDisposer&&onRefTargetDestroyedHookDisposer();var storedRefParentNode=storedRefNode.parent,storedRefParentValue=storedRefParentNode&&storedRefParentNode.storedValue;if(storedRefParentNode&&storedRefParentNode.isAlive&&storedRefParentValue){(customGetSet?!!customGetSet.get(identifier,storedRefParentValue):storedRefNode.root.identifierCache.has(_this.targetType,normalizeIdentifier(identifier)))?onRefTargetDestroyedHookDisposer=_this.addTargetNodeWatcher(storedRefNode,identifier):sync||_this.fireInvalidated("invalidSnapshotReference",storedRefNode,identifier,null)}};storedRefNode.state===NodeLifeCycle.FINALIZED?startWatching(!0):(storedRefNode.isRoot||storedRefNode.root.registerHook(Hook.afterCreationFinalization,(function(){storedRefNode.parent&&storedRefNode.parent.createObservableInstanceIfNeeded()})),storedRefNode.registerHook(Hook.afterAttach,(function(){startWatching(!1)})))}}}),BaseReferenceType}(SimpleType),IdentifierReferenceType=function(_super){function IdentifierReferenceType(targetType,onInvalidated){return _super.call(this,targetType,onInvalidated)||this}return __extends(IdentifierReferenceType,_super),Object.defineProperty(IdentifierReferenceType.prototype,"getValue",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode){if(storedRefNode.isAlive)return storedRefNode.storedValue.resolvedValue}}),Object.defineProperty(IdentifierReferenceType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode){return storedRefNode.storedValue.identifier}}),Object.defineProperty(IdentifierReferenceType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){var identifier=isStateTreeNode(initialValue)?function getIdentifier(target){return assertIsStateTreeNode(target,1),getStateTreeNode(target).identifier}(initialValue):initialValue,storedRef=new StoredReference(initialValue,this.targetType),storedRefNode=createScalarNode(this,parent,subpath,environment,storedRef);return storedRef.node=storedRefNode,this.watchTargetNodeForInvalidations(storedRefNode,identifier,void 0),storedRefNode}}),Object.defineProperty(IdentifierReferenceType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){if(!current.isDetaching&&current.type===this){var compareByValue=isStateTreeNode(newValue),ref=current.storedValue;if(!compareByValue&&ref.identifier===newValue||compareByValue&&ref.resolvedValue===newValue)return current.setParent(parent,subpath),current}var newNode=this.instantiate(parent,subpath,void 0,newValue);return current.die(),newNode}}),IdentifierReferenceType}(BaseReferenceType),CustomReferenceType=function(_super){function CustomReferenceType(targetType,options,onInvalidated){var _this=_super.call(this,targetType,onInvalidated)||this;return Object.defineProperty(_this,"options",{enumerable:!0,configurable:!0,writable:!0,value:options}),_this}return __extends(CustomReferenceType,_super),Object.defineProperty(CustomReferenceType.prototype,"getValue",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode){if(storedRefNode.isAlive)return this.options.get(storedRefNode.storedValue,storedRefNode.parent?storedRefNode.parent.storedValue:null)}}),Object.defineProperty(CustomReferenceType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(storedRefNode){return storedRefNode.storedValue}}),Object.defineProperty(CustomReferenceType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,newValue){var identifier=isStateTreeNode(newValue)?this.options.set(newValue,parent?parent.storedValue:null):newValue,storedRefNode=createScalarNode(this,parent,subpath,environment,identifier);return this.watchTargetNodeForInvalidations(storedRefNode,identifier,this.options),storedRefNode}}),Object.defineProperty(CustomReferenceType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){var newIdentifier=isStateTreeNode(newValue)?this.options.set(newValue,current?current.storedValue:null):newValue;if(!current.isDetaching&&current.type===this&&current.storedValue===newIdentifier)return current.setParent(parent,subpath),current;var newNode=this.instantiate(parent,subpath,void 0,newIdentifier);return current.die(),newNode}}),CustomReferenceType}(BaseReferenceType);function reference(subType,options){assertIsType(subType,1);var getSetOptions=options||void 0,onInvalidated=options?options.onInvalidated:void 0;return getSetOptions&&(getSetOptions.get||getSetOptions.set)?new CustomReferenceType(subType,{get:getSetOptions.get,set:getSetOptions.set},onInvalidated):new IdentifierReferenceType(subType,onInvalidated)}var BaseIdentifierType=function(_super){function BaseIdentifierType(name,validType){var _this=_super.call(this,name)||this;return Object.defineProperty(_this,"validType",{enumerable:!0,configurable:!0,writable:!0,value:validType}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Identifier}),_this}return __extends(BaseIdentifierType,_super),Object.defineProperty(BaseIdentifierType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){if(!(parent&&parent.type instanceof ModelType))throw fail("Identifier types can only be instantiated as direct child of a model type");return createScalarNode(this,parent,subpath,environment,initialValue)}}),Object.defineProperty(BaseIdentifierType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,newValue,parent,subpath){if(current.storedValue!==newValue)throw fail("Tried to change identifier from '"+current.storedValue+"' to '"+newValue+"'. Changing identifiers is not allowed.");return current.setParent(parent,subpath),current}}),Object.defineProperty(BaseIdentifierType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){return typeof value!==this.validType?typeCheckFailure(context,value,"Value is not a valid "+this.describe()+", expected a "+this.validType):typeCheckSuccess()}}),BaseIdentifierType}(SimpleType),IdentifierType=function(_super){function IdentifierType(){var _this=_super.call(this,"identifier","string")||this;return Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Identifier}),_this}return __extends(IdentifierType,_super),Object.defineProperty(IdentifierType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"identifier"}}),IdentifierType}(BaseIdentifierType),IdentifierNumberType=function(_super){function IdentifierNumberType(){return _super.call(this,"identifierNumber","number")||this}return __extends(IdentifierNumberType,_super),Object.defineProperty(IdentifierNumberType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return node.storedValue}}),Object.defineProperty(IdentifierNumberType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"identifierNumber"}}),IdentifierNumberType}(BaseIdentifierType),identifier=new IdentifierType,identifierNumber=new IdentifierNumberType;function normalizeIdentifier(id){return""+id}function isValidIdentifier(id){return"string"==typeof id||"number"==typeof id}var CustomType=function(_super){function CustomType(options){var _this=_super.call(this,options.name)||this;return Object.defineProperty(_this,"options",{enumerable:!0,configurable:!0,writable:!0,value:options}),Object.defineProperty(_this,"flags",{enumerable:!0,configurable:!0,writable:!0,value:TypeFlags.Custom}),_this}return __extends(CustomType,_super),Object.defineProperty(CustomType.prototype,"describe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.name}}),Object.defineProperty(CustomType.prototype,"isValidSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(value,context){if(this.options.isTargetType(value))return typeCheckSuccess();var typeError=this.options.getValidationMessage(value);return typeError?typeCheckFailure(context,value,"Invalid value for type '"+this.name+"': "+typeError):typeCheckSuccess()}}),Object.defineProperty(CustomType.prototype,"getSnapshot",{enumerable:!1,configurable:!0,writable:!0,value:function(node){return this.options.toSnapshot(node.storedValue)}}),Object.defineProperty(CustomType.prototype,"instantiate",{enumerable:!1,configurable:!0,writable:!0,value:function(parent,subpath,environment,initialValue){return createScalarNode(this,parent,subpath,environment,this.options.isTargetType(initialValue)?initialValue:this.options.fromSnapshot(initialValue,parent&&parent.root.environment))}}),Object.defineProperty(CustomType.prototype,"reconcile",{enumerable:!1,configurable:!0,writable:!0,value:function(current,value,parent,subpath){var isSnapshot=!this.options.isTargetType(value);if(!current.isDetaching&&(current.type===this&&(isSnapshot?value===current.snapshot:value===current.storedValue)))return current.setParent(parent,subpath),current;var valueToStore=isSnapshot?this.options.fromSnapshot(value,parent.root.environment):value,newNode=this.instantiate(parent,subpath,void 0,valueToStore);return current.die(),newNode}}),CustomType}(SimpleType),types={enumeration:function enumeration(name,options){var realOptions="string"==typeof name?options:name,type=union.apply(void 0,__spread(realOptions.map((function(option){return literal(""+option)}))));return"string"==typeof name&&(type.name=name),type},model:function model(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var name="string"==typeof args[0]?args.shift():"AnonymousModel",properties=args.shift()||{};return new ModelType({name,properties})},compose:function compose(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var hasTypename="string"==typeof args[0],typeName=hasTypename?args[0]:"AnonymousModel";return hasTypename&&args.shift(),args.reduce((function(prev,cur){return prev.cloneAndEnhance({name:prev.name+"_"+cur.name,properties:cur.properties,initializers:cur.initializers,preProcessor:function(snapshot){return cur.applySnapshotPreProcessor(prev.applySnapshotPreProcessor(snapshot))},postProcessor:function(snapshot){return cur.applySnapshotPostProcessor(prev.applySnapshotPostProcessor(snapshot))}})})).named(typeName)},custom:function custom(options){return new CustomType(options)},reference,safeReference:function safeReference(subType,options){var refType=reference(subType,__assign(__assign({},options),{onInvalidated:function(ev){options&&options.onInvalidated&&options.onInvalidated(ev),ev.removeRef()}}));return options&&!1===options.acceptsUndefined?refType:maybe(refType)},union,optional,literal,maybe,maybeNull:function maybeNull(type){return assertIsType(type,1),union(type,optionalNullType)},refinement:function refinement(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var name="string"==typeof args[0]?args.shift():isType(args[0])?args[0].name:null,type=args[0],predicate=args[1],message=args[2]?args[2]:function(v){return"Value does not respect the refinement predicate"};return assertIsType(type,[1,2]),assertIsString(),assertIsFunction(),assertIsFunction(),new Refinement(name,type,predicate,message)},string,boolean,number,integer,float,finite,Date:DatePrimitive,map:function map(subtype){return new MapType("Map<string, "+subtype.name+">",subtype)},array:function array(subtype){return assertIsType(subtype,1),new ArrayType(subtype.name+"[]",subtype)},frozen:function frozen(arg){return 0===arguments.length?untypedFrozenInstance:isType(arg)?new Frozen(arg):optional(untypedFrozenInstance,arg)},identifier,identifierNumber,late:function late(nameOrType,maybeType){var name="string"==typeof nameOrType?nameOrType:"late("+nameOrType.toString()+")",type="string"==typeof nameOrType?maybeType:nameOrType;return new Late(name,type)},lazy:function lazy(name,options){return new Lazy(name,options)},undefined:undefinedType,null:nullType,snapshotProcessor:function snapshotProcessor(type,processors,name){return assertIsType(type,1),new SnapshotProcessor(type,processors,name)}}}}]);