{"version":3,"file":"screens-SubjectTalkPage-components-SubjectTalkData-components-Discussion-Discussion-stories.7e920cc3.iframe.bundle.js","mappings":";;;;;;;;;;AAkBA;;ACGA;AACA;;AAMA","sources":["webpack://@zooniverse/fe-project/./src/screens/SubjectTalkPage/components/SubjectTalkData/components/PlainButton/PlainButton.jsx","webpack://@zooniverse/fe-project/./src/screens/SubjectTalkPage/components/SubjectTalkData/components/Discussion/Discussion.jsx"],"sourcesContent":["import { SpacedText } from '@zooniverse/react-components'\nimport { Button } from 'grommet'\nimport styled from 'styled-components'\n\n// to be used with Add a Tag, comments' Newest/Oldest First, and (eventually) Classify this Subject\n\nconst StyledButton = styled(Button)`\n  &:focus,\n  &:hover {\n    text-decoration: underline;\n  }\n\n  &:disabled {\n    cursor: not-allowed;\n    text-decoration: none;\n  }\n`\n\nconst DEFAULT_HANDLER = () => true\n\nfunction PlainButton({\n  icon,\n  onClick = DEFAULT_HANDLER,\n  text = '',\n  ...props\n}) {\n  return (\n    <StyledButton\n      gap='xsmall'\n      icon={icon}\n      label={\n        <SpacedText\n          color={{ dark: 'accent-1', light: 'neutral-1' }}\n          size='1rem'\n          weight={500}\n        >\n          {text}\n        </SpacedText>\n      }\n      plain\n      onClick={onClick}\n      {...props}\n    />\n  )\n}\n\nexport default PlainButton\n","import { Loader, SpacedText } from '@zooniverse/react-components'\nimport { Anchor, Box, Text } from 'grommet'\nimport { Down, FormNext, Up } from 'grommet-icons'\nimport { useTranslation } from 'next-i18next'\nimport { number, shape, string } from 'prop-types'\nimport { useState } from 'react'\nimport styled from 'styled-components'\n\nimport addQueryParams from '@helpers/addQueryParams'\nimport {\n  useComments,\n  usePanoptesUsers,\n  useTalkRoles\n} from '@hooks'\n\nimport ParticipantsAndComments from '../ParticipantsAndComments'\nimport PlainButton from '../PlainButton'\nimport TalkComment from '../TalkComment'\n\nconst StyledBox = styled(Box)`\n  border-radius: 4px 0 0 0;\n  border-left: 4px solid ${props => props.theme.dark ? props.theme.global.colors['accent-1'] : props.theme.global.colors['neutral-1']};\n`\n\nconst StyledOrderedList = styled(Box)`\n  list-style: none;\n`\n\nfunction Discussion({ discussion, login }) {\n  const [sort, setSort] = useState('-created_at')\n\n  const { t } = useTranslation('screens')\n\n  const commentsQuery = {\n    discussion_id: discussion.id,\n    sort,\n    page_size: 10,\n  }\n  \n  const {\n    data: comments,\n    isLoading,\n    error\n  } = useComments(commentsQuery)\n\n  const userIds = comments?.map(comment => comment.user_id)\n  const uniqueUserIds = [...new Set(userIds)]\n  const userIdsString = uniqueUserIds.join(',')\n  \n  const {\n    data: users,\n    isLoading: usersLoading,\n    error: usersError\n  } = usePanoptesUsers({ id: userIdsString })\n\n  const {\n    data: roles,\n    isLoading: rolesLoading,\n    error: rolesError\n  } = useTalkRoles({\n    is_shown: true,\n    section: `zooniverse,${discussion.section}`,\n    user_id: userIdsString\n  })\n  \n  const showChronologicalSort = discussion.comments_count > 1\n  const sortButtonLabel = sort === 'created_at' ? t('Talk.Discussions.sortedOldestFirst') : t('Talk.Discussions.sortedNewestFirst')\n\n  function handleSortChange() {\n    setSort(prevSort => (\n      prevSort === 'created_at' ?\n        '-created_at'\n        : 'created_at'\n    ))\n  }\n\n  return (\n    <Box gap='small'>\n      <Box\n        align='center'\n        direction='row-responsive'\n        justify='between'\n      >\n        <Box\n          align='center'\n          direction='row'\n          gap='small'\n        >\n          <StyledBox\n            align='center'\n            direction='row'\n            pad={{ horizontal:'xxsmall' }}\n          >\n            <Anchor\n              href={addQueryParams(`/projects/${discussion.project_slug}/talk/${discussion.board_id}`)}\n              label={discussion.board_title}\n              size='1rem'\n            />\n            <FormNext\n              color={{ dark: 'accent-1', light: 'neutral-1' }}\n              size='16px'\n            />\n            <Anchor\n              href={addQueryParams(`/projects/${discussion.project_slug}/talk/${discussion.board_id}/${discussion.id}`)}\n              label={discussion.title}\n              size='1rem'\n            />\n          </StyledBox>\n          <ParticipantsAndComments\n            commentsCount={discussion.comments_count}\n            usersCount={discussion.users_count}\n          />\n        </Box>\n        <Box\n          align='center'\n          alignSelf='end'\n          direction='row'\n          gap='xsmall'\n        >\n          {showChronologicalSort && (\n            <Box\n              align='center'\n              direction='row'\n              gap='xxsmall'\n            >\n              <PlainButton\n                margin={{ left: 'xsmall' }}\n                onClick={handleSortChange}\n                text={sortButtonLabel}\n              />\n              {sort === 'created_at' ? (\n                <Up\n                  color={{ dark: 'accent-1', light: 'neutral-1' }}\n                  size='12px'\n                />\n              ) : (\n                <Down\n                  color={{ dark: 'accent-1', light: 'neutral-1' }}\n                  size='12px'\n                />\n              )}\n            </Box>\n          )}\n        </Box>\n      </Box>\n      <StyledOrderedList\n        forwardedAs='ol'\n        gap='small'\n        margin='none'\n        pad='none'\n      >\n        {error ? (\n          <Box align='center' justify='center' fill pad='medium'>\n            <SpacedText uppercase={false}>\n              {t('Talk.somethingWentWrong')}\n            </SpacedText>\n          </Box>\n        ) : isLoading ? (\n          <Box align='center' justify='center' fill pad='medium'>\n            <Loader />\n          </Box>\n        ) : comments?.map((comment) => {\n          const author = users?.find(user => user.id === comment.user_id)\n\n          const authorRoles = roles?.filter(role => role.user_id === author?.id)\n\n          return (\n            <li key={comment.id}>\n              <TalkComment\n                avatar={author?.avatar_src}\n                comment={comment}\n                login={login}\n                roles={authorRoles}\n              />\n            </li>\n          )\n        })}\n      </StyledOrderedList>\n      <Text size='1rem'>\n        {t('Talk.Discussions.commentsViewing', { count: comments?.length, total: discussion.comments_count })}\n      </Text>\n    </Box>\n  )\n}\n\nDiscussion.propTypes = {\n  discussion: shape({\n    id: string,\n    comments_count: number,\n    section: string,\n    title: string,\n    users_count: number\n  }),\n  login: string\n}\n\nexport default Discussion\n"],"names":[],"ignoreList":[],"sourceRoot":""}