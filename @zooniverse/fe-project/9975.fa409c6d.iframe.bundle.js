"use strict";(self.webpackChunk_zooniverse_fe_project=self.webpackChunk_zooniverse_fe_project||[]).push([[9975],{"../lib-async-states/src/async-states.js"(module){const asyncStates={};Object.defineProperty(asyncStates,"initialized",{value:"initialized",enumerable:!0}),Object.defineProperty(asyncStates,"loading",{value:"loading",enumerable:!0}),Object.defineProperty(asyncStates,"putting",{value:"putting",enumerable:!0}),Object.defineProperty(asyncStates,"posting",{value:"posting",enumerable:!0}),Object.defineProperty(asyncStates,"success",{value:"success",enumerable:!0}),Object.defineProperty(asyncStates,"error",{value:"error",enumerable:!0}),Object.defineProperty(asyncStates,"values",{value:Object.values(asyncStates)}),module.exports=asyncStates},"./src/helpers/getCookie/index.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>getCookie});var dist=__webpack_require__("./node_modules/cookie/dist/index.js");function getCookie(name){var _document;if(null===(_document=document)||void 0===_document?void 0:_document.cookie){const parsedCookie=dist.qg(document.cookie);return parsedCookie&&parsedCookie[name]?parsedCookie[name]:""}return""}},"./src/helpers/logger/logToSentry.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>logToSentry});var _sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/@sentry/core/build/esm/exports.js"),_sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/@sentry/core/build/esm/currentScopes.js"),process=__webpack_require__("../../node_modules/process/browser.js");function logToSentry(error,errorInfo={}){return process.env.SENTRY_PROJECT_DSN&&(0,_sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__.v4)(scope=>{Object.keys(errorInfo).forEach(key=>{scope.setExtra(key,errorInfo[key])}),(0,_sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__.Cp)(error)}),null}},"./stores/Store.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>stores_Store});var async_states=__webpack_require__("../lib-async-states/src/async-states.js"),async_states_default=__webpack_require__.n(async_states),mobx_state_tree_module=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),mobx_esm=__webpack_require__("../../node_modules/mobx/dist/mobx.esm.js"),logToSentry=__webpack_require__("./src/helpers/logger/logToSentry.js");const types_numberString=mobx_state_tree_module.gK.refinement("numberString",mobx_state_tree_module.gK.string,value=>/^\d+$/.test(value)),TranslationStrings=mobx_state_tree_module.gK.map(mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string)),stores_Organization=mobx_state_tree_module.gK.model("Organization",{id:mobx_state_tree_module.gK.maybeNull(types_numberString),display_name:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),listed:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),primary_language:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,"en"),slug:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),strings:TranslationStrings}).views(self=>({get title(){return self.strings.get("title")}})),Project_TranslationStrings=mobx_state_tree_module.gK.map(mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string)),stores_Project=mobx_state_tree_module.gK.model("Project",{about_pages:mobx_state_tree_module.gK.frozen([]),avatar:mobx_state_tree_module.gK.frozen({}),background:mobx_state_tree_module.gK.frozen({}),beta_approved:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),beta_requested:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),classifications_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),classifiers_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),configuration:mobx_state_tree_module.gK.frozen({}),completeness:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),error:mobx_state_tree_module.gK.frozen({}),experimental_tools:mobx_state_tree_module.gK.frozen([]),id:mobx_state_tree_module.gK.maybeNull(types_numberString),launch_approved:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),links:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),live:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),primary_language:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,"en"),owners:mobx_state_tree_module.gK.frozen([]),retired_subjects_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),slug:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.string,""),strings:Project_TranslationStrings,subjects_count:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),urls:mobx_state_tree_module.gK.frozen([])}).views(self=>({get baseUrl(){return`/${self.slug}`},get defaultWorkflow(){let singleActiveWorkflow;return 1===self.links.active_workflows.length&&([singleActiveWorkflow]=self.links.active_workflows),singleActiveWorkflow},get description(){return self.strings.get("description")},get display_name(){return self.strings.get("display_name")},get displayName(){return self.display_name},get hasResultsPage(){return!!self.about_pages.find(page=>"results"===page.url_key)},get introduction(){return self.strings.get("introduction")},get isComplete(){return 1===self.completeness},get inBeta(){return!self.launch_approved&&self.beta_approved},get researcher_quote(){return self.strings.get("researcher_quote")},get title(){return self.strings.get("title")},get workflow_description(){return self.strings.get("workflow_description")},workflowIsActive:workflowId=>self.links.active_workflows.includes(workflowId)}));var dist=__webpack_require__("./node_modules/cookie/dist/index.js"),string_hash=__webpack_require__("../../node_modules/@sindresorhus/string-hash/index.js"),string_hash_default=__webpack_require__.n(string_hash),getCookie=__webpack_require__("./src/helpers/getCookie/index.js"),process=__webpack_require__("../../node_modules/process/browser.js");const canSetCookie=process.browser||"test"===process.env.BABEL_ENV,stores_UI=mobx_state_tree_module.gK.model("UI",{authModalActiveIndex:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,-1),dismissedProjectAnnouncementBanner:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.number)}).views(self=>({get showAnnouncement(){const{announcement}=(0,mobx_state_tree_module.Zn)(self).project.configuration;return!announcement||string_hash_default()(announcement)!==self.dismissedProjectAnnouncementBanner}})).preProcessSnapshot(snapshot=>({dismissedProjectAnnouncementBanner:snapshot&&snapshot.dismissedProjectAnnouncementBanner?parseInt(snapshot.dismissedProjectAnnouncementBanner,10):void 0})).actions(self=>({afterAttach(){self.createDismissedProjectAnnouncementBannerObserver()},createDismissedProjectAnnouncementBannerObserver(){const dismissedProjectAnnouncementBannerDisposer=(0,mobx_esm.fm)(()=>{(0,mobx_state_tree_module.k4)(self,patch=>{const{path}=patch,isCorrectPath="/dismissedProjectAnnouncementBanner"===path,parsedCookie=dist.qg(document.cookie)||{},cookieIsStale=parseInt(parsedCookie.dismissedProjectAnnouncementBanner,10)!==self.dismissedProjectAnnouncementBanner;canSetCookie&&isCorrectPath&&cookieIsStale&&self.setProjectAnnouncementBannerCookie()})},{name:"updateDismissedProjectAnnouncementBannerCookie"});(0,mobx_state_tree_module.LF)(self,dismissedProjectAnnouncementBannerDisposer)},dismissProjectAnnouncementBanner(){const{announcement}=(0,mobx_state_tree_module.Zn)(self).project.configuration,announcementHash=string_hash_default()(announcement);self.dismissedProjectAnnouncementBanner=announcementHash},readCookies(){canSetCookie&&(self.dismissedProjectAnnouncementBanner=parseInt((0,getCookie.A)("dismissedProjectAnnouncementBanner"),10)||null)},setAuthModalActiveIndex(index){self.authModalActiveIndex=index},setProjectAnnouncementBannerCookie(){const{slug}=(0,mobx_state_tree_module.Zn)(self).project;document.cookie=dist.lK("dismissedProjectAnnouncementBanner",self.dismissedProjectAnnouncementBanner,{domain:getCookieDomain(),path:`/projects/${slug}`})}}));function getCookieDomain(){return"zooniverse.org"}var auth=__webpack_require__("../../node_modules/panoptes-client/lib/auth.js"),auth_default=__webpack_require__.n(auth),Collections=__webpack_require__("./stores/User/Collections/Collections.js"),console=__webpack_require__("../../node_modules/console-browserify/index.js");const Recent=mobx_state_tree_module.gK.model("Recent",{favorite:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),subjectId:mobx_state_tree_module.gK.string,locations:mobx_state_tree_module.gK.frozen({})}).actions(self=>({toggleFavourite:function toggleFavourite(){const{collections}=(0,mobx_state_tree_module.k2)(self,User_User);self.favorite=!self.favorite,self.favorite?collections.addFavourites([self.subjectId]):collections.removeFavourites([self.subjectId])}})),Recents_Recents=mobx_state_tree_module.gK.model("Recents",{error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),recents:mobx_state_tree_module.gK.array(Recent),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized)}).actions(self=>({fetch:(0,mobx_state_tree_module.L3)(function*fetch(){const{client,project,user}=(0,mobx_state_tree_module.Zn)(self);self.loadingState=async_states_default().loading;try{const authorization=`Bearer ${yield auth_default().checkBearerToken()}`,query={project_id:project.id,sort:"-created_at"},response=yield client.panoptes.get(`/users/${user.id}/recents`,query,{authorization}),{recents}=response.body;self.recents=recents.map(recent=>({subjectId:recent.links.subject,locations:recent.locations})),self.loadingState=async_states_default().success}catch(error){console.error(error),self.error=error,self.loadingState=async_states_default().error}}),add({subjectId,favorite=!1,locations}){self.recents.unshift(Recent.create({subjectId,favorite,locations}))}}));var src=__webpack_require__("../lib-panoptes-js/src/index.js");var Notifications_console=__webpack_require__("../../node_modules/console-browserify/index.js");let sugarClient;!async function initSugarClient(){{const sugarModule=await Promise.all([__webpack_require__.e(7588),__webpack_require__.e(6857)]).then(__webpack_require__.t.bind(__webpack_require__,"../../node_modules/panoptes-client/lib/sugar.js",23));sugarClient=sugarModule.sugarClient}}();const Notifications_Notifications=mobx_state_tree_module.gK.model("Notifications",{unreadConversationsIds:mobx_state_tree_module.gK.array(mobx_state_tree_module.gK.string),unreadNotificationsCount:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0),error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized)}).actions(self=>({fetchAndSubscribe(){self.fetchInitialUnreadConversationsIds(),self.fetchInitialUnreadNotificationsCount(),self.subscribeToSugarNotifications()},fetchInitialUnreadConversationsIds:(0,mobx_state_tree_module.L3)(function*fetchInitialUnreadConversationsIds(){self.setLoadingState(async_states_default().loading);try{const authorization=`Bearer ${yield auth_default().checkBearerToken()}`,unreadConversationsIds=yield async function getUnreadConversationsIds(authorization){if(!authorization)return[];let unreadConversationsIds=[];return async function getConversations(page=1){const query={unread:!0,page},response=await src.Hv.get("/conversations",query,{authorization}),{meta,conversations}=(null==response?void 0:response.body)||{};return conversations&&conversations.length&&(unreadConversationsIds=unreadConversationsIds.concat(conversations.map(conversation=>conversation.id))),(null==meta?void 0:meta.next_page)?getConversations(meta.next_page):unreadConversationsIds}(1)}(authorization);self.unreadConversationsIds=unreadConversationsIds,self.setLoadingState(async_states_default().success)}catch(error){self.handleError(error)}}),fetchInitialUnreadNotificationsCount:(0,mobx_state_tree_module.L3)(function*fetchInitialUnreadNotificationsCount(){self.setLoadingState(async_states_default().loading);try{const authorization=`Bearer ${yield auth_default().checkBearerToken()}`;let unreadNotificationsCount=0;unreadNotificationsCount=yield async function getUnreadNotificationsCount(authorization){if(!authorization)return;return src.Hv.get("/notifications",{delivered:!1,page_size:1},{authorization}).then(response=>{var _response_body_meta_notifications,_response_body_meta,_response_body;return null==response||null===(_response_body=response.body)||void 0===_response_body||null===(_response_body_meta=_response_body.meta)||void 0===_response_body_meta||null===(_response_body_meta_notifications=_response_body_meta.notifications)||void 0===_response_body_meta_notifications?void 0:_response_body_meta_notifications.count})}(authorization),self.unreadNotificationsCount=unreadNotificationsCount,self.setLoadingState(async_states_default().success)}catch(error){self.handleError(error)}}),processSugarNotification(notification){if("Moderation"!==(null==notification?void 0:notification.data.source_type)&&(self.unreadNotificationsCount=self.unreadNotificationsCount+1),"Message"===(null==notification?void 0:notification.data.source_type)){const conversationId=notification.data.url.split("/").pop();self.unreadConversationsIds.includes(conversationId)||self.unreadConversationsIds.push(conversationId)}},subscribeToSugarNotifications(){const{user}=(0,mobx_state_tree_module.Zn)(self);try{sugarClient.subscribeTo(`user:${user.id}`),sugarClient.on("notification",notification=>self.processSugarNotification(notification))}catch(error){self.handleError(error)}},unsubscribeFromSugarNotifications(){const{user}=(0,mobx_state_tree_module.Zn)(self);if(user)try{sugarClient.unsubscribeFrom(`user:${null==user?void 0:user.id}`)}catch(error){self.handleError(error)}},handleError(error){Notifications_console.error(error),self.error=error,self.setLoadingState(async_states_default().error)},setLoadingState(state){self.loadingState=state},reset(){this.unsubscribeFromSugarNotifications(),self.unreadConversationsIds=[],self.unreadNotificationsCount=0,self.error=void 0,this.setLoadingState(async_states_default().initialized)}}));var UserProjectPreferences_console=__webpack_require__("../../node_modules/console-browserify/index.js");const Preferences=mobx_state_tree_module.gK.model("Preferences",{minicourses:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen()),selected_workflow:mobx_state_tree_module.gK.maybe(types_numberString),tutorials_completed_at:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen())}),Settings=mobx_state_tree_module.gK.model("Settings",{workflow_id:mobx_state_tree_module.gK.maybe(types_numberString)}).preProcessSnapshot(snapshot=>{var _snapshot_workflow_id;if(!snapshot)return snapshot;return{...snapshot,workflow_id:null==snapshot||null===(_snapshot_workflow_id=snapshot.workflow_id)||void 0===_snapshot_workflow_id?void 0:_snapshot_workflow_id.toString()}}),UserProjectPreferences_UserProjectPreferences=mobx_state_tree_module.gK.model("UserProjectPreferences",{error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),id:mobx_state_tree_module.gK.maybe(types_numberString),links:mobx_state_tree_module.gK.maybe(mobx_state_tree_module.gK.frozen({project:mobx_state_tree_module.gK.string,user:mobx_state_tree_module.gK.string})),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),preferences:mobx_state_tree_module.gK.maybe(Preferences),settings:mobx_state_tree_module.gK.maybe(Settings)}).views(self=>({get assignedWorkflowID(){var _self_settings;return null===(_self_settings=self.settings)||void 0===_self_settings?void 0:_self_settings.workflow_id},promptAssignment(currentWorkflowID){const project=(0,mobx_state_tree_module.Zn)(self).project;return!(!self.assignedWorkflowID||!currentWorkflowID||self.assignedWorkflowID===currentWorkflowID)&&project.workflowIsActive(self.assignedWorkflowID)},get isLoaded(){return self.loadingState===async_states_default().success}})).actions(self=>{async function _fetch(){const{client,project,user}=(0,mobx_state_tree_module.Zn)(self),authorization=`Bearer ${await auth_default().checkBearerToken()}`,query={project_id:project.id,user_id:user.id},response=await client.panoptes.get("/project_preferences",query,{authorization}),[preferences]=response.body.project_preferences;return preferences}return{reset(){const resetSnapshot={error:void 0,id:void 0,links:void 0,loadingState:async_states_default().initialized,preferences:void 0,settings:void 0};(0,mobx_state_tree_module.Nh)(self,resetSnapshot)},setResource(resource){(0,mobx_state_tree_module.Nh)(self,resource)},setLoadingState(state){self.loadingState=state},fetchResource:(0,mobx_state_tree_module.L3)(function*fetchResource(){try{if(!self.id){self.setLoadingState(async_states_default().loading);const preferences=yield _fetch();preferences&&(0,mobx_state_tree_module.Nh)(self,preferences),self.setLoadingState(async_states_default().success)}}catch(error){UserProjectPreferences_console.error(error),(0,logToSentry.A)(error),self.error=error,self.setLoadingState(async_states_default().error)}}),refreshSettings:(0,mobx_state_tree_module.L3)(function*refreshSettings(){try{const preferences=yield _fetch();(null==preferences?void 0:preferences.settings)&&(self.settings=preferences.settings),self.setLoadingState(async_states_default().success)}catch(error){UserProjectPreferences_console.error(error)}})}}),UserPersonalization_UserPersonalization=mobx_state_tree_module.gK.model("UserPersonalization",{notifications:mobx_state_tree_module.gK.optional(Notifications_Notifications,{}),projectPreferences:mobx_state_tree_module.gK.optional(UserProjectPreferences_UserProjectPreferences,{}),sessionCount:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.number,0)}).views(self=>({get sessionCountIsDivisibleByFive(){return self.sessionCount%5==0}})).actions(self=>{function _onUserChange(){const{user}=(0,mobx_state_tree_module.Zn)(self);user.isLoggedIn||user.loadingState!==async_states_default().success||self.projectPreferences.setLoadingState(async_states_default().success)}return{afterAttach(){(0,mobx_state_tree_module.LF)(self,(0,mobx_esm.fm)(_onUserChange))},incrementSessionCount(){self.sessionCount=self.sessionCount+1;const{user}=(0,mobx_state_tree_module.Zn)(self);(null==user?void 0:user.id)&&self.sessionCountIsDivisibleByFive&&self.projectPreferences.refreshSettings()},load(newUser=!0){self.notifications.fetchAndSubscribe(),newUser?self.projectPreferences.fetchResource():self.projectPreferences.refreshSettings()},reset(){self.notifications.reset(),self.projectPreferences.reset(),self.projectPreferences.setLoadingState(async_states_default().success),self.sessionCount=0}}}),User_User=mobx_state_tree_module.gK.model("User",{admin:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.boolean,!1),avatar_src:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),collections:mobx_state_tree_module.gK.optional(Collections.A,{}),display_name:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),error:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.frozen({})),id:mobx_state_tree_module.gK.maybeNull(types_numberString),login:mobx_state_tree_module.gK.maybeNull(mobx_state_tree_module.gK.string),loadingState:mobx_state_tree_module.gK.optional(mobx_state_tree_module.gK.enumeration("state",async_states_default().values),async_states_default().initialized),personalization:mobx_state_tree_module.gK.optional(UserPersonalization_UserPersonalization,{}),recents:mobx_state_tree_module.gK.optional(Recents_Recents,{})}).views(self=>({get displayName(){return self.display_name},get isAdmin(){return self.isLoggedIn&&self.admin},get isLoaded(){return self.loadingState===async_states_default().success},get isLoggedIn(){return!!self.id}})).actions(self=>({clear(){const loggedOutUser={id:null,display_name:null,login:null,loadingState:async_states_default().success,personalization:{projectPreferences:{loadingState:async_states_default().success}}};(0,mobx_state_tree_module.Nh)(self,loggedOutUser)},set(user){const newUser=self.id!==(null==user?void 0:user.id),{personalization}=(0,mobx_state_tree_module.dV)(self),userSnapshot={personalization,...user,loadingState:async_states_default().success};(0,mobx_state_tree_module.Nh)(self,userSnapshot),self.recents.fetch(),self.collections.searchCollections({favorite:!1,current_user_roles:"owner,collaborator,contributor",page_size:100}),self.id&&self.personalization.load(newUser)}}));var Store_console=__webpack_require__("../../node_modules/console-browserify/index.js");const stores_Store=mobx_state_tree_module.gK.model("Store",{organization:mobx_state_tree_module.gK.optional(stores_Organization,{}),project:mobx_state_tree_module.gK.optional(stores_Project,{}),ui:mobx_state_tree_module.gK.optional(stores_UI,{}),user:mobx_state_tree_module.gK.optional(User_User,{})}).views(self=>({get client(){return(0,mobx_state_tree_module._$)(self).client},get appLoadingState(){const loadingStates=[self.user.loadingState,self.user.personalization.projectPreferences.loadingState,self.project.loadingState];return loadingStates.includes(async_states_default().error)?async_states_default().error:loadingStates.includes(async_states_default().loading)?async_states_default().loading:loadingStates.every(state=>state===async_states_default().success)?async_states_default().success:async_states_default().initialized}})).actions(self=>({afterCreate(){!function createSignOutObserver(){const signOutDisposer=(0,mobx_esm.fm)(()=>{(0,mobx_state_tree_module.i5)(self,call=>{"clear"===call.name&&self.user.personalization.reset()})},{name:"User clear action Observer autorun"});(0,mobx_state_tree_module.LF)(self,signOutDisposer)}(),(0,mobx_state_tree_module.I7)(self,(call,next,abort)=>{try{next(call)}catch(error){Store_console.error("Project App MST error:",error),(0,logToSentry.A)(error)}})},testError(){throw new Error("Testing errors")}}))},"./stores/User/Collections/Collections.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,p:()=>Collection});var mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/mobx-state-tree/dist/mobx-state-tree.module.js"),panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/panoptes-client/lib/auth.js"),panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1__),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../lib-async-states/src/async-states.js"),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2__),console=__webpack_require__("../../node_modules/console-browserify/index.js");const Collection=mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.model("Collection",{display_name:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.maybeNull(mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.string),favorite:!1,id:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.identifier,links:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.frozen({}),private:!0}),__WEBPACK_DEFAULT_EXPORT__=mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.model("Collections",{error:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.maybeNull(mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.frozen({})),collections:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.array(Collection),favourites:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.maybeNull(Collection),loadingState:mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.optional(mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.gK.enumeration("state",_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().values),_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().initialized)}).actions(self=>{let client;const fetchCollections=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*fetchCollections(query){try{self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().loading;const authorization=`Bearer ${yield panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1___default().checkBearerToken()}`,response=yield client.collections.get({authorization,query}),{collections}=response.body;return self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().success,collections}catch(error){return console.log(error.message),self.error=error,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().error,[]}}),newCollection=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*newCollection(options,subjectIds=[]){try{const{project}=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.Zn)(self);self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().loading;const authorization=`Bearer ${yield panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1___default().checkBearerToken()}`,defaults={display_name:"",favorite:!1,private:!1},data=Object.assign({},defaults,options),response=yield client.collections.create({authorization,data,project:project.id,subjects:subjectIds});self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().success;const[collection]=response.body.collections;return collection}catch(error){return console.log(error.message),self.error=error,self.loadingState=_zooniverse_async_states__WEBPACK_IMPORTED_MODULE_2___default().error,null}});return{afterAttach(){client=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.Zn)(self).client},createCollection:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*createCollection(options,subjectIds=[]){return yield newCollection(options,subjectIds)}),createFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*createFavourites(subjectIds=[]){const{project}=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.Zn)(self),options={display_name:`Favorites ${project.slug}`,favorite:!0,private:!0};return yield newCollection(options,subjectIds)}),searchCollections:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*searchCollections(query){self.collections=yield fetchCollections(query)}),fetchFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*fetchFavourites(){const{project,user}=(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.Zn)(self),query={favorite:!0,project_ids:[project.id],owner:user.login};let[favourites]=yield fetchCollections(query);return favourites}),fetchOrCreateFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*fetchOrCreateFavourites(){let favouritesData=yield self.fetchFavourites();return favouritesData||(favouritesData=yield self.createFavourites()),self.setFavourites(favouritesData),self.favourites}),setFavourites(favourites){self.favourites=favourites?Collection.create(favourites):null},addSubjects:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*addSubjects(id,subjectIds){const params={authorization:`Bearer ${yield panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1___default().checkBearerToken()}`,id,subjects:subjectIds},response=yield client.collections.addSubjects(params),[collection]=response.body.collections;return collection}),addFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*addFavourites(subjectIds){var _self_favourites;(null===(_self_favourites=self.favourites)||void 0===_self_favourites?void 0:_self_favourites.id)||(yield self.fetchOrCreateFavourites());const favouritesData=yield self.addSubjects(self.favourites.id,subjectIds);self.setFavourites(favouritesData)}),removeSubjects:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*removeSubjects(id,subjectIds){const params={authorization:`Bearer ${yield panoptes_client_lib_auth__WEBPACK_IMPORTED_MODULE_1___default().checkBearerToken()}`,id,subjects:subjectIds};yield client.collections.removeSubjects(params)}),removeFavourites:(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_0__.L3)(function*removeFavourites(subjectIds){yield self.removeSubjects(self.favourites.id,subjectIds)})}})}}]);