(self.webpackChunk_zooniverse_fe_project=self.webpackChunk_zooniverse_fe_project||[]).push([[7588],{"../../node_modules/panoptes-client/lib/SugarClient/client.js":(module,__unused_webpack_exports,__webpack_require__)=>{module=__webpack_require__.nmd(module);var console=__webpack_require__("../../node_modules/console-browserify/index.js");__webpack_require__("../../node_modules/panoptes-client/lib/auth.js");class SugarClient{static initClass(){this.host=null,this.Primus=null}constructor(userId,authToken){this.primusUrl=this.primusUrl.bind(this),this.refreshToken=this.refreshToken.bind(this),this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.receiveData=this.receiveData.bind(this),this.subscribeTo=this.subscribeTo.bind(this),this.unsubscribeFrom=this.unsubscribeFrom.bind(this),this.on=this.on.bind(this),this.off=this.off.bind(this),this.emit=this.emit.bind(this),this.__subscribeToChannels=this.__subscribeToChannels.bind(this),this.__subscribeTo=this.__subscribeTo.bind(this),this.createEvent=this.createEvent.bind(this),this.userId=userId,this.authToken=authToken,this.events={},this.subscriptions={},this.initializePrimus()}initializePrimus(){if(null==SugarClient.Primus)throw"SugarClient.Primus is not defined";if(null==SugarClient.host)throw"SugarClient.host is not defined";return this.primus=SugarClient.Primus.connect(SugarClient.host,{websockets:!0,network:!0,manual:!0}),this.primus.on("outgoing::url",this.primusUrl),this.primus.on("data",this.receiveData)}host(){return SugarClient.host}async refreshToken(token){const tokenChanged=token!==this.authToken;this.userId&&tokenChanged&&(this.authToken=token,this.connect())}primusUrl(baseUrl){if(this.userId&&this.authToken)return baseUrl.query=`user_id=${this.userId}&auth_token=${this.authToken}`}connect(){return this.disconnect(),this.primus.open()}disconnect(){let key,userKeys=[];for(key of(userKeys=(()=>{const result=[];for(key in this.subscriptions){this.subscriptions[key];key.match(/^(session|user):/i)&&result.push(key)}return result})(),userKeys))delete this.subscriptions[key];return this.userKey=this.loggedIn=null,this.primus.end()}receiveData(data){return"connection"===data.type?(console&&console.info&&console.info("[CONNECTED] ",data),this.loggedIn=data.loggedIn,this.userKey=data.userKey,this.subscriptions[this.userKey]=!0,setTimeout(this.__subscribeToChannels,100)):this.emit(data)}subscribeTo(channel){return!this.subscriptions[channel]&&(this.subscriptions[channel]=!0,this.__subscribeTo(channel))}unsubscribeFrom(channel){if(this.subscriptions[channel])return delete this.subscriptions[channel],this.primus.write({action:"Unsubscribe",params:{channel}})}on(type,callback){return this.events[type]||(this.events[type]=[]),this.events[type].push(callback)}off(type,callback){return callback&&this.events[type]?this.events[type]=this.events[type].filter((cb=>cb!==callback)):delete this.events[type]}emit(data){return(this.events[data.type]||[]).map((callback=>callback(data)))}__subscribeToChannels(){return(()=>{const result=[];for(let channel in this.subscriptions){this.subscriptions[channel];result.push(this.__subscribeTo(channel))}return result})()}__subscribeTo(channel){return this.primus.write({action:"Subscribe",params:{channel}})}createEvent(type,channel,data){return this.primus.write({action:"Event",params:{type,channel,data}})}}SugarClient.initClass(),null!==module&&(module.exports=SugarClient)},"../../node_modules/panoptes-client/lib/SugarClient/primus.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function UMDish(name,context,definition,plugins){context[name]=definition.call(context);for(var i=0;i<plugins.length;i++)plugins[i](context[name]);module.exports?module.exports=context[name]:void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function reference(){return context[name]}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}("Primus",this||{},(function wrapper(){var Primus=function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){if(!f&&__webpack_require__("../../node_modules/panoptes-client/lib/SugarClient sync recursive"))return require(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u=void 0,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(_dereq_,module,exports){"use strict";module.exports=function demolish(keys,options){var split=/[, ]+/;function run(key,selfie){if(options[key]){if("string"==typeof options[key]&&(options[key]=options[key].split(split)),"function"==typeof options[key])return options[key].call(selfie);for(var type,what,i=0;i<options[key].length;i++)"function"===(type=typeof(what=options[key][i]))?what.call(selfie):"string"===type&&"function"==typeof selfie[what]&&selfie[what]()}}return options=options||{},"string"==typeof(keys=keys||[])&&(keys=keys.split(split)),function destroy(){var prop,i=0;if(null===this[keys[0]])return!1;for(run("before",this);i<keys.length;i++)this[prop=keys[i]]&&("function"==typeof this[prop].destroy&&this[prop].destroy(),this[prop]=null);return this.emit&&this.emit("destroy"),run("after",this),!0}}},{}],2:[function(_dereq_,module,exports){"use strict";module.exports=function emits(){for(var parser,self=this,i=0,l=arguments.length,args=new Array(l);i<l;i++)args[i]=arguments[i];return"function"!=typeof args[args.length-1]?function emitter(){for(var i=0,l=arguments.length,arg=new Array(l);i<l;i++)arg[i]=arguments[i];return self.emit.apply(self,args.concat(arg))}:(parser=args.pop(),function emitter(){for(var i=0,l=arguments.length,arg=new Array(l+1);i<l;i++)arg[i+1]=arguments[i];return arg[0]=function next(err,returned){if(err)return self.emit("error",err);arg=void 0===returned?arg.slice(1):null===returned?[]:returned,self.emit.apply(self,args.concat(arg))},parser.apply(self,arg),!0})}},{}],3:[function(_dereq_,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,void 0!==module&&(module.exports=EventEmitter)},{}],4:[function(_dereq_,module,exports){"function"==typeof Object.create?module.exports=function inherits(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},{}],5:[function(_dereq_,module,exports){"use strict";var regex=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i"),day=864e5;module.exports=function millisecond(ms){var amount,match,type=typeof ms;if("number"===type)return ms;if("string"!==type||"0"===ms||!ms)return 0;if(+ms)return+ms;if(ms.length>1e4||!(match=regex.exec(ms)))return 0;switch(amount=parseFloat(match[1]),match[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*amount;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*amount;case"days":case"day":case"d":return amount*day;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*amount;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*amount;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*amount;default:return amount}}},{}],6:[function(_dereq_,module,exports){"use strict";module.exports=function one(fn){var value,called=0;function onetime(){return called||(called=1,value=fn.apply(this,arguments),fn=null),value}return onetime.displayName=fn.displayName||fn.name||onetime.displayName||onetime.name,onetime}},{}],7:[function(_dereq_,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],8:[function(_dereq_,module,exports){"use strict";var has=Object.prototype.hasOwnProperty;function decode(input){try{return decodeURIComponent(input.replace(/\+/g," "))}catch(e){return null}}function encode(input){try{return encodeURIComponent(input)}catch(e){return null}}exports.stringify=function querystringify(obj,prefix){prefix=prefix||"";var value,key,pairs=[];for(key in"string"!=typeof prefix&&(prefix="?"),obj)if(has.call(obj,key)){if((value=obj[key])||null!=value&&!isNaN(value)||(value=""),key=encode(key),value=encode(value),null===key||null===value)continue;pairs.push(key+"="+value)}return pairs.length?prefix+pairs.join("&"):""},exports.parse=function querystring(query){for(var part,parser=/([^=?#&]+)=?([^&]*)/g,result={};part=parser.exec(query);){var key=decode(part[1]),value=decode(part[2]);null===key||null===value||key in result||(result[key]=value)}return result}},{}],9:[function(_dereq_,module,exports){"use strict";var EventEmitter=_dereq_("eventemitter3"),millisecond=_dereq_("millisecond"),destroy=_dereq_("demolish"),Tick=_dereq_("tick-tock"),one=_dereq_("one-time");function defaults(name,selfie,opts){return millisecond(name in opts?opts[name]:name in selfie?selfie[name]:Recovery[name])}function Recovery(options){if(!(this instanceof Recovery))return new Recovery(options);options=options||{},this.attempt=null,this._fn=null,this["reconnect timeout"]=defaults("reconnect timeout",this,options),this.retries=defaults("retries",this,options),this.factor=defaults("factor",this,options),this.max=defaults("max",this,options),this.min=defaults("min",this,options),this.timers=new Tick(this)}Recovery.prototype=new EventEmitter,Recovery.prototype.constructor=Recovery,Recovery["reconnect timeout"]="30 seconds",Recovery.max=1/0,Recovery.min="500 ms",Recovery.retries=10,Recovery.factor=2,Recovery.prototype.reconnect=function reconnect(){var recovery=this;return recovery.backoff((function backedoff(err,opts){if(opts.duration=+new Date-opts.start,err)return recovery.emit("reconnect failed",err,opts);recovery.emit("reconnected",opts)}),recovery.attempt)},Recovery.prototype.backoff=function backoff(fn,opts){var recovery=this;return(opts=opts||recovery.attempt||{}).backoff?recovery:(opts["reconnect timeout"]=defaults("reconnect timeout",recovery,opts),opts.retries=defaults("retries",recovery,opts),opts.factor=defaults("factor",recovery,opts),opts.max=defaults("max",recovery,opts),opts.min=defaults("min",recovery,opts),opts.start=+opts.start||+new Date,opts.duration=+opts.duration||0,opts.attempt=+opts.attempt||0,opts.attempt===opts.retries?(fn.call(recovery,new Error("Unable to recover"),opts),recovery):(opts.backoff=!0,opts.attempt++,recovery.attempt=opts,opts.scheduled=1!==opts.attempt?Math.min(Math.round((Math.random()+1)*opts.min*Math.pow(opts.factor,opts.attempt-1)),opts.max):opts.min,recovery.timers.setTimeout("reconnect",(function delay(){opts.duration=+new Date-opts.start,opts.backoff=!1,recovery.timers.clear("reconnect, timeout");var connect=recovery._fn=one((function connect(err){if(recovery.reset(),err)return recovery.backoff(fn,opts);fn.call(recovery,void 0,opts)}));recovery.emit("reconnect",opts,connect),recovery.timers.setTimeout("timeout",(function timeout(){var err=new Error("Failed to reconnect in a timely manner");opts.duration=+new Date-opts.start,recovery.emit("reconnect timeout",err,opts),connect(err)}),opts["reconnect timeout"])}),opts.scheduled),recovery.emit("reconnect scheduled",opts),recovery))},Recovery.prototype.reconnecting=function reconnecting(){return!!this.attempt},Recovery.prototype.reconnected=function reconnected(err){return this._fn&&this._fn(err),this},Recovery.prototype.reset=function reset(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},Recovery.prototype.destroy=destroy("timers attempt _fn"),module.exports=Recovery},{demolish:1,eventemitter3:10,millisecond:5,"one-time":6,"tick-tock":12}],10:[function(_dereq_,module,exports){"use strict";var prefix="function"!=typeof Object.create&&"~";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function listeners(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.once=function once(event,fn,context){var listener=new EE(fn,context||this,!0),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;var listeners=this._events[evt],events=[];if(fn)if(listeners.fn)(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context)&&events.push(listeners);else for(var i=0,length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);return events.length?this._events[evt]=1===events.length?events[0]:events:delete this._events[evt],this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){return this._events?(event?delete this._events[prefix?prefix+event:event]:this._events=prefix?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this},EventEmitter.prefixed=prefix,void 0!==module&&(module.exports=EventEmitter)},{}],11:[function(_dereq_,module,exports){"use strict";module.exports=function required(port,protocol){if(protocol=protocol.split(":")[0],!(port=+port))return!1;switch(protocol){case"http":case"ws":return 80!==port;case"https":case"wss":return 443!==port;case"ftp":return 21!==port;case"gopher":return 70!==port;case"file":return!1}return 0!==port}},{}],12:[function(_dereq_,module,exports){(function(setImmediate,clearImmediate){(function(){"use strict";var has=Object.prototype.hasOwnProperty,ms=_dereq_("millisecond");function Timer(timer,clear,duration,fn){this.start=+new Date,this.duration=duration,this.clear=clear,this.timer=timer,this.fns=[fn]}function unsetTimeout(id){clearTimeout(id)}function unsetInterval(id){clearInterval(id)}function unsetImmediate(id){clearImmediate(id)}function Tick(context){if(!(this instanceof Tick))return new Tick(context);this.timers={},this.context=context||this}Timer.prototype.remaining=function remaining(){return this.duration-this.taken()},Timer.prototype.taken=function taken(){return+new Date-this.start},Tick.prototype.tock=function ticktock(name,clear){var tock=this;return function tickedtock(){if(name in tock.timers){var fns=tock.timers[name].fns.slice(),l=fns.length,i=0;for(clear?tock.clear(name):tock.start=+new Date;i<l;i++)fns[i].call(tock.context)}}},Tick.prototype.setTimeout=function timeout(name,fn,time){var tock;return this.timers[name]?(this.timers[name].fns.push(fn),this):(tock=ms(time),this.timers[name]=new Timer(setTimeout(this.tock(name,!0),ms(time)),unsetTimeout,tock,fn),this)},Tick.prototype.setInterval=function interval(name,fn,time){var tock;return this.timers[name]?(this.timers[name].fns.push(fn),this):(tock=ms(time),this.timers[name]=new Timer(setInterval(this.tock(name),ms(time)),unsetInterval,tock,fn),this)},Tick.prototype.setImmediate=function immediate(name,fn){return"function"!=typeof setImmediate?this.setTimeout(name,fn,0):this.timers[name]?(this.timers[name].fns.push(fn),this):(this.timers[name]=new Timer(setImmediate(this.tock(name,!0)),unsetImmediate,0,fn),this)},Tick.prototype.active=function active(name){return name in this.timers},Tick.prototype.clear=function clear(){var timer,i,l,args=arguments.length?arguments:[];if(1===args.length&&"string"==typeof args[0]&&(args=args[0].split(/[, ]+/)),!args.length)for(timer in this.timers)has.call(this.timers,timer)&&args.push(timer);for(i=0,l=args.length;i<l;i++)(timer=this.timers[args[i]])&&(timer.clear(timer.timer),timer.fns=timer.timer=timer.clear=null,delete this.timers[args[i]]);return this},Tick.prototype.adjust=function adjust(name,time){var interval,tock=ms(time),timer=this.timers[name];return timer?(interval=timer.clear===unsetInterval,timer.clear(timer.timer),timer.start=+new Date,timer.duration=tock,timer.timer=(interval?setInterval:setTimeout)(this.tock(name,!interval),tock),this):this},Tick.prototype.end=Tick.prototype.destroy=function end(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},Tick.Timer=Timer,module.exports=Tick}).call(this)}).call(this,_dereq_("timers").setImmediate,_dereq_("timers").clearImmediate)},{millisecond:5,timers:13}],13:[function(_dereq_,module,exports){(function(setImmediate,clearImmediate){(function(){var nextTick=_dereq_("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout((function onTimeout(){item._onTimeout&&item._onTimeout()}),msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[id]=!0,nextTick((function onNextTick(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))})),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(this)}).call(this,_dereq_("timers").setImmediate,_dereq_("timers").clearImmediate)},{"process/browser.js":7,timers:13}],14:[function(_dereq_,module,exports){(function(global){(function(){"use strict";var required=_dereq_("requires-port"),qs=_dereq_("querystringify"),controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(str){return(str||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function sanitize(address,url){return isSpecial(url.protocol)?address.replace(/\\/g,"/"):address},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(loc){var key,location=("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{}).location||{},finaldestination={},type=typeof(loc=loc||location);if("blob:"===loc.protocol)finaldestination=new Url(unescape(loc.pathname),{});else if("string"===type)for(key in finaldestination=new Url(loc,{}),ignore)delete finaldestination[key];else if("object"===type){for(key in loc)key in ignore||(finaldestination[key]=loc[key]);void 0===finaldestination.slashes&&(finaldestination.slashes=slashes.test(loc.href))}return finaldestination}function isSpecial(scheme){return"file:"===scheme||"ftp:"===scheme||"http:"===scheme||"https:"===scheme||"ws:"===scheme||"wss:"===scheme}function extractProtocol(address,location){address=(address=trimLeft(address)).replace(CRHTLF,""),location=location||{};var rest,match=protocolre.exec(address),protocol=match[1]?match[1].toLowerCase():"",forwardSlashes=!!match[2],otherSlashes=!!match[3],slashesCount=0;return forwardSlashes?otherSlashes?(rest=match[2]+match[3]+match[4],slashesCount=match[2].length+match[3].length):(rest=match[2]+match[4],slashesCount=match[2].length):otherSlashes?(rest=match[3]+match[4],slashesCount=match[3].length):rest=match[4],"file:"===protocol?slashesCount>=2&&(rest=rest.slice(2)):isSpecial(protocol)?rest=match[4]:protocol?forwardSlashes&&(rest=rest.slice(2)):slashesCount>=2&&isSpecial(location.protocol)&&(rest=match[4]),{protocol,slashes:forwardSlashes||isSpecial(protocol),slashesCount,rest}}function Url(address,location,parser){if(address=(address=trimLeft(address)).replace(CRHTLF,""),!(this instanceof Url))return new Url(address,location,parser);var relative,extracted,parse,instruction,index,key,instructions=rules.slice(),type=typeof location,url=this,i=0;for("object"!==type&&"string"!==type&&(parser=location,location=null),parser&&"function"!=typeof parser&&(parser=qs.parse),relative=!(extracted=extractProtocol(address||"",location=lolcation(location))).protocol&&!extracted.slashes,url.slashes=extracted.slashes||relative&&location.slashes,url.protocol=extracted.protocol||location.protocol||"",address=extracted.rest,("file:"===extracted.protocol&&(2!==extracted.slashesCount||windowsDriveLetter.test(address))||!extracted.slashes&&(extracted.protocol||extracted.slashesCount<2||!isSpecial(url.protocol)))&&(instructions[3]=[/(.*)/,"pathname"]);i<instructions.length;i++)"function"!=typeof(instruction=instructions[i])?(parse=instruction[0],key=instruction[1],parse!=parse?url[key]=address:"string"==typeof parse?~(index="@"===parse?address.lastIndexOf(parse):address.indexOf(parse))&&("number"==typeof instruction[2]?(url[key]=address.slice(0,index),address=address.slice(index+instruction[2])):(url[key]=address.slice(index),address=address.slice(0,index))):(index=parse.exec(address))&&(url[key]=index[1],address=address.slice(0,index.index)),url[key]=url[key]||relative&&instruction[3]&&location[key]||"",instruction[4]&&(url[key]=url[key].toLowerCase())):address=instruction(address,url);parser&&(url.query=parser(url.query)),relative&&location.slashes&&"/"!==url.pathname.charAt(0)&&(""!==url.pathname||""!==location.pathname)&&(url.pathname=function resolve(relative,base){if(""===relative)return base;for(var path=(base||"/").split("/").slice(0,-1).concat(relative.split("/")),i=path.length,last=path[i-1],unshift=!1,up=0;i--;)"."===path[i]?path.splice(i,1):".."===path[i]?(path.splice(i,1),up++):up&&(0===i&&(unshift=!0),path.splice(i,1),up--);return unshift&&path.unshift(""),"."!==last&&".."!==last||path.push(""),path.join("/")}(url.pathname,location.pathname)),"/"!==url.pathname.charAt(0)&&isSpecial(url.protocol)&&(url.pathname="/"+url.pathname),required(url.port,url.protocol)||(url.host=url.hostname,url.port=""),url.username=url.password="",url.auth&&(~(index=url.auth.indexOf(":"))?(url.username=url.auth.slice(0,index),url.username=encodeURIComponent(decodeURIComponent(url.username)),url.password=url.auth.slice(index+1),url.password=encodeURIComponent(decodeURIComponent(url.password))):url.username=encodeURIComponent(decodeURIComponent(url.auth)),url.auth=url.password?url.username+":"+url.password:url.username),url.origin="file:"!==url.protocol&&isSpecial(url.protocol)&&url.host?url.protocol+"//"+url.host:"null",url.href=url.toString()}Url.prototype={set:function set(part,value,fn){var url=this;switch(part){case"query":"string"==typeof value&&value.length&&(value=(fn||qs.parse)(value)),url[part]=value;break;case"port":url[part]=value,required(value,url.protocol)?value&&(url.host=url.hostname+":"+value):(url.host=url.hostname,url[part]="");break;case"hostname":url[part]=value,url.port&&(value+=":"+url.port),url.host=value;break;case"host":url[part]=value,port.test(value)?(value=value.split(":"),url.port=value.pop(),url.hostname=value.join(":")):(url.hostname=value,url.port="");break;case"protocol":url.protocol=value.toLowerCase(),url.slashes=!fn;break;case"pathname":case"hash":if(value){var char="pathname"===part?"/":"#";url[part]=value.charAt(0)!==char?char+value:value}else url[part]=value;break;case"username":case"password":url[part]=encodeURIComponent(value);break;case"auth":var index=value.indexOf(":");~index?(url.username=value.slice(0,index),url.username=encodeURIComponent(decodeURIComponent(url.username)),url.password=value.slice(index+1),url.password=encodeURIComponent(decodeURIComponent(url.password))):url.username=encodeURIComponent(decodeURIComponent(value))}for(var i=0;i<rules.length;i++){var ins=rules[i];ins[4]&&(url[ins[1]]=url[ins[1]].toLowerCase())}return url.auth=url.password?url.username+":"+url.password:url.username,url.origin="file:"!==url.protocol&&isSpecial(url.protocol)&&url.host?url.protocol+"//"+url.host:"null",url.href=url.toString(),url},toString:function toString(stringify){stringify&&"function"==typeof stringify||(stringify=qs.stringify);var query,url=this,host=url.host,protocol=url.protocol;protocol&&":"!==protocol.charAt(protocol.length-1)&&(protocol+=":");var result=protocol+(url.protocol&&url.slashes||isSpecial(url.protocol)?"//":"");return url.username?(result+=url.username,url.password&&(result+=":"+url.password),result+="@"):url.password?(result+=":"+url.password,result+="@"):"file:"!==url.protocol&&isSpecial(url.protocol)&&!host&&"/"!==url.pathname&&(result+="@"),(":"===host[host.length-1]||port.test(url.hostname)&&!url.port)&&(host+=":"),result+=host+url.pathname,(query="object"==typeof url.query?stringify(url.query):url.query)&&(result+="?"!==query.charAt(0)?"?"+query:query),url.hash&&(result+=url.hash),result}},Url.extractProtocol=extractProtocol,Url.location=lolcation,Url.trimLeft=trimLeft,Url.qs=qs,module.exports=Url}).call(this)}).call(this,void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:8,"requires-port":11}],15:[function(_dereq_,module,exports){"use strict";var prev,alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),map={},seed=0,i=0;function encode(num){var encoded="";do{encoded=alphabet[num%64]+encoded,num=Math.floor(num/64)}while(num>0);return encoded}function yeast(){var now=encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode(seed++)}for(;i<64;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=function decode(str){var decoded=0;for(i=0;i<str.length;i++)decoded=64*decoded+map[str.charAt(i)];return decoded},module.exports=yeast},{}],16:[function(_dereq_,module,exports){"use strict";var defaultUrl,EventEmitter=_dereq_("eventemitter3"),TickTock=_dereq_("tick-tock"),Recovery=_dereq_("recovery"),qs=_dereq_("querystringify"),inherits=_dereq_("inherits"),destroy=_dereq_("demolish"),yeast=_dereq_("yeast"),u2028=/\u2028/g,u2029=/\u2029/g;function context(self,method){if(!(self instanceof Primus)){var failure=new Error("Primus#"+method+"'s context should called with a Primus instance");if("function"!=typeof self.listeners||!self.listeners("error").length)throw failure;self.emit("error",failure)}}try{defaultUrl=location.origin?location.origin:location.protocol+"//"+location.host}catch(e){defaultUrl="http://127.0.0.1"}function Primus(url,options){if(!(this instanceof Primus))return new Primus(url,options);if(Primus.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof url?url=(options=url).url||options.uri||defaultUrl:options=options||{},"ping"in options||"pong"in options)return this.critical(new Error("The `ping` and `pong` options have been removed"));var primus=this;options.queueSize="queueSize"in options?options.queueSize:1/0,options.timeout="timeout"in options?options.timeout:1e4,options.reconnect="reconnect"in options?options.reconnect:{},options.pingTimeout="pingTimeout"in options?options.pingTimeout:45e3,options.strategy="strategy"in options?options.strategy:[],options.transport="transport"in options?options.transport:{},primus.buffer=[],primus.writable=!0,primus.readable=!0,primus.url=primus.parse(url||defaultUrl),primus.readyState=Primus.CLOSED,primus.options=options,primus.timers=new TickTock(this),primus.socket=null,primus.disconnect=!1,primus.transport=options.transport,primus.transformers={outgoing:[],incoming:[]},primus.recovery=new Recovery(options.reconnect),"string"==typeof options.strategy&&(options.strategy=options.strategy.split(/\s?,\s?/g)),!1===options.strategy?options.strategy=[]:options.strategy.length||(options.strategy.push("disconnect","online"),this.authorization||options.strategy.push("timeout")),options.strategy=options.strategy.join(",").toLowerCase(),"websockets"in options&&(primus.AVOID_WEBSOCKETS=!options.websockets),"network"in options&&(primus.NETWORK_EVENTS=options.network),options.manual||primus.timers.setTimeout("open",(function open(){primus.timers.clear("open"),primus.open()}),0),primus.initialise(options)}Primus.requires=Primus.require=function requires(name){if("function"==typeof _dereq_)return _dereq_(name)};try{Primus.Stream=Primus.requires("stream")}catch(e){}Primus.Stream||(Primus.Stream=EventEmitter),inherits(Primus,Primus.Stream),Primus.OPENING=1,Primus.CLOSED=2,Primus.OPEN=3,Primus.prototype.AVOID_WEBSOCKETS=!1,Primus.prototype.NETWORK_EVENTS=!1,Primus.prototype.online=!0;try{(Primus.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(Primus.prototype.online=!1))}catch(e){}Primus.prototype.ark={},Primus.prototype.emits=_dereq_("emits"),Primus.prototype.plugin=function plugin(name){if(context(this,"plugin"),name)return this.ark[name];var plugins={};for(name in this.ark)plugins[name]=this.ark[name];return plugins},Primus.prototype.reserved=function reserved(evt){return/^(incoming|outgoing)::/.test(evt)||evt in this.reserved.events},Primus.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},Primus.prototype.initialise=function initialise(options){var primus=this;for(var plugin in primus.recovery.on("reconnected",primus.emits("reconnected")).on("reconnect failed",primus.emits("reconnect failed",(function failed(next){primus.emit("end"),next()}))).on("reconnect timeout",primus.emits("reconnect timeout")).on("reconnect scheduled",primus.emits("reconnect scheduled")).on("reconnect",primus.emits("reconnect",(function reconnect(next){primus.emit("outgoing::reconnect"),next()}))),primus.on("outgoing::open",(function opening(){var readyState=primus.readyState;primus.readyState=Primus.OPENING,readyState!==primus.readyState&&primus.emit("readyStateChange","opening")})),primus.on("incoming::open",(function opened(){var readyState=primus.readyState;if(primus.recovery.reconnecting()&&primus.recovery.reconnected(),primus.writable=!0,primus.readable=!0,primus.online||(primus.online=!0,primus.emit("online")),primus.readyState=Primus.OPEN,readyState!==primus.readyState&&primus.emit("readyStateChange","open"),primus.heartbeat(),primus.buffer.length){var data=primus.buffer.slice(),length=data.length,i=0;for(primus.buffer.length=0;i<length;i++)primus._write(data[i])}primus.emit("open")})),primus.on("incoming::ping",(function ping(time){primus.online=!0,primus.heartbeat(),primus.emit("outgoing::pong",time),primus._write("primus::pong::"+time)})),primus.on("incoming::error",(function error(e){var connect=primus.timers.active("connect"),err=e;if("string"==typeof e)err=new Error(e);else if(!(e instanceof Error)&&"object"==typeof e)for(var key in err=new Error(e.message||e.reason),e)Object.prototype.hasOwnProperty.call(e,key)&&(err[key]=e[key]);if(primus.recovery.reconnecting())return primus.recovery.reconnected(err);primus.listeners("error").length&&primus.emit("error",err),connect&&(~primus.options.strategy.indexOf("timeout")?primus.recovery.reconnect():primus.end())})),primus.on("incoming::data",(function message(raw){primus.decoder(raw,(function decoding(err,data){if(err)return primus.listeners("error").length&&primus.emit("error",err);primus.protocol(data)||primus.transforms(primus,primus,"incoming",data,raw)}))})),primus.on("incoming::end",(function end(){var readyState=primus.readyState;return primus.disconnect?(primus.disconnect=!1,primus.end()):(primus.readyState=Primus.CLOSED,readyState!==primus.readyState&&primus.emit("readyStateChange","end"),primus.timers.active("connect")&&primus.end(),readyState!==Primus.OPEN?!!primus.recovery.reconnecting()&&primus.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),primus.emit("close"),~primus.options.strategy.indexOf("disconnect")?primus.recovery.reconnect():(primus.emit("outgoing::end"),void primus.emit("end"))))})),primus.client(),primus.ark)primus.ark[plugin].call(primus,primus,options);return primus.NETWORK_EVENTS?(primus.offlineHandler=function offline(){primus.online&&(primus.online=!1,primus.emit("offline"),primus.end(),primus.recovery.reset())},primus.onlineHandler=function online(){primus.online||(primus.online=!0,primus.emit("online"),~primus.options.strategy.indexOf("online")&&primus.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",primus.offlineHandler,!1),window.addEventListener("online",primus.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",primus.offlineHandler),document.body.attachEvent("ononline",primus.onlineHandler)),primus):primus},Primus.prototype.protocol=function protocol(msg){if("string"!=typeof msg||0!==msg.indexOf("primus::"))return!1;var last=msg.indexOf(":",8),value=msg.slice(last+2);switch(msg.slice(8,last)){case"ping":this.emit("incoming::ping",+value);break;case"server":"close"===value&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",value);break;default:return!1}return!0},Primus.prototype.transforms=function transforms(primus,connection,type,data,raw){var packet={data},fns=primus.transformers[type];return function transform(index,done){var transformer=fns[index++];if(!transformer)return done();if(1===transformer.length){if(!1===transformer.call(connection,packet))return;return transform(index,done)}transformer.call(connection,packet,(function finished(err,arg){if(err)return connection.emit("error",err);!1!==arg&&transform(index,done)}))}(0,(function done(){if("incoming"===type)return connection.emit("data",packet.data,raw);connection._write(packet.data)})),this},Primus.prototype.id=function id(fn){return this.socket&&this.socket.id?fn(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",fn))},Primus.prototype.open=function open(){return context(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},Primus.prototype.write=function write(data){return context(this,"write"),this.transforms(this,this,"outgoing",data),!0},Primus.prototype._write=function write(data){var primus=this;return Primus.OPEN!==primus.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(data),!1):(primus.encoder(data,(function encoded(err,packet){if(err)return primus.listeners("error").length&&primus.emit("error",err);"string"==typeof packet&&(~packet.indexOf("\u2028")&&(packet=packet.replace(u2028,"\\u2028")),~packet.indexOf("\u2029")&&(packet=packet.replace(u2029,"\\u2029"))),primus.emit("outgoing::data",packet)})),!0)},Primus.prototype.heartbeat=function heartbeat(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",(function expired(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))}),this.options.pingTimeout),this):this},Primus.prototype.timeout=function timeout(){var primus=this;function remove(){primus.removeListener("error",remove).removeListener("open",remove).removeListener("end",remove).timers.clear("connect")}return primus.timers.setTimeout("connect",(function expired(){remove(),primus.readyState===Primus.OPEN||primus.recovery.reconnecting()||(primus.emit("timeout"),~primus.options.strategy.indexOf("timeout")?primus.recovery.reconnect():primus.end())}),primus.options.timeout),primus.on("error",remove).on("open",remove).on("end",remove)},Primus.prototype.end=function end(data){if(context(this,"end"),this.readyState===Primus.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==data&&this.write(data),this.writable=!1,this.readable=!1;var readyState=this.readyState;return this.readyState=Primus.CLOSED,readyState!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},Primus.prototype.destroy=destroy("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function detach(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),Primus.prototype.clone=function clone(obj){return this.merge({},obj)},Primus.prototype.merge=function merge(target){for(var key,obj,i=1;i<arguments.length;i++)for(key in obj=arguments[i])Object.prototype.hasOwnProperty.call(obj,key)&&(target[key]=obj[key]);return target},Primus.prototype.parse=_dereq_("url-parse"),Primus.prototype.querystring=qs.parse,Primus.prototype.querystringify=qs.stringify,Primus.prototype.uri=function uri(options){var url=this.url,server=[],qsa=!1;options.query&&(qsa=!0),(options=options||{}).protocol="protocol"in options?options.protocol:"http:",options.query=!(!url.query||!qsa)&&url.query.slice(1),options.secure="secure"in options?options.secure:"https:"===url.protocol||"wss:"===url.protocol,options.auth="auth"in options?options.auth:url.auth,options.pathname="pathname"in options?options.pathname:this.pathname,options.port="port"in options?+options.port:+url.port||(options.secure?443:80);var querystring=this.querystring(options.query||"");return querystring._primuscb=yeast(),options.query=this.querystringify(querystring),this.emit("outgoing::url",options),server.push(options.secure?options.protocol.replace(":","s:"):options.protocol,""),server.push(options.auth?options.auth+"@"+url.host:url.host),options.pathname&&server.push(options.pathname.slice(1)),qsa?server[server.length-1]+="?"+options.query:delete options.query,options.object?options:server.join("/")},Primus.prototype.transform=function transform(type,fn){return context(this,"transform"),type in this.transformers?(this.transformers[type].push(fn),this):this.critical(new Error("Invalid transformer type"))},Primus.prototype.critical=function critical(err){if(this.emit("error",err))return this;throw err},Primus.connect=function connect(url,options){return new Primus(url,options)},Primus.EventEmitter=EventEmitter,Primus.prototype.client=function client(){var socket,onmessage=this.emits("incoming::data"),onerror=this.emits("incoming::error"),onopen=this.emits("incoming::open"),onclose=this.emits("incoming::end"),primus=this,factory=function factory(){if("undefined"!=typeof eio)return eio;try{var Socket=Primus.requires("engine.io-client").Socket;return function eio(options){return new Socket(options)}}catch(e){}}();if(!factory)return primus.critical(new Error("Missing required `engine.io-client` module. Please run `npm install --save engine.io-client`"));primus.on("outgoing::open",(function opening(){primus.emit("outgoing::end"),primus.socket=socket=factory(primus.merge(primus.transport,primus.url,primus.uri({protocol:"http:",query:!0,object:!0}),{rememberUpgrade:!1,forceBase64:!0,timestampRequests:!0,path:this.pathname,transports:primus.AVOID_WEBSOCKETS?["polling"]:["polling","websocket"]})),socket.on("message",onmessage),socket.on("error",onerror),socket.on("close",onclose),socket.on("open",onopen)})),primus.on("outgoing::data",(function write(message){socket&&socket.send(message)})),primus.on("outgoing::reconnect",(function reconnect(){primus.emit("outgoing::open")})),primus.on("outgoing::end",(function close(){socket&&(socket.removeListener("message",onmessage),socket.removeListener("error",onerror),socket.removeListener("close",onclose),socket.removeListener("open",onopen),socket.close(),socket=null)}))},Primus.prototype.authorization=!1,Primus.prototype.pathname="/sugar",Primus.prototype.encoder=function encoder(data,fn){var err;try{data=JSON.stringify(data)}catch(e){err=e}fn(err,data)},Primus.prototype.decoder=function decoder(data,fn){var err;if("string"!=typeof data)return fn(err,data);try{data=JSON.parse(data)}catch(e){err=e}fn(err,data)},Primus.prototype.version="8.0.9",module.exports=Primus},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:8,recovery:9,"tick-tock":12,"url-parse":14,yeast:15}]},{},[16])(16);return Primus}),[function(Primus){var g;"undefined"!=typeof window?g=window:"undefined"!=typeof self&&(g=self),g.eio=function(){var eio=function(){"use strict";function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(Parent,args,Class){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance},_construct.apply(null,arguments)}function _isNativeFunction(fn){return-1!==Function.toString.call(fn).indexOf("[native code]")}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(Class){if(null===Class||!_isNativeFunction(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)},_wrapNativeSuper(Class)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return"symbol"==typeof key?key:String(key)}var PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";var PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach((function(key){PACKET_TYPES_REVERSE[PACKET_TYPES[key]]=key}));var TEXT_ENCODER,ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$1="function"==typeof ArrayBuffer,isView=function isView(obj){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer},encodePacket=function encodePacket(_ref,supportsBinary,callback){var type=_ref.type,data=_ref.data;return withNativeBlob&&data instanceof Blob?supportsBinary?callback(data):encodeBlobAsBase64(data,callback):withNativeArrayBuffer$1&&(data instanceof ArrayBuffer||isView(data))?supportsBinary?callback(data):encodeBlobAsBase64(new Blob([data]),callback):callback(PACKET_TYPES[type]+(data||""))},encodeBlobAsBase64=function encodeBlobAsBase64(data,callback){var fileReader=new FileReader;return fileReader.onload=function(){var content=fileReader.result.split(",")[1];callback("b"+(content||""))},fileReader.readAsDataURL(data)};function toArray(data){return data instanceof Uint8Array?data:data instanceof ArrayBuffer?new Uint8Array(data):new Uint8Array(data.buffer,data.byteOffset,data.byteLength)}function encodePacketToBinary(packet,callback){return withNativeBlob&&packet.data instanceof Blob?packet.data.arrayBuffer().then(toArray).then(callback):withNativeArrayBuffer$1&&(packet.data instanceof ArrayBuffer||isView(packet.data))?callback(toArray(packet.data)):void encodePacket(packet,!1,(function(encoded){TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),callback(TEXT_ENCODER.encode(encoded))}))}for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup[chars.charCodeAt(i$1)]=i$1;var TEXT_DECODER,decode$1=function decode(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer},withNativeArrayBuffer="function"==typeof ArrayBuffer,decodePacket=function decodePacket(encodedPacket,binaryType){if("string"!=typeof encodedPacket)return{type:"message",data:mapBinary(encodedPacket,binaryType)};var type=encodedPacket.charAt(0);return"b"===type?{type:"message",data:decodeBase64Packet(encodedPacket.substring(1),binaryType)}:PACKET_TYPES_REVERSE[type]?encodedPacket.length>1?{type:PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:PACKET_TYPES_REVERSE[type]}:ERROR_PACKET},decodeBase64Packet=function decodeBase64Packet(data,binaryType){if(withNativeArrayBuffer){var decoded=decode$1(data);return mapBinary(decoded,binaryType)}return{base64:!0,data}},mapBinary=function mapBinary(data,binaryType){return"blob"===binaryType?data instanceof Blob?data:new Blob([data]):data instanceof ArrayBuffer?data:data.buffer},SEPARATOR=String.fromCharCode(30),encodePayload=function encodePayload(packets,callback){var length=packets.length,encodedPackets=new Array(length),count=0;packets.forEach((function(packet,i){encodePacket(packet,!1,(function(encodedPacket){encodedPackets[i]=encodedPacket,++count===length&&callback(encodedPackets.join(SEPARATOR))}))}))},decodePayload=function decodePayload(encodedPayload,binaryType){for(var encodedPackets=encodedPayload.split(SEPARATOR),packets=[],i=0;i<encodedPackets.length;i++){var decodedPacket=decodePacket(encodedPackets[i],binaryType);if(packets.push(decodedPacket),"error"===decodedPacket.type)break}return packets};function decodePacketFromBinary(data,isBinary,binaryType){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);var isPlainBinary=isBinary||data[0]<48||data[0]>54;return decodePacket(isPlainBinary?data:TEXT_DECODER.decode(data),binaryType)}var protocol=4;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var cb,callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return 0===callbacks.length&&delete this._callbacks["$"+event],this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};for(var args=new Array(arguments.length-1),callbacks=this._callbacks["$"+event],i=1;i<arguments.length;i++)args[i-1]=arguments[i];if(callbacks){i=0;for(var len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};var globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function pick(obj){for(var _len=arguments.length,attr=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)attr[_key-1]=arguments[_key];return attr.reduce((function(acc,k){return obj.hasOwnProperty(k)&&(acc[k]=obj[k]),acc}),{})}var NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(obj,opts){opts.useNativeTimers?(obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(obj.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),obj.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}var BASE64_OVERHEAD=1.33;function byteLength(obj){return"string"==typeof obj?utf8Length(obj):Math.ceil((obj.byteLength||obj.size)*BASE64_OVERHEAD)}function utf8Length(str){for(var c=0,length=0,i=0,l=str.length;i<l;i++)(c=str.charCodeAt(i))<128?length+=1:c<2048?length+=2:c<55296||c>=57344?length+=3:(i++,length+=4);return length}function encode$1(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str}function decode(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}var prev,TransportError=function(_Error){_inherits(TransportError,_Error);var _super=_createSuper(TransportError);function TransportError(reason,description,context){var _this;return _classCallCheck(this,TransportError),(_this=_super.call(this,reason)).description=description,_this.context=context,_this.type="TransportError",_this}return _createClass(TransportError)}(_wrapNativeSuper(Error)),Transport=function(_Emitter){_inherits(Transport,_Emitter);var _super2=_createSuper(Transport);function Transport(opts){var _this2;return _classCallCheck(this,Transport),(_this2=_super2.call(this)).writable=!1,installTimerFunctions(_assertThisInitialized(_this2),opts),_this2.opts=opts,_this2.query=opts.query,_this2.socket=opts.socket,_this2}return _createClass(Transport,[{key:"onError",value:function onError(reason,description,context){return _get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"error",new TransportError(reason,description,context)),this}},{key:"open",value:function open(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function send(packets){"open"===this.readyState&&this.write(packets)}},{key:"onOpen",value:function onOpen(){this.readyState="open",this.writable=!0,_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function onData(data){var packet=decodePacket(data,this.socket.binaryType);this.onPacket(packet)}},{key:"onPacket",value:function onPacket(packet){_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"packet",packet)}},{key:"onClose",value:function onClose(details){this.readyState="closed",_get(_getPrototypeOf(Transport.prototype),"emitReserved",this).call(this,"close",details)}},{key:"pause",value:function pause(onPause){}},{key:"createUri",value:function createUri(schema){var query=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return schema+"://"+this._hostname()+this._port()+this.opts.path+this._query(query)}},{key:"_hostname",value:function _hostname(){var hostname=this.opts.hostname;return-1===hostname.indexOf(":")?hostname:"["+hostname+"]"}},{key:"_port",value:function _port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function _query(query){var encodedQuery=encode$1(query);return encodedQuery.length?"?"+encodedQuery:""}}]),Transport}(Emitter),alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0;function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded,num=Math.floor(num/length)}while(num>0);return encoded}function yeast(){var now=encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;var value=!1;try{value="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){}var hasCORS=value;function XHR(opts){var xdomain=opts.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}if(!xdomain)try{return new(globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function createCookieJar(){}function empty(){}var hasXHR2=null!=new XHR({xdomain:!1}).responseType,Polling=function(_Transport){_inherits(Polling,_Transport);var _super=_createSuper(Polling);function Polling(opts){var _this;if(_classCallCheck(this,Polling),(_this=_super.call(this,opts)).polling=!1,"undefined"!=typeof location){var isSSL="https:"===location.protocol,port=location.port;port||(port=isSSL?"443":"80"),_this.xd="undefined"!=typeof location&&opts.hostname!==location.hostname||port!==opts.port}var forceBase64=opts&&opts.forceBase64;return _this.supportsBinary=hasXHR2&&!forceBase64,_this.opts.withCredentials&&(_this.cookieJar=createCookieJar()),_this}return _createClass(Polling,[{key:"name",get:function get(){return"polling"}},{key:"doOpen",value:function doOpen(){this.poll()}},{key:"pause",value:function pause(onPause){var _this2=this;this.readyState="pausing";var pause=function pause(){_this2.readyState="paused",onPause()};if(this.polling||!this.writable){var total=0;this.polling&&(total++,this.once("pollComplete",(function(){--total||pause()}))),this.writable||(total++,this.once("drain",(function(){--total||pause()})))}else pause()}},{key:"poll",value:function poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function onData(data){var _this3=this,callback=function callback(packet){if("opening"===_this3.readyState&&"open"===packet.type&&_this3.onOpen(),"close"===packet.type)return _this3.onClose({description:"transport closed by the server"}),!1;_this3.onPacket(packet)};decodePayload(data,this.socket.binaryType).forEach(callback),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function doClose(){var _this4=this,close=function close(){_this4.write([{type:"close"}])};"open"===this.readyState?close():this.once("open",close)}},{key:"write",value:function write(packets){var _this5=this;this.writable=!1,encodePayload(packets,(function(data){_this5.doWrite(data,(function(){_this5.writable=!0,_this5.emitReserved("drain")}))}))}},{key:"uri",value:function uri(){var schema=this.opts.secure?"https":"http",query=this.query||{};return!1!==this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||query.sid||(query.b64=1),this.createUri(schema,query)}},{key:"request",value:function request(){var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends(opts,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request(this.uri(),opts)}},{key:"doWrite",value:function doWrite(data,fn){var _this6=this,req=this.request({method:"POST",data});req.on("success",fn),req.on("error",(function(xhrStatus,context){_this6.onError("xhr post error",xhrStatus,context)}))}},{key:"doPoll",value:function doPoll(){var _this7=this,req=this.request();req.on("data",this.onData.bind(this)),req.on("error",(function(xhrStatus,context){_this7.onError("xhr poll error",xhrStatus,context)})),this.pollXhr=req}}]),Polling}(Transport),Request=function(_Emitter){_inherits(Request,_Emitter);var _super2=_createSuper(Request);function Request(uri,opts){var _this8;return _classCallCheck(this,Request),installTimerFunctions(_assertThisInitialized(_this8=_super2.call(this)),opts),_this8.opts=opts,_this8.method=opts.method||"GET",_this8.uri=uri,_this8.data=void 0!==opts.data?opts.data:null,_this8.create(),_this8}return _createClass(Request,[{key:"create",value:function create(){var _a,_this9=this,opts=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");opts.xdomain=!!this.opts.xd;var xhr=this.xhr=new XHR(opts);try{xhr.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.opts.extraHeaders[i])}catch(e){}if("POST"===this.method)try{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}null===(_a=this.opts.cookieJar)||void 0===_a||_a.addCookies(xhr),"withCredentials"in xhr&&(xhr.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(xhr.timeout=this.opts.requestTimeout),xhr.onreadystatechange=function(){var _a;3===xhr.readyState&&(null===(_a=_this9.opts.cookieJar)||void 0===_a||_a.parseCookies(xhr)),4===xhr.readyState&&(200===xhr.status||1223===xhr.status?_this9.onLoad():_this9.setTimeoutFn((function(){_this9.onError("number"==typeof xhr.status?xhr.status:0)}),0))},xhr.send(this.data)}catch(e){return void this.setTimeoutFn((function(){_this9.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}},{key:"onError",value:function onError(err){this.emitReserved("error",err,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function cleanup(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function onLoad(){var data=this.xhr.responseText;null!==data&&(this.emitReserved("data",data),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function abort(){this.cleanup()}}]),Request}(Emitter);function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}Request.requestsCount=0,Request.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",unloadHandler):"function"==typeof addEventListener&&addEventListener("onpagehide"in globalThisShim?"pagehide":"unload",unloadHandler,!1));var nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?function(cb){return Promise.resolve().then(cb)}:function(cb,setTimeoutFn){return setTimeoutFn(cb,0)},WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),WS=function(_Transport){_inherits(WS,_Transport);var _super=_createSuper(WS);function WS(opts){var _this;return _classCallCheck(this,WS),(_this=_super.call(this,opts)).supportsBinary=!opts.forceBase64,_this}return _createClass(WS,[{key:"name",get:function get(){return"websocket"}},{key:"doOpen",value:function doOpen(){if(this.check()){var uri=this.uri(),protocols=this.opts.protocols,opts=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?protocols?new WebSocket(uri,protocols):new WebSocket(uri):new WebSocket(uri,protocols,opts)}catch(err){return this.emitReserved("error",err)}this.ws.binaryType=this.socket.binaryType||defaultBinaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function addEventListeners(){var _this2=this;this.ws.onopen=function(){_this2.opts.autoUnref&&_this2.ws._socket.unref(),_this2.onOpen()},this.ws.onclose=function(closeEvent){return _this2.onClose({description:"websocket connection closed",context:closeEvent})},this.ws.onmessage=function(ev){return _this2.onData(ev.data)},this.ws.onerror=function(e){return _this2.onError("websocket error",e)}}},{key:"write",value:function write(packets){var _this3=this;this.writable=!1;for(var _loop=function _loop(){var packet=packets[i],lastPacket=i===packets.length-1;encodePacket(packet,_this3.supportsBinary,(function(data){try{usingBrowserWebSocket&&_this3.ws.send(data)}catch(e){}lastPacket&&nextTick((function(){_this3.writable=!0,_this3.emitReserved("drain")}),_this3.setTimeoutFn)}))},i=0;i<packets.length;i++)_loop()}},{key:"doClose",value:function doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function uri(){var schema=this.opts.secure?"wss":"ws",query=this.query||{};return this.opts.timestampRequests&&(query[this.opts.timestampParam]=yeast()),this.supportsBinary||(query.b64=1),this.createUri(schema,query)}},{key:"check",value:function check(){return!!WebSocket}}]),WS}(Transport);function shouldIncludeBinaryHeader(packet,encoded){return"message"===packet.type&&"string"!=typeof packet.data&&encoded[0]>=48&&encoded[0]<=54}var WT=function(_Transport){_inherits(WT,_Transport);var _super=_createSuper(WT);function WT(){return _classCallCheck(this,WT),_super.apply(this,arguments)}return _createClass(WT,[{key:"name",get:function get(){return"webtransport"}},{key:"doOpen",value:function doOpen(){var _this=this;"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){_this.onClose()})).catch((function(err){_this.onError("webtransport error",err)})),this.transport.ready.then((function(){_this.transport.createBidirectionalStream().then((function(stream){var binaryFlag,reader=stream.readable.getReader();_this.writer=stream.writable.getWriter();var read=function read(){reader.read().then((function(_ref){var done=_ref.done,value=_ref.value;done||(binaryFlag||1!==value.byteLength||54!==value[0]?(_this.onPacket(decodePacketFromBinary(value,binaryFlag,"arraybuffer")),binaryFlag=!1):binaryFlag=!0,read())})).catch((function(err){}))};read();var handshake=_this.query.sid?'0{"sid":"'.concat(_this.query.sid,'"}'):"0";_this.writer.write((new TextEncoder).encode(handshake)).then((function(){return _this.onOpen()}))}))})))}},{key:"write",value:function write(packets){var _this2=this;this.writable=!1;for(var _loop=function _loop(){var packet=packets[i],lastPacket=i===packets.length-1;encodePacketToBinary(packet,(function(data){shouldIncludeBinaryHeader(packet,data)&&_this2.writer.write(Uint8Array.of(54)),_this2.writer.write(data).then((function(){lastPacket&&nextTick((function(){_this2.writable=!0,_this2.emitReserved("drain")}),_this2.setTimeoutFn)}))}))},i=0;i<packets.length;i++)_loop()}},{key:"doClose",value:function doClose(){var _a;null===(_a=this.transport)||void 0===_a||_a.close()}}]),WT}(Transport),transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri.pathNames=pathNames(uri,uri.path),uri.queryKey=queryKey(uri,uri.query),uri}function pathNames(obj,path){var regx=/\/{2,9}/g,names=path.replace(regx,"/").split("/");return"/"!=path.slice(0,1)&&0!==path.length||names.splice(0,1),"/"==path.slice(-1)&&names.splice(names.length-1,1),names}function queryKey(uri,query){var data={};return query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function($0,$1,$2){$1&&(data[$1]=$2)})),data}var Socket=function(_Emitter){_inherits(Socket,_Emitter);var _super=_createSuper(Socket);function Socket(uri){var _this,opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,Socket),(_this=_super.call(this)).writeBuffer=[],uri&&"object"===_typeof(uri)&&(opts=uri,uri=null),uri?(uri=parse(uri),opts.hostname=uri.host,opts.secure="https"===uri.protocol||"wss"===uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=parse(opts.host).host),installTimerFunctions(_assertThisInitialized(_this),opts),_this.secure=null!=opts.secure?opts.secure:"undefined"!=typeof location&&"https:"===location.protocol,opts.hostname&&!opts.port&&(opts.port=_this.secure?"443":"80"),_this.hostname=opts.hostname||("undefined"!=typeof location?location.hostname:"localhost"),_this.port=opts.port||("undefined"!=typeof location&&location.port?location.port:_this.secure?"443":"80"),_this.transports=opts.transports||["polling","websocket","webtransport"],_this.writeBuffer=[],_this.prevBufferLen=0,_this.opts=_extends({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},opts),_this.opts.path=_this.opts.path.replace(/\/$/,"")+(_this.opts.addTrailingSlash?"/":""),"string"==typeof _this.opts.query&&(_this.opts.query=decode(_this.opts.query)),_this.id=null,_this.upgrades=null,_this.pingInterval=null,_this.pingTimeout=null,_this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(_this.opts.closeOnBeforeunload&&(_this.beforeunloadEventListener=function(){_this.transport&&(_this.transport.removeAllListeners(),_this.transport.close())},addEventListener("beforeunload",_this.beforeunloadEventListener,!1)),"localhost"!==_this.hostname&&(_this.offlineEventListener=function(){_this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",_this.offlineEventListener,!1))),_this.open(),_this}return _createClass(Socket,[{key:"createTransport",value:function createTransport(name){var query=_extends({},this.opts.query);query.EIO=protocol,query.transport=name,this.id&&(query.sid=this.id);var opts=_extends({},this.opts,{query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[name]);return new transports[name](opts)}},{key:"open",value:function open(){var transport,_this2=this;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))transport="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){_this2.emitReserved("error","No transports available")}),0);transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)}},{key:"setTransport",value:function setTransport(transport){var _this3=this;this.transport&&this.transport.removeAllListeners(),this.transport=transport,transport.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(reason){return _this3.onClose("transport close",reason)}))}},{key:"probe",value:function probe(name){var _this4=this,transport=this.createTransport(name),failed=!1;Socket.priorWebsocketSuccess=!1;var onTransportOpen=function onTransportOpen(){failed||(transport.send([{type:"ping",data:"probe"}]),transport.once("packet",(function(msg){if(!failed)if("pong"===msg.type&&"probe"===msg.data){if(_this4.upgrading=!0,_this4.emitReserved("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name,_this4.transport.pause((function(){failed||"closed"!==_this4.readyState&&(cleanup(),_this4.setTransport(transport),transport.send([{type:"upgrade"}]),_this4.emitReserved("upgrade",transport),transport=null,_this4.upgrading=!1,_this4.flush())}))}else{var err=new Error("probe error");err.transport=transport.name,_this4.emitReserved("upgradeError",err)}})))};function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}var onerror=function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),_this4.emitReserved("upgradeError",error)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!==transport.name&&freezeTransport()}var cleanup=function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),_this4.off("close",onclose),_this4.off("upgrading",onupgrade)};transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==name?this.setTimeoutFn((function(){failed||transport.open()}),200):transport.open()}},{key:"onOpen",value:function onOpen(){if(this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var i=0,l=this.upgrades.length;i<l;i++)this.probe(this.upgrades[i])}},{key:"onPacket",value:function onPacket(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",packet),this.emitReserved("heartbeat"),packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var err=new Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emitReserved("data",packet.data),this.emitReserved("message",packet.data)}}},{key:"onHandshake",value:function onHandshake(data){this.emitReserved("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.maxPayload=data.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function resetPingTimeout(){var _this5=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){_this5.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var packets=this.getWritablePackets();this.transport.send(packets),this.prevBufferLen=packets.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var payloadSize=1,i=0;i<this.writeBuffer.length;i++){var data=this.writeBuffer[i].data;if(data&&(payloadSize+=byteLength(data)),i>0&&payloadSize>this.maxPayload)return this.writeBuffer.slice(0,i);payloadSize+=2}return this.writeBuffer}},{key:"write",value:function write(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}},{key:"send",value:function send(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}},{key:"sendPacket",value:function sendPacket(type,data,options,fn){if("function"==typeof data&&(fn=data,data=void 0),"function"==typeof options&&(fn=options,options=null),"closing"!==this.readyState&&"closed"!==this.readyState){(options=options||{}).compress=!1!==options.compress;var packet={type,data,options};this.emitReserved("packetCreate",packet),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush()}}},{key:"close",value:function close(){var _this6=this,close=function close(){_this6.onClose("forced close"),_this6.transport.close()},cleanupAndClose=function cleanupAndClose(){_this6.off("upgrade",cleanupAndClose),_this6.off("upgradeError",cleanupAndClose),close()},waitForUpgrade=function waitForUpgrade(){_this6.once("upgrade",cleanupAndClose),_this6.once("upgradeError",cleanupAndClose)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){_this6.upgrading?waitForUpgrade():close()})):this.upgrading?waitForUpgrade():close()),this}},{key:"onError",value:function onError(err){Socket.priorWebsocketSuccess=!1,this.emitReserved("error",err),this.onClose("transport error",err)}},{key:"onClose",value:function onClose(reason,description){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",reason,description),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function filterUpgrades(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;i<j;i++)~this.transports.indexOf(upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}]),Socket}(Emitter);return Socket.protocol=protocol,function(uri,opts){return new Socket(uri,opts)}}();return eio}()}])},"../../node_modules/panoptes-client/lib/sugar.js":(module,__unused_webpack_exports,__webpack_require__)=>{var console=__webpack_require__("../../node_modules/console-browserify/index.js"),SugarClient=__webpack_require__("../../node_modules/panoptes-client/lib/SugarClient/client.js"),JSONAPIClient=__webpack_require__("../../node_modules/panoptes-client/lib/json-api-client/index.js"),auth=__webpack_require__("../../node_modules/panoptes-client/lib/auth.js"),config=__webpack_require__("../../node_modules/panoptes-client/lib/config.js");if("undefined"!=typeof navigator){SugarClient.Primus=__webpack_require__("../../node_modules/panoptes-client/lib/SugarClient/primus.js"),SugarClient.host=config.sugarHost;var sugarClient=new SugarClient,sugarApiClient=new JSONAPIClient(config.sugarHost,{"Content-Type":"application/json",Accept:"application/json"},{beforeEveryRequest:function(){return auth.checkBearerToken()}});auth.listen("refresh",(function(token){sugarClient.refreshToken(token)})),auth.listen("change",(function(){auth.checkCurrent().then((function(user){user?(sugarClient.userId=user.id,auth.checkBearerToken().then((function(token){sugarClient.refreshToken(token)}))):sugarClient.disconnect()})).catch((function(e){throw console.error(e),new Error("Failed to checkCurrent auth from sugar client")}))})),module.exports={sugarClient,sugarApiClient}}}}]);