"use strict";(self.webpackChunk_zooniverse_react_components=self.webpackChunk_zooniverse_react_components||[]).push([[1437],{"../lib-subject-viewers/dist/esm/VolumetricViewer/VolumetricPreview/index.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>VolumetricPreview});var prop_types=__webpack_require__("../../node_modules/prop-types/index.js"),react=__webpack_require__("../../node_modules/react/index.js"),Box=__webpack_require__("../../node_modules/grommet/es6/components/Box/Box.js"),three_core=__webpack_require__("../../node_modules/three/build/three.core.js"),three_module=__webpack_require__("../../node_modules/three/build/three.module.js"),_changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new three_core.RlV,_plane=new three_core.Zcv,TILT_LIMIT=Math.cos(70*three_core.cj9.DEG2RAD);class OrbitControls extends three_core.Qev{constructor(object,domElement){var offset,quat,quatInverse,lastPosition,lastQuaternion,lastTargetPosition,twoPI;super(),this.object=object,this.domElement=domElement,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new three_core.Pq0,this.cursor=new three_core.Pq0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:three_core.kBv.ROTATE,MIDDLE:three_core.kBv.DOLLY,RIGHT:three_core.kBv.PAN},this.touches={ONE:three_core.wtR.ROTATE,TWO:three_core.wtR.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return spherical.phi},this.getAzimuthalAngle=function(){return spherical.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(domElement){domElement.addEventListener("keydown",onKeyDown),this._domElementKeyEvents=domElement},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",onKeyDown),this._domElementKeyEvents=null},this.saveState=function(){scope.target0.copy(scope.target),scope.position0.copy(scope.object.position),scope.zoom0=scope.object.zoom},this.reset=function(){scope.target.copy(scope.target0),scope.object.position.copy(scope.position0),scope.object.zoom=scope.zoom0,scope.object.updateProjectionMatrix(),scope.dispatchEvent(_changeEvent),scope.update(),state=STATE.NONE},this.update=(offset=new three_core.Pq0,quat=(new three_core.PTz).setFromUnitVectors(object.up,new three_core.Pq0(0,1,0)),quatInverse=quat.clone().invert(),lastPosition=new three_core.Pq0,lastQuaternion=new three_core.PTz,lastTargetPosition=new three_core.Pq0,twoPI=2*Math.PI,function update(){var deltaTime=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,position=scope.object.position;offset.copy(position).sub(scope.target),offset.applyQuaternion(quat),spherical.setFromVector3(offset),scope.autoRotate&&state===STATE.NONE&&rotateLeft(function getAutoRotationAngle(deltaTime){return null!==deltaTime?2*Math.PI/60*scope.autoRotateSpeed*deltaTime:2*Math.PI/60/60*scope.autoRotateSpeed}(deltaTime)),scope.enableDamping?(spherical.theta+=sphericalDelta.theta*scope.dampingFactor,spherical.phi+=sphericalDelta.phi*scope.dampingFactor):(spherical.theta+=sphericalDelta.theta,spherical.phi+=sphericalDelta.phi);var min=scope.minAzimuthAngle,max=scope.maxAzimuthAngle;isFinite(min)&&isFinite(max)&&(min<-Math.PI?min+=twoPI:min>Math.PI&&(min-=twoPI),max<-Math.PI?max+=twoPI:max>Math.PI&&(max-=twoPI),spherical.theta=min<=max?Math.max(min,Math.min(max,spherical.theta)):spherical.theta>(min+max)/2?Math.max(min,spherical.theta):Math.min(max,spherical.theta)),spherical.phi=Math.max(scope.minPolarAngle,Math.min(scope.maxPolarAngle,spherical.phi)),spherical.makeSafe(),!0===scope.enableDamping?scope.target.addScaledVector(panOffset,scope.dampingFactor):scope.target.add(panOffset),scope.target.sub(scope.cursor),scope.target.clampLength(scope.minTargetRadius,scope.maxTargetRadius),scope.target.add(scope.cursor);var zoomChanged=!1;if(scope.zoomToCursor&&performCursorZoom||scope.object.isOrthographicCamera)spherical.radius=clampDistance(spherical.radius);else{var prevRadius=spherical.radius;spherical.radius=clampDistance(spherical.radius*scale),zoomChanged=prevRadius!=spherical.radius}if(offset.setFromSpherical(spherical),offset.applyQuaternion(quatInverse),position.copy(scope.target).add(offset),scope.object.lookAt(scope.target),!0===scope.enableDamping?(sphericalDelta.theta*=1-scope.dampingFactor,sphericalDelta.phi*=1-scope.dampingFactor,panOffset.multiplyScalar(1-scope.dampingFactor)):(sphericalDelta.set(0,0,0),panOffset.set(0,0,0)),scope.zoomToCursor&&performCursorZoom){var newRadius=null;if(scope.object.isPerspectiveCamera){var _prevRadius=offset.length(),radiusDelta=_prevRadius-(newRadius=clampDistance(_prevRadius*scale));scope.object.position.addScaledVector(dollyDirection,radiusDelta),scope.object.updateMatrixWorld(),zoomChanged=!!radiusDelta}else if(scope.object.isOrthographicCamera){var mouseBefore=new three_core.Pq0(mouse.x,mouse.y,0);mouseBefore.unproject(scope.object);var prevZoom=scope.object.zoom;scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/scale)),scope.object.updateProjectionMatrix(),zoomChanged=prevZoom!==scope.object.zoom;var mouseAfter=new three_core.Pq0(mouse.x,mouse.y,0);mouseAfter.unproject(scope.object),scope.object.position.sub(mouseAfter).add(mouseBefore),scope.object.updateMatrixWorld(),newRadius=offset.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),scope.zoomToCursor=!1;null!==newRadius&&(this.screenSpacePanning?scope.target.set(0,0,-1).transformDirection(scope.object.matrix).multiplyScalar(newRadius).add(scope.object.position):(_ray.origin.copy(scope.object.position),_ray.direction.set(0,0,-1).transformDirection(scope.object.matrix),Math.abs(scope.object.up.dot(_ray.direction))<TILT_LIMIT?object.lookAt(scope.target):(_plane.setFromNormalAndCoplanarPoint(scope.object.up,scope.target),_ray.intersectPlane(_plane,scope.target))))}else if(scope.object.isOrthographicCamera){var _prevZoom=scope.object.zoom;scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/scale)),_prevZoom!==scope.object.zoom&&(scope.object.updateProjectionMatrix(),zoomChanged=!0)}return scale=1,performCursorZoom=!1,!!(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS||lastTargetPosition.distanceToSquared(scope.target)>EPS)&&(scope.dispatchEvent(_changeEvent),lastPosition.copy(scope.object.position),lastQuaternion.copy(scope.object.quaternion),lastTargetPosition.copy(scope.target),!0)}),this.dispose=function(){scope.domElement.removeEventListener("contextmenu",onContextMenu),scope.domElement.removeEventListener("pointerdown",onPointerDown),scope.domElement.removeEventListener("pointercancel",onPointerUp),scope.domElement.removeEventListener("wheel",onMouseWheel),scope.domElement.removeEventListener("pointermove",onPointerMove),scope.domElement.removeEventListener("pointerup",onPointerUp),scope.domElement.getRootNode().removeEventListener("keydown",interceptControlDown,{capture:!0}),null!==scope._domElementKeyEvents&&(scope._domElementKeyEvents.removeEventListener("keydown",onKeyDown),scope._domElementKeyEvents=null)};var scope=this,STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},state=STATE.NONE,EPS=1e-6,spherical=new three_core.YHV,sphericalDelta=new three_core.YHV,scale=1,panOffset=new three_core.Pq0,rotateStart=new three_core.I9Y,rotateEnd=new three_core.I9Y,rotateDelta=new three_core.I9Y,panStart=new three_core.I9Y,panEnd=new three_core.I9Y,panDelta=new three_core.I9Y,dollyStart=new three_core.I9Y,dollyEnd=new three_core.I9Y,dollyDelta=new three_core.I9Y,dollyDirection=new three_core.Pq0,mouse=new three_core.I9Y,performCursorZoom=!1,pointers=[],pointerPositions={},controlActive=!1;function getZoomScale(delta){var normalizedDelta=Math.abs(.01*delta);return Math.pow(.95,scope.zoomSpeed*normalizedDelta)}function rotateLeft(angle){sphericalDelta.theta-=angle}function rotateUp(angle){sphericalDelta.phi-=angle}var v,panLeft=(v=new three_core.Pq0,function panLeft(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0),v.multiplyScalar(-distance),panOffset.add(v)}),panUp=function(){var v=new three_core.Pq0;return function panUp(distance,objectMatrix){!0===scope.screenSpacePanning?v.setFromMatrixColumn(objectMatrix,1):(v.setFromMatrixColumn(objectMatrix,0),v.crossVectors(scope.object.up,v)),v.multiplyScalar(distance),panOffset.add(v)}}(),pan=function(){var offset=new three_core.Pq0;return function pan(deltaX,deltaY){var element=scope.domElement;if(scope.object.isPerspectiveCamera){var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180),panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix),panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix)}else scope.object.isOrthographicCamera?(panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix),panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),scope.enablePan=!1)}}();function dollyOut(dollyScale){scope.object.isPerspectiveCamera||scope.object.isOrthographicCamera?scale/=dollyScale:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function dollyIn(dollyScale){scope.object.isPerspectiveCamera||scope.object.isOrthographicCamera?scale*=dollyScale:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function updateZoomParameters(x,y){if(scope.zoomToCursor){performCursorZoom=!0;var rect=scope.domElement.getBoundingClientRect(),dx=x-rect.left,dy=y-rect.top,w=rect.width,h=rect.height;mouse.x=dx/w*2-1,mouse.y=-dy/h*2+1,dollyDirection.set(mouse.x,mouse.y,1).unproject(scope.object).sub(scope.object.position).normalize()}}function clampDistance(dist){return Math.max(scope.minDistance,Math.min(scope.maxDistance,dist))}function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY)}function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY)}function handleTouchStartRotate(event){if(1===pointers.length)rotateStart.set(event.pageX,event.pageY);else{var position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);rotateStart.set(x,y)}}function handleTouchStartPan(event){if(1===pointers.length)panStart.set(event.pageX,event.pageY);else{var position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);panStart.set(x,y)}}function handleTouchStartDolly(event){var position=getSecondPointerPosition(event),dx=event.pageX-position.x,dy=event.pageY-position.y,distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance)}function handleTouchMoveRotate(event){if(1==pointers.length)rotateEnd.set(event.pageX,event.pageY);else{var position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);rotateEnd.set(x,y)}rotateDelta.subVectors(rotateEnd,rotateStart).multiplyScalar(scope.rotateSpeed);var element=scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientHeight),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight),rotateStart.copy(rotateEnd)}function handleTouchMovePan(event){if(1===pointers.length)panEnd.set(event.pageX,event.pageY);else{var position=getSecondPointerPosition(event),x=.5*(event.pageX+position.x),y=.5*(event.pageY+position.y);panEnd.set(x,y)}panDelta.subVectors(panEnd,panStart).multiplyScalar(scope.panSpeed),pan(panDelta.x,panDelta.y),panStart.copy(panEnd)}function handleTouchMoveDolly(event){var position=getSecondPointerPosition(event),dx=event.pageX-position.x,dy=event.pageY-position.y,distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance),dollyDelta.set(0,Math.pow(dollyEnd.y/dollyStart.y,scope.zoomSpeed)),dollyOut(dollyDelta.y),dollyStart.copy(dollyEnd),updateZoomParameters(.5*(event.pageX+position.x),.5*(event.pageY+position.y))}function onPointerDown(event){!1!==scope.enabled&&(0===pointers.length&&(scope.domElement.setPointerCapture(event.pointerId),scope.domElement.addEventListener("pointermove",onPointerMove),scope.domElement.addEventListener("pointerup",onPointerUp)),function isTrackingPointer(event){for(var i=0;i<pointers.length;i++)if(pointers[i]==event.pointerId)return!0;return!1}(event)||(!function addPointer(event){pointers.push(event.pointerId)}(event),"touch"===event.pointerType?onTouchStart(event):function onMouseDown(event){var mouseAction;switch(event.button){case 0:mouseAction=scope.mouseButtons.LEFT;break;case 1:mouseAction=scope.mouseButtons.MIDDLE;break;case 2:mouseAction=scope.mouseButtons.RIGHT;break;default:mouseAction=-1}switch(mouseAction){case three_core.kBv.DOLLY:if(!1===scope.enableZoom)return;!function handleMouseDownDolly(event){updateZoomParameters(event.clientX,event.clientX),dollyStart.set(event.clientX,event.clientY)}(event),state=STATE.DOLLY;break;case three_core.kBv.ROTATE:if(event.ctrlKey||event.metaKey||event.shiftKey){if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN}else{if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE}break;case three_core.kBv.PAN:if(event.ctrlKey||event.metaKey||event.shiftKey){if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE}else{if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN}break;default:state=STATE.NONE}state!==STATE.NONE&&scope.dispatchEvent(_startEvent)}(event)))}function onPointerMove(event){!1!==scope.enabled&&("touch"===event.pointerType?function onTouchMove(event){switch(trackPointer(event),state){case STATE.TOUCH_ROTATE:if(!1===scope.enableRotate)return;handleTouchMoveRotate(event),scope.update();break;case STATE.TOUCH_PAN:if(!1===scope.enablePan)return;handleTouchMovePan(event),scope.update();break;case STATE.TOUCH_DOLLY_PAN:if(!1===scope.enableZoom&&!1===scope.enablePan)return;!function handleTouchMoveDollyPan(event){scope.enableZoom&&handleTouchMoveDolly(event),scope.enablePan&&handleTouchMovePan(event)}(event),scope.update();break;case STATE.TOUCH_DOLLY_ROTATE:if(!1===scope.enableZoom&&!1===scope.enableRotate)return;!function handleTouchMoveDollyRotate(event){scope.enableZoom&&handleTouchMoveDolly(event),scope.enableRotate&&handleTouchMoveRotate(event)}(event),scope.update();break;default:state=STATE.NONE}}(event):function onMouseMove(event){switch(state){case STATE.ROTATE:if(!1===scope.enableRotate)return;!function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart).multiplyScalar(scope.rotateSpeed);var element=scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientHeight),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight),rotateStart.copy(rotateEnd),scope.update()}(event);break;case STATE.DOLLY:if(!1===scope.enableZoom)return;!function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),dollyDelta.y>0?dollyOut(getZoomScale(dollyDelta.y)):dollyDelta.y<0&&dollyIn(getZoomScale(dollyDelta.y)),dollyStart.copy(dollyEnd),scope.update()}(event);break;case STATE.PAN:if(!1===scope.enablePan)return;!function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY),panDelta.subVectors(panEnd,panStart).multiplyScalar(scope.panSpeed),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}(event)}}(event))}function onPointerUp(event){switch(function removePointer(event){delete pointerPositions[event.pointerId];for(var i=0;i<pointers.length;i++)if(pointers[i]==event.pointerId)return void pointers.splice(i,1)}(event),pointers.length){case 0:scope.domElement.releasePointerCapture(event.pointerId),scope.domElement.removeEventListener("pointermove",onPointerMove),scope.domElement.removeEventListener("pointerup",onPointerUp),scope.dispatchEvent(_endEvent),state=STATE.NONE;break;case 1:var pointerId=pointers[0],position=pointerPositions[pointerId];onTouchStart({pointerId,pageX:position.x,pageY:position.y})}}function onMouseWheel(event){!1!==scope.enabled&&!1!==scope.enableZoom&&state===STATE.NONE&&(event.preventDefault(),scope.dispatchEvent(_startEvent),function handleMouseWheel(event){updateZoomParameters(event.clientX,event.clientY),event.deltaY<0?dollyIn(getZoomScale(event.deltaY)):event.deltaY>0&&dollyOut(getZoomScale(event.deltaY)),scope.update()}(function customWheelEvent(event){var mode=event.deltaMode,newEvent={clientX:event.clientX,clientY:event.clientY,deltaY:event.deltaY};switch(mode){case 1:newEvent.deltaY*=16;break;case 2:newEvent.deltaY*=100}event.ctrlKey&&!controlActive&&(newEvent.deltaY*=10);return newEvent}(event)),scope.dispatchEvent(_endEvent))}function interceptControlDown(event){"Control"===event.key&&(controlActive=!0,scope.domElement.getRootNode().addEventListener("keyup",interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(event){"Control"===event.key&&(controlActive=!1,scope.domElement.getRootNode().removeEventListener("keyup",interceptControlUp,{passive:!0,capture:!0}))}function onKeyDown(event){!1!==scope.enabled&&!1!==scope.enablePan&&function handleKeyDown(event){var needsUpdate=!1;switch(event.code){case scope.keys.UP:event.ctrlKey||event.metaKey||event.shiftKey?rotateUp(2*Math.PI*scope.rotateSpeed/scope.domElement.clientHeight):pan(0,scope.keyPanSpeed),needsUpdate=!0;break;case scope.keys.BOTTOM:event.ctrlKey||event.metaKey||event.shiftKey?rotateUp(-2*Math.PI*scope.rotateSpeed/scope.domElement.clientHeight):pan(0,-scope.keyPanSpeed),needsUpdate=!0;break;case scope.keys.LEFT:event.ctrlKey||event.metaKey||event.shiftKey?rotateLeft(2*Math.PI*scope.rotateSpeed/scope.domElement.clientHeight):pan(scope.keyPanSpeed,0),needsUpdate=!0;break;case scope.keys.RIGHT:event.ctrlKey||event.metaKey||event.shiftKey?rotateLeft(-2*Math.PI*scope.rotateSpeed/scope.domElement.clientHeight):pan(-scope.keyPanSpeed,0),needsUpdate=!0}needsUpdate&&(event.preventDefault(),scope.update())}(event)}function onTouchStart(event){switch(trackPointer(event),pointers.length){case 1:switch(scope.touches.ONE){case three_core.wtR.ROTATE:if(!1===scope.enableRotate)return;handleTouchStartRotate(event),state=STATE.TOUCH_ROTATE;break;case three_core.wtR.PAN:if(!1===scope.enablePan)return;handleTouchStartPan(event),state=STATE.TOUCH_PAN;break;default:state=STATE.NONE}break;case 2:switch(scope.touches.TWO){case three_core.wtR.DOLLY_PAN:if(!1===scope.enableZoom&&!1===scope.enablePan)return;!function handleTouchStartDollyPan(event){scope.enableZoom&&handleTouchStartDolly(event),scope.enablePan&&handleTouchStartPan(event)}(event),state=STATE.TOUCH_DOLLY_PAN;break;case three_core.wtR.DOLLY_ROTATE:if(!1===scope.enableZoom&&!1===scope.enableRotate)return;!function handleTouchStartDollyRotate(event){scope.enableZoom&&handleTouchStartDolly(event),scope.enableRotate&&handleTouchStartRotate(event)}(event),state=STATE.TOUCH_DOLLY_ROTATE;break;default:state=STATE.NONE}break;default:state=STATE.NONE}state!==STATE.NONE&&scope.dispatchEvent(_startEvent)}function onContextMenu(event){!1!==scope.enabled&&event.preventDefault()}function trackPointer(event){var position=pointerPositions[event.pointerId];void 0===position&&(position=new three_core.I9Y,pointerPositions[event.pointerId]=position),position.set(event.pageX,event.pageY)}function getSecondPointerPosition(event){var pointerId=event.pointerId===pointers[0]?pointers[1]:pointers[0];return pointerPositions[pointerId]}scope.domElement.addEventListener("contextmenu",onContextMenu),scope.domElement.addEventListener("pointerdown",onPointerDown),scope.domElement.addEventListener("pointercancel",onPointerUp),scope.domElement.addEventListener("wheel",onMouseWheel,{passive:!1}),scope.domElement.getRootNode().addEventListener("keydown",interceptControlDown,{passive:!0,capture:!0}),this.update()}}var COLOR_HUES=[90,60,30,0,330,300,270,240,210,180,150,120],colors={canvas:{default:[],active:[],inactive:[]},three:{default:[],active:[],inactive:[]}},pixelToPercent=value=>"".concat(Math.round(value/255*100),"%");COLOR_HUES.forEach((hue,i)=>{colors.canvas.active[i]=[],colors.three.active[i]=[],colors.canvas.inactive[i]=[],colors.three.inactive[i]=[];for(var lightness=0;lightness<256;lightness++){var lightnessPercent=pixelToPercent(Math.floor(.75*lightness));if(0===i){var hslDefault="hsl(0, 0%, ".concat(lightnessPercent,")");colors.canvas.default[lightness]=hslDefault,colors.three.default[lightness]=new three_core.Q1f(hslDefault)}var hslActive="hsl(".concat(hue,", ").concat(100,"%, ").concat(lightnessPercent,")");colors.canvas.active[i][lightness]=hslActive,colors.three.active[i][lightness]=new three_core.Q1f(hslActive);var hslInactive="hsl(".concat(hue,", ").concat(45,"%, ").concat(lightnessPercent,")");colors.canvas.inactive[i][lightness]=hslInactive,colors.three.inactive[i][lightness]=new three_core.Q1f(hslInactive)}});var _templateObject,BinarySearch=_ref=>{var{data,left,right,value}=_ref;for(left=null!=left?left:0,right=null!=right?right:data.length-1;left<=right;){var mid=Math.floor((left+right)/2);if(data[mid]===value)return{index:mid,left,right};data[mid]<value?left=mid+1:right=mid-1}return{index:-1,left,right}},SortedSetIntersection=_ref2=>{var{sets}=_ref2,validSets=sets.filter(s=>null!=(null==s?void 0:s.data));if(0===validSets.length)return SortedSet({data:[]});for(var[firstSet,...restSets]=validSets.map(s=>s.data).sort((a,b)=>a.length-b.length),results=[],indexCurrent=0,indexMax=firstSet.length;indexCurrent<indexMax;){for(var currentValue=firstSet[indexCurrent],isIntersecting=!0,n=0;n<restSets.length;n++){var comparisonSet=restSets[n];if(-1===BinarySearch({data:comparisonSet,left:0,right:comparisonSet.length-1,value:currentValue}).index){isIntersecting=!1;break}}isIntersecting&&results.push(currentValue),indexCurrent++}return SortedSet({data:results})},SortedSetUnion=_ref3=>{var{sets}=_ref3,validSets=sets.filter(s=>null!=(null==s?void 0:s.data));if(0===validSets.length)return SortedSet({data:[]});var sortedSets=validSets.map(s=>s.data).sort((a,b)=>a.length-b.length),results=[],indexCurrent=[],indexMax=[];function isInRange(indexCurrent,indexMax){var inRange=!1;return indexCurrent.forEach((val,i)=>{val<=indexMax[i]&&(inRange=!0)}),inRange}sortedSets.forEach((set,i)=>{indexCurrent[i]=0,indexMax[i]=set.length-1});for(var matches=[],_loop=function _loop(){matches.length=0;var smallest=16777217;indexCurrent.forEach((val,i)=>{var value=sortedSets[i][val];value<smallest?(smallest=value,matches=[i]):value===smallest&&matches.push(i)}),matches.forEach(index=>{indexCurrent[index]++}),results.push(smallest)};isInRange(indexCurrent,indexMax);)_loop();return SortedSet({data:results})},SortedSet=function SortedSet(){var{data}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:[]};null===data&&(data=[]);var sortedSet={data,add:_ref4=>{var{value}=_ref4,{index,left}=BinarySearch({data,value});return-1!==index?{index,data}:(data.splice(left,0,value),{index:left,data})},has:_ref5=>{var{value}=_ref5,resp_index=BinarySearch({data,value}).index;return-1!==resp_index},intersection:_ref6=>{var{sets}=_ref6;return SortedSetIntersection({sets:[sortedSet,...sets]})},remove:_ref7=>{var{value}=_ref7;if(!Array.isArray(value)){var{index}=BinarySearch({data,value});return-1!==index&&data.splice(index,1),{index,data}}value.map(v=>sortedSet.remove({value:v}))},union:_ref8=>{var{sets}=_ref8;return SortedSetUnion({sets:[sortedSet,...sets]})}};return sortedSet},jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),AXIS_COLORS=[14965072,458358,2317823],Cube=_ref=>{var{annotations,tool,viewer,orbitControlsEnabled=!0}=_ref,NUM_MESH_POINTS=3*Math.pow(viewer.base,2)-3*viewer.base+1,canvasRef=(0,react.useRef)(null),meshPlaneSet=(0,react.useRef)(null),threeRef=(0,react.useRef)({}),animationFrameId=(0,react.useRef)(null);function animate(){if(threeRef.current.lastRender||0===threeRef.current.lastRender){var lastRender=Date.now()-threeRef.current.lastRender;animationFrameId.current=window.requestAnimationFrame(animate),lastRender>16.666666666666668&&(!function render(){if(!threeRef.current.raycaster||!threeRef.current.renderer)return;if(threeRef.current.raycaster.setFromCamera(threeRef.current.mouse,threeRef.current.camera),-1!==threeRef.current.isClicked){var button=threeRef.current.isClicked,shiftKey=threeRef.current.isShift,intersectionScene=threeRef.current.raycaster.intersectObject(threeRef.current.scene);if(threeRef.current.isClicked=-1,threeRef.current.isShift=!1,intersectionScene.length>0){var intersectingIndex=intersectionScene.findIndex(o=>0===o.object.name.indexOf("Annotation")||"plane"===o.object.name);if(-1===intersectingIndex)return;var point,_meshPlaneSet$current,iObj=intersectionScene[intersectingIndex];if("plane"===iObj.object.name)point=null===(_meshPlaneSet$current=meshPlaneSet.current)||void 0===_meshPlaneSet$current||null===(_meshPlaneSet$current=_meshPlaneSet$current.data)||void 0===_meshPlaneSet$current?void 0:_meshPlaneSet$current[iObj.instanceId];else 0===iObj.object.name.indexOf("Annotation")&&(point=annotations.annotations[iObj.object.annotationIndex].points.active[0]);if(!point)return;null!=tool&&tool.events.click&&tool.events.click({button,point,shiftKey})}}threeRef.current.renderer.render(threeRef.current.scene,threeRef.current.camera)}(),threeRef.current.lastRender=Date.now())}}function renderPlanePoints(){var _threeRef$current,_threeRef$current2;if(viewer&&!(viewer.base<=0)&&null!==(_threeRef$current=threeRef.current)&&void 0!==_threeRef$current&&_threeRef$current.meshPlane){var frames=viewer.planeFrameActive,sets=frames.map((frame,dimension)=>viewer.getPlaneSet({dimension,frame}));meshPlaneSet.current=SortedSetUnion({sets});var meshPlane=null===(_threeRef$current2=threeRef.current)||void 0===_threeRef$current2?void 0:_threeRef$current2.meshPlane;meshPlane&&(meshPlaneSet.current.data.forEach((point,index)=>{drawMeshPoint({mesh:meshPlane,meshPointIndex:index,point})}),function renderPlaneOutline(_ref2){var{frames}=_ref2,OUTLINE_MAX=viewer.base-.25,OUTLINE_MIN=-.75,planeOutlines=[[[frames[0],OUTLINE_MIN,OUTLINE_MIN],[frames[0],OUTLINE_MAX,OUTLINE_MIN],[frames[0],OUTLINE_MAX,OUTLINE_MAX],[frames[0],OUTLINE_MIN,OUTLINE_MAX],[frames[0],OUTLINE_MIN,OUTLINE_MIN]],[[OUTLINE_MAX,frames[1],OUTLINE_MAX],[OUTLINE_MAX,frames[1],OUTLINE_MIN],[OUTLINE_MIN,frames[1],OUTLINE_MIN],[OUTLINE_MIN,frames[1],OUTLINE_MAX],[OUTLINE_MAX,frames[1],OUTLINE_MAX]],[[OUTLINE_MAX,OUTLINE_MIN,frames[2]],[OUTLINE_MAX,OUTLINE_MAX,frames[2]],[OUTLINE_MIN,OUTLINE_MAX,frames[2]],[OUTLINE_MIN,OUTLINE_MIN,frames[2]],[OUTLINE_MAX,OUTLINE_MIN,frames[2]]]];planeOutlines.forEach((planeOutline,dimension)=>{var points=planeOutline.map(coors=>getPositionInSpace({coors})).map(pnt=>new three_core.Pq0(...pnt)),line=threeRef.current.scene.children.find(c=>c.name==="Line ".concat(dimension));if(line)return line.geometry.setFromPoints(points);var geometry=(new three_core.LoY).setFromPoints(points),material=new three_core.mrM({color:AXIS_COLORS[dimension]}),newLine=new three_core.N1A(geometry,material);newLine.name="Line ".concat(dimension),threeRef.current.scene.add(newLine)})}({frames}),meshPlane.instanceMatrix&&(meshPlane.instanceMatrix.needsUpdate=!0),meshPlane.instanceColor&&(meshPlane.instanceColor.needsUpdate=!0))}}function renderAnnotations(){for(var objsToRemove=[],i=0;i<threeRef.current.scene.children.length;i++){var obj=threeRef.current.scene.children[i];0===obj.name.indexOf("Annotation")&&objsToRemove.push(obj)}threeRef.current.scene.remove(...objsToRemove);for(var _i=0;_i<annotations.annotations.length;_i++){var annotation=annotations.annotations[_i];annotation.points.active.length>0&&addAnnotation({annotation,annotationIndex:_i})}}function addAnnotation(_ref3){var{annotation,annotationIndex}=_ref3,mesh=new three_core.ZLX(new three_core.iNn(1,1,1),new three_core.V9B({color:16777215}),annotation.points.all.data.length);annotation.points.all.data.forEach((point,pointIndex)=>{drawMeshPoint({annotationIndex,mesh,meshPointIndex:pointIndex,point})}),mesh.name=annotation.label,mesh.annotationIndex=annotationIndex,threeRef.current.scene.add(mesh),mesh.instanceMatrix.needsUpdate=!0}function drawMeshPoint(_ref4){var{annotationIndex=-1,mesh,meshPointIndex,point}=_ref4,isInactive=-1!==annotationIndex&&(null==annotations?void 0:annotations.config.activeAnnotation)!==annotationIndex,pointValue=viewer.getPointValue({point}),position=viewer.isPointInThreshold({point})?getPositionInSpace({coors:viewer.getPointCoordinates({point})}):[5e4,5e4,5e4];threeRef.current.matrix.setPosition(...position),mesh.setMatrixAt(meshPointIndex,threeRef.current.matrix),mesh.setColorAt(meshPointIndex,(_ref=>{var{annotationIndex=-1,isInactive=!1,isThree=!1,pointValue,threshold={min:5,max:255}}=_ref,ctx=isThree?"three":"canvas",type=-1===annotationIndex?"default":isInactive?"inactive":"active",annotationIndexMod=annotationIndex%COLOR_HUES.length,pointValueClamped=pointValue<threshold.min?threshold.min:pointValue>threshold.max?threshold.max:pointValue,pointValueScaled=Math.floor((pointValueClamped-threshold.min)*(255/(threshold.max-threshold.min)));return-1===annotationIndex?colors[ctx][type][pointValueScaled]:colors[ctx][type][annotationIndexMod][pointValueScaled]})({annotationIndex,isInactive,isThree:!0,pointValue,threshold:viewer.threshold}))}function getPositionInSpace(_ref5){var{coors}=_ref5,[x,y,z]=coors,numPointsAdjustment=viewer.base-1,positionOffset=numPointsAdjustment/2*-1;return[numPointsAdjustment+positionOffset-x,numPointsAdjustment+positionOffset-y,numPointsAdjustment+positionOffset-z]}function onMouseMove(e){if(canvasRef.current&&threeRef.current&&threeRef.current.mouse){var{height,left,top,width}=canvasRef.current.parentElement.getBoundingClientRect();threeRef.current.mouse.x=(e.clientX-left)/width*2-1,threeRef.current.mouse.y=1-(e.clientY-top)/height*2}}function resizeCube(){if(threeRef.current.camera){var{width}=canvasRef.current.parentElement.getBoundingClientRect();threeRef.current.camera.aspect=1,threeRef.current.camera.updateProjectionMatrix(),threeRef.current.renderer.setSize(width,width)}}return(0,react.useEffect)(()=>(function setupCube(){threeRef.current={canvas:null,camera:new three_core.ubm(100,1,.01,3e3),cubes:new three_core.B69,isShift:!1,isClicked:-1,lastRender:0,light:new three_core.dth(16777215,8947848,3),matrix:new three_core.kn4,mouse:new three_core.I9Y(1,1),mouseDown:0,meshPlane:new three_core.ZLX(new three_core.iNn(1,1,1),new three_core.V9B({color:16777215}),NUM_MESH_POINTS),orbit:null,raycaster:new three_core.tBo,renderer:null,scene:new three_core.Z58};var position=.66*viewer.base;threeRef.current.camera.position.set(position,position,position),threeRef.current.light.position.set(0,1,0),threeRef.current.meshPlane.name="plane",threeRef.current.scene.background=new three_core.Q1f(0),threeRef.current.scene.add(threeRef.current.light),threeRef.current.renderer=new three_module.JeP({context:null,canvas:canvasRef.current,preserveDrawingBuffer:!0}),threeRef.current.renderer.setPixelRatio(window.devicePixelRatio),resizeCube(),threeRef.current.orbit=new OrbitControls(threeRef.current.camera,threeRef.current.renderer.domElement),threeRef.current.orbit.target.set(0,0,0),threeRef.current.orbit.enableDamping=!1,threeRef.current.orbit.enableZoom=!1,threeRef.current.orbit.enablePan=!1,threeRef.current.orbit.enableRotate=orbitControlsEnabled,threeRef.current.orbit.update()}(),renderPlanePoints(),threeRef.current.scene.add(threeRef.current.meshPlane),annotations&&renderAnnotations(),animate(),resizeCube(),annotations&&(annotations.on("active:annotation",renderAnnotations),annotations.on("add:annotation",renderAnnotations),annotations.on("update:annotation",renderAnnotations)),viewer.on("change:dimension:frame",renderPlanePoints),viewer.on("change:threshold",renderPlanePoints),()=>{animationFrameId.current&&(window.cancelAnimationFrame(animationFrameId.current),animationFrameId.current=null),annotations&&(annotations.off("active:annotation",renderAnnotations),annotations.off("add:annotation",renderAnnotations),annotations.off("update:annotation",renderAnnotations)),viewer.off("change:dimension:frame",renderPlanePoints),viewer.off("change:threshold",renderPlanePoints),threeRef.current&&(threeRef.current.orbit&&threeRef.current.orbit.dispose(),threeRef.current.scene&&(threeRef.current.scene.traverse(object=>{object.geometry&&object.geometry.dispose(),object.material&&(Array.isArray(object.material)?object.material.forEach(material=>material.dispose()):object.material.dispose())}),threeRef.current.scene.clear()),threeRef.current.renderer&&threeRef.current.renderer.dispose(),threeRef.current={}),meshPlaneSet.current=null}),[]),(0,react.useLayoutEffect)(()=>(window.addEventListener("resize",resizeCube),window.addEventListener("mousemove",onMouseMove),()=>{window.removeEventListener("resize",resizeCube),window.removeEventListener("mousemove",onMouseMove)}),[]),(0,jsx_runtime.jsx)("canvas",{"data-testid":"cube",onPointerDown:function onPointerDown(){threeRef.current.mouseDown=Date.now()},onPointerUp:function onPointerUp(e){Date.now()-threeRef.current.mouseDown<250&&(e.shiftKey&&(threeRef.current.isShift=!0),threeRef.current.isClicked=e.button)},ref:canvasRef})};function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Cube.propTypes={annotations:prop_types.object,tool:prop_types.object,viewer:prop_types.object};var StyledBox=(0,__webpack_require__("../../node_modules/styled-components/dist/styled-components.browser.esm.js").default)(Box.a)(_templateObject||(_templateObject=function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n  background-color: #000000;\n  position: relative;\n  width: 100%;\n  margin-top: -50px;\n"]))),ComponentPreview=_ref=>{var{models}=_ref;return(0,jsx_runtime.jsx)(StyledBox,{className:"volume-cube",children:(0,jsx_runtime.jsx)(Cube,_objectSpread(_objectSpread({},models),{},{orbitControlsEnabled:!1}))})};ComponentPreview.propTypes={models:prop_types.object};var buffer=__webpack_require__("../../node_modules/buffer/index.js"),DEFAULT_HANDLER=()=>{};function VolumetricPreview(_ref){var{subject}=_ref,{data,loading,error}=(_ref=>{var{onError=DEFAULT_HANDLER,onReady=DEFAULT_HANDLER,subject}=_ref,[error,setError]=(0,react.useState)(),[data,setData]=(0,react.useState)();return(0,react.useEffect)(()=>{if(setData(null),setError(null),!subject)return setError("No subject found");if(null!=subject&&subject.subjectJSON)return setData(subject.subjectJSON);var jsonLocation=subject.locations.find(l=>"application"===l.type);if(!jsonLocation.url)return setError("No JSON url found for this subject");fetch(jsonLocation.url).then(res=>res.json()).then(json=>{setData(json.data),onReady()}).catch(err=>{setError(err),onError(err)})},[subject]),{data,loading:!data&&!error,error}})({subject}),[modelState,setModelState]=(0,react.useState)(null);return(0,react.useEffect)(()=>{if(data){var pointModel,state={viewer:(pointModel={base:0,baseFrames:[[],[],[]],baseFrameMod:[0,0,0],data:[],dimensions:["x","y","z"],planesAbsoluteSets:[[],[],[]],planeFrameActive:[0,0,0],points:[],threshold:{min:5,max:255},initialize:_ref=>{var{data}=_ref;pointModel.data=buffer.hp.from(data,"base64"),pointModel.base=Math.cbrt(pointModel.data.length),pointModel.baseFrameMod=[Math.pow(pointModel.base,2),pointModel.base,1],pointModel.planeFrameActive=[pointModel.base-1,pointModel.base-1,pointModel.base-1];for(var i=0,x=0;x<pointModel.base;x++)for(var y=0;y<pointModel.base;y++)for(var z=0;z<pointModel.base;z++){if(pointModel.points[i]=[pointModel.data[i],x,y,z,!0,-1],0===x&&(pointModel.baseFrames[0][z]||(pointModel.baseFrames[0][z]=[]),pointModel.baseFrames[0][z][y]=i),0===y){var yz=pointModel.base-1-z,yx=pointModel.base-1-x;pointModel.baseFrames[1][yx]||(pointModel.baseFrames[1][yx]=[]),pointModel.baseFrames[1][yx][yz]=i}if(0===z){var zx=pointModel.base-1-x;pointModel.baseFrames[2][zx]||(pointModel.baseFrames[2][zx]=[]),pointModel.baseFrames[2][zx][y]=i}pointModel.planesAbsoluteSets[0][x]||(pointModel.planesAbsoluteSets[0][x]=SortedSet({data:[]})),pointModel.planesAbsoluteSets[1][y]||(pointModel.planesAbsoluteSets[1][y]=SortedSet({data:[]})),pointModel.planesAbsoluteSets[2][z]||(pointModel.planesAbsoluteSets[2][z]=SortedSet({data:[]})),pointModel.planesAbsoluteSets[0][x].add({value:i}),pointModel.planesAbsoluteSets[1][y].add({value:i}),pointModel.planesAbsoluteSets[2][z].add({value:i}),i++}return pointModel},getDimensionLabel:_ref2=>{var{dimension=0}=_ref2;return pointModel.dimensions[dimension]},getPlaneFrame:_ref3=>{var{dimension=0,frame}=_ref3;frame=null!=frame?frame:pointModel.planeFrameActive[dimension];var baseFrame=pointModel.baseFrames[dimension];if(0===frame)return baseFrame;var offset=pointModel.baseFrameMod[dimension]*frame;return baseFrame.map(r=>r.map(p=>p+offset))},getPlaneFrameIndex:_ref4=>{var{dimension=0}=_ref4;return pointModel.planeFrameActive[dimension]},getPlaneSet:_ref5=>{var _dimensionSets$frame,{dimension=0,frame=0}=_ref5,dimensionSets=pointModel.planesAbsoluteSets[dimension];return!dimensionSets||frame<0||frame>=dimensionSets.length?SortedSet({data:[]}):null!==(_dimensionSets$frame=dimensionSets[frame])&&void 0!==_dimensionSets$frame?_dimensionSets$frame:SortedSet({data:[]})},getPointAnnotationIndex:_ref6=>{var{point}=_ref6;return null!=point&&pointModel.points[point]?pointModel.points[point][5]:-1},getPointCoordinates:_ref7=>{var{point}=_ref7;return null!=point&&pointModel.points[point]?pointModel.points[point].slice(1,4):[0,0,0]},getPointFromStructured:_ref8=>{var{point}=_ref8;if(!(point.indexOf(-1)>-1||point.indexOf(pointModel.base)>-1))return point.map((factor,dim)=>pointModel.baseFrameMod[dim]*factor).reduce((acc,val)=>acc+val,0)},getPointValue:_ref9=>{var{point}=_ref9;return null!=point&&pointModel.points[point]?pointModel.points[point][0]:0},isPointInThreshold:_ref0=>{var{point}=_ref0;return!(null==point||!pointModel.points[point])&&pointModel.points[point][4]},saveScreenshot:()=>{pointModel.publish("save:screenshot")},setPlaneFrameActive:_ref1=>{var{dimension,frame}=_ref1;pointModel.planeFrameActive[dimension]=frame,pointModel.publish("change:dimension-".concat(dimension,":frame"),{frame}),pointModel.publish("change:dimension:frame",{dimension,frame})},setPointsAnnotationIndex:_ref10=>{var{points,index}=_ref10;points.forEach(point=>{pointModel.points[point][5]=index})},setThreshold:_ref11=>{var{min,max}=_ref11;pointModel.threshold.min=min,pointModel.threshold.max=max,pointModel.points.forEach((point,i)=>{point[4]=min<=point[0]&&max>=point[0]}),pointModel.publish("change:threshold",{min,max})},dispose:()=>{pointModel.data=[],pointModel.points=[],pointModel.baseFrames=[[],[],[]],pointModel.planesAbsoluteSets=[[],[],[]],pointModel._listeners=[]},_listeners:[],publish:(eventName,data)=>{pointModel._listeners.forEach(listener=>{listener.eventName===eventName&&listener.cb(data)})},on:(eventName,cb)=>{pointModel._listeners.push({eventName,cb})},off:(eventName,cb)=>{var index=pointModel._listeners.findIndex(listener=>listener.eventName===eventName&&listener.cb===cb);index>-1&&pointModel._listeners.splice(index,1)}},pointModel)};state.viewer.initialize({data}),setModelState(state)}},[data]),loading?(0,jsx_runtime.jsx)("p",{children:"Loading..."}):error||null===data||null===modelState?(0,jsx_runtime.jsx)("p",{children:"Error"}):(0,jsx_runtime.jsx)(ComponentPreview,{"data-testid":"subject-viewer-volumetric",config:{},data,models:modelState})}VolumetricPreview.propTypes={subject:prop_types.object}}}]);